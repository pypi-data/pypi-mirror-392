[project]
name = "haolib"
version = "0.1.1"
description = "A Python utility library with common components for building applications in the HAO ecosystem"
readme = "README.md"
authors = [{ name = "Kamil Biktimirov" }]
keywords = ["backend", "utilities", "microservices", "observability"]
requires-python = ">=3.14"
dependencies = [
    "httpx>=0.28.1",
    "packaging>=25.0",
    "pydantic>=2.12.3",
    "pydantic-settings>=2.11.0",
    "pytest-timeout>=2.4.0",
    "uvloop>=0.21.0",
]
license = "MIT OR Apache-2.0"

[project.optional-dependencies]
dishka = ["dishka>=1.6.0"]
fastapi = ["fastapi>=0.120.1", "uvicorn>=0.35.0"]
sqlalchemy = ["sqlalchemy>=2.0.42"]
faststream = ["faststream>=0.5.48"]
redis = ["redis>=6.4.0"]
taskiq = ["taskiq>=0.11.19", "taskiq-redis>=1.1.2"]
fastmcp = ["fastmcp>=2.13.0.2"]
observability = [
    "sentry-sdk>=2.35.0",
    "opentelemetry-distro>=0.57b0",
    "opentelemetry-exporter-otlp-proto-grpc>=1.36.0",
    "opentelemetry-exporter-otlp-proto-http>=1.36.0",
    "opentelemetry-instrumentation>=0.57b0",
    "opentelemetry-instrumentation-fastapi>=0.57b0",
    "opentelemetry-instrumentation-faststream>=0.1.3",
    "opentelemetry-instrumentation-httpx>=0.57b0",
    "opentelemetry-instrumentation-logging>=0.57b0",
]
security = ["bcrypt>=4.3.0", "cryptography>=45.0.6", "pyjwt[crypto]>=2.10.1"]
s3 = ["aioboto3>=15.5.0"]


[tool.setuptools.package-data]
"haolib" = ["py.typed"]


[tool.ruff]
target-version = "py314"
line-length = 120

# Disable fix for unused imports (`F401`).
lint.unfixable = ["F401"]
lint.select = ["ALL"]
lint.ignore = [
    "D203",    #incorrect-blank-line-before-class
    "D213",    # multi-line-summary-second-line
    "TRY003",  # raise-vanilla-args
    "EM101",   # raw-string-in-exception
    "D107",    # undocumented-public-init
    "A002",    # builtin-argument-shadowing
    "D202",    # blank-line-after-function
    "D401",    # non-imperative-mood
    "G004",    # logging-f-string
    "ANN401",  # any-type
    "S101",    # assert
    "PT011",   # pytest-raises-too-broad
    "B024",    # abstract-base-class-without-abstract-method
    "EXE002",  # shebang-missing-executable-file
    "RUF001",  # ambiguous-unicode-character-string
    "BLE001",  # blind-except
    "ARG001",  # unused-function-argument
    "N818",    # error-suffix-on-exception-name
    "PLR0913", # too-many-arguments
    "TC001",   # typing-only-first-party-import
    "RUF012",  # mutable-class-default
    "COM812",  # missing-trailing-comma
    "FBT001",  # boolean-type-hint-positional-argument
    "FBT002",  # boolean-default-value-positional-argument
    "TC001",   # typing-only-first-party-import
    "TC002",   # typing-only-third-party-import
    "TC003",   # typing-only-standard-library-import
    "PLR0911", # too-many-return-statements
    "PLR0912", # too-many-branches
    "C901",    # complex-structure
]

[tool.ruff.lint.per-file-ignores]
"./tests/integration/s3/conftest.py" = ["ARG002", "EM102"]
"./tests/*" = ["SLF001"]


[tool.mypy]
python_version = "3.14"

[tool.pytest.ini_options]
timeout = 30
timeout_method = "thread"

[tool.coverage.run]
# We need *__dishka_factory* here to be excluded because it is a generated file by dishka.
omit = ["*/lib/*", "*__dishka_factory*", "app.py", "dependencies.py", "tests/*"]

[dependency-groups]
dev = [
    "aiosqlite>=0.21.0",
    "faststream[confluent]>=0.6.3",
    "httpx>=0.28.1",
    "mypy>=1.18.1",
    "psutil>=7.1.3",
    "pytest>=8.4.1",
    "pytest-asyncio>=1.1.0",
    "pytest-benchmark>=5.2.3",
    "pytest-cov>=6.2.1",
    "pytest-timeout>=2.3.1",
    "pytest-xdist>=3.8.0",
    "ruff>=0.12.9",
]
