<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_order_form" model="ir.ui.view">
        <field name="name">license_sale.view_order_form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_view_invoice']" position="before">
                <button
                    type="object"
                    name="action_view_license"
                    class="oe_stat_button"
                    icon="fa-key"
                    invisible="license_count == 0"
                    groups="license.group_user"
                >
                    <field name="license_count" widget="statinfo" string="Licenses" />
                </button>
            </xpath>

            <xpath
                expr="//field[@name='order_line']/list//field[@name='price_subtotal']"
                position="after"
            >
                <field name="license_refs" optional="hide" />
            </xpath>
        </field>
    </record>

    <record id="sale_order_line_view_form_editable" model="ir.ui.view">
        <field name="name">license_sale.sale_order_line_view_form_editable</field>
        <field name="model">sale.order.line</field>
        <field
            name="inherit_id"
            ref="sale_order_line_form_action.sale_order_line_view_form_editable"
        />
        <field name="arch" type="xml">
            <sheet position="before">
                <header>
                    <button
                        name="button_create_license"
                        string="Create License"
                        type="object"
                        icon="fa-key"
                    />
                </header>
            </sheet>
            <xpath expr="//group/group[2]" position="after">
                <field name="license_ids" widget="many2many">
                    <list>
                        <field name="name" />
                        <field name="client_order_ref" />
                        <field name="key" />
                        <field name="date_end" />
                        <field
                            name="state"
                            decoration-success="state in ['assigned', 'active']"
                            decoration-info="state == 'draft'"
                            decoration-danger="state in ['disabled']"
                            decoration-muted="state == 'closed'"
                            widget="badge"
                        />
                    </list>
                </field>
            </xpath>
        </field>
    </record>
</odoo>
