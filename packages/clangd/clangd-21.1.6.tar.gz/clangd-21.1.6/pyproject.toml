[build-system]
requires = ["scikit-build-core"]
build-backend = "scikit_build_core.build"

[project]
name = "clangd"
dynamic = ["version"]
authors = [
    {name = "LLVM team"},
    {name = "Dan Ilan"}
    ]
maintainers = [ {name = "Dan Ilan"} ]
license = "Apache-2.0 WITH LLVM-exception"
description = "binaries for clangd, a clang-based C++ language server (LSP)"
readme = "README.md"
keywords = [
    "clangd",
    "llvm",
    "clang",
    "lsp",
    "cpp",
    "c"
]
classifiers = [
        "Environment :: No Input/Output (Daemon)",
        "Intended Audience :: Developers",
        "Operating System :: OS Independent",
        "Programming Language :: C",
        "Programming Language :: C++",
        "Topic :: Software Development",
]

[tool.scikit-build.metadata.version]
provider = "scikit_build_core.metadata.regex"
regex = '^(?P<value>\d+\.\d+\.\d+(\.[1-9]\d*)?)'
input = "clangd_version.txt"

[project.urls]
Documentation = "https://clangd.llvm.org/"
Source = "https://github.com/jmpfar/clangd-wheel"

[dependency-groups]
test = [
    "pytest==9.0.0",
    "pytest-sugar==1.1.1",
    "pytest-timeout==2.4.0",
    "pylspclient==0.1.2",
    "PyYAML==6.0.3"
]
dev = [
    "ruff==0.14.4",
]

[project.scripts]
"clangd" = "clangd:clangd"

[tool.scikit-build]
wheel.packages = ["src/clangd"]
wheel.py-api = "py2.py3"
cmake.version = ">=3.16.0"
ninja.version = ">=1.10.0"
cmake.verbose = true
logging.level = "DEBUG"
wheel.exclude = ["*.h", "!clangd/data/lib/clang/**"]

[tool.pytest.ini_options]
log_cli = true
log_cli_level = "INFO"
log_cli_format = "%(asctime)s [%(levelname)s] (%(filename)s:%(lineno)s) %(message)s"
log_cli_date_format = "%Y-%m-%d %H:%M:%S"

[tool.cibuildwheel]
# Super-verbose output for debugging purpose
build-verbosity = 3
# Set CMAKE_GENERATOR env var which is respected by scikit-build-core to use Ninja on all platforms
environment = "CMAKE_GENERATOR=Ninja"

test-command = "pytest {package}/tests"
test-groups = ["test", "dev"]