---
device: Line 6 Helix Floor/LT/Rack
manufacturer: Line 6
version: 3.80
default_channel: 1
documentation: https://line6.com/support/manuals/helix
firmware_notes: |
  CRITICAL TIMING REQUIREMENTS:
  - Firmware 3.5x: 350ms delay required after PC messages before sending CC
  - Firmware 3.10+: CC69 (snapshot) messages are buffered during preset load
  - Firmware 3.80 (current): Stable but MIDI Clock Rx has known issues with preset changes

  SNAPSHOT COUNT: 8 snapshots per preset (values 0-7)
  PRESET CAPACITY: 1024 presets (8 setlists Ã— 128 presets)
  FOOTSWITCHES: 11 (FS1-5, FS7-11) - FS6 reserved for internal use
  EXPRESSION PEDALS: 3 (EXP1, EXP2, EXP3)

  For HX Edit communication and detailed specifications, see:
  https://line6.com/software/reaper-extension
---

# Import common Line 6 Helix family aliases
@import "devices/line6_common.mmd"

# ============================================
# HELIX-SPECIFIC FEATURES
# ============================================
#
# This library extends line6_common.mmd with Helix-specific features:
# - Bank Select (CC0/CC32) preset addressing
# - 8 snapshots (full range 0-7)
# - 3 expression pedals (EXP3 unique to Helix)
# - 11 footswitches
# - 5-pin DIN MIDI support
# - Command Center macros
#

# ============================================
# PRESET MANAGEMENT (HELIX-SPECIFIC)
# ============================================

# Setlist and Preset Selection
# Full Helix models use Bank Select (CC32) + Program Change for addressing
# CC32 values 0-7 select Setlists 1-8
# PC values 0-127 select Presets 1-128 within the active setlist

@alias helix_setlist cc.{ch}.32.{setlist:0-7} "Select setlist (0=Setlist 1...7=Setlist 8)"

@alias helix_preset pc.{ch}.{preset:0-127} "Select preset within current setlist (0=Preset 1...127=Preset 128)"

@alias helix_load {ch} {setlist} {preset} "Complete preset load: setlist + preset"
  # CRITICAL: This macro includes required timing for firmware 3.5x
  # For firmware 3.10+, the delays are conservative but safe
  # Bank MSB (for compatibility)
  - cc {ch}.0.{setlist}
  # Bank LSB - actual setlist selector
  - cc {ch}.32.{setlist}
  # Wait to ensure bank select processed
  [@]
  # Load preset
  - pc {ch}.{preset}
@end

@alias helix_load_snapshot {ch} {setlist} {preset} {snapshot:0-7} "Load preset and switch to specific snapshot"
  - cc {ch}.0.{setlist}
  - cc {ch}.32.{setlist}
  [@]
  - pc {ch}.{preset}
  # Note: In firmware 3.10+, CC69 is automatically buffered during preset load
  # For firmware 3.5x, you may need to add +350ms delay here manually
  [@]
  - cc {ch}.69.{snapshot}
@end

# ============================================
# SNAPSHOT CONTROL (HELIX: 8 SNAPSHOTS)
# ============================================

# Direct Snapshot Selection (0-7 for snapshots 1-8)
@alias helix_snapshot cc.{ch}.69.{snap:0-7} "Switch to snapshot (0=Snap1...7=Snap8)"

# Named snapshot shortcuts
@alias helix_snap_1 cc.{ch}.69.0 "Snapshot 1"
@alias helix_snap_2 cc.{ch}.69.1 "Snapshot 2"
@alias helix_snap_3 cc.{ch}.69.2 "Snapshot 3"
@alias helix_snap_4 cc.{ch}.69.3 "Snapshot 4"
@alias helix_snap_5 cc.{ch}.69.4 "Snapshot 5"
@alias helix_snap_6 cc.{ch}.69.5 "Snapshot 6"
@alias helix_snap_7 cc.{ch}.69.6 "Snapshot 7"
@alias helix_snap_8 cc.{ch}.69.7 "Snapshot 8"

# ============================================
# EXPRESSION PEDAL 3 (HELIX-SPECIFIC)
# ============================================

# Full Helix Floor/Rack models have 3 expression pedals (EXP3 is unique)
@alias helix_exp3 cc.{ch}.3.{value:0-127} "Emulate EXP 3 pedal position (Floor/Rack only)"

# Expression automation with modulation (EXP3)
@alias helix_exp3_swell {ch} {start_val:0-127} {end_val:0-127} "Smooth EXP3 swell with curve"
  - cc {ch}.3.curve({start_val}, {end_val}, ease-in-out)
@end

# ============================================
# COMMAND CENTER MACROS
# ============================================

# These macros simulate common Command Center operations
# Command Center allows Helix to send MIDI to external gear
# Instant commands (1-6) fire automatically on preset load

# Example: Switch amp channel and engage external delay on preset load
@alias helix_preset_with_amp_switch {ch} {setlist} {preset} {amp_channel} {delay_preset} "Load Helix preset and control external gear"
  # Load Helix preset
  - cc {ch}.32.{setlist}
  [@]
  - pc {ch}.{preset}

  # Wait for preset load (conservative timing for firmware 3.5x)
  [+350ms]

  # Switch external amp channel (example: Marshall JVM via MIDI)
  # Amp on channel {ch}+1 to avoid conflicts
  - pc {ch}.{amp_channel}

  # Engage external delay pedal (example: Strymon Timeline)
  # Timeline on channel {ch}+2
  - cc {ch}.71.127

  # Load delay preset
  - pc {ch}.{delay_preset}
@end

# Example: Snapshot change with external reverb mix adjustment
@alias helix_snapshot_with_reverb {ch} {snapshot:0-7} {reverb_mix:0-127} "Change snapshot and adjust external reverb"
  - cc {ch}.69.{snapshot}

  # External reverb (example: H90) on different channel
  # Adjust mix parameter
  [+50ms]
  - cc {ch}.84.{reverb_mix}
@end

# ============================================
# COMPLETE SONG SECTION MACRO
# ============================================

# This macro demonstrates a complete song section change
# Combines preset load, snapshot selection, and external gear control
@alias helix_song_section {ch} {section_preset} {snapshot:0-7} {tempo_bpm:40-300} "Complete song section: preset + snapshot + tempo"
  # Load the preset for this song section
  - pc {ch}.{section_preset}

  # Wait for preset load (firmware 3.10+ buffers CC69, but we wait anyway)
  [+350ms]

  # Switch to the appropriate snapshot (verse, chorus, bridge, etc.)
  - cc {ch}.69.{snapshot}

  # Set tempo via tap (requires conversion - send 4 taps at correct interval)
  # This is a simplified version - real implementation would calculate intervals
  [+100ms]
  - cc {ch}.64.127
  [+500ms]  # 120 BPM = 500ms per beat
  - cc {ch}.64.127
  [+500ms]
  - cc {ch}.64.127
  [+500ms]
  - cc {ch}.64.127
@end

# ============================================
# USAGE EXAMPLES AND NOTES
# ============================================

# Example 1: Simple preset change
# [00:00.000]
# - helix_load 1 0 5          // Load Setlist 1, Preset 6

# Example 2: Preset with specific snapshot
# [00:16.000]
# - helix_load_snapshot 1 0 5 2    // Load Setlist 1, Preset 6, Snapshot 3

# Example 3: Snapshot changes within a preset (verse, chorus, bridge)
# [00:00.000]
# - helix_load 1 0 5          // Load verse preset
# [00:16.000]
# - helix_snap_3              // Switch to chorus snapshot
# [00:32.000]
# - helix_snap_4              // Switch to bridge snapshot
# [00:48.000]
# - helix_snap_1              // Back to verse

# Example 4: Expression pedal automation (volume swell) - using modulation
# [00:00.000]
# - line6_exp_swell 1 1 0 127         // Smooth EXP1 swell with curve

# Example 5: Expression vibrato effect using wave modulation
# [00:04.000]
# - line6_exp_vibrato 1 1 64 2.5 20   // EXP1 vibrato: center=64, freq=2.5Hz, depth=20%

# Example 6: Toggle effects during performance
# [01:00.000]
# - line6_fs3 1               // Toggle FS3 (maybe a delay)
# [01:04.000]
# - line6_fs7 1               // Toggle FS7 (maybe a reverb)

# Example 7: Looper control sequence (using common library)
# [02:00.000]
# - line6_looper_start_recording 1    // Enter looper and start recording
# [02:08.000]
# - line6_looper_playback 1           // Switch to playback
# [02:16.000]
# - line6_looper_stop_exit 1          // Stop and exit

# ============================================
# FIRMWARE-SPECIFIC RECOMMENDATIONS
# ============================================

# FIRMWARE 3.5x (requires conservative timing):
#   - Add +350ms after ALL PC messages
#   - Add +100ms between rapid CC messages
#   - Use snapshot-based workflow within presets to avoid PC delays

# FIRMWARE 3.10+ (improved timing):
#   - CC69 (snapshot) is buffered during preset load
#   - Can reduce delays to +50ms in most cases
#   - Still recommend +350ms after PC for safety with complex presets

# FIRMWARE 3.80 (current, November 2024):
#   - Most stable version
#   - Known issue: MIDI Clock Rx doesn't apply on preset change
#   - Workaround: Use Tap Tempo (CC64) after preset changes if tempo sync critical

# ============================================
# RESERVED CC NUMBERS (HELIX-SPECIFIC)
# ============================================

# In addition to common reserved CCs (see line6_common.mmd):
# CC0   - Bank Select MSB
# CC3   - Expression Pedal 3 (Helix Floor/Rack only)
# CC32  - Bank Select LSB (Setlist selector)
# CC70-76 - Reserved for future use

# All other CC numbers (4-31, 33-48, 77-127) are available for:
# - Block bypass control (via MIDI Learn)
# - Parameter control (via MIDI Learn)
# - Custom assignments per preset

# ============================================
# TROUBLESHOOTING TIPS
# ============================================

# Issue: "Helix ignores my MIDI messages"
# Solution: Check for 350ms dead time after preset changes (firmware 3.5x)
#          Ensure MIDI Base Channel matches in Global Settings

# Issue: "Snapshots don't switch reliably"
# Solution: Use firmware 3.10+ for CC69 buffering
#          Add delay after PC if using older firmware

# Issue: "Footswitch toggles don't work as expected"
# Solution: Helix footswitches always TOGGLE, can't force on/off
#          Program controller to send toggle commands, not state commands

# Issue: "Expression pedal is glitchy"
# Solution: Ensure external controller sends smooth CC curves
#          Check for MIDI message rate limiting in controller

# Issue: "MIDI timing is sloppy"
# Solution: Use 5-pin DIN MIDI instead of USB for clock
#          Verify no MIDI feedback loops
#          Check for ground loops in power supply
