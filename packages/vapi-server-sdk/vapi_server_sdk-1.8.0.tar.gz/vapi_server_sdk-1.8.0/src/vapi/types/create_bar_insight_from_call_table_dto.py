# This file was auto-generated by Fern from our API Definition.

import typing

import pydantic
import typing_extensions
from ..core.pydantic_utilities import IS_PYDANTIC_V2
from ..core.serialization import FieldMetadata
from ..core.unchecked_base_model import UncheckedBaseModel
from .bar_insight_metadata import BarInsightMetadata
from .create_bar_insight_from_call_table_dto_group_by import CreateBarInsightFromCallTableDtoGroupBy
from .create_bar_insight_from_call_table_dto_queries_item import CreateBarInsightFromCallTableDtoQueriesItem
from .insight_formula import InsightFormula
from .insight_time_range_with_step import InsightTimeRangeWithStep


class CreateBarInsightFromCallTableDto(UncheckedBaseModel):
    name: typing.Optional[str] = pydantic.Field(default=None)
    """
    This is the name of the Insight.
    """

    type: typing.Literal["bar"] = "bar"
    formulas: typing.Optional[typing.List[InsightFormula]] = pydantic.Field(default=None)
    """
    Formulas are mathematical expressions applied on the data returned by the queries to transform them before being used to create the insight.
    The formulas needs to be a valid mathematical expression, supported by MathJS - https://mathjs.org/docs/expressions/syntax.html
    A formula is created by using the query names as the variable.
    The formulas must contain at least one query name in the LiquidJS format {{query_name}} or {{['query name']}} which will be substituted with the query result.
    For example, if you have 2 queries, 'Was Booking Made' and 'Average Call Duration', you can create a formula like this:
    ```
    {{['Query 1']}} / {{['Query 2']}} * 100
    ```
    
    ```
    ({{[Query 1]}} * 10) + {{[Query 2]}}
    ```
    This will take the
    
    You can also use the query names as the variable in the formula.
    """

    metadata: typing.Optional[BarInsightMetadata] = pydantic.Field(default=None)
    """
    This is the metadata for the insight.
    """

    time_range: typing_extensions.Annotated[
        typing.Optional[InsightTimeRangeWithStep], FieldMetadata(alias="timeRange")
    ] = None
    group_by: typing_extensions.Annotated[
        typing.Optional[CreateBarInsightFromCallTableDtoGroupBy], FieldMetadata(alias="groupBy")
    ] = pydantic.Field(default=None)
    """
    This is the group by column for the insight when table is `call`.
    These are the columns to group the results by.
    All results are grouped by the time range step by default.
    """

    queries: typing.List[CreateBarInsightFromCallTableDtoQueriesItem] = pydantic.Field()
    """
    These are the queries to run to generate the insight.
    """

    if IS_PYDANTIC_V2:
        model_config: typing.ClassVar[pydantic.ConfigDict] = pydantic.ConfigDict(extra="allow", frozen=True)  # type: ignore # Pydantic v2
    else:

        class Config:
            frozen = True
            smart_union = True
            extra = pydantic.Extra.allow
