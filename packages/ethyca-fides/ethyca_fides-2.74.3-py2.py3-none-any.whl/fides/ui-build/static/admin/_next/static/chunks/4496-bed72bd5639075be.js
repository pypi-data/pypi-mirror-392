(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4496],{12197:function(e){var t;t=function(){"use strict";var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(s,n,i){var a,l=function(e,s,n){void 0===n&&(n={});var i,a,l,r,o=new Date(e);return(void 0===(i=n)&&(i={}),(r=t[l=s+"|"+(a=i.timeZoneName||"short")])||(r=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:a}),t[l]=r),r).formatToParts(o)},r=function(t,s){for(var n=l(t,s),a=[],r=0;r<n.length;r+=1){var o=n[r],d=o.type,u=o.value,c=e[d];c>=0&&(a[c]=parseInt(u,10))}var m=a[3],f=a[0]+"-"+a[1]+"-"+a[2]+" "+(24===m?0:m)+":"+a[4]+":"+a[5]+":000",h=+t;return(i.utc(f).valueOf()-(h-=h%1e3))/6e4},o=n.prototype;o.tz=function(e,t){void 0===e&&(e=a);var s,n=this.utcOffset(),l=this.toDate(),r=l.toLocaleString("en-US",{timeZone:e}),o=Math.round((l-new Date(r))/1e3/60),d=-(15*Math.round(l.getTimezoneOffset()/15))-o;if(Number(d)){if(s=i(r,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(d,!0),t){var u=s.utcOffset();s=s.add(n-u,"minute")}}else s=this.utcOffset(0,t);return s.$x.$timezone=e,s},o.offsetName=function(e){var t=this.$x.$timezone||i.tz.guess(),s=l(this.valueOf(),t,{timeZoneName:e}).find(function(e){return"timezonename"===e.type.toLowerCase()});return s&&s.value};var d=o.startOf;o.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return d.call(this,e,t);var s=i(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return d.call(s,e,t).tz(this.$x.$timezone,!0)},i.tz=function(e,t,s){var n=s&&t,l=s||t||a,o=r(+i(),l);if("string"!=typeof e)return i(e).tz(l);var d=function(e,t,s){var n=e-60*t*1e3,i=r(n,s);if(t===i)return[n,t];var a=r(n-=60*(i-t)*1e3,s);return i===a?[n,i]:[e-60*Math.min(i,a)*1e3,Math.max(i,a)]}(i.utc(e,n).valueOf(),o,l),u=d[0],c=d[1],m=i(u).utcOffset(c);return m.$x.$timezone=l,m},i.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},i.tz.setDefault=function(e){a=e}}},e.exports=t()},4496:function(e,t,s){"use strict";s.d(t,{Z:function(){return w}});var n=s(24246),i=s(98227),a=s(86677),l=s(27378),r=s(812),o=s(58452),d=s(77830),u=s(19904),c=s(65735),m=s(35493),f=s(40822),h=s(54458),g=s(27693),p=s.n(g),y=s(12197),x=s.n(y),v=s(96600),j=s.n(v),D=s(81179);p().extend(j()),p().extend(x());let{Text:S}=i.AntTypography,N="09:00",_=D.eO.MONDAY,b=[{label:"Daily",value:D.Di.DAILY},{label:"Weekly",value:D.Di.WEEKLY},{label:"Weekdays",value:D.Di.WEEKDAYS},{label:"Monthly",value:D.Di.MONTHLY}];var T=e=>{let{value:t,onChange:s,onTimezoneChange:a,timezone:r}=e,[o,d]=(0,l.useState)(D.Di.WEEKLY),[u,c]=(0,l.useState)(1),[m,f]=(0,l.useState)(!1),g=(0,l.useRef)(!1),y=p().tz.guess(),x=r||y,v=(0,l.useMemo)(()=>{let e=new Date,t=(0,h.WU)(e,"O",{timeZone:x}),s=x.split("/");return{cityName:s[s.length-1].replace(/_/g," "),gmtOffset:t}},[x]);(0,l.useEffect)(()=>{r||null==a||a(y)},[y,a,r]),(0,l.useEffect)(()=>{if(t&&!g.current){let e=(0,D.se)(t);e?(f(!1),d(e.frequency),void 0!==e.dayOfMonth&&c(e.dayOfMonth)):f(!0),g.current=!0}},[t]),(0,l.useEffect)(()=>{let e={frequency:o,time:N,...o===D.Di.WEEKLY&&{dayOfWeek:_},...o===D.Di.MONTHLY&&{dayOfMonth:u}};try{let t=(0,D.Ns)(e);null==s||s(t)}catch(e){console.error("Error generating cron expression:",e)}},[o,u,s]);let j={frequency:o,time:N,...o===D.Di.WEEKLY&&{dayOfWeek:_},...o===D.Di.MONTHLY&&{dayOfMonth:u}};return(0,n.jsxs)(i.vyj,{direction:"vertical",size:"middle",className:"w-full",children:[m&&(0,n.jsx)(i.DUx,{message:"Custom Cron Expression",description:"This digest uses a custom cron expression that cannot be edited with the picker. Changing the schedule will replace the custom expression.",type:"warning",closable:!0,onClose:()=>f(!1)}),(0,n.jsxs)("div",{children:[(0,n.jsx)(S,{strong:!0,className:"mb-1 block",children:"Frequency"}),(0,n.jsx)(i.WPr,{value:o,onChange:d,options:b,"data-testid":"select-frequency",className:"w-full",id:"select-frequency","aria-label":"Frequency"})]}),o===D.Di.MONTHLY&&(0,n.jsxs)("div",{children:[(0,n.jsx)(S,{strong:!0,className:"mb-1 block",children:"Day of Month"}),(0,n.jsx)(i.W7D,{value:u,onChange:e=>{null!==e&&(0,D.Ch)(e)&&c(e)},min:1,max:31,"data-testid":"input-day-of-month",className:"w-full"}),u>28&&(0,n.jsx)(S,{type:"secondary",className:"mt-1 block text-xs",children:"Note: Days 29-31 will not trigger in all months"})]}),(0,n.jsx)("div",{className:"rounded-md bg-gray-50 p-3",children:(0,n.jsxs)(S,{type:"secondary",className:"text-xs",children:["Schedule: ",(0,D.qV)(j)," ",v.cityName," (",v.gmtOffset,")"]})})]})},P=e=>{let{isOpen:t,onClose:s,digestConfigId:a,digestType:l}=e,[o]=i.PPS.useForm(),[d,u]=i.Pg3.useMessage(),[c,{isLoading:m}]=(0,f.ch)(),h=async e=>{let t=await c({digest_config_id:a,digest_config_type:l,test_email:e.email});if((0,r.D4)(t)){d.error((0,r.e$)(t.error));return}d.success("Test email sent to ".concat(e.email)),o.resetFields(),s()},g=()=>{o.resetFields(),s()};return(0,n.jsxs)(i.$zI,{title:"Send Test Email",open:t,onCancel:g,footer:null,destroyOnClose:!0,children:[u,(0,n.jsxs)(i.PPS,{form:o,layout:"vertical",onFinish:h,initialValues:{email:""},children:[(0,n.jsx)(i.PPS.Item,{label:"Email Address",name:"email",rules:[{required:!0,message:"Please enter an email address"},{type:"email",message:"Please enter a valid email address"}],children:(0,n.jsx)(i.AntInput,{type:"email",placeholder:"user@example.com","data-testid":"test-email-input"})}),(0,n.jsx)(i.PPS.Item,{children:(0,n.jsxs)(i.vyj,{className:"w-full justify-end",children:[(0,n.jsx)(i.wpx,{onClick:g,"data-testid":"cancel-test-btn",children:"Cancel"}),(0,n.jsx)(i.wpx,{type:"primary",htmlType:"submit",loading:m,"data-testid":"send-test-btn",children:"Send Test"})]})})]})]})},w=e=>{let{initialValues:t,isLoading:s}=e,[h]=i.PPS.useForm(),g=(0,a.useRouter)(),[p,y]=i.Pg3.useMessage(),[x,v]=(0,l.useState)(!1),[j,D]=(0,l.useState)(!1),[S,N]=(0,l.useState)((null==t?void 0:t.timezone)||m.EW),[_,{isLoading:b}]=(0,f.m1)(),[w,{isLoading:A}]=(0,f.zb)(),[M]=(0,f.yG)(),O=!!(null==t?void 0:t.id),C=(0,u.Tg)([c.Sh.DIGEST_CONFIG_DELETE])&&O,E=async()=>{let e=await M({config_id:null==t?void 0:t.id,digest_config_type:c.tB.MANUAL_TASKS});if((0,r.D4)(e)){p.error((0,r.e$)(e.error)),D(!1);return}p.success("Digest configuration deleted successfully",void 0,()=>{g.push(d.DN)})},L=async e=>{var s;let{id:n,...i}=e,a={...i,messaging_service_type:i.messaging_service_type||c.qr.EMAIL,enabled:null===(s=null==t?void 0:t.enabled)||void 0===s||s,timezone:S};if(O&&n){let e=await w({config_id:n,digest_config_type:c.tB.MANUAL_TASKS,data:a});if((0,r.D4)(e)){p.error((0,r.e$)(e.error));return}p.success({content:"Digest configuration updated successfully",duration:3}),setTimeout(()=>{g.push(d.DN)},500)}else{let e=await _({digest_config_type:c.tB.MANUAL_TASKS,data:a});if((0,r.D4)(e)){p.error((0,r.e$)(e.error));return}p.success({content:"Digest configuration created successfully",duration:3}),setTimeout(()=>{g.push(d.DN)},500)}},z=t||{name:"",digest_type:c.tB.MANUAL_TASKS,messaging_service_type:c.qr.EMAIL,cron_expression:m.by,timezone:m.EW,config_metadata:null};return s?(0,n.jsx)("div",{children:"Loading..."}):(0,n.jsxs)(n.Fragment,{children:[y,(0,n.jsxs)(i.PPS,{form:h,layout:"vertical",initialValues:z,onFinish:L,className:"max-w-2xl",children:[(0,n.jsx)(i.PPS.Item,{label:"Digest Type",name:"digest_type",tooltip:"Type of content this digest will contain",children:(0,n.jsx)(i.WPr,{disabled:!0,options:[{label:"Manual Tasks",value:c.tB.MANUAL_TASKS}],"data-testid":"select-digest-type","aria-label":"Digest Type"})}),(0,n.jsx)(i.PPS.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please enter a name"}],tooltip:"A descriptive name for this digest configuration",children:(0,n.jsx)(i.AntInput,{"data-testid":"input-name",placeholder:"e.g., Weekly Manual Tasks Summary"})}),(0,n.jsx)(i.PPS.Item,{name:"id",hidden:!0,children:(0,n.jsx)(i.AntInput,{})}),(0,n.jsx)(i.PPS.Item,{name:"messaging_service_type",hidden:!0,children:(0,n.jsx)(i.AntInput,{})}),(0,n.jsx)(i.PPS.Item,{name:"cron_expression",rules:[{required:!0,message:"Please configure a schedule"}],tooltip:"Configure when the digest should be sent",children:(0,n.jsx)(T,{onTimezoneChange:N,timezone:null==t?void 0:t.timezone})}),(0,n.jsx)(i.PPS.Item,{children:(0,n.jsxs)(i.vyj,{className:"w-full justify-between",children:[(0,n.jsxs)(i.vyj,{children:[O&&(0,n.jsx)(i.wpx,{onClick:()=>v(!0),"data-testid":"test-email-btn",children:"Send test"}),C&&(0,n.jsx)(i.wpx,{danger:!0,onClick:()=>{D(!0)},"data-testid":"delete-btn",children:"Delete"})]}),(0,n.jsxs)(i.vyj,{children:[(0,n.jsx)(i.wpx,{onClick:()=>g.push(d.DN),"data-testid":"cancel-btn",children:"Cancel"}),(0,n.jsx)(i.wpx,{type:"primary",htmlType:"submit",loading:b||A,"data-testid":"submit-btn",children:O?"Update":"Create"})]})]})})]}),O&&(null==t?void 0:t.id)&&(0,n.jsx)(P,{isOpen:x,onClose:()=>v(!1),digestConfigId:t.id,digestType:c.tB.MANUAL_TASKS}),(0,n.jsx)(o.Z,{isOpen:j,onClose:()=>{D(!1)},onConfirm:E,title:"Delete digest configuration",message:(0,n.jsxs)("span",{className:"text-gray-500",children:['Are you sure you want to delete the digest "',null==t?void 0:t.name,'"? This action cannot be undone.']}),continueButtonText:"Delete",isCentered:!0,icon:(0,n.jsx)(i.aNP,{})})]})}}}]);