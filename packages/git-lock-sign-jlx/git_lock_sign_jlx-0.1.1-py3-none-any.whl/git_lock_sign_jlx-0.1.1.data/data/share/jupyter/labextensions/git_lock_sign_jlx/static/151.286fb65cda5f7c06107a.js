"use strict";(self.webpackChunkgit_lock_sign_jlx=self.webpackChunkgit_lock_sign_jlx||[]).push([[151],{151:(e,i,t)=>{t.r(i),t.d(i,{SessionManager:()=>a});var s=t(256);class a{constructor(e,i){this._isInitializing=!1,this._overlayWidget=null,this._serviceManager=e,this._fileBrowser=i}_showOverlay(e){}_hideOverlay(){this._overlayWidget&&(s.Widget.detach(this._overlayWidget),this._overlayWidget.dispose(),this._overlayWidget=null)}_updateOverlayMessage(e){}async initializeSession(){if(this._isInitializing)return{success:!1,error:"Session initialization already in progress"};this._isInitializing=!0;try{let e;this._showOverlay("Initializing workspace session..."),this._updateOverlayMessage("Determining workspace directory..."),await this._delay(500);try{const{gitLockSignAPI:i}=await Promise.resolve().then(t.bind(t,446)),s=await i.getWorkingDirectory();e=s.success&&s.working_directory?s.working_directory:"."}catch(i){console.warn("âš ï¸ Could not determine workspace dynamically, using current directory fallback"),e="."}this._updateOverlayMessage("Setting up git repository and connecting to remote..."),await this._delay(500);const{gitLockSignAPI:i}=await Promise.resolve().then(t.bind(t,446)),s=await this._checkWorkSubdirectoryNavigation(e);this._refreshFileBrowser().catch(e=>{});const a=await i.initializeSession(e);if(a.success){this._updateOverlayMessage("Session initialization completed successfully!"),await this._delay(1e3),console.log("âœ… Workspace session initialized successfully"),s&&(this._updateOverlayMessage("Navigating to work directory..."),await this._navigateToWorkDirectory(e),await this._delay(500)),this._updateOverlayMessage("Refreshing file browser...");try{await this._refreshFileBrowser(),this._updateOverlayMessage("Ensuring files are visible..."),await this._delay(800),await this._refreshFileBrowser(),this._updateOverlayMessage("Files updated successfully!"),await this._delay(1200)}catch(e){console.warn("âš ï¸ File browser refresh had issues:",e),this._updateOverlayMessage("Sync completed - refreshing files...");try{await this._refreshFileBrowser()}catch(e){}await this._delay(1e3)}}else this._updateOverlayMessage("Session initialization completed with warnings"),await this._delay(1e3),console.warn("âš ï¸ Session initialization completed with warnings:",a.error);return a}catch(e){return this._updateOverlayMessage("Session initialization failed"),await this._delay(1e3),console.error("âŒ Session initialization error:",e),{success:!1,error:`Session initialization failed: ${e}`}}finally{this._isInitializing=!1,this._hideOverlay(),setTimeout(async()=>{try{await this._refreshFileBrowser(),setTimeout(async()=>{try{await this._refreshFileBrowser()}catch(e){}},1e3)}catch(e){}},500)}}async validateSync(e){try{this._showOverlay("Validating sync operation...");const{gitLockSignAPI:i}=await Promise.resolve().then(t.bind(t,446)),s=await i.validateSync(e);return s.success?(this._updateOverlayMessage("Sync validation completed successfully!"),await this._delay(1e3),console.log("âœ… Sync validation completed successfully"),(s.warnings.length>0||s.critical_issues.length>0)&&(this._updateOverlayMessage(`Validation completed with ${s.warnings.length} warnings and ${s.critical_issues.length} critical issues`),await this._delay(2e3))):(this._updateOverlayMessage("Sync validation failed"),await this._delay(1e3),console.error("âŒ Sync validation failed:",s.error)),s}catch(e){return this._updateOverlayMessage("Sync validation failed"),await this._delay(1e3),console.error("âŒ Sync validation error:",e),{success:!1,error:`Sync validation failed: ${e}`,warnings:[],critical_issues:[],recommendations:[]}}finally{this._hideOverlay()}}get isInitializing(){return this._isInitializing}async _delay(e){return new Promise(i=>setTimeout(i,e))}async _refreshFileBrowser(){let e=!1;for(let i=1;i<=3;i++)try{await this._fileBrowser.model.refresh(),e=!0;break}catch(e){i<3&&await this._delay(200*i)}if(!e)try{await this._serviceManager.contents.get(".",{content:!0}),e=!0}catch(e){}}async _checkWorkSubdirectoryNavigation(e){try{console.log("ðŸ” [SESSION-MANAGER] Checking if work subdirectory navigation is needed...");const{gitLockSignAPI:i}=await Promise.resolve().then(t.bind(t,446)),s=await i.getWorkingDirectory();if(s.success&&s.working_directory){const i=s.working_directory,t=i.endsWith("/work")&&i.startsWith(e);return console.log(`ðŸ“ [SESSION-MANAGER] Base workspace: ${e}`),console.log(`ðŸ“ [SESSION-MANAGER] Working directory: ${i}`),console.log(`ðŸ” [SESSION-MANAGER] Work subdirectory navigation needed: ${t}`),t}return console.log("âš ï¸ [SESSION-MANAGER] Could not determine working directory, skipping navigation"),!1}catch(e){return console.warn("âš ï¸ [SESSION-MANAGER] Error checking work subdirectory navigation:",e),!1}}async _navigateToWorkDirectory(e){try{console.log("ðŸš€ [SESSION-MANAGER] Navigating to work subdirectory...");const e="work";console.log(`ðŸ“ [SESSION-MANAGER] Navigating file browser to: ${e}`),await this._fileBrowser.model.cd(e),console.log("âœ… [SESSION-MANAGER] Successfully navigated to work directory"),await this._fileBrowser.model.refresh(),console.log("âœ… [SESSION-MANAGER] File browser refreshed in work directory")}catch(e){console.error("âŒ [SESSION-MANAGER] Failed to navigate to work directory:",e);try{console.log("ðŸ”„ [SESSION-MANAGER] Attempting alternative navigation method..."),"directory"===(await this._serviceManager.contents.get("work",{content:!0})).type&&(await this._fileBrowser.model.cd("work"),console.log("âœ… [SESSION-MANAGER] Alternative navigation successful"))}catch(e){console.error("âŒ [SESSION-MANAGER] Alternative navigation also failed:",e)}}}dispose(){this._hideOverlay(),this._isInitializing=!1}}}}]);