var pe=Object.defineProperty;var m=(o,e)=>pe(o,"name",{value:e,configurable:!0});import{computed as p,defineComponent as I,mergeModels as T,useModel as U,openBlock as v,createBlock as B,withCtx as X,createVNode as F,unref as S,mergeProps as _,createElementBlock as k,normalizeClass as C,createElementVNode as x,toDisplayString as K,createCommentVNode as j,useTemplateRef as J,ref as D,withDirectives as le,vModelText as fe,Fragment as ee,renderList as te,inject as me,resolveDirective as ve,createTextVNode as ge,watch as Y,provide as ye,toRef as be}from"vue";import{c as $,t as L,y as ae,bQ as we,a as he,b_ as Se,c4 as ke}from"./index-CU6LcO2W.js";import{bs as xe,cj as Me}from"./vendor-other-BpgYsL4Z.js";import"primevue/button";import"vue-i18n";import"primevue/message";import"primevue/checkbox";import"primevue/divider";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/progressbar";import"primevue/floatlabel";import"primevue/inputtext";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/progressspinner";import"primevue/skeleton";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/badge";import"primevue/chip";import"primevue/tabpanel";import $e from"primevue/select";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/slider";import"primevue/panel";import"primevue/tabmenu";import se from"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"./vendor-xterm-DV1MVhAx.js";import"primevue/galleria";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/selectbutton";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import{f as ie,P as re}from"./widgetPropFilter-CygYoMQt.js";import{W as ne}from"./index-CqZHjtQN.js";import{_ as de}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-Azr_vpNt.js";import{a as Ce}from"./LazyImage.vue_vue_type_script_setup_true_lang-BEjdi0-r.js";function ue(o={}){return p(()=>({appendTo:"self",...o}))}m(ue,"useTransformCompatOverlayProps");const Ue=I({__name:"WidgetSelectDefault",props:T({widget:{}},{modelValue:{default(o){return o.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const e=o,s=U(o,"modelValue"),y=ue(),i=p(()=>{const r=e.widget.options;return r?.values&&Array.isArray(r.values)?r.values:[]}),b=p(()=>!!s.value&&!i.value.includes(s.value)),M=p(()=>({...ie(e.widget.options,re),...y.value,...b.value?{placeholder:`${s.value}`}:{}}));return(r,c)=>(v(),B(de,{widget:r.widget},{default:X(()=>[F(S($e),_({modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=n=>s.value=n),invalid:b.value,options:i.value},M.value,{class:S($)(S(ne),"w-full text-xs"),"aria-label":r.widget.name,size:"small",pt:{option:"text-xs",dropdown:"w-8",label:"truncate min-w-[4ch]",overlay:"w-fit min-w-full"},"data-capture-wheel":"true"}),null,16,["modelValue","invalid","options","class","aria-label"])]),_:1},8,["widget"]))}}),ze={class:"min-w-0 flex-1 px-1 py-2 text-left truncate"},Ae={key:0},Oe={key:1},Ve=["multiple","disabled","accept"],De=I({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},files:{},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(o,{emit:e}){const s=o,y=e,i=p(()=>s.items.filter(r=>s.selected.has(r.id))),b=p(()=>$("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",{"rotate-180":s.isOpen})),M=p(()=>$("border-0 bg-component-node-widget-background outline-none text-text-secondary",{"hover:bg-component-node-widget-background-hovered cursor-pointer":!s.disabled,"cursor-not-allowed":s.disabled,"text-text-primary":i.value.length>0}));return(r,c)=>(v(),k("div",{class:C(S($)(S(ne),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":r.disabled}))},[x("button",{class:C(S($)(M.value,"flex justify-between items-center flex-1 min-w-0 h-8",{"rounded-l-lg":r.uploadable,"rounded-lg":!r.uploadable})),onClick:c[0]||(c[0]=n=>y("select-click",n))},[x("span",ze,[i.value.length?(v(),k("span",Oe,K(i.value.map(n=>n.label??n.name).join(", ")),1)):(v(),k("span",Ae,K(s.placeholder),1))]),x("i",{class:C(["icon-[lucide--chevron-down]",b.value])},null,2)],2),r.uploadable?(v(),k("label",{key:0,class:C(S($)(M.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[c[2]||(c[2]=x("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),x("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:r.maxSelectable>1,disabled:r.disabled,accept:r.accept,onChange:c[1]||(c[1]=n=>y("file-change",n))},null,40,Ve)],2)):j("",!0)],2))}}),Ie={class:"text-secondary flex gap-2 px-4"},Qe={key:0,class:"mr-2 icon-[lucide--loader-circle] size-4 animate-spin"},Te={key:1,class:"mr-2 icon-[lucide--search] size-4"},Pe={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-component-node-widget-background-highlighted"},Le=["onClick"],Fe={key:0,class:"icon-[lucide--check] size-4"},W="bg-transparent border-0 outline-0 ring-0 text-left",oe="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",Be=I({__name:"FormDropdownMenuActions",props:T({isQuerying:{type:Boolean},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(o){const e=U(o,"layoutMode"),s=U(o,"searchQuery"),y=U(o,"sortSelected"),i=$("h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-node-component-border transition-all duration-150"),b=J("sortPopoverRef"),M=J("sortTriggerRef"),r=D(!1);function c(d){!b.value||!M.value||(r.value=!r.value,b.value.toggle(d,M.value))}m(c,"toggleSortPopover");function n(){r.value=!1,b.value?.hide()}m(n,"closeSortPopover");function l(d){y.value=d.id,n()}return m(l,"handleSortSelected"),(d,f)=>(v(),k("div",Ie,[x("label",{class:C(S($)(S(i),"flex-1 flex px-2 items-center text-base leading-none cursor-text",s.value?.trim()!==""?"text-base-foreground":"","hover:outline-component-node-widget-background-highlighted/80","focus-within:outline-component-node-widget-background-highlighted/80"))},[d.isQuerying?(v(),k("i",Qe)):(v(),k("i",Te)),le(x("input",{"onUpdate:modelValue":f[0]||(f[0]=h=>s.value=h),type:"text",class:C(W),placeholder:"Search"},null,512),[[fe,s.value]])],2),x("button",{ref_key:"sortTriggerRef",ref:M,class:C(S($)(W,S(i),"relative w-8 flex justify-center items-center cursor-pointer","hover:outline-component-node-widget-background-highlighted","active:!scale-95")),onClick:c},[y.value!=="default"?(v(),k("div",Pe)):j("",!0),f[4]||(f[4]=x("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),F(S(se),{ref_key:"sortPopoverRef",ref:b,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:f[1]||(f[1]=h=>r.value=!1)},{default:X(()=>[x("div",{class:C(S($)("flex flex-col gap-2 p-2 min-w-32","bg-component-node-background","rounded-lg outline outline-offset-[-1px] outline-component-node-border"))},[(v(!0),k(ee,null,te(d.sortOptions,h=>(v(),k("button",{key:h.name,class:C(S($)(W,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:m(A=>l(h),"onClick")},[x("span",null,K(h.name),1),y.value===h.id?(v(),k("i",Fe)):j("",!0)],10,Le))),128))],2)]),_:1},512),x("div",{class:C(S($)(S(i),"flex justify-center items-center p-1 gap-1 hover:outline-component-node-widget-background-highlighted"))},[x("button",{class:C(S($)(W,oe,e.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:f[2]||(f[2]=h=>e.value="list")},f[5]||(f[5]=[x("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),x("button",{class:C(S($)(W,oe,e.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:f[3]||(f[3]=h=>e.value="grid")},f[6]||(f[6]=[x("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),je={class:"text-secondary mb-4 flex gap-1 px-4"},Re=["onClick"],Ke=I({__name:"FormDropdownMenuFilter",props:T({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(o){const e=U(o,"filterSelected");return(s,y)=>(v(),k("div",je,[(v(!0),k(ee,null,te(s.filterOptions,i=>(v(),k("div",{key:i.id,class:C(S($)("px-4 py-2 rounded-md inline-flex justify-center items-center cursor-pointer select-none","transition-all duration-150","hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered","active:scale-95",e.value===i.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:m(b=>e.value=i.id,"onClick")},K(i.name),11,Re))),128))]))}}),ce=Symbol("assetKind"),We={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-base-foreground bg-primary-background"},Ee=["src"],qe={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},He={class:"text-secondary block text-xs"},Ne=I({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(o,{emit:e}){const s=o,y=e,i=D(null),b=me(ce),M=p(()=>b?.value==="video");function r(){y("click",s.index)}m(r,"handleClick");function c(l){if(y("mediaLoad",l),!l.target||!(l.target instanceof HTMLImageElement))return;const d=l.target;d.naturalWidth&&d.naturalHeight&&(i.value=`${d.naturalWidth} x ${d.naturalHeight}`)}m(c,"handleImageLoad");function n(l){if(y("mediaLoad",l),!l.target||!(l.target instanceof HTMLVideoElement))return;const d=l.target;d.videoWidth&&d.videoHeight&&(i.value=`${d.videoWidth} x ${d.videoHeight}`)}return m(n,"handleVideoLoad"),(l,d)=>{const f=ve("tooltip");return v(),k("div",{class:C(S($)("flex gap-1 select-none group/item cursor-pointer bg-component-node-widget-background","transition-all duration-150",{"flex-col text-center":l.layout==="grid","flex-row text-left max-h-16 rounded-lg hover:scale-102 active:scale-98":l.layout==="list","flex-row text-left hover:bg-component-node-widget-background-hovered rounded-lg":l.layout==="list-small","ring-2 ring-component-node-widget-background-highlighted":l.layout==="list"&&l.selected})),onClick:r},[l.layout!=="list-small"?(v(),k("div",{key:0,class:C(S($)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":l.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":l.layout==="grid","ring-2 ring-component-node-widget-background-highlighted":l.layout==="grid"&&l.selected}))},[l.selected?(v(),k("div",We,d[0]||(d[0]=[x("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-base-foreground bold"},null,-1)]))):j("",!0),l.mediaSrc&&M.value?(v(),k("video",{key:1,src:l.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:n},null,40,Ee)):l.mediaSrc?(v(),B(Ce,{key:2,src:l.mediaSrc,alt:l.name,"image-class":"size-full object-cover",onLoad:c},null,8,["src","alt"])):(v(),k("div",qe))],2)):j("",!0),x("div",{class:C(S($)("flex gap-1",{"flex-col":l.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":l.layout==="list","flex-row p-2 items-center justify-between w-full":l.layout==="list-small"}))},[le((v(),k("span",{class:C(S($)("block text-xs line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!l.selected&&"text-base-foreground"))},[ge(K(l.label??l.name),1)],2)),[[f,l.layout==="grid"?l.label??l.name:void 0]]),x("span",He,K(l.metadata||i.value),1)],2)],2)}}}),Xe={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-component-node-background pt-4 outline outline-offset-[-1px] outline-node-component-border"},Ze={class:"relative flex h-full mt-2 overflow-y-scroll"},Ge={key:0,class:"absolute inset-0 flex items-center justify-center"},Je=I({__name:"FormDropdownMenu",props:T({items:{},isSelected:{type:Function},isQuerying:{type:Boolean},filterOptions:{},sortOptions:{}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:T(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(o,{emit:e}){const s=e,y=U(o,"filterSelected"),i=U(o,"layoutMode"),b=U(o,"sortSelected"),M=U(o,"searchQuery");return(r,c)=>(v(),k("div",Xe,[r.filterOptions.length>0?(v(),B(Ke,{key:0,"filter-selected":y.value,"onUpdate:filterSelected":c[0]||(c[0]=n=>y.value=n),"filter-options":r.filterOptions},null,8,["filter-selected","filter-options"])):j("",!0),F(Be,{"layout-mode":i.value,"onUpdate:layoutMode":c[1]||(c[1]=n=>i.value=n),"sort-selected":b.value,"onUpdate:sortSelected":c[2]||(c[2]=n=>b.value=n),"search-query":M.value,"onUpdate:searchQuery":c[3]||(c[3]=n=>M.value=n),"sort-options":r.sortOptions,"is-querying":r.isQuerying},null,8,["layout-mode","sort-selected","search-query","sort-options","is-querying"]),x("div",Ze,[x("div",{class:C(S($)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":i.value==="grid","grid-cols-1 gap-y-2":i.value==="list","grid-cols-1 gap-y-1":i.value==="list-small"}))},[c[5]||(c[5]=x("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5"},null,-1)),r.items.length===0?(v(),k("div",Ge,c[4]||(c[4]=[x("i",{title:"No items",class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,-1)]))):j("",!0),(v(!0),k(ee,null,te(r.items,(n,l)=>(v(),B(Ne,{key:n.id,index:l,selected:r.isSelected(n,l),"media-src":n.mediaSrc,name:n.name,label:n.label,metadata:n.metadata,layout:i.value,onClick:m(d=>s("item-click",n,l),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function Ye(o,e){if(o.trim()==="")return e;const s=o.trim().toLowerCase().split(" ");return e.filter(y=>{const i=y.name.toLowerCase();return s.every(b=>i.includes(b))})}m(Ye,"defaultSearcher");function _e(){return[{name:"Default",id:"default",sorter:m(({items:o})=>o.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:m(({items:o})=>o.slice().sort((e,s)=>e.name.localeCompare(s.name)),"sorter")}]}m(_e,"getDefaultSortOptions");const et=I({__name:"FormDropdown",props:T({items:{},placeholder:{default:L("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:m(()=>[],"default")},sortOptions:{default:m(()=>_e(),"default")},isSelected:{type:Function,default:m((o,e,s)=>o.has(e.id),"default")},searcher:{type:Function,default:Ye}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(o){const e=o,s=U(o,"selected"),y=U(o,"filterSelected"),i=U(o,"sortSelected"),b=U(o,"layoutMode"),M=U(o,"files"),r=U(o,"searchQuery"),c=xe(r,700,{maxWait:700}),n=D(!1),l=ae(),d=D(),f=J("triggerRef"),h=D(!1),A=p(()=>e.multiple===!0?1/0:typeof e.multiple=="number"?e.multiple:1),P=D([]);Y(r,w=>{n.value=w!==c.value}),Y([c,()=>e.items],(w,g,t)=>{let a=!1,u;t(()=>{a=!0,u?.()}),e.searcher(c.value,e.items,z=>u=z).then(z=>{a||(P.value=z)}).finally(()=>{a||(n.value=!1)})},{immediate:!0});const O=p(()=>e.sortOptions.find(g=>g.id==="default")?.sorter||(({items:g})=>g.slice())),Q=p(()=>i.value==="default"?O.value:e.sortOptions.find(g=>g.id===i.value)?.sorter||O.value),E=p(()=>Q.value({items:P.value})||[]);function q(w,g){return e.isSelected?.(s.value,w,g)??!1}m(q,"internalIsSelected");const H=m(w=>{e.disabled||d.value&&f.value&&(d.value.toggle(w,f.value),h.value=!h.value)},"toggleDropdown"),N=m(()=>{d.value&&(d.value.hide(),h.value=!1)},"closeDropdown");function Z(w){if(e.disabled)return;const g=w.target;g.files&&(M.value=Array.from(g.files)),g.value=""}m(Z,"handleFileChange");function G(w,g){if(e.disabled)return;const t=s.value;if(q(w,g))t.delete(w.id);else if(t.size<A.value)t.add(w.id);else if(A.value===1)t.clear(),t.add(w.id);else{l.addAlert("Maximum selection limit reached");return}s.value=new Set(t),A.value===1&&N()}return m(G,"handleSelection"),(w,g)=>(v(),k("div",{ref_key:"triggerRef",ref:f},[F(De,{files:M.value,"is-open":h.value,placeholder:w.placeholder,items:w.items,"max-selectable":A.value,selected:s.value,uploadable:w.uploadable,disabled:w.disabled,accept:w.accept,onSelectClick:H,onFileChange:Z},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),F(S(se),{ref_key:"popoverRef",ref:d,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:g[4]||(g[4]=t=>h.value=!1)},{default:X(()=>[F(Je,{"filter-selected":y.value,"onUpdate:filterSelected":g[0]||(g[0]=t=>y.value=t),"layout-mode":b.value,"onUpdate:layoutMode":g[1]||(g[1]=t=>b.value=t),"sort-selected":i.value,"onUpdate:sortSelected":g[2]||(g[2]=t=>i.value=t),"search-query":r.value,"onUpdate:searchQuery":g[3]||(g[3]=t=>r.value=t),"filter-options":w.filterOptions,"sort-options":w.sortOptions,disabled:w.disabled,"is-querying":n.value,items:E.value,"is-selected":q,"max-selectable":A.value,onClose:N,onItemClick:G},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","is-querying","items","max-selectable"])]),_:1},512)],512))}});function tt(o){return{category:p(()=>{}),assets:p(()=>[]),dropdownItems:p(()=>[]),isLoading:p(()=>!1),error:p(()=>null)}}m(tt,"useAssetWidgetData");const ot=I({__name:"WidgetSelectDropdown",props:T({widget:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},{modelValue:{default(o){return o.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const e=o;ye(ce,p(()=>e.assetKind));const s=U(o,"modelValue"),y=ae(),i=we(),b=ue(),M=p(()=>({...ie(e.widget.options,re),...b.value})),c=m(()=>e.isAssetMode&&e.nodeType?tt(be(()=>e.nodeType)):null,"getAssetData")(),n=D("all"),l=p(()=>{if(e.isAssetMode){const t=c?.category.value??"All";return[{id:"all",name:Me(t)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),d=D(new Set);function f(t){const a=e.widget.options?.getOptionLabel;if(!a)return t;try{return a(t)}catch(u){return console.error("Failed to map value:",u),t}}m(f,"getDisplayLabel");const h=p(()=>{const t=e.widget.options?.values||[];return Array.isArray(t)?t.map((a,u)=>({id:`input-${u}`,mediaSrc:g(a,"input"),name:a,label:f(a),metadata:""})):[]}),A=p(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const t=new Set;return i.historyTasks.forEach(a=>{a.flatOutputs.forEach(u=>{const z=e.assetKind==="image"&&u.mediaType==="images"||e.assetKind==="video"&&u.mediaType==="video";if(u.type==="output"&&z){const R=`${u.subfolder?`${u.subfolder}/${u.filename}`:u.filename} [output]`;t.add(R)}})}),Array.from(t).map((a,u)=>({id:`output-${u}`,mediaSrc:g(a.replace(" [output]",""),"output"),name:a,label:f(a),metadata:""}))}),P=p(()=>e.isAssetMode&&c?c.dropdownItems.value:[...h.value,...A.value]),O=p(()=>{if(e.isAssetMode)return P.value;switch(n.value){case"inputs":return h.value;case"outputs":return A.value;case"all":default:return P.value}}),Q=p(()=>{const t=e.widget.options;if(t?.placeholder)return t.placeholder;switch(e.assetKind){case"image":return L("widgets.uploadSelect.placeholderImage");case"video":return L("widgets.uploadSelect.placeholderVideo");case"audio":return L("widgets.uploadSelect.placeholderAudio");case"model":return L("widgets.uploadSelect.placeholderModel");case"unknown":return L("widgets.uploadSelect.placeholderUnknown")}return L("widgets.uploadSelect.placeholder")}),E=p(()=>e.isAssetMode?!1:e.allowUpload===!0),q=p(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),H=D(e.defaultLayoutMode??"grid");Y(s,t=>{if(t!==void 0){const a=O.value.find(u=>u.name===t);a&&(d.value.clear(),d.value.add(a.id))}else d.value.clear()},{immediate:!0});function N(t){let a;if(t.size>0&&(a=t.values().next().value),a==null){s.value=void 0;return}const u=O.value.find(z=>z.id===a)?.name;if(!u){s.value=void 0;return}s.value=u}m(N,"updateSelectedItems");const Z=m(async(t,a=!1,u={})=>{const z=new FormData;z.append("image",t),a&&z.append("subfolder","pasted"),u.type&&z.append("type",u.type);const V=await he.fetchApi("/upload/image",{method:"POST",body:z});if(V.status!==200)return y.addAlert(V.status+" - "+V.statusText),null;const R=await V.json();return(u.type==="input"||!u.type&&!a)&&await Se().updateInputs(),R.subfolder?`${R.subfolder}/${R.name}`:R.name},"uploadFile"),G=m(async t=>{const a=e.uploadFolder??"input",u=t.map(V=>Z(V,!1,{type:a}));return(await Promise.all(u)).filter(V=>V!==null)},"uploadFiles");async function w(t){if(!(!t||t.length===0))try{const a=await G(t);if(a.length===0){y.addAlert("File upload failed");return}e.widget.options?.values&&a.forEach(u=>{const z=e.widget.options.values;z.includes(u)||z.push(u)}),s.value=a[0],e.widget.callback&&e.widget.callback(a[0])}catch(a){console.error("Upload error:",a),y.addAlert(`Upload failed: ${a}`)}}m(w,"handleFilesUpdate");function g(t,a="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(t)}&type=${a}`:""}return m(g,"getMediaUrl"),(t,a)=>(v(),B(de,{widget:t.widget},{default:X(()=>[F(et,_({selected:d.value,"onUpdate:selected":a[0]||(a[0]=u=>d.value=u),"filter-selected":n.value,"onUpdate:filterSelected":a[1]||(a[1]=u=>n.value=u),"layout-mode":H.value,"onUpdate:layoutMode":a[2]||(a[2]=u=>H.value=u),items:O.value,placeholder:Q.value,multiple:!1,uploadable:E.value,accept:q.value,"filter-options":l.value},M.value,{class:"w-full","onUpdate:selected":N,"onUpdate:files":w}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),io=I({__name:"WidgetSelect",props:T({widget:{},nodeType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const e=o,s=U(o,"modelValue"),y=p(()=>{if(e.widget.spec&&ke(e.widget.spec))return e.widget.spec}),i=p(()=>{const d=y.value;if(!d)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:f,animated_image_upload:h,video_upload:A,image_folder:P,audio_upload:O}=d;let Q="unknown";return A?Q="video":f||h?Q="image":O&&(Q="audio"),{kind:Q,allowUpload:f===!0||h===!0||A===!0||O===!0,folder:P}}),b=p(()=>!1),M=p(()=>i.value.kind),r=p(()=>b.value||M.value!=="unknown"),c=p(()=>i.value.allowUpload),n=p(()=>i.value.folder??"input"),l=p(()=>b.value?"list":"grid");return(d,f)=>r.value?(v(),B(ot,_({key:0},e,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=h=>s.value=h),"asset-kind":M.value,"allow-upload":c.value,"upload-folder":n.value,"is-asset-mode":b.value,"default-layout-mode":l.value}),null,16,["modelValue","asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):(v(),B(Ue,{key:1,modelValue:s.value,"onUpdate:modelValue":f[1]||(f[1]=h=>s.value=h),widget:d.widget},null,8,["modelValue","widget"]))}});export{io as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-DAG4OhP7.js.map
