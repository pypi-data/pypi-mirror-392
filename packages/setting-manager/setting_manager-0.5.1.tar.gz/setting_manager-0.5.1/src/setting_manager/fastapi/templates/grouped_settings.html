<!DOCTYPE html>
<html>
<head>
    <title>Application Settings</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .settings-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .settings-table th, .settings-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .settings-table th { background-color: #f2f2f2; }
        .source-database { color: #28a745; font-weight: bold; }
        .source-environment { color: #17a2b8; }
        .source-default { color: #6c757d; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–π */
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            margin: 20px 0 0 0;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .section-header.collapsed {
            margin-bottom: 0;
            border-radius: 8px 8px 8px 8px;
        }

        .section-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .section-content.collapsed {
            display: none;
        }

        .toggle-icon {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .section-header:first-child {
            margin-top: 20px;
        }

        input[type="text"] {
            padding: 4px;
            width: 100%;
            flex: 1;
            box-sizing: border-box;
        }
        button {
            padding: 4px 8px;
            cursor: pointer;
            border: 1px solid #ccc;
            white-space: nowrap;
        }
        .btn-update {
            background: #007bff;
            color: white;
            border: none;
        }
        .btn-reset {
            background: #dc3545;
            color: white;
            border: none;
        }
        .btn-reset:disabled {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px dashed #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .btn-reset:not(:disabled):hover { background: #c82333; }
        .value-info { font-size: 0.9em; color: #666; }
        .actions-group {
            display: flex;
            gap: 5px;
            align-items: center;
            margin-left: auto;
            flex-shrink: 0;
        }
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%;
        }
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 300px;
            text-align: center;
        }
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .hidden { display: none; }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
            font-style: italic;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .col-type { width: 100px; }
        .col-source { width: 120px; }
        .col-values { width: 200px; }

        .value-text {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
            vertical-align: bottom;
            cursor: help;
        }

        .input-container {
            position: relative;
            flex: 1;
            min-width: 200px;
            max-width: 100%;
        }

        .input-collapsed {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: inherit;
            resize: none;
            height: 32px;
            line-height: 24px;
        }

        .input-expanded {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
            resize: none;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: inherit;
            height: auto;
            min-height: 32px;
            max-height: 50vh;
            overflow-y: hidden;
        }

        .input-expanded.need-scroll {
            overflow-y: auto;
        }

        .expand-toggle {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
            padding: 4px 6px;
            z-index: 2;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .expand-toggle:hover {
            color: #007bff;
            background: #f8f9fa;
            border-color: #007bff;
            box-shadow: 0 2px 4px rgba(0,123,255,0.2);
        }

        .expand-toggle::before {
            content: "‚§¢";
        }

        .expand-toggle.expanded::before {
            content: "‚§°";
        }

        .value-text {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
            vertical-align: bottom;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π */
        .sensitive-field {
            background-color: #fff3cd;
            border-left: 3px solid #ffc107;
        }

        .sensitive-warning {
            color: #856404;
            font-size: 0.8em;
            font-style: italic;
            margin-top: 2px;
        }

        .masked-value {
            font-family: monospace;
            letter-spacing: 2px;
            color: #666;
        }

        .readonly-field {
            background-color: #f8f9fa;
            opacity: 0.7;
        }

        textarea:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <h1>Application Settings</h1>

    <div id="message" class="hidden"></div>

    <div class="actions">
        <button type="button" onclick="resetAllSettings()"
                style="background: #dc3545; color: white; padding: 8px 16px;">
            Reset All Settings
        </button>
        <button type="button" onclick="toggleAllSections()"
                style="background: #6c757d; color: white; padding: 8px 16px; margin-left: 10px;">
            Toggle All Sections
        </button>
    </div>

    {% for section_name, settings in settings_grouped.items() %}
    <div class="section-container">
        <div class="section-header {% if section_name == 'System' %}collapsed{% endif %}"
             onclick="toggleSection('{{ section_name }}')"
             id="header-{{ section_name }}">
            <span>{{ section_name }}</span>
            <span class="toggle-icon {% if section_name == 'System' %}collapsed{% endif %}"
                  id="toggle-{{ section_name }}">‚ñº</span>
        </div>
        <div class="section-content {% if section_name == 'System' %}collapsed{% endif %}"
             id="content-{{ section_name }}">
            <table class="settings-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Current Value & Actions</th>
                        <th class="col-type">Type</th>
                        <th class="col-source">Source</th>
                        <th class="col-values">Values</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for setting in settings %}
                    <tr id="row-{{ setting.name }}"
                        {% if setting.is_sensitive %}class="sensitive-field"{% endif %}
                        {% if not setting.allow_change %}class="readonly-field"{% endif %}>
                        <td>
                            <strong>{{ setting.name }}</strong>
                            {% if setting.is_sensitive %}
                            <div class="sensitive-warning">üîí Sensitive field</div>
                            {% endif %}
                            {% if not setting.allow_change %}
                            <div class="sensitive-warning">üö´ Read-only</div>
                            {% endif %}
                            {% if setting.required_role %}
                            <div class="role-warning" style="color: #856404; font-size: 0.8em;">
                                üëë Requires role: {{ setting.required_role }}
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <div class="input-group">
                                <div class="input-container">
                                    <textarea
                                        id="input-{{ setting.name }}"
                                        aria-label="Value for {{ setting.name }}"
                                        placeholder="{% if setting.is_sensitive %}Enter new sensitive value{% else %}Enter new value{% endif %}"
                                        class="input-collapsed"
                                        {% if not setting.allow_change %}disabled{% endif %}>{{ setting.value }}</textarea>
                                    <button type="button"
                                            class="expand-toggle"
                                            id="toggle-input-{{ setting.name }}"
                                            onclick="toggleInput('{{ setting.name }}')"
                                            style="display: none;"
                                            aria-label="Expand/collapse textarea"
                                            {% if not setting.allow_change %}disabled{% endif %}>
                                    </button>
                                </div>
                                <div class="actions-group">
                                    <button type="button" class="btn-update" onclick="updateSetting('{{ setting.name }}')"
                                            {% if not setting.allow_change %}disabled{% endif %}>
                                        Update
                                    </button>
                                    <div class="tooltip">
                                        {% if setting.can_reset and setting.allow_change %}
                                        <button type="button" class="btn-reset" onclick="resetSetting('{{ setting.name }}')">
                                            Reset
                                        </button>
                                        {% else %}
                                        <button type="button" class="btn-reset" disabled>
                                            Reset
                                        </button>
                                        <span class="tooltiptext">
                                            {% if not setting.allow_change %}
                                            Reset not available for read-only settings
                                            {% else %}
                                            Reset available only for database values
                                            {% endif %}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="col-type">{{ setting.type }}</td>
                        <td class="col-source">
                            <span class="source-{{ setting.source }}">‚óè {{ setting.source }}</span>
                        </td>
                        <td class="col-values">
                            <div class="value-info">
                                <div>
                                    <strong>Env:</strong>
                                    {% if setting.environment_value is not none %}
                                        <div class="tooltip">
                                            <span class="value-text {% if setting.is_sensitive %}masked-value{% endif %}">
                                                {{ setting.environment_value }}
                                            </span>
                                            {% if setting.is_sensitive %}
                                            <span class="tooltiptext">
                                                This is a masked sensitive value
                                            </span>
                                            {% else %}
                                            <span class="tooltiptext">
                                                {{ setting.environment_value }}
                                            </span>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <span style="color: #999; font-style: italic;">(not set)</span>
                                    {% endif %}
                                </div>
                                {% if setting.default_value is not none %}
                                <div>
                                    <strong>Default:</strong>
                                    <div class="tooltip">
                                        <span class="value-text {% if setting.is_sensitive %}masked-value{% endif %}">
                                            {{ setting.default_value }}
                                        </span>
                                        {% if setting.is_sensitive %}
                                        <span class="tooltiptext">
                                            This is a masked sensitive value
                                        </span>
                                        {% else %}
                                        <span class="tooltiptext">
                                            {{ setting.default_value }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </td>
                        <td>{{ setting.description or '' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}

    <script>
        const ROUTER_PREFIX = "{{ router_prefix }}";

        function getApiUrl(path) {
            const fullPath = `${ROUTER_PREFIX}${path}`;
            return new URL(fullPath, window.location.origin).href;
        }

        function showMessage(text, type = 'success') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message message-${type}`;
            messageEl.classList.remove('hidden');

            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏
        function toggleSection(sectionName) {
            const header = document.getElementById(`header-${sectionName}`);
            const content = document.getElementById(`content-${sectionName}`);
            const toggle = document.getElementById(`toggle-${sectionName}`);

            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            toggle.classList.toggle('collapsed');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π
        function toggleAllSections() {
            const headers = document.querySelectorAll('.section-header');
            const allCollapsed = Array.from(headers).every(header => header.classList.contains('collapsed'));

            headers.forEach(header => {
                const sectionName = header.id.replace('header-', '');
                const content = document.getElementById(`content-${sectionName}`);
                const toggle = document.getElementById(`toggle-${sectionName}`);

                if (allCollapsed) {
                    // –ï—Å–ª–∏ –≤—Å–µ —Å–≤–µ—Ä–Ω—É—Ç—ã - —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ
                    header.classList.remove('collapsed');
                    content.classList.remove('collapsed');
                    toggle.classList.remove('collapsed');
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –≤—Å–µ —Å–≤–µ—Ä–Ω—É—Ç—ã - —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ
                    header.classList.add('collapsed');
                    content.classList.add('collapsed');
                    toggle.classList.add('collapsed');
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ textarea
        function toggleInput(settingName) {
            const textarea = document.getElementById(`input-${settingName}`);
            const toggle = document.getElementById(`toggle-input-${settingName}`);

            if (textarea.classList.contains('input-collapsed')) {
                // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º
                textarea.classList.remove('input-collapsed');
                textarea.classList.add('input-expanded');
                toggle.classList.add('expanded');
                textarea.focus();
                adjustTextareaHeight(textarea);
            } else {
                // –°–∫—Ä—ã–≤–∞–µ–º
                textarea.classList.remove('input-expanded');
                textarea.classList.add('input-collapsed');
                toggle.classList.remove('expanded');
                textarea.style.height = '32px';
            }
            // –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
            checkTextareaOverflow(settingName);
        }

        // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
        function checkTextareaOverflow(settingName) {
            const textarea = document.getElementById(`input-${settingName}`);
            const toggle = document.getElementById(`toggle-input-${settingName}`);

            // –í —Å–≤–µ—Ä–Ω—É—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è
            // –í —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º —Ä–µ–∂–∏–º–µ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–≤–µ—Ä–Ω—É—Ç—å
            if (textarea.classList.contains('input-collapsed')) {
                const isOverflowing = textarea.scrollWidth > textarea.clientWidth;
                toggle.style.display = isOverflowing ? 'block' : 'none';
            } else {
                toggle.style.display = 'block';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã—Å–æ—Ç—ã textarea
        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            const contentHeight = textarea.scrollHeight;
            const maxHeight = window.innerHeight * 0.5;
            const newHeight = Math.min(contentHeight, maxHeight);
            textarea.style.height = newHeight + 'px';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è
            if (contentHeight > maxHeight) {
                textarea.classList.add('need-scroll');
            } else {
                textarea.classList.remove('need-scroll');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        async function updateSetting(settingName) {
            const textarea = document.getElementById(`input-${settingName}`);
            const value = textarea.value.trim();

            if (!value) {
                showMessage('Please enter a value', 'error');
                return;
            }

            try {
                const response = await fetch(getApiUrl(`/${settingName}`), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `value=${encodeURIComponent(value)}`
                });

                if (response.ok) {
                    showMessage(`Setting "${settingName}" updated successfully`);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                    const resetButton = document.querySelector(`#row-${settingName} .btn-reset`);
                    if (resetButton) {
                        resetButton.disabled = false;
                        resetButton.onclick = () => resetSetting(settingName);
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞ "database"
                    const sourceElement = document.querySelector(`#row-${settingName} .col-source span`);
                    if (sourceElement) {
                        sourceElement.className = 'source-database';
                        sourceElement.textContent = '‚óè database';
                    }
                } else {
                    const result = await response.json();
                    showMessage('Error: ' + (result.detail || 'Unknown error'), 'error');
                }
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        async function resetSetting(settingName) {
            if (confirm(`Reset setting "${settingName}" to environment/default value?`)) {
                try {
                    const response = await fetch(getApiUrl(`/${settingName}`), {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showMessage(`Setting "${settingName}" reset successfully`);

                        // –û–±–Ω–æ–≤–ª—è–µ–º UI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        updateSettingUI(settingName, result.value, result.source);
                    } else {
                        const result = await response.json();
                        showMessage('Error resetting setting: ' + (result.detail || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    showMessage('Error: ' + error.message, 'error');
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        function updateSettingUI(settingName, value, source) {
            const textarea = document.getElementById(`input-${settingName}`);

            if (textarea) {
                textarea.value = value;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
            const sourceElement = document.querySelector(`#row-${settingName} .col-source span`);
            if (sourceElement) {
                sourceElement.className = `source-${source}`;
                sourceElement.textContent = `‚óè ${source}`;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É Reset - –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ disabled
            const resetButton = document.querySelector(`#row-${settingName} .btn-reset`);
            if (resetButton) {
                resetButton.disabled = true;
                resetButton.onclick = null;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
            checkTextareaOverflow(settingName);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        async function resetAllSettings() {
            if (confirm('Are you sure you want to reset ALL settings? This will remove all database values.')) {
                try {
                    const response = await fetch(getApiUrl('/actions/reset-all'), {
                        method: 'POST'
                    });

                    if (response.ok) {
                        showMessage('All settings reset successfully');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        const result = await response.json();
                        showMessage('Error: ' + (result.detail || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    showMessage('Error: ' + error.message, 'error');
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                const settingName = textarea.id.replace('input-', '');
                checkTextareaOverflow(settingName);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
                textarea.addEventListener('input', function() {
                    checkTextareaOverflow(settingName);
                    if (this.classList.contains('input-expanded')) {
                        adjustTextareaHeight(this);
                    }
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
                textarea.addEventListener('resize', function() {
                    checkTextareaOverflow(settingName);
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter
                textarea.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        if (e.ctrlKey || this.classList.contains('input-expanded')) {
                            // Ctrl+Enter –∏–ª–∏ Enter –≤ —Ä–∞—Å–∫—Ä—ã—Ç–æ–º —Ä–µ–∂–∏–º–µ - –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
                            if (!e.ctrlKey) {
                                setTimeout(() => {
                                    adjustTextareaHeight(this);
                                    checkTextareaOverflow(settingName);
                                }, 0);
                            }
                        } else {
                            // Enter –≤ —Å–≤–µ—Ä–Ω—É—Ç–æ–º —Ä–µ–∂–∏–º–µ - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
                            e.preventDefault();
                            if (confirm(`Update setting "${settingName}" to "${this.value}"?`)) {
                                updateSetting(settingName);
                            }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>