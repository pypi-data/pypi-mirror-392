# Getting Started

This guide distills the essentials from the onboarding, environment, and ontology-as-code (OaC)
documentation into a single workflow.

## Prerequisites

- **Python** 3.11 (managed via [uv](https://github.com/astral-sh/uv) or `pyenv`)
- **DuckDB** for local data pipelines (installed automatically by the tooling)
- **Node** 18+ if you intend to build the documentation site with MkDocs Material
- Optional: **Temporal** stack for end-to-end Actions testing (`docker compose` support required)

Clone the repository and install dependencies:

```bash
uv sync --dev
```

Apply the latest database migrations (SQLite by default):

```bash
just db-upgrade
# or: uv run alembic upgrade head
```

## 0. Bootstrap an Ontologia Sandbox (Recommended)

Use the Typer-based CLI to create a self-contained project directory, complete with ontology YAML,
Docker Compose, and local context tracking (`~/.ontologia/config.json`). Services start
automatically when `--start-services` is supplied.

```bash
uv run ontologia-cli genesis --name my_sandbox --directory ./sandboxes --start-services --bootstrap
cd sandboxes/my_sandbox
```

Inside a sandbox you can collaborate with the Architect agent at any time:

```bash
ontologia agent
```

## 1. Generate the SDK

Ontologia treats YAML definitions under `ontologia/` (inside a sandbox created via `ontologia-cli genesis`) as the source of truth. Generate the static SDK
from those definitions:

```bash
uv run ontologia-cli --dir ontologia generate-sdk --source local
```

Key outputs go to `ontologia_sdk/ontology/`:

- Typed object classes (`objects.py`)
- Link descriptor helpers (`links.py`)
- Autogenerated imports (`__init__.py`)

Regenerate after every YAML change to keep the SDK in sync.

## 2. Run Smoke Tests

```bash
uv run pytest -q
```

This executes unit and integration tests, including the SDK smoke tests powered by the
`MockOntologyClient`.

## 3. Explore the API

Spin up the FastAPI application and inspect the OpenAPI specification:

```bash
uv run uvicorn ontologia_api.main:app --reload
```

Visit `http://127.0.0.1:8000/docs` and click **Authorize** to supply a bearer token. Keep the
[API Reference](API_REFERENCE.md) tab open for endpoint-specific details and code samples.

### Authentication & Authorization

Tokens follow the OAuth2 password flow. Use one of the seeded users (`admin`, `editor`, `viewer`)
with password matching the username:

```bash
curl -X POST http://127.0.0.1:8000/v2/auth/token \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=admin&password=admin"
```

Include the returned `access_token` in the `Authorization: Bearer <token>` header for all requests.
Global roles determine the default access level, while tenant-specific roles (e.g.,
`{"ontology/default": "editor"}`) gate operations on individual ontologies.

## 4. Ontology as Code Workflow

1. Author or edit YAML definitions under `ontologia/object_types/` and `ontologia/link_types/` (in your sandbox).
2. Run validation:

   ```bash
   uv run ontologia-cli --dir ontologia validate
   ```

3. Preview server changes:

   ```bash
   uv run ontologia-cli --dir ontologia diff --host http://127.0.0.1:8000
   ```

4. Apply when ready (consider `--allow-destructive` for deletions):

   ```bash
   uv run ontologia-cli --dir ontologia apply --host http://127.0.0.1:8000 --yes
   ```

See [OAC_GUIDE.md](OAC_GUIDE.md) for schema structure, CLI arguments, and advanced flags. Continuous
integration hooks are described in [OAC_CI.md](OAC_CI.md).

## 5. Generate Documentation Locally

```bash
uvx mkdocs serve
```

Open the local preview to validate new documentation contributions before submitting a pull request.

## 6. Hybrid Query Engine

The generated SDK exposes `.traverse(...)` to request multi-hop searches in a single round-trip:

```python
from ontologia_sdk.ontology.objects import Employee

client = OntologyClient(host="http://127.0.0.1:8000", ontology="default", token=TOKEN)

departments = (
    Employee.search_builder(client)
    .where(Employee.dept == "ENG")
    .traverse("works_in", where={"property": "name", "op": "eq", "value": "Engineering"})
    .all()
)
```

The API mirrors this structure via the `traverse` field in `POST /objects/{objectTypeApiName}/search`.

## Next Steps

- Review the [Architecture Overview](platform/architecture.md) for a component-level understanding.
- Experiment with the SDK DSL and link proxies using the examples in `example_project/examples/` (a cookbook is on
  the way).
- Explore historical decisions and compliance reports under the [Archive](archive/reports.md).

If you're iterating within a sandbox, remember that project context is cached globallyâ€”`ontologia
projects list` shows every environment you've provisioned.

If you hit issues while setting up, check [ENVIRONMENT.md](ENVIRONMENT.md) for feature flags and
troubleshooting tips, or ping the team in the `#ontologia` Slack channel.
