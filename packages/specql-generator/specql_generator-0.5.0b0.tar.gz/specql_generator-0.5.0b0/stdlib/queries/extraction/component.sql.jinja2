-- @fraiseql:view
-- @fraiseql:description {{ purpose | default("Extract non-null components for efficient LEFT JOIN") }}
CREATE OR REPLACE VIEW {{ schema }}.{{ view_name }} AS
SELECT
    {{ pk_field }} AS pk_{{ name | lower }},
{% for field in extracted_fields %}
    {{ field.name }}{% if field.alias %} AS {{ field.alias }}{% endif %}{% if not loop.last %},{% endif %}
{% endfor %}
FROM {{ schema }}.{{ source_table | default(table) }}
WHERE deleted_at IS NULL
{% if filter_condition %}
  AND {{ filter_condition }}
{% endif %}
{% if is_multi_tenant %}
  AND tenant_id = CURRENT_SETTING('app.current_tenant_id')::uuid
{% endif %};

-- Index for LEFT JOIN performance
CREATE INDEX IF NOT EXISTS idx_{{ view_name }}_pk_{{ name | lower }}
    ON {{ schema }}.{{ view_name }}(pk_{{ name | lower }});