{%- if section == "columns" %}
-- ============================================================================
-- Vector Embeddings: {{ entity.name }}
-- FraiseQL 1.5 auto-discovers these columns and provides GraphQL operators
-- ============================================================================

ALTER TABLE {{ schema }}.tb_{{ entity.name|lower }}
ADD COLUMN embedding vector(384);

ALTER TABLE {{ schema }}.tv_{{ entity.name|lower }}
ADD COLUMN embedding vector(384);

{%- elif section == "indexes" %}
-- ============================================================================
-- HNSW Index for Fast Vector Similarity Search
-- FraiseQL 1.5 uses this index for optimized vector queries
-- ============================================================================

CREATE INDEX idx_tb_{{ entity.name|lower }}_embedding_hnsw
ON {{ schema }}.tb_{{ entity.name|lower }}
USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

COMMENT ON INDEX {{ schema }}.idx_tb_{{ entity.name|lower }}_embedding_hnsw IS
'HNSW index for fast vector similarity search on {{ entity.name }}.
- m = 16: Number of connections per layer
- ef_construction = 64: Quality of index construction
- Operator: <=> (cosine distance)

FraiseQL 1.5 GraphQL operators: cosineDistance, l2Distance, innerProduct';
{%- endif %}