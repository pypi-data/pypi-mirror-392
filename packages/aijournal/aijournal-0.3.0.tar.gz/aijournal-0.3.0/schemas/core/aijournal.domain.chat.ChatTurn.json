{
  "$defs": {
    "ChatCitation": {
      "description": "Reference to a retrieved chunk included in a chat response.",
      "properties": {
        "chunk_id": {
          "title": "Chunk Id",
          "type": "string"
        },
        "chunk_index": {
          "title": "Chunk Index",
          "type": "integer"
        },
        "chunk_type": {
          "title": "Chunk Type",
          "type": "string"
        },
        "code": {
          "title": "Code",
          "type": "string"
        },
        "date": {
          "title": "Date",
          "type": "string"
        },
        "normalized_id": {
          "title": "Normalized Id",
          "type": "string"
        },
        "score": {
          "title": "Score",
          "type": "number"
        },
        "source_path": {
          "title": "Source Path",
          "type": "string"
        },
        "tags": {
          "items": {
            "type": "string"
          },
          "title": "Tags",
          "type": "array"
        }
      },
      "required": [
        "chunk_id",
        "code",
        "normalized_id",
        "chunk_index",
        "source_path",
        "date",
        "score",
        "chunk_type"
      ],
      "title": "ChatCitation",
      "type": "object"
    },
    "ChatCitationRef": {
      "description": "Reference emitted by the LLM; resolved against retrieved chunks.",
      "properties": {
        "code": {
          "minLength": 1,
          "title": "Code",
          "type": "string"
        }
      },
      "required": [
        "code"
      ],
      "title": "ChatCitationRef",
      "type": "object"
    },
    "ChatResponse": {
      "description": "Structured response returned by the chat LLM.",
      "properties": {
        "answer": {
          "maxLength": 4000,
          "title": "Answer",
          "type": "string"
        },
        "citations": {
          "items": {
            "$ref": "#/$defs/ChatCitationRef"
          },
          "title": "Citations",
          "type": "array"
        },
        "clarifying_question": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Clarifying Question"
        },
        "telemetry": {
          "additionalProperties": true,
          "title": "Telemetry",
          "type": "object"
        },
        "timestamp": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Timestamp"
        }
      },
      "required": [
        "answer"
      ],
      "title": "ChatResponse",
      "type": "object"
    },
    "ChatTelemetry": {
      "description": "Telemetry captured during a chat turn.",
      "properties": {
        "chunk_count": {
          "title": "Chunk Count",
          "type": "integer"
        },
        "model": {
          "title": "Model",
          "type": "string"
        },
        "retrieval_ms": {
          "title": "Retrieval Ms",
          "type": "number"
        },
        "retriever_source": {
          "title": "Retriever Source",
          "type": "string"
        }
      },
      "required": [
        "retrieval_ms",
        "chunk_count",
        "retriever_source",
        "model"
      ],
      "title": "ChatTelemetry",
      "type": "object"
    },
    "ClaimAtom": {
      "description": "Typed, scoped claim describing part of the persona.",
      "properties": {
        "id": {
          "title": "Id",
          "type": "string"
        },
        "method": {
          "$ref": "#/$defs/ClaimMethod"
        },
        "predicate": {
          "title": "Predicate",
          "type": "string"
        },
        "provenance": {
          "$ref": "#/$defs/Provenance"
        },
        "review_after_days": {
          "default": 120,
          "title": "Review After Days",
          "type": "integer"
        },
        "scope": {
          "$ref": "#/$defs/Scope"
        },
        "statement": {
          "title": "Statement",
          "type": "string"
        },
        "status": {
          "$ref": "#/$defs/ClaimStatus",
          "default": "tentative"
        },
        "strength": {
          "default": 0.5,
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Strength",
          "type": "number"
        },
        "subject": {
          "title": "Subject",
          "type": "string"
        },
        "type": {
          "$ref": "#/$defs/ClaimType"
        },
        "user_verified": {
          "default": false,
          "title": "User Verified",
          "type": "boolean"
        },
        "value": {
          "title": "Value",
          "type": "string"
        }
      },
      "required": [
        "id",
        "type",
        "subject",
        "predicate",
        "value",
        "statement",
        "method",
        "provenance"
      ],
      "title": "ClaimAtom",
      "type": "object"
    },
    "ClaimMethod": {
      "enum": [
        "self_report",
        "inferred",
        "behavioral"
      ],
      "title": "ClaimMethod",
      "type": "string"
    },
    "ClaimStatus": {
      "enum": [
        "accepted",
        "tentative",
        "rejected"
      ],
      "title": "ClaimStatus",
      "type": "string"
    },
    "ClaimType": {
      "enum": [
        "preference",
        "value",
        "goal",
        "boundary",
        "trait",
        "habit",
        "aversion",
        "skill"
      ],
      "title": "ClaimType",
      "type": "string"
    },
    "PersonaCore": {
      "description": "Primary persona payload used by chat/advise pipelines.",
      "properties": {
        "claims": {
          "items": {
            "$ref": "#/$defs/ClaimAtom"
          },
          "title": "Claims",
          "type": "array"
        },
        "profile": {
          "additionalProperties": true,
          "title": "Profile",
          "type": "object"
        }
      },
      "title": "PersonaCore",
      "type": "object"
    },
    "Provenance": {
      "description": "Provenance metadata recorded for a claim atom.",
      "properties": {
        "first_seen": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "First Seen"
        },
        "last_updated": {
          "title": "Last Updated",
          "type": "string"
        },
        "observation_count": {
          "default": 1,
          "minimum": 1,
          "title": "Observation Count",
          "type": "integer"
        },
        "sources": {
          "items": {
            "$ref": "#/$defs/SourceRef"
          },
          "title": "Sources",
          "type": "array"
        }
      },
      "required": [
        "last_updated"
      ],
      "title": "Provenance",
      "type": "object"
    },
    "RetrievedChunk": {
      "description": "Chunk returned from retrieval with a similarity score.",
      "properties": {
        "chunk_id": {
          "title": "Chunk Id",
          "type": "string"
        },
        "chunk_index": {
          "title": "Chunk Index",
          "type": "integer"
        },
        "chunk_type": {
          "default": "entry",
          "title": "Chunk Type",
          "type": "string"
        },
        "date": {
          "title": "Date",
          "type": "string"
        },
        "manifest_hash": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Manifest Hash"
        },
        "normalized_id": {
          "title": "Normalized Id",
          "type": "string"
        },
        "score": {
          "title": "Score",
          "type": "number"
        },
        "source_hash": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Source Hash"
        },
        "source_path": {
          "title": "Source Path",
          "type": "string"
        },
        "source_type": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Source Type"
        },
        "tags": {
          "items": {
            "type": "string"
          },
          "title": "Tags",
          "type": "array"
        },
        "text": {
          "title": "Text",
          "type": "string"
        },
        "tokens": {
          "title": "Tokens",
          "type": "integer"
        }
      },
      "required": [
        "chunk_id",
        "normalized_id",
        "chunk_index",
        "text",
        "date",
        "source_path",
        "tokens",
        "score"
      ],
      "title": "RetrievedChunk",
      "type": "object"
    },
    "Scope": {
      "description": "Contextual qualifiers for a claim atom.",
      "properties": {
        "conditions": {
          "items": {
            "type": "string"
          },
          "title": "Conditions",
          "type": "array"
        },
        "context": {
          "items": {
            "type": "string"
          },
          "title": "Context",
          "type": "array"
        },
        "domain": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Domain"
        }
      },
      "title": "Scope",
      "type": "object"
    },
    "SourceRef": {
      "description": "Reference to a normalized entry and the supporting spans.",
      "properties": {
        "entry_id": {
          "title": "Entry Id",
          "type": "string"
        },
        "spans": {
          "items": {
            "$ref": "#/$defs/Span"
          },
          "title": "Spans",
          "type": "array"
        }
      },
      "required": [
        "entry_id"
      ],
      "title": "SourceRef",
      "type": "object"
    },
    "Span": {
      "description": "Detailed pointer back into a source document.",
      "properties": {
        "end": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "End"
        },
        "index": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Index"
        },
        "start": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Start"
        },
        "text": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Text"
        },
        "type": {
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "title": "Span",
      "type": "object"
    }
  },
  "description": "Structured representation of a chat turn.",
  "properties": {
    "answer": {
      "title": "Answer",
      "type": "string"
    },
    "citations": {
      "items": {
        "$ref": "#/$defs/ChatCitation"
      },
      "title": "Citations",
      "type": "array"
    },
    "clarifying_question": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Clarifying Question"
    },
    "fake_mode": {
      "title": "Fake Mode",
      "type": "boolean"
    },
    "intent": {
      "title": "Intent",
      "type": "string"
    },
    "persona": {
      "$ref": "#/$defs/PersonaCore"
    },
    "question": {
      "title": "Question",
      "type": "string"
    },
    "response": {
      "$ref": "#/$defs/ChatResponse"
    },
    "retrieved_chunks": {
      "items": {
        "$ref": "#/$defs/RetrievedChunk"
      },
      "title": "Retrieved Chunks",
      "type": "array"
    },
    "telemetry": {
      "$ref": "#/$defs/ChatTelemetry"
    },
    "timestamp": {
      "title": "Timestamp",
      "type": "string"
    }
  },
  "required": [
    "question",
    "answer",
    "response",
    "persona",
    "fake_mode",
    "intent",
    "telemetry",
    "timestamp"
  ],
  "title": "ChatTurn",
  "type": "object"
}
