import numpy as np
from scipy.special import softmax

# Initialize weight matrices for each direction condition
weights = {
    'up': np.zeros((8,52)),
    'down': np.zeros((8,52)), 
    'left': np.zeros((8,52)), 
    'right': np.zeros((8,52)) 
}

# Up condition weights
weights['up'][4:7, 20:30] = 1  # Emphasize main peak region for channels 4-6
weights['up'][4:7, 30:35] = 0.8  # Smaller peak region for channels 4-6
weights['up'] = softmax(weights['up'], axis=None) * 10

# Down condition weights
weights['down'][1, 20:40] = 0.7       # Main peak for channel 3
weights['down'][2, 30:50] = 1.0   # Supporting channels 6-7 in the main peak range
weights['down'] = softmax(weights['down'], axis=None) * 10

# Left condition weights
weights['left'][1, 30:40] = 1       # Main peak for channel 2
weights['left'][3:5, 40:50] = 0.8   # Supporting channels 4-5 in the main peak range
weights['left'] = softmax(weights['left'], axis=None) * 25

# Right condition weights
weights['right'][0, 30:50] = 1       # Main peak for channel 1
weights['right'][4, 30:50] = 0.8     # Support for channel 5 in the main peak range
weights['right'][7, 30:50] = 0.9     # Secondary peak region for channel 8
weights['right'] = softmax(weights['right'], axis=None) * 25

# # max_2024_11_07_4: velocity (known working)
model = {
    'mode': 1, 
    'coeff': np.array([
        [-0.010000,-0.007500], 
        [ 0.000060, 0.000080],
        [-0.000015, 0.000040],
        [-0.000050, 0.000050],
        [-0.000105, 0.000040],
        [-0.000050, 0.000010],
        [-0.000100, 0.000075],
        [ 0.000090,-0.000150],
        [ 0.000050, 0.000030]
    ])
}

# # max_2024_11_07_4: velocity (known working; variant: no bounding)
# model = {
#     'mode': 3, 
#     'coeff': np.array([
#         [-0.010000,-0.007500], 
#         [ 0.000060, 0.000080],
#         [-0.000015, 0.000040],
#         [-0.000050, 0.000050],
#         [-0.000105, 0.000040],
#         [-0.000050, 0.000010],
#         [-0.000100, 0.000075],
#         [ 0.000090,-0.000150],
#         [ 0.000050, 0.000030]
#     ])
# }

# # # max_2024_11_07_4: velocity (known working; variant: no bounding)
# model = {
#     'mode': 4, 
#     'coeff': np.array([
#         [-0.010000,-0.007500, 0.0], 
#         [ 0.000060, 0.000080, 0.0],
#         [-0.000015, 0.000040, 0.0],
#         [-0.000050, 0.000050, 0.0],
#         [-0.000105, 0.000040, 0.0],
#         [-0.000050, 0.000010, 0.0],
#         [-0.000100, 0.000075, 0.0],
#         [ 0.000090,-0.000150, 0.0],
#         [ 0.000050, 0.000030, 0.0]
#     ])
# }

# # # # max_2025_03_28_12: rates (angular velocity x/y + button)
# model = {
#     'mode': 4, 
#     'coeff': np.array([
#         [0.00756040,-0.03745719,-0.10316255],
#         [-0.00133703,-0.00194472,-0.05901467],
#         [0.00010629,-0.00049768,0.04830102],
#         [0.00112625,-0.00084525,0.03037631],
#         [-0.00456892,0.00523675,0.02660028],
#         [0.00054971,0.00540615,-0.01663413],
#         [0.00069700,-0.00089077,-0.01177690],
#         [0.00359386,-0.00280556,-0.03592421],
#         [-0.00308145,0.00201486,0.03131329],
#         [0.00248250,0.00040010,-0.01678088],
#         [-0.00013776,-0.00151619,0.05120621],
#         [-0.00454886,-0.00198858,-0.00604682],
#         [0.00477951,0.00369107,-0.00261291],
#         [-0.01019500,-0.00398626,0.04985202],
#         [-0.00107842,-0.00138998,-0.00249002],
#         [0.00829700,-0.00508561,0.00670568],
#         [-0.00001063,0.00151553,-0.05529197],
#         [0.00269342,-0.00064980,-0.01855449],
#         [-0.00426026,0.00083102,-0.05730447],
#         [-0.00494070,0.00227514,-0.02410296],
#         [-0.00350242,0.00326275,0.04387250],
#         [0.00264337,0.00000152,0.01339342],
#         [0.00492149,0.00090677,0.03138933],
#         [0.00332356,0.00277211,0.00550738],
#         [0.00679557,0.00045049,-0.00140610],
#         [-0.00435288,0.00130111,0.02597133],
#         [-0.00286185,0.00008873,-0.02171440],
#         [-0.00019495,-0.00061974,0.01616804],
#         [0.00299740,-0.00410713,0.00547010],
#         [-0.00273184,0.00413397,-0.03224383],
#         [0.00072964,-0.00162851,0.04601371],
#         [-0.00166353,-0.00291835,0.00569045],
#         [0.00351283,0.00044076,-0.03691943]
#     ])
# }

# # mcp06_2025_03_28_26: rates (angular velocity x/y + button)
# model = {
#     'mode': 4, 
#     'coeff': np.array([
#         [0.05704446,-0.04057949,0.00000000],
#         [0.00000341,-0.00067906,0.00000000],
#         [-0.00126093,0.00159007,0.00000000],
#         [0.00296111,0.00189569,0.00000000],
#         [0.00453154,0.00058457,0.00000000],
#         [0.00988283,0.00046729,0.00000000],
#         [-0.00807234,0.00250225,0.00000000],
#         [0.00176694,0.00015240,0.00000000],
#         [0.00137136,-0.00179012,0.00000000],
#         [-0.00673551,-0.00147220,0.00000000],
#         [-0.00181380,-0.00190859,0.00000000],
#         [-0.00375311,0.00216982,0.00000000],
#         [0.00058181,-0.00101201,0.00000000],
#         [0.00442049,0.00422205,0.00000000],
#         [-0.00071638,0.00074876,0.00000000],
#         [-0.00394018,-0.00104550,0.00000000],
#         [0.01005629,-0.00158298,0.00000000],
#         [0.00108972,-0.00011698,0.00000000],
#         [-0.00130192,0.00137764,0.00000000],
#         [0.00360801,0.00220856,0.00000000],
#         [-0.00021978,0.00137767,0.00000000],
#         [-0.00628606,-0.00064223,0.00000000],
#         [0.00330852,-0.00054990,0.00000000],
#         [0.00142587,-0.00199116,0.00000000],
#         [-0.00609415,-0.00434922,0.00000000],
#         [0.00304050,-0.00007453,0.00000000],
#         [0.00609127,-0.00092982,0.00000000],
#         [-0.00568434,0.00094735,0.00000000],
#         [-0.00041596,-0.00193698,0.00000000],
#         [-0.00579424,-0.00143760,0.00000000],
#         [0.00005030,0.00278098,0.00000000],
#         [-0.00389730,0.00063913,0.00000000],
#         [-0.00285945,0.00140821,0.00000000]
#     ])
# }

# Online adaptation
# model={
#         'mode': 1,
#         'coeff': np.array([
#         [-9.999351e-03, -7.504919e-03],
#         [5.545079e-05, 8.110349e-05],
#         [-1.987208e-05, 4.693801e-05],
#         [-4.870495e-05, 5.747001e-05],
#         [-1.112748e-04, 3.288309e-05],
#         [-5.747018e-05, 4.837812e-06],
#         [-1.031452e-04, 7.339089e-05],
#         [9.232604e-05, -1.373009e-04],
#         [5.405266e-05, 4.204875e-05],
#         ])
# }

# # Online adaptation after rotate closer to BR
# model={
#         'mode': 1,
#         'coeff': np.array([
#         [-9.972024e-03, -7.602789e-03],
#         [-1.621469e-05, 1.800703e-04],
#         [-1.223527e-04, 1.068493e-04],
#         [-6.119123e-05, 1.227209e-04],
#         [-1.053916e-04, -9.419224e-05],
#         [1.089788e-05, -1.093254e-04],
#         [-2.511346e-05, 1.113106e-04],
#         [2.830185e-05, -1.364669e-04],
#         [2.620430e-04, 7.986850e-05],
#         ])
# }

# # Offline max_2024_11_07_4: Python
# model={
#         'mode': 1,
#         'coeff': np.array([
#         [2.201020e-04, 4.672849e-05],
#         [1.162302e-04, -3.285221e-05],
#         [2.884276e-05, 2.993521e-04],
#         [-3.334405e-05, 1.172134e-04],
#         [-8.291521e-05, -1.374896e-04],
#         [-1.198460e-04, -2.599455e-04],
#         [-1.054993e-04, 4.186384e-04],
#         [1.302834e-04, -2.667105e-04],
#         [-4.656223e-05, 8.636186e-05],
#         ])
# }

# # max_2024_11_11_2: small velocity
# model = {
#     'mode': 1, 
#     'coeff': np.array([
#         [-0.00112749,-0.00138833],
#         [0.00000000,-0.00000000],
#         [0.00001261,0.00004837],
#         [0.00000579,0.00005708],
#         [-0.00001161,0.00001590],
#         [-0.00003875,-0.00001560],
#         [-0.00002217,-0.00001820],
#         [-0.00000339,-0.00000272],
#         [0.00001499,-0.00000689]
#     ])
# }

# max_2024_11_11_2: acceleration
# model = {
#     'mode': 2, 
#     'coeff': np.array([
#         [0.00002984,-0.00001880],
#         [-0.00000000,0.00000000],
#         [-0.00000046,-0.00000021],
#         [-0.00000023,0.00000053],
#         [-0.00000023,-0.00000021],
#         [-0.00000013,-0.00000093],
#         [0.00000013,-0.00000064],
#         [0.00000061,0.00000040],
#         [-0.00000042,-0.00000003]
#     ])
# }

# # max_2024_11_13_8: velocity/rates
# model = {
#     'mode': 1, 
#     'coeff': np.array([
#         [-0.00317492,0.00369311],
#         [0.00626445,-0.00363374],
#         [0.00341571,-0.00013391],
#         [-0.00298006,-0.00097614],
#         [-0.00179568,0.00103421],
#         [0.00504991,-0.00065019],
#         [-0.00246818,0.00041699],
#         [-0.00233796,0.00202569],
#         [-0.00666736,0.00409588]
#     ])
# }

if __name__ == "__main__":
    # Flatten the coefficient matrix (row-major order)
    flattened_coeff = model['coeff'].flatten()

    # Save as binary file (Little-Endian, Float32)
    with open("weights.bin", "wb") as f:
        flattened_coeff.astype(np.float32).tofile(f)

    print(f"âœ… Weights saved to weights.bin with shape {model['coeff'].shape}")
