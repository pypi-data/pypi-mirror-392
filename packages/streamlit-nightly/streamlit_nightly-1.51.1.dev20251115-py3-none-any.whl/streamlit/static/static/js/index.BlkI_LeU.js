import{r as o,L as R,e as T,B as w,f as U,j as d,b as v,c as I,D as A,a as j,S as N}from"./index.BTj4XZUf.js";import{c as C}from"./createDownloadLinkElement.ZaXNnPK4.js";function Y(E){const{disabled:y,element:c,widgetMgr:m,endpoints:n,fragmentId:B}=E,{help:S,label:x,icon:L,ignoreRerun:g,type:p,url:h,deferredFileId:t}=c,[k,u]=o.useState(!1),[l,r]=o.useState(null),{enforceDownloadInNewTab:a=!1}=o.useContext(R),{requestDeferredFile:f}=o.useContext(T);let D=w.SECONDARY;p==="primary"?D=w.PRIMARY:p==="tertiary"&&(D=w.TERTIARY);const i=o.useMemo(()=>n.buildDownloadUrl(h),[n,h]);o.useEffect(()=>{!!t?.length||n.checkSourceUrlResponse(i,"Download Button")},[i,n,t]);const b=o.useCallback(async()=>{if(!f||!t){r("Deferred download not properly configured");return}u(!0),r(null);try{const e=await f(t);if(e.errorMsg){r(e.errorMsg),u(!1);return}const s=n.buildDownloadUrl(e.url);n.checkSourceUrlResponse(s,"Download Button"),C({filename:"",url:s,enforceDownloadInNewTab:a}).click()}catch(e){const s=e instanceof Error?e.message:"Download failed";r(s)}finally{u(!1)}},[f,t,n,a]),M=o.useCallback(()=>{g||m.setTriggerValue(c,{fromUi:!0},B),!!t?.length?b():C({filename:"",url:i,enforceDownloadInNewTab:a}).click()},[g,m,c,B,t,b,i,a]);return o.useEffect(()=>{if(l){const e=setTimeout(()=>r(null),5e3);return()=>clearTimeout(e)}},[l]),U("div",{className:"stDownloadButton","data-testid":"stDownloadButton",children:[d(j,{help:S,containerWidth:!0,children:d(v,{kind:D,size:I.SMALL,disabled:y||k,onClick:M,containerWidth:!0,children:d(A,{icon:k?"spinner":L,label:x})})}),l&&d(N,{"data-testid":"stDownloadButtonError",children:l})]})}const q=o.memo(Y);export{q as default};
