import{r,E as q,_ as M,w as k,aD as T,n as h,p as J,y as de,u as pe,a7 as fe,a8 as me,aE as _,f as W,j as u,l as be,W as ge,T as he,P as ye,X as Ie,a9 as Te,z as we,ap as X}from"./index.BTj4XZUf.js";import{u as Ce}from"./uniqueId.BkmntDB0.js";import{I as Se}from"./InputInstructions.Dj-242_o.js";import{u as ve}from"./FormClearHelper.BaLOtzQI.js";import{s as Ve}from"./sprintf.D7DtBTRn.js";import{I as xe}from"./input.DCyVgqSz.js";import"./base-input.fUoO5PcK.js";var Q=r.forwardRef(function(e,t){var a={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(q,M({iconAttrs:a,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:t}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});Q.displayName="Minus";var Y=r.forwardRef(function(e,t){var a={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(q,M({iconAttrs:a,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:t}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});Y.displayName="Plus";const De=k("div",{target:"eaba2yi0"})(({theme:e})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:e.sizes.minElementHeight,borderWidth:e.sizes.borderWidth,borderStyle:"solid",borderColor:e.colors.widgetBorderColor??e.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:e.radii.default,overflow:"hidden","&.focused":{borderColor:e.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:e.spacing.none}}})),Ee=k("div",{target:"eaba2yi1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),G=k("button",{target:"eaba2yi2"})(({theme:e})=>({margin:e.spacing.none,border:"none",height:e.sizes.full,display:"flex",alignItems:"center",width:e.sizes.numberInputControlsWidth,justifyContent:"center",color:e.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:e.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:e.colors.white,backgroundColor:e.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:disabled":{cursor:"not-allowed",color:e.colors.fadedText40}})),ke=k("div",{target:"eaba2yi3"})(({theme:e,clearable:t})=>({position:"absolute",marginRight:e.spacing.twoXS,left:0,right:`calc(${e.sizes.numberInputControlsWidth} * 2 + ${t?"1em":"0em"})`})),Re=de.getLogger("NumberInput");function Ne(e){return h(e)||e===""?void 0:e}const E=({value:e,format:t,step:a,dataType:m})=>{if(h(e))return null;let o=Ne(t);if(h(o)&&J(a)){const i=a.toString();m===T.DataType.FLOAT&&a!==0&&i.includes(".")&&(o=`%0.${i.split(".")[1].length}f`)}if(h(o))return e.toString();try{return Ve.sprintf(o,e)}catch(i){return Re.warn(`Error in sprintf(${o}, ${e}): ${i}`),String(e)}},Fe=(e,t,a)=>h(e)?!1:e-t>=a,ze=(e,t,a)=>h(e)?!1:e+t<=a,We=e=>(e.element.dataType===T.DataType.INT?e.widgetMgr.getIntValue(e.element):e.widgetMgr.getDoubleValue(e.element))??e.element.default??null,K=({step:e,dataType:t})=>e||(t===T.DataType.INT?1:.01),Le=({disabled:e,element:t,widgetMgr:a,fragmentId:m})=>{const o=pe(),{dataType:i,id:v,formId:f,default:L,format:b,icon:R,min:y,max:I}=t,{width:B,elementRef:Z}=fe(),[s,ee]=r.useState(()=>K(t)),P=We({element:t,widgetMgr:a}),[g,w]=r.useState(!1),[l,C]=r.useState(P),[U,H]=r.useState(!1),V=r.useRef(null),A=r.useRef(Ce("number_input_")),[$,S]=r.useState(()=>E({value:P,dataType:i,format:b,step:s})),x=Fe(l,s,y),D=ze(l,s,I),O=me({formId:f}),te=O?a.allowFormEnterToSubmit(f):g,oe=U&&B>o.breakpoints.hideWidgetDetails;r.useEffect(()=>{ee(K({step:t.step,dataType:t.dataType}))},[t.dataType,t.step]),r.useEffect(()=>{g||S(E({value:l,dataType:i,format:b,step:s}))},[i,b,s]);const d=r.useCallback(({value:n,source:c})=>{if(J(n)&&(y>n||n>I))V.current?.reportValidity();else{const p=n??L??null;switch(i){case T.DataType.INT:a.setIntValue({id:v,formId:f},p,c,m);break;case T.DataType.FLOAT:a.setDoubleValue({id:v,formId:f},p,c,m);break;default:throw new Error("Invalid data type")}w(!1),C(p),S(E({value:p,dataType:i,format:b,step:s}))}},[y,I,V,a,m,s,i,v,f,L,b]),re=r.useCallback(()=>{g&&d({value:l,source:{fromUi:!0}}),H(!1)},[g,l,d]),ne=r.useCallback(()=>{H(!0)},[]),j=r.useCallback(()=>{const{value:n}=t;t.setValue=!1,C(n??null),S(E({value:n??null,dataType:i,format:b,step:s})),d({value:n??null,source:{fromUi:!1}})},[t,s,d,i,b]);r.useEffect(()=>{t.setValue?j():d({value:l,source:{fromUi:!1}});const n=V.current;if(n){const c=p=>{p.preventDefault()};return n.addEventListener("wheel",c),()=>{n.removeEventListener("wheel",c)}}},[]),t.setValue&&j();const N=h(t.default)&&!e,ae=r.useCallback(()=>{const n=t.default??null;C(n),d({value:n,source:{fromUi:!0}})},[t]);ve({element:t,widgetMgr:a,onFormCleared:ae});const se=n=>{const{value:c}=n.target;if(c==="")w(!0),C(null),S(null);else{let p;t.dataType===T.DataType.INT?p=parseInt(c,10):p=parseFloat(c),w(!0),C(p),S(c)}},F=r.useCallback(()=>{D&&(w(!0),d({value:(l??y)+s,source:{fromUi:!0}}))},[l,y,s,D]),z=r.useCallback(()=>{x&&(w(!0),d({value:(l??I)-s,source:{fromUi:!0}}))},[l,I,s,x]),ie=r.useCallback(n=>{const{key:c}=n;switch(c){case"ArrowUp":n.preventDefault(),F();break;case"ArrowDown":n.preventDefault(),z();break}},[F,z]),le=r.useCallback(n=>{n.key==="Enter"&&(g&&d({value:l,source:{fromUi:!0}}),a.allowFormEnterToSubmit(f)&&a.submitForm(f,m))},[g,l,d,a,f,m]),ce=_(o.iconSizes.lg)+2*_(o.spacing.twoXS),ue=R?o.breakpoints.hideNumberInputControls+ce:o.breakpoints.hideNumberInputControls;return W("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:Z,children:[u(Ie,{label:t.label,disabled:e,labelVisibility:be(t.labelVisibility?.value),htmlFor:A.current,children:t.help&&u(ge,{children:u(he,{content:t.help,placement:ye.TOP_RIGHT})})}),W(De,{className:U?"focused":"","data-testid":"stNumberInputContainer",children:[u(xe,{type:"number",inputRef:V,value:$??"",placeholder:t.placeholder,onBlur:re,onFocus:ne,onChange:se,onKeyPress:le,onKeyDown:ie,clearable:N,clearOnEscape:N,disabled:e,"aria-label":t.label,startEnhancer:t.icon&&u(we,{"data-testid":"stNumberInputIcon",iconValue:t.icon,size:"lg"}),id:A.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:o.colors.grayTextColor,padding:o.spacing.threeXS,height:o.sizes.clearIconSize,width:o.sizes.clearIconSize,":hover":{fill:o.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:s,min:y,max:I,type:"number",inputMode:""},style:{fontWeight:o.fontWeights.normal,lineHeight:o.lineHeights.inputWidget,paddingRight:o.spacing.sm,paddingLeft:o.spacing.md,paddingBottom:o.spacing.sm,paddingTop:o.spacing.sm,"::placeholder":{color:o.colors.fadedText60}}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0,paddingLeft:R?o.spacing.sm:0}},StartEnhancer:{style:{paddingLeft:0,paddingRight:0,minWidth:o.iconSizes.lg,color:Te(R)?o.colors.fadedText60:"inherit"}}}}),B>ue&&W(Ee,{children:[u(G,{"data-testid":"stNumberInputStepDown",onClick:z,disabled:!x||e,tabIndex:-1,children:u(X,{content:Q,size:"xs",color:x?"inherit":o.colors.fadedText40})}),u(G,{"data-testid":"stNumberInputStepUp",onClick:F,disabled:!D||e,tabIndex:-1,children:u(X,{content:Y,size:"xs",color:D?"inherit":o.colors.fadedText40})})]})]}),oe&&u(ke,{clearable:N,children:u(Se,{dirty:g,value:$??"",inForm:O,allowEnterToSubmit:te})})]})},je=r.memo(Le);export{je as default};
