{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "autosize": {
    "contains": "padding",
    "resize": false,
    "type": "fit"
  },
  "config": {
    "axis": {
      "labelFontSize": 14,
      "labelFontWeight": 300,
      "titleFontSize": 16,
      "titleFontWeight": 400,
      "titlePadding": 10
    },
    "concat": {
      "spacing": 0
    },
    "legend": {
      "labelFontSize": 14,
      "labelFontWeight": 300,
      "orient": "top",
      "padding": 20,
      "symbolSize": 500.0,
      "symbolType": "circle",
      "titleFontSize": 16,
      "titleFontWeight": 400
    },
    "title": {
      "anchor": "start",
      "fontSize": 18,
      "fontWeight": 400,
      "subtitlePadding": 10
    },
    "view": {
      "continuousHeight": 300,
      "continuousWidth": 400,
      "stroke": null
    }
  },
  "params": [
    {
      "bind": "legend",
      "name": "param_1",
      "select": {
        "fields": [
          "set"
        ],
        "type": "point"
      },
      "views": [
        "view_2",
        "view_3",
        "view_4",
        "view_0",
        "view_1"
      ]
    },
    {
      "name": "param_0",
      "select": {
        "fields": [
          "intersection_id"
        ],
        "on": "mouseover",
        "type": "point"
      },
      "views": [
        "view_0",
        "view_1"
      ]
    }
  ],
  "resolve": {
    "scale": {
      "x": "shared"
    }
  },
  "spacing": 5,
  "title": {
    "fontSize": 20,
    "fontWeight": 500,
    "subtitle": "Set bars on top, intersection matrix below",
    "subtitleColor": "#3A3A3A",
    "subtitleFontSize": 14,
    "text": "Vertical UpSet Plot"
  },
  "vconcat": [
    {
      "hconcat": [
        {
          "encoding": {
            "x": {
              "axis": null,
              "field": "x",
              "type": "quantitative"
            },
            "y": {
              "axis": null,
              "field": "y",
              "type": "quantitative"
            }
          },
          "height": 360.0,
          "mark": {
            "opacity": 0,
            "size": 0,
            "type": "point"
          },
          "name": "view_4",
          "width": 120
        },
        {
          "spacing": 0,
          "vconcat": [
            {
              "encoding": {
                "color": {
                  "field": "set",
                  "scale": {
                    "domain": [
                      "A",
                      "B",
                      "C"
                    ],
                    "range": [
                      "#55A8DB",
                      "#3070B5",
                      "#30363F",
                      "#F1AD60",
                      "#DF6234",
                      "#BDC6CA"
                    ]
                  },
                  "title": null,
                  "type": "nominal"
                },
                "opacity": {
                  "value": 1
                },
                "x": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "title": null,
                  "type": "nominal"
                },
                "y": {
                  "aggregate": "sum",
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "offset": 0,
                    "tickCount": 3,
                    "titlePadding": 5
                  },
                  "field": "count",
                  "scale": {
                    "nice": true,
                    "padding": 0.1,
                    "zero": true
                  },
                  "title": "Set Size",
                  "type": "quantitative"
                }
              },
              "height": 320.0,
              "mark": {
                "color": "#3A3A3A",
                "size": 20,
                "type": "bar"
              },
              "name": "view_2",
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": "(datum['is_intersect'] === 1)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ],
              "width": 680
            },
            {
              "height": 40,
              "layer": [
                {
                  "encoding": {
                    "color": {
                      "field": "set",
                      "scale": {
                        "domain": [
                          "A",
                          "B",
                          "C"
                        ],
                        "range": [
                          "#55A8DB",
                          "#3070B5",
                          "#30363F",
                          "#F1AD60",
                          "#DF6234",
                          "#BDC6CA"
                        ]
                      },
                      "title": null,
                      "type": "nominal"
                    },
                    "opacity": {
                      "value": 1
                    },
                    "x": {
                      "axis": {
                        "domain": false,
                        "grid": false,
                        "labels": false,
                        "ticks": false
                      },
                      "field": "set_order",
                      "scale": {
                        "paddingInner": 0,
                        "paddingOuter": 0
                      },
                      "title": null,
                      "type": "nominal"
                    }
                  },
                  "mark": {
                    "size": 500,
                    "type": "circle"
                  },
                  "name": "view_3",
                  "transform": [
                    {
                      "aggregate": [
                        {
                          "as": "count",
                          "field": "count",
                          "op": "sum"
                        }
                      ],
                      "groupby": [
                        "A",
                        "B",
                        "C"
                      ]
                    },
                    {
                      "as": "degree",
                      "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                    },
                    {
                      "as": [
                        "set",
                        "is_intersect"
                      ],
                      "fold": [
                        "A",
                        "B",
                        "C"
                      ]
                    },
                    {
                      "filter": "(datum['degree'] !== 0)"
                    },
                    {
                      "filter": {
                        "param": "param_1"
                      }
                    },
                    {
                      "filter": {
                        "param": "param_1"
                      }
                    },
                    {
                      "frame": [
                        null,
                        0
                      ],
                      "sort": [
                        {
                          "field": "set_order"
                        }
                      ],
                      "window": [
                        {
                          "as": "set_order",
                          "field": "set",
                          "op": "distinct"
                        }
                      ]
                    },
                    {
                      "frame": [
                        null,
                        null
                      ],
                      "window": [
                        {
                          "as": "intersection_id",
                          "field": "",
                          "op": "row_number"
                        }
                      ]
                    },
                    {
                      "from": {
                        "fields": [
                          "set_abbre"
                        ],
                        "key": "set"
                      },
                      "lookup": "set"
                    },
                    {
                      "from": {
                        "fields": [
                          "set_order"
                        ],
                        "key": "set"
                      },
                      "lookup": "set"
                    },
                    {
                      "groupby": [
                        "intersection_id",
                        "count"
                      ],
                      "op": "max",
                      "pivot": "set",
                      "value": "is_intersect"
                    }
                  ]
                },
                {
                  "encoding": {
                    "color": {
                      "value": "white"
                    },
                    "opacity": {
                      "value": 1
                    },
                    "text": {
                      "field": "set_abbre",
                      "type": "nominal"
                    },
                    "x": {
                      "axis": {
                        "domain": false,
                        "grid": false,
                        "labels": false,
                        "ticks": false
                      },
                      "field": "set_order",
                      "scale": {
                        "paddingInner": 0,
                        "paddingOuter": 0
                      },
                      "title": null,
                      "type": "nominal"
                    }
                  },
                  "mark": {
                    "align": "center",
                    "type": "text"
                  },
                  "transform": [
                    {
                      "aggregate": [
                        {
                          "as": "count",
                          "field": "count",
                          "op": "sum"
                        }
                      ],
                      "groupby": [
                        "A",
                        "B",
                        "C"
                      ]
                    },
                    {
                      "as": "degree",
                      "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                    },
                    {
                      "as": [
                        "set",
                        "is_intersect"
                      ],
                      "fold": [
                        "A",
                        "B",
                        "C"
                      ]
                    },
                    {
                      "filter": "(datum['degree'] !== 0)"
                    },
                    {
                      "filter": {
                        "param": "param_1"
                      }
                    },
                    {
                      "filter": {
                        "param": "param_1"
                      }
                    },
                    {
                      "frame": [
                        null,
                        0
                      ],
                      "sort": [
                        {
                          "field": "set_order"
                        }
                      ],
                      "window": [
                        {
                          "as": "set_order",
                          "field": "set",
                          "op": "distinct"
                        }
                      ]
                    },
                    {
                      "frame": [
                        null,
                        null
                      ],
                      "window": [
                        {
                          "as": "intersection_id",
                          "field": "",
                          "op": "row_number"
                        }
                      ]
                    },
                    {
                      "from": {
                        "fields": [
                          "set_abbre"
                        ],
                        "key": "set"
                      },
                      "lookup": "set"
                    },
                    {
                      "from": {
                        "fields": [
                          "set_order"
                        ],
                        "key": "set"
                      },
                      "lookup": "set"
                    },
                    {
                      "groupby": [
                        "intersection_id",
                        "count"
                      ],
                      "op": "max",
                      "pivot": "set",
                      "value": "is_intersect"
                    }
                  ]
                }
              ],
              "width": 680
            }
          ]
        }
      ],
      "spacing": 0
    },
    {
      "hconcat": [
        {
          "height": 240.0,
          "layer": [
            {
              "encoding": {
                "color": {
                  "condition": {
                    "test": {
                      "not": {
                        "param": "param_0"
                      }
                    },
                    "value": "#3A3A3A"
                  },
                  "value": "#EA4667"
                },
                "text": {
                  "field": "count",
                  "format": ".0f",
                  "type": "quantitative"
                },
                "tooltip": [
                  {
                    "field": "count",
                    "title": "Cardinality",
                    "type": "quantitative"
                  },
                  {
                    "field": "degree",
                    "title": "Degree",
                    "type": "quantitative"
                  }
                ],
                "x": {
                  "aggregate": "max",
                  "axis": {
                    "grid": false,
                    "offset": 0,
                    "orient": "bottom",
                    "tickCount": 3,
                    "titlePadding": 5
                  },
                  "field": "count",
                  "scale": {
                    "nice": false,
                    "padding": 0,
                    "zero": true
                  },
                  "title": "Intersection Size",
                  "type": "quantitative"
                },
                "y": {
                  "axis": {
                    "domain": true,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "align": "left",
                "color": "#3A3A3A",
                "dx": 10,
                "size": 16,
                "type": "text"
              },
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            },
            {
              "encoding": {
                "color": {
                  "condition": {
                    "test": {
                      "not": {
                        "param": "param_0"
                      }
                    },
                    "value": "#3A3A3A"
                  },
                  "value": "#EA4667"
                },
                "tooltip": [
                  {
                    "field": "count",
                    "title": "Cardinality",
                    "type": "quantitative"
                  },
                  {
                    "field": "degree",
                    "title": "Degree",
                    "type": "quantitative"
                  }
                ],
                "x": {
                  "aggregate": "max",
                  "axis": {
                    "grid": false,
                    "offset": 0,
                    "orient": "bottom",
                    "tickCount": 3,
                    "titlePadding": 5
                  },
                  "field": "count",
                  "scale": {
                    "nice": false,
                    "padding": 0,
                    "zero": true
                  },
                  "title": "Intersection Size",
                  "type": "quantitative"
                },
                "y": {
                  "axis": {
                    "domain": true,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "color": "#3A3A3A",
                "size": 25.0,
                "type": "bar"
              },
              "name": "view_1",
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            }
          ],
          "width": 120
        },
        {
          "height": 240.0,
          "layer": [
            {
              "encoding": {
                "color": {
                  "condition": {
                    "test": {
                      "not": {
                        "param": "param_0"
                      }
                    },
                    "value": "#3A3A3A"
                  },
                  "value": "#EA4667"
                },
                "x": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "title": null,
                  "type": "nominal"
                },
                "y": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "opacity": 1,
                "size": 100,
                "type": "circle"
              },
              "name": "view_0",
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": "(datum['is_intersect'] === 1)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            },
            {
              "encoding": {
                "color": {
                  "condition": {
                    "test": {
                      "not": {
                        "param": "param_0"
                      }
                    },
                    "value": "#3A3A3A"
                  },
                  "value": "#EA4667"
                },
                "x": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "title": null,
                  "type": "nominal"
                },
                "y": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "opacity": 1,
                "size": 100,
                "type": "circle"
              },
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": "(datum['is_intersect'] === 1)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            },
            {
              "encoding": {
                "color": {
                  "value": "#E6E6E6"
                },
                "x": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "title": null,
                  "type": "nominal"
                },
                "y": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "opacity": 1,
                "size": 100,
                "type": "circle"
              },
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            },
            {
              "encoding": {
                "color": {
                  "value": "#F7F7F7"
                },
                "x": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "title": null,
                  "type": "nominal"
                },
                "y": {
                  "axis": {
                    "domain": false,
                    "grid": false,
                    "labels": false,
                    "ticks": false
                  },
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "title": null,
                  "type": "nominal"
                }
              },
              "mark": {
                "type": "rect"
              },
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "((datum['set_order'] % 2) === 1)"
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            },
            {
              "encoding": {
                "x": {
                  "aggregate": "min",
                  "field": "set_order",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "type": "nominal"
                },
                "x2": {
                  "aggregate": "max",
                  "field": "set_order"
                },
                "y": {
                  "field": "intersection_id",
                  "scale": {
                    "paddingInner": 0,
                    "paddingOuter": 0
                  },
                  "sort": {
                    "field": "count",
                    "order": "ascending"
                  },
                  "type": "nominal"
                }
              },
              "mark": {
                "color": "#3A3A3A",
                "size": 1,
                "type": "bar"
              },
              "transform": [
                {
                  "aggregate": [
                    {
                      "as": "count",
                      "field": "count",
                      "op": "sum"
                    }
                  ],
                  "groupby": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "as": "degree",
                  "calculate": "(isDefined(datum['A']) ? datum['A'] : 0)+(isDefined(datum['B']) ? datum['B'] : 0)+(isDefined(datum['C']) ? datum['C'] : 0)"
                },
                {
                  "as": [
                    "set",
                    "is_intersect"
                  ],
                  "fold": [
                    "A",
                    "B",
                    "C"
                  ]
                },
                {
                  "filter": "(datum['degree'] !== 0)"
                },
                {
                  "filter": "(datum['is_intersect'] === 1)"
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "filter": {
                    "param": "param_1"
                  }
                },
                {
                  "frame": [
                    null,
                    0
                  ],
                  "sort": [
                    {
                      "field": "set_order"
                    }
                  ],
                  "window": [
                    {
                      "as": "set_order",
                      "field": "set",
                      "op": "distinct"
                    }
                  ]
                },
                {
                  "frame": [
                    null,
                    null
                  ],
                  "window": [
                    {
                      "as": "intersection_id",
                      "field": "",
                      "op": "row_number"
                    }
                  ]
                },
                {
                  "from": {
                    "fields": [
                      "set_abbre"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "from": {
                    "fields": [
                      "set_order"
                    ],
                    "key": "set"
                  },
                  "lookup": "set"
                },
                {
                  "groupby": [
                    "intersection_id",
                    "count"
                  ],
                  "op": "max",
                  "pivot": "set",
                  "value": "is_intersect"
                }
              ]
            }
          ],
          "width": 680
        }
      ],
      "resolve": {
        "scale": {
          "y": "shared"
        }
      },
      "spacing": 0
    }
  ]
}
