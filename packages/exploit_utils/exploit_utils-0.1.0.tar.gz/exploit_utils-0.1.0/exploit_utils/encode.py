"""常见编码的编解码操作"""

import base64
import html
import urllib.parse
from typing import Iterable


__all__ = [
    "sjoin", "base64_encode", "base64_decode", "url_encode", "url_decode",
    "html_encode", "html_decode",
]


def sjoin(texts: Iterable[str], front: str = "", mid: str = "", after: str = "") -> str:
    """以特定格式编排数据"""
    return mid.join(f"{front}{i}{after}" for i in texts)


def hex2(i: int) -> str:
    return hex(i)[2:].zfill(2)


def base64_encode(text: str | bytes, encoding: str = "utf-8") -> str:
    """base64 编码"""
    if isinstance(text, str):
        text = text.encode(encoding=encoding)
    return base64.b64encode(text).decode(encoding=encoding)


def base64_decode(text: str, tostr: bool = False, encoding: str = "utf-8") -> bytes | str:
    """base64 解码"""
    t = base64.b64decode(text)
    return t.decode(encoding=encoding) if tostr else t


def url_encode(text: str, encoding: str = "utf-8", all: bool = False) -> str:
    """URL 编码"""
    if all:
        return sjoin((hex2(i) for i in text.encode(encoding=encoding)), front="%")
    return urllib.parse.quote(text, encoding=encoding)


def url_decode(text: str, encoding: str | None = None) -> str:
    """URL 解码"""
    return urllib.parse.unquote(text, encoding=encoding)


def html_encode(text: str, all: bool = False):
    """HTML 编码"""
    if all:
        return sjoin((ord(i) for i in text), front="&#", after=";")
    return html.escape(text)


def html_decode(text: str):
    """HTML 解码"""
    return html.unescape(text)
