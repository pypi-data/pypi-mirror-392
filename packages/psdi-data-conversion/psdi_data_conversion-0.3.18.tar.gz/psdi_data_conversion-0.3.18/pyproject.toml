[build-system]
requires = ["hatchling==1.27.0", "hatch-vcs"]
build-backend = "hatchling.build"

[project]
name = "psdi_data_conversion"
authors = [
  { name = "Ray Whorley" },
  { name = "Don Cruickshank" },
  { name = "Samantha Pearman-Kanza", email = "s.pearman-kanza@soton.ac.uk" },
  { name = "Bryan Gillis", email = "7204836+brgillis@users.noreply.github.com" },
  { name = "Tom Underwood" },
]
description = "Chemistry file format conversion service, provided by PSDI"
readme = "README.md"
keywords = ["chemistry", "conversion", "openbabel", "atomsk", "flask"]
license = { file = "LICENSE" }
classifiers = [
  "Development Status :: 3 - Alpha",
  "Framework :: Flask",
  "Intended Audience :: Science/Research",
  "License :: OSI Approved :: Apache Software License",
  "Natural Language :: English",
  "Operating System :: POSIX :: Linux",
  "Programming Language :: JavaScript",
  "Programming Language :: Python :: 3",
  "Topic :: File Formats",
  "Topic :: Scientific/Engineering :: Chemistry",
]
dependencies = ["igraph", "openbabel-wheel", "py"]

# Note: The conversion of tarball/zip archives of files requires Python 3.12, but this is a rare use-case for local
# installation, so Python 3.11 is permitted here
requires-python = ">= 3.11"

# Version specification - we determine the version through git. If you wish to install this without it being in a git
# repository, you can do so by uncommenting the next line, then commenting out the block below which specifies how to
# determine the version from git

# version = "0.0.1"

# If using a fixed version, start commenting out from here
dynamic = ["version"]

[tool.hatch.version]
source = "vcs"

[tool.hatch.version.raw-options]
local_scheme = "no-local-version"
# If using a fixed version, stop commenting out here

[project.optional-dependencies]
test = ["pytest", "coverage"]
gui = ["Flask", "requests"]
gui-test = [
  "Flask",
  "requests",
  "pytest",
  "coverage",
  "selenium",
  "webdriver_manager",
]
deploy = ["cachetools", "Flask", "gunicorn", "PyJWT[crypto]", "requests"]
doc = [
  "pdoc3",
  "cachetools",
  "Flask",
  "gunicorn",
  "PyJWT[crypto]",
  "requests",
  "pytest",
  "selenium",
]
plots = ["matplotlib"]

[project.scripts]
psdi-data-convert = "psdi_data_conversion.main:main"
psdi-data-convert-gui = "psdi_data_conversion.main_gui:main"

[project.urls]
Homepage = "https://data-conversion.psdi.ac.uk/"
Documentation = "https://psdi-uk.github.io/psdi-data-conversion/"
Issues = "https://github.com/PSDI-UK/psdi-data-conversion/issues"
Changelog = "https://github.com/PSDI-UK/psdi-data-conversion/blob/main/CHANGELOG.md"

Repository = "https://github.com/PSDI-UK/psdi-data-conversion"
Download = "https://github.com/PSDI-UK/psdi-data-conversion/releases/latest"

[tool.hatch.build]
exclude = [
  ".github/**",
  "deploy/**",
  "scripts/fetch-common-style.*",
  "scripts/make-index-html.sh",
  "Dockerfile",
]

# The following lines run a script which excludes binaries for platforms other than the current from the binary.
# Once the project is set up to make separate builds for different platforms, the below can be uncommented to
# enable this behaviour.
# [tool.hatch.build.hooks.custom]
# path = "scripts/setup_bin.py"

[tool.pytest.ini_options]
pythonpath = ["."]

[tool.coverage.run]
source_pkgs = ["psdi_data_conversion"]
branch = true
# main_gui.py is tested via the Selenium tests, which are indirect enough that the coverage tool doesn't pick up that the
# lines are being tested, so we exclude it from the coverage % calculation
omit = [
  "*/testing/*",
  "main_gui.py",
  "*/gui/accessibility.py",
  "*/gui/get.py",
  "*/gui/post.py",
]

[tool.coverage.paths]
tests = ["tests/python"]

[tool.coverage.report]
exclude_lines = ["no cov", "if __name__ == .__main__.:", "if TYPE_CHECKING:"]
