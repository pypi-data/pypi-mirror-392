services:
  minio:
    image: minio/minio:latest
    command: server /data --console-address ":9001"
    environment:
    - MINIO_ROOT_USER=${MINIO_ROOT_USER:-miniokey}
    - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD:-miniosecret}
    ports:
    - 9000:9000
    - 9001:9001
    volumes:
    - minio_data:/data
    healthcheck:
      test: [CMD, curl, -f, http://localhost:9000/minio/health/live]
      interval: 30s
      timeout: 20s
      retries: 3

  minio-mc:
    image: minio/mc
    depends_on:
      minio:
        condition: service_healthy
    entrypoint: /bin/sh
    command: -c "until mc alias set local http://minio:9000 $$MINIO_ROOT_USER $$MINIO_ROOT_PASSWORD; do sleep 3; done && mc mb -p local/podcast || true && tail -f /dev/null"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-miniokey}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-miniosecret}

volumes:
  minio_data:
