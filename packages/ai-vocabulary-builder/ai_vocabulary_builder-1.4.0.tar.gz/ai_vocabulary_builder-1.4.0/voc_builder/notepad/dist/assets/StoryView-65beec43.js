import{d as b,r as c,J as a,y as g,o as S,a as N,b as k,n as x,g as r,h as t,i as D,m as v,j as p,w as L,A as E,l as m,F as V,k as M,e as T,f as A,p as P,q as i,t as h}from"./index-99739378.js";import{L as I}from"./LearnNav-e2a42dec.js";const J={class:"row mt-4"},O={class:"col-12"},U={class:"row mt-2"},B={class:"cols-12"},C=t("div",{class:"alert alert-info mt-2",role:"alert"}," Read stories, master vocabulary! ",-1),W={class:"d-flex align-items-center"},$=["disabled"],F=t("i",{class:"bi bi-book"},null,-1),H=t("span",{class:"ms-4"},"Use",-1),j=t("option",{value:"6"},"6",-1),q=t("option",{value:"12"},"12",-1),G=t("option",{value:"24"},"24",-1),R=[j,q,G],Y=t("span",{class:"ms-2"},"Words",-1),z={class:"row"},K={class:"cols-12"},Q=t("hr",{class:"mt-3"},null,-1),X={key:0,class:"alert alert-danger mt-2",role:"alert"},Z={key:1},tt=["innerHTML"],et=t("h5",{class:"mt-3 mb-1"},"Words Used",-1),st={class:"word-cards mt-2"},ot={class:"card-body"},at={class:"card-title"},nt=["data-tippy-content"],rt={class:"card-text text-secondary"},lt=b({__name:"StoryView",setup(it){const n=c(a.NotStarted),l=c(6),d=c(""),_=g([]),u=c(!1);async function y(){try{const s=await T.get(window.API_ENDPOINT+"/api/system_status");u.value=s.data.story_mode_available}catch(s){console.log(s)}}S(()=>{y()});function w(){n.value=a.Doing,d.value="";const s=new EventSource(window.API_ENDPOINT+"/api/stories/?words_num="+l.value);s.addEventListener("story_partial",e=>{d.value=e.data}),s.addEventListener("story",e=>{d.value=e.data,n.value=a.Done}),s.addEventListener("words",e=>{const o=JSON.parse(e.data);_.length=0,_.push(...o)}),s.addEventListener("error",e=>{if(e.data===void 0)return;const o=JSON.parse(e.data);A.error(o.message)}),s.onerror=function(e){s.close(),n.value=a.Done}}const f=N(()=>d.value.replace(/\$(\w+)?\$/g,'<span class="word"><mark>$1</mark></span>').replace(/\n/g,"<br>"));return k(()=>{x(()=>{P("i.word-card-info-icon[data-tippy-content]",{delay:100})})}),(s,e)=>(i(),r("div",null,[t("div",J,[t("div",O,[D(I,{activePanel:"story"})])]),t("div",U,[t("div",B,[C,t("div",W,[t("button",{type:"button",class:"btn btn-primary",id:"write-story",onClick:w,disabled:n.value===v(a).Doing||!u.value},[F,p(" Write Me a Story ")],8,$),H,L(t("select",{class:"form-select ms-2","onUpdate:modelValue":e[0]||(e[0]=o=>l.value=o),style:{width:"100px"}},R,512),[[E,l.value]]),Y])])]),t("div",z,[t("div",K,[Q,u.value?m("",!0):(i(),r("div",X," You don't have enough words yet. Gather some more and come back! ")),n.value!==v(a).NotStarted?(i(),r("div",Z,[t("div",{id:"story",innerHTML:v(f)},null,8,tt),et,t("div",st,[(i(!0),r(V,null,M(_,o=>(i(),r("div",{class:"card border-info word-card",key:o.word},[t("div",ot,[t("h5",at,[p(h(o.word)+" ",1),t("i",{class:"bi bi-info-circle float-end word-card-info-icon","data-tippy-content":o.orig_text+" / "+o.translated_text},null,8,nt)]),t("p",rt,h(o.simple_definition),1)])]))),128))])])):m("",!0)])])]))}});export{lt as default};
