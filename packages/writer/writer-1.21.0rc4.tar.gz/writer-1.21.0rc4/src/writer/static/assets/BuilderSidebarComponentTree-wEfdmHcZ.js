import{a as ce,B as de}from"./BuilderApp-RTZyH7vY.js";import{c as v,d as F,r as z,i as P,a as k,u as W,w as O,aW as ue,L as D,o as p,b,z as y,g as f,f as B,D as T,x as I,y as _,S as h,R as c,t as pe,E as me,bj as ge,C as V,ax as Q,l as fe,aL as ve,_ as Y,W as $,A as j}from"./index-DgecPIuV.js";import{u as he}from"./useComponentDescription-DJw_NOhU.js";import"./WdsCheckbox-CyMfoekc.js";import"./marked.esm-273vDTCT.js";function G(i,r){function a(o){if(!r.value)return!0;const t=i.getComponentDefinition(o.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(r.value)||Object.values(o.content).filter(d=>d.toLocaleLowerCase().includes(r.value)).length>0)}return{isComponentMatchingQuery:a}}function Ce(i,r,a){const{isComponentMatchingQuery:o}=G(i,r);return{searchResultCount:v(()=>{if(!r.value)return;let l=0;for(const d of i.getComponentsNested(a.value))o(d)&&l++;return l})}}function ye(i,r,a){const{isComponentMatchingQuery:o}=G(i,r),t=v(()=>!r.value||o(a.value));return{hasMatchingChildren:v(()=>{if(!r.value)return!0;for(const d of i.getComponentsNested(a.value.id))if(o(d))return!0;return!1}),matched:t}}const Ie={class:"BuilderSidebarComponentTreeBranch__nameRight"},Be={class:"previewText"},Te=F({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(i,{emit:r}){const a=i,o=z(),t=P(k.core),l=P(k.builderManager),d=v(()=>l.isComponentIdSelected(a.componentId)),x=W(t),{createAndInsertComponent:E,moveComponent:w,goToComponentParentPage:m,isDraggingAllowed:g}=Q(t,l,x),{getComponentInfoFromDrag:S,removeInsertionCandidacy:A,isParentSuitable:U}=ve(t),{isComponentVisible:H}=fe(t),J=r,X=v(()=>{var e;return((e=a.query)==null?void 0:e.toLocaleLowerCase())??""}),s=v(()=>t.getComponentById(a.componentId)),{hasMatchingChildren:Z,matched:ee}=ye(t,X,s);O(Z,e=>{var n;return(n=o.value)==null?void 0:n.toggleCollapse(!e)},{immediate:!0});const L=v(()=>t.getComponents(a.componentId,{sortedByPosition:!0}).filter(e=>{var n;return((n=t.getComponentDefinition(e.type))==null?void 0:n.category)!=="Internal"})),{name:te,previewText:N}=he(t,s);async function ne(e){m(a.componentId),await D(),l.handleSelectionFromEvent(e,a.componentId,void 0,"tree"),M()}function M(){o.value&&(o.value.expand(),J("expandBranch"))}function ae(){var q;const e=(q=o.value)==null?void 0:q.$el;if(!e)return;const n=e.closest(".BuilderSidebarComponentTree"),u=n.getBoundingClientRect(),C=o.value.$el.offsetTop-u.height/2,le=o.value.$el.offsetLeft-u.left-16;n.scrollTo({top:C,left:Math.max(0,le),behavior:"smooth"})}function oe(e){l.setSelection(null),e.dataTransfer.setData(`application/json;writer=${s.value.type},${s.value.id}`,"{}")}function re(e){A(e)}function se(e){const n=S(e);if(!n)return;const{draggedType:u,draggedId:C}=n;U(a.componentId,C,u)&&e.preventDefault()}function ie(e){const n=S(e);if(!n)return;const{draggedType:u,draggedId:C}=n;C?w(C,s.value.id):E(u,s.value.id),A(e)}const R=v(()=>{if(!t.activePageId.value)return!1;const e=t.getComponents(l.activeRootId.value).some(u=>u.id===t.activePageId.value);return ue.has(s.value.type)&&e&&a.componentId!==t.activePageId.value});return O(t.activePageId,()=>{var e;t.activePageId.value&&R.value&&((e=o.value)==null||e.toggleCollapse(!0))}),O(l.firstSelectedItem,async e=>{e&&e.componentId===a.componentId&&e.source!="tree"&&(M(),await D(),ae())},{immediate:!0}),(e,n)=>s.value?(p(),b(ce,{key:0,ref_key:"treeBranch",ref:o,class:"BuilderSidebarComponentTreeBranch","component-id":i.componentId,name:c(te),query:i.query,"has-children":L.value.length>0,"data-automation-key":s.value.type,draggable:c(g)(i.componentId),matched:c(ee),selected:d.value,variant:c(ge).has(s.value.type)?"root":void 0,"disable-collapse":c(V).has(s.value.type),"no-nested-space":c(V).has(s.value.type),collapsed:R.value,onSelect:ne,onDragover:se,onDragstart:oe,onDragend:re,onDrop:ie},{nameRight:y(()=>[f("span",Ie,[Object.keys(s.value.handlers??{}).length>0?(p(),B(T,{key:0},[n[0]||(n[0]=f("span",{class:"middot"},null,-1)),I(_,{name:"zap"})],64)):h("",!0),c(H)(s.value.id)?h("",!0):(p(),B(T,{key:1},[n[1]||(n[1]=f("span",{class:"middot"},null,-1)),I(_,{name:"eye-off"})],64)),s.value.isCodeManaged?(p(),B(T,{key:2},[n[2]||(n[2]=f("span",{class:"middot"},null,-1)),I(_,{name:"square-terminal"})],64)):h("",!0),c(N)?(p(),B(T,{key:3},[n[3]||(n[3]=f("span",{class:"middot"},null,-1)),f("span",Be,pe(c(N)),1)],64)):h("",!0)])]),children:y(()=>[(p(!0),B(T,null,me(L.value,u=>(p(),b(K,{key:u.id,"component-id":u.id,query:i.query,onExpandBranch:M},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected","variant","disable-collapse","no-nested-space","collapsed"])):h("",!0)}}),K=Y(Te,[["__scopeId","data-v-4a1d8845"]]),be={class:"add"},_e=F({__name:"BuilderSidebarComponentTree",setup(i){const r=P(k.core),a=P(k.builderManager),o=z(""),t=W(r),{createAndInsertComponent:l}=Q(r,a,t),d=a.activeRootId,{searchResultCount:x}=Ce(r,o,d);async function E(){const m=l("page","root");r.setActivePageId(m),await D(),a.setSelection(m),t.track("ui_page_added")}async function w(){const m=l("blueprints_blueprint","blueprints_root");r.setActivePageId(m),await D(),a.setSelection(m),t.track("blueprints_new_added")}return(m,g)=>(p(),b(de,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=S=>o.value=S),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":c(x)},{footer:y(()=>[f("div",be,[c(d)=="root"?(p(),b($,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:E},{default:y(()=>[I(_,{name:"plus"}),g[1]||(g[1]=j(" Add page "))]),_:1})):h("",!0),c(d)=="blueprints_root"?(p(),b($,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint",onClick:w},{default:y(()=>[I(_,{name:"plus"}),g[2]||(g[2]=j(" Add blueprint "))]),_:1})):h("",!0)])]),default:y(()=>[f("div",null,[I(K,{class:"rootBranch","component-id":c(d),query:o.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),Ee=Y(_e,[["__scopeId","data-v-e4f25153"]]);export{Ee as default};
