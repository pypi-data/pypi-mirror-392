# Depanalyzer - ä¾èµ–å…³ç³»åˆ†æžå·¥å…·

## ðŸ“ é¡¹ç›®æž¶æž„

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–åˆ†å±‚æž¶æž„ï¼ŒæŒ‰åŠŸèƒ½ç»„ç»‡ä»£ç ï¼š

```
depanalyzer/
â”œâ”€â”€ main.py                 # ä¸»å…¥å£ç‚¹
â”œâ”€â”€ app/                    # åº”ç”¨å±‚
â”‚   â””â”€â”€ run.py             # CLIæŽ¥å£å’Œå‘½ä»¤è¡Œå‚æ•°å¤„ç†
â”œâ”€â”€ core/                   # æ ¸å¿ƒç¼–æŽ’å±‚
â”‚   â””â”€â”€ orchestrator.py    # ä¸»è¦çš„å·¥ä½œæµåè°ƒå™¨
â”œâ”€â”€ tasks/                  # ä»»åŠ¡ç®¡ç†å±‚
â”‚   â”œâ”€â”€ task_system.py     # ä»»åŠ¡è°ƒåº¦å’Œä¾èµ–ç®¡ç†
â”‚   â”œâ”€â”€ enhanced_task_builder.py  # å¢žå¼ºä»»åŠ¡æž„å»ºå™¨
â”‚   â””â”€â”€ parse_types.py     # è§£æžä»»åŠ¡ç±»åž‹å®šä¹‰
â”œâ”€â”€ dependencies/           # ä¾èµ–ç®¡ç†å±‚
â”‚   â””â”€â”€ dependency_manager.py  # ç¬¬ä¸‰æ–¹ä¾èµ–ç®¡ç†
â”œâ”€â”€ base/                   # åŸºç¡€å±‚
â”‚   â”œâ”€â”€ base.py            # æŠ½è±¡åŸºç±»å’Œé€šç”¨åŠŸèƒ½
â”‚   â””â”€â”€ registry.py        # è§£æžå™¨æ³¨å†Œå’Œå‘çŽ°
â”œâ”€â”€ parsers/               # è§£æžå™¨å±‚
â”‚   â”œâ”€â”€ cpp/               # C/C++ è§£æžå™¨
â”‚   â”‚   â”œâ”€â”€ code_parser.py
â”‚   â”‚   â””â”€â”€ config_parser.py
â”‚   â””â”€â”€ hvigor/            # HarmonyOS/TypeScript è§£æžå™¨
â”‚       â”œâ”€â”€ code_parser.py
â”‚       â””â”€â”€ config_parser.py
â”œâ”€â”€ utils/                 # å·¥å…·å±‚
â”‚   â”œâ”€â”€ fs.py              # æ–‡ä»¶ç³»ç»Ÿå·¥å…·
â”‚   â”œâ”€â”€ graph.py           # å›¾æ•°æ®ç»“æž„ç®¡ç†
â”‚   â””â”€â”€ structure.py       # ç»“æž„åŒ–æ•°æ®å·¥å…·
â””â”€â”€ pyproject.toml         # é¡¹ç›®é…ç½®
```

## ðŸ—ï¸ æž¶æž„å±‚æ¬¡è¯´æ˜Ž

### 1. **åº”ç”¨å±‚** (`app/`)
- **èŒè´£**: æä¾›ç”¨æˆ·æŽ¥å£ï¼Œå¤„ç†å‘½ä»¤è¡Œå‚æ•°å’Œç¨‹åºå…¥å£
- **ä¸»è¦ç»„ä»¶**: `run.py` - CLIæŽ¥å£å®žçŽ°

### 2. **æ ¸å¿ƒç¼–æŽ’å±‚** (`core/`)
- **èŒè´£**: åè°ƒæ•´ä¸ªåˆ†æžæµç¨‹ï¼Œç®¡ç†å„ä¸ªç»„ä»¶çš„äº¤äº’
- **ä¸»è¦ç»„ä»¶**: `orchestrator.py` - ä¸»è¦å·¥ä½œæµåè°ƒå™¨

### 3. **ä»»åŠ¡ç®¡ç†å±‚** (`tasks/`)
- **èŒè´£**: å®žçŽ°å¤æ‚çš„ä»»åŠ¡è°ƒåº¦ï¼Œæ”¯æŒä»»åŠ¡ä¾èµ–å…³ç³»å’ŒåŠ¨æ€ä»»åŠ¡ç”Ÿæˆ
- **ä¸»è¦ç»„ä»¶**:
  - `task_system.py` - ä»»åŠ¡è°ƒåº¦å™¨æ ¸å¿ƒ
  - `enhanced_task_builder.py` - æ”¯æŒç¬¬ä¸‰æ–¹ä¾èµ–çš„ä»»åŠ¡æž„å»ºå™¨
  - `parse_types.py` - è§£æžä»»åŠ¡ç±»åž‹å®šä¹‰

### 4. **ä¾èµ–ç®¡ç†å±‚** (`dependencies/`)
- **èŒè´£**: å¤„ç†ç¬¬ä¸‰æ–¹åº“çš„æ‹‰å–ã€ç¼“å­˜å’Œé€’å½’ä¾èµ–è§£æž
- **ä¸»è¦ç»„ä»¶**: `dependency_manager.py` - ä¾èµ–ç®¡ç†å™¨

### 5. **åŸºç¡€å±‚** (`base/`)
- **èŒè´£**: æä¾›æŠ½è±¡åŸºç±»ã€é€šç”¨åŠŸèƒ½å’Œè§£æžå™¨ç®¡ç†
- **ä¸»è¦ç»„ä»¶**:
  - `base.py` - æŠ½è±¡è§£æžå™¨åŸºç±»
  - `registry.py` - è§£æžå™¨æ³¨å†Œå’Œè‡ªåŠ¨å‘çŽ°

### 6. **è§£æžå™¨å±‚** (`parsers/`)
- **èŒè´£**: ç‰¹å®šè¯­è¨€çš„ä»£ç è§£æžå®žçŽ°
- **æ”¯æŒè¯­è¨€**:
  - `cpp/` - C/C++ è¯­è¨€è§£æžå™¨
  - `hvigor/` - HarmonyOS/TypeScript è§£æžå™¨

### 7. **å·¥å…·å±‚** (`utils/`)
- **èŒè´£**: æä¾›é€šç”¨å·¥å…·å‡½æ•°å’Œæ•°æ®ç»“æž„
- **ä¸»è¦ç»„ä»¶**:
  - `fs.py` - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
  - `graph.py` - å›¾æ•°æ®ç»“æž„ç®¡ç†
  - `structure.py` - ç»“æž„åŒ–æ•°æ®å¤„ç†

## ðŸš€ ä½¿ç”¨æ–¹æ³•

```bash
# è¿è¡Œä¾èµ–åˆ†æž
python main.py --repo /path/to/repo --out output.json --workers 8 --max-depth 3
```

### å‚æ•°è¯´æ˜Ž:
- `--repo`: è¦åˆ†æžçš„ä»“åº“æ ¹ç›®å½•
- `--out`: è¾“å‡ºå›¾æ–‡ä»¶(.json æˆ– .gmlæ ¼å¼)
- `--workers`: æœ€å¤§å¹¶è¡Œå·¥ä½œçº¿ç¨‹æ•°(é»˜è®¤:8)
- `--max-depth`: ç¬¬ä¸‰æ–¹ä¾èµ–é€’å½’æ·±åº¦(é»˜è®¤:3)

## ðŸ“Š æ ¸å¿ƒç‰¹æ€§

- **å¤šè¯­è¨€æ”¯æŒ**: æ’ä»¶å¼è§£æžå™¨æž¶æž„ï¼Œæ˜“äºŽæ‰©å±•æ–°è¯­è¨€
- **å¹¶å‘å¤„ç†**: å¤šçº¿ç¨‹ä»»åŠ¡è°ƒåº¦ï¼Œå……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æº
- **ä¾èµ–ç®¡ç†**: å®Œæ•´çš„ç¬¬ä¸‰æ–¹ä¾èµ–è§£æžé“¾ï¼Œæ”¯æŒç¼“å­˜å’Œé€’å½’
- **å›¾å½¢åŒ–è¾“å‡º**: ç»Ÿä¸€çš„å›¾æ•°æ®æ ¼å¼ï¼Œæ”¯æŒJSONå’ŒGMLå¯¼å‡º
- **é”™è¯¯å¤„ç†**: å…¨é¢çš„å¼‚å¸¸å¤„ç†å’Œé™çº§ç­–ç•¥

## ðŸ”§ æ‰©å±•æ–°è¯­è¨€è§£æžå™¨

1. åœ¨ `parsers/` ä¸‹åˆ›å»ºæ–°çš„è¯­è¨€æ–‡ä»¶å¤¹
2. å®žçŽ° `code_parser.py` (å¿…éœ€) å’Œ `config_parser.py` (å¯é€‰)
3. ç»§æ‰¿ `BaseCodeParser` å’Œ `BaseConfigParser` ç±»
4. é‡å†™è§£æžæ–¹æ³•ï¼Œè§£æžå™¨ä¼šè¢«è‡ªåŠ¨å‘çŽ°å’Œæ³¨å†Œ

## ðŸ“ˆ æž¶æž„ä¼˜åŠ¿

- **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**: æ¯ä¸ªå±‚æ¬¡éƒ½æœ‰æ˜Žç¡®çš„èŒè´£è¾¹ç•Œ
- **é«˜åº¦æ¨¡å—åŒ–**: ç»„ä»¶é—´è€¦åˆåº¦ä½Žï¼Œæ˜“äºŽç»´æŠ¤å’Œæ‰©å±•
- **å¯æ‰©å±•æ€§**: æ’ä»¶å¼æž¶æž„æ”¯æŒå¿«é€Ÿæ·»åŠ æ–°åŠŸèƒ½
- **å¹¶å‘å®‰å…¨**: çº¿ç¨‹å®‰å…¨çš„è®¾è®¡æ”¯æŒé«˜æ•ˆå¹¶è¡Œå¤„ç†






## ðŸ“¦ å®‰è£…ä¸Žè¿è¡Œ

### 1) ä½¿ç”¨ pip æœ¬åœ°å®‰è£…

```bash
pip install .
# æˆ–å¼€å‘æ¨¡å¼å®‰è£…
pip install -e .
```

å®‰è£…å®ŒæˆåŽå°†è‡ªåŠ¨ç”Ÿæˆ CLIï¼š

```bash
# ä¾èµ–å…³ç³»åˆ†æžï¼ˆåŸºç¡€ï¼‰
depanalyzer --repo /path/to/repo --out output.json --workers 8 --max-depth 3

# å¯ç”¨è®¸å¯è¯æ£€æµ‹ä¸Žå…¼å®¹æ€§æ£€æŸ¥
depanalyzer \
  --repo /path/to/repo \
  --out output.json \
  --enable-license-check \
  --scancode-cmd scancode \
  --license-map-out license_map.json \
  --license-out compatible.json
```

çŽ¯å¢ƒä¸Žä¾èµ–è¯´æ˜Žï¼š
- éœ€è¦ Python >=3.12, <=3.14
- è‹¥å¯ç”¨ `--enable-license-check`ï¼Œéœ€ç³»ç»Ÿå¯æ‰§è¡Œ `scancode`ï¼ˆå»ºè®®å®‰è£… ScanCode å·¥å…·ï¼‰ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨å†…ç½®çš„ `liscopelens` æ¨¡å—è¿›è¡Œå…¼å®¹æ€§åˆ†æž

### 2) ä½œä¸ºæ¨¡å—è°ƒç”¨

```python
from core.orchestrator import Orchestrator

orch = Orchestrator("/path/to/repo", max_workers=8, max_dependency_depth=3)
graph = orch.run()
graph.save("output.json", save_format="json")
```

### 3) å¸¸è§é—®é¢˜
- è‹¥ `depanalyzer` å‘½ä»¤ä¸å¯ç”¨ï¼Œè¯·ç¡®è®¤å®‰è£…è¿‡ç¨‹æ— æŠ¥é”™ï¼Œå¹¶ç¡®ä¿ Python çš„è„šæœ¬ç›®å½•åœ¨ `PATH` ä¸­
- è®¸å¯è¯ç›¸å…³å‘½ä»¤éœ€è¦å¤–éƒ¨å·¥å…· `scancode` å¯ç”¨


