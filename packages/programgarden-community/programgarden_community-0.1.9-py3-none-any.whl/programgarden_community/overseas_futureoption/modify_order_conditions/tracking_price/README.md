# Futures Tracking Price Modify

## 전략 ID
FuturesTrackingPriceModify

## 한 줄 요약
선물 주문 가격이 시장에서 벗어나면 1호가(최우선 호가)로 자동 정정해 주는 전략입니다.

## 왜 필요한가요?
선물 주문을 내고 잠깐 한눈을 팔면 시장이 빠르게 움직입니다. 특히 변동성이 큰 장에서는 주문가격이 의미 없을 정도로 멀어지곤 하죠. 이 전략은 **“주문을 살려둘 가치가 있을 때는 가격을 최신 호가로 붙여 놓자”** 라는 아이디어로 만들어졌습니다. 사용자는 한 번만 조건을 설정하면 전략이 알아서 정정 주문을 만들어 줍니다.

## 동작 과정
1. 현재 미체결 주문 목록을 확인합니다.
2. 주문가능 증거금과 `min_remaining_balance_ratio`를 비교해 정정에 사용할 수 있는 여유 한도를 계산합니다.
3. 각 주문의 현재가를 LS API(o3106)로 불러옵니다.
4. 기존 주문가와 1호가의 차이를 계산합니다.
5. 차이가 `price_gap` 이상이고, 정정으로 인해 필요한 추가 증거금이 여유 한도 안이면 정정 주문을 생성합니다.

## DSL 예시
```python
{
    "condition_id": "FuturesTrackingPriceModify",
    "params": {
        "price_gap": 1.5,
        "enable": "buy"
    }
}
```

## 파라미터
| 이름 | 기본값 | 설명 |
| --- | --- | --- |
| `price_gap` | 1.0 | 주문가와 현재 1호가 사이에 허용할 최대 차이. |
| `enable` | `all` | `buy`, `sell`, `all` 중 선택하여 특정 방향만 정정할 수 있습니다. |
| `min_remaining_balance_ratio` | 0.1 | 정정 실행 후에도 계좌에 남겨둘 주문가능 증거금 비율. 0.1이면 최소 10%를 남깁니다. |
| `appkey`, `appsecretkey` | 선택 | 전략이 직접 LS API를 호출해야 할 때 입력합니다. 시스템 차원에서 로그인되어 있다면 생략 가능. |

## 팁
- `price_gap`을 너무 작게 잡으면 주문이 계속 정정되어 거래소 수수료가 증가할 수 있습니다.
- `min_remaining_balance_ratio`를 활용하면 다른 전략이나 수동 주문을 위해 남겨야 하는 증거금 비율을 손쉽게 제한할 수 있습니다.
- 취소 전략과 함께 사용하면, 먼저 정정으로 시세를 따라붙고 그래도 멀어지면 취소하는 식의 다단계 제어가 가능합니다.
