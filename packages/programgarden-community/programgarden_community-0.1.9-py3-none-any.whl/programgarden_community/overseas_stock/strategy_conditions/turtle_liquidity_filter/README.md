# 터틀 유동성 체크 (Turtle Liquidity Filter)

## 전략 ID
`OverseasStockTurtleLiquidity`
## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **“이 종목이 터틀 전략을 적용하기에 거래가 충분히 붙어 있는지”** 를 먼저 확인하는 유동성 필터입니다.

최근 일정 기간의 **하루 평균 거래대금과 거래량** 을 계산한 뒤,
우리가 정한 최소 기준을 모두 통과한 종목만 다음 단계(변동성·돌파·손절 등)로 넘겨 줍니다.
## 이 전략이 필요한 이유

- 터틀 전략은 **진입 후에도 꾸준히 매수·매도가 원활히 체결되는 시장**을 전제로 합니다.
- 거래대금과 거래량이 너무 얇은 종목은, 원하는 가격에 체결되지 않거나 **슬리피지(미끄러짐)** 가 크게 발생해 전략 성과가 크게 왜곡될 수 있습니다.
- `Turtle Liquidity Filter`를 사용하면:
    - **거래가 얇은 종목을 초기에 걸러내고**,
    - **터틀 원칙에 맞게 충분히 “물량이 받쳐 주는” 종목만 다음 필터로 전달**할 수 있어,
    - 전체 터틀 전략 체인의 신뢰도를 높이는 데 도움이 됩니다.
## 전략 상세 설명

### 어떤 방식으로 동작하나요?

1. 해외주식 일봉 데이터를 불러와, `lookback_days` 동안의 캔들만 사용합니다.
2. 각 일자의 **종가 × 거래량**으로 거래대금을 계산한 뒤, 해당 기간의 **평균 거래대금**을 구합니다.
3. 같은 기간의 **평균 거래량**도 함께 계산합니다.
4. 평균 거래대금이 `min_turnover`, 평균 거래량이 `min_volume` 기준을 모두 넘는지 확인합니다.
5. 두 기준을 모두 통과하면 **“통과”**, 둘 중 하나라도 모자라면 **“보류”** 상태로 결과를 반환합니다.

### 방향성은 이렇게 고릅니다

이 전략은 **매수/매도 방향을 고르는 전략이 아니라, “이 종목을 터틀 전략 후보로 쓸지 말지”를 결정하는 전처리 필터**입니다.

- 기준을 모두 충족하면: “이 종목은 유동성이 충분하니, 다음 단계(변동성·돌파·손절 전략 등)로 넘겨도 좋다”는 의미입니다.
- 기준을 충족하지 못하면: “현재 유동성이 아쉬우니, 이번 터틀 전략 사이클에서는 제외하는 것이 좋다”는 신호입니다.

### 활용 시나리오

- 해외주식 종목 풀에서 **거래대금/거래량이 충분한 종목만 먼저 추리기 위한 1차 필터**로 사용
- 터틀 변동성 필터, 돌파 전략, 리스크 관리 전략 앞단에 붙여, **유동성이 부족한 종목을 초기에 제거**
- 특정 시장(섹터/국가)에 따라 `min_turnover`, `min_volume` 기준치를 달리 설정해,
  **시장별 유동성 특성에 맞는 맞춤형 터틀 유동성 필터**로 활용
## DSL 예시

```python
{
    "condition_id": "OverseasStockTurtleLiquidity",
    "symbol": [{"symbol": "AAPL", "exchcd": "82"}],
    "params": {
        "appkey": "LS증권 발급키",
        "appsecretkey": "LS증권 발급시크릿",
        "lookback_days": 20,
        "min_turnover": 800000,
        "min_volume": 250000
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `lookback_days` | int | 20 | 평균을 계산할 일수입니다. 값이 길수록 단기적인 튀는 거래를 덜 타고, 더 안정적인 유동성 판단이 가능합니다. |
| `min_turnover` | float | 1000000 | 하루 평균 거래대금 최소 기준입니다. 이 금액 이상이어야 “유동성이 충분하다”고 판단합니다. |
| `min_volume` | int | 300000 | 하루 평균 거래량 최소 기준입니다. 지나치게 거래량이 적은 종목을 미리 걸러냅니다. |
| `qrycnt` | int | 80 | 서버에서 불러올 일봉 개수입니다. `lookback_days`보다 크게 두어야 평균 계산에 필요한 데이터를 충분히 확보할 수 있습니다. |
| `appkey` | str | - | LS증권 해외주식 Open API 인증 키입니다. |
| `appsecretkey` | str | - | LS증권 해외주식 Open API 인증 시크릿입니다. |

## 전략 사용 시 주의사항

- 이 조건은 단독 매매 신호가 아니라, **터틀 전략의 전처리(유동성 필터) 역할**에 가깝습니다. 보통 변동성·돌파·손절 조건과 함께 사용하기를 권장합니다.
- 시장 상황(변동성 확대/축소, 특정 섹터 이슈 등)에 따라 **`min_turnover`, `min_volume` 기준치는 주기적으로 재조정**해 주는 것이 좋습니다.
- LS증권 API 키(`appkey`, `appsecretkey`)가 없으면 데이터를 불러올 수 없습니다. 키는 외부에 노출되지 않도록 안전하게 보관하세요.
- 과거 거래대금·거래량이 충분했다고 해서, **앞으로도 항상 유동성이 유지된다는 보장은 없습니다.** 따라서 실시간 호가·체결 상황도 함께 체크하는 것이 좋습니다.