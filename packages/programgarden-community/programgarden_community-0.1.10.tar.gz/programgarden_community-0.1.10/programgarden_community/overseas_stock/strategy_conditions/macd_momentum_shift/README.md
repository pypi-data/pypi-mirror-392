# 해외주식 MACD 모멘텀 전환 전략

## 전략 ID
`StockMACDShift`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **MACD·시그널선·히스토그램을 한 번에 정리해서 모멘텀의 방향 전환을 잡아주는 도구**입니다.

빠른 EMA와 느린 EMA의 차이를 MACD로 계산하고, 시그널선/히스토그램과 함께 추적해
**“지금 상승 에너지가 커지는지, 하락 에너지가 세지는지”를 한 줄 요약으로 보여 줍니다.**

## 이 전략이 필요한 이유

- 해외주식은 장이 열려 있는 시간대마다 수급이 크게 달라져 **모멘텀이 어느 쪽으로 기울었는지 빠르게 파악하기 어렵습니다.**
- 차트를 직접 보며 MACD·시그널선·히스토그램을 일일이 비교하기 번거로운 투자자를 위해,
    세 가지 정보를 한 번에 정리해 **상승/하락 에너지의 방향 변화를 직관적으로** 보여 줍니다.
- 상승/하락 중 관심 있는 방향을 `focus_direction`으로 지정해, **원하는 시그널만 골라 보는 필터**로 활용할 수 있습니다.

## 전략 상세 설명

### MACD·시그널선·히스토그램이 뭔가요?

MACD 세트는 보통 이렇게 3종 세트로 움직입니다.

- **MACD 라인**
    - 주가의 **빠른 평균(단기 EMA)** 과 **느린 평균(장기 EMA)** 의 차이를 나타내는 선입니다.
    - 쉽게 말해,
        - 단기 EMA가 장기 EMA보다 위에 있으면 **상승 쪽 힘이 더 크다**,
        - 아래에 있으면 **하락 쪽 힘이 더 크다**
        고 보는 지표입니다.
    - 선이 위로 벌어지면 상승 힘이 세지는 중, 선이 다시 좁혀지면 힘이 약해지는 중이라고 볼 수 있습니다.

- **시그널선**
    - MACD 라인을 한 번 더 부드럽게 평균 낸 선입니다.
    - MACD가 들쭉날쭉 튀는 것을 한 번 정리해서, **전환 타이밍을 더 보기 쉽게 만든 기준선**이라고 생각하면 됩니다.
    - MACD가 시그널선을 **아래에서 위로 뚫고 올라가면** 보통 **상승 전환(골든 크로스)**,
    - **위에서 아래로 내려가면** **하락 전환(데드 크로스)** 신호로 자주 해석합니다.

- **히스토그램**
    - MACD 라인과 시그널선의 **차이(간격)** 를 막대그래프로 그린 것입니다.
    - 막대가 **크고 양수**면: MACD가 시그널선 위에서 멀리 떨어져 있다는 뜻 → **상승 에너지가 강해진 상태**로 볼 수 있습니다.
    - 막대가 **크고 음수**면: MACD가 시그널선 아래에서 멀리 떨어져 있다는 뜻 → **하락 에너지가 강한 상태**입니다.
    - 양수에서 점점 줄어들거나, 음수에서 점점 줄어드는 모습은
        “지금까지 이어지던 힘이 서서히 약해지는 중”으로 해석할 수 있습니다.

이 전략은 이 세 가지를 일일이 따로 보지 않고,
**“지금 힘이 어느 방향으로 움직이는지”를 한 줄 요약으로 정리해서 보여 주는 역할**을 합니다.

### 어떤 방식으로 동작하나요?

- 종가 기준으로 빠른 EMA(`fast_period`)와 느린 EMA(`slow_period`)를 계산합니다.
- 두 EMA의 차이를 MACD 선으로 만들고, 이를 다시 EMA로 부드럽게 한 선이 **시그널선(`signal_period`)**입니다.
- MACD와 시그널선의 차이를 막대 그래프(히스토그램)로 표현해, **모멘텀이 어느 쪽으로 커지고 있는지**를 시각적으로 요약합니다.
- 전략은 이 세 가지 값을 바탕으로 최근 골든/데드 크로스, 히스토그램 변화 등을 정리해 `data.recent_crossovers` 형태로 반환합니다.

### 방향성은 이렇게 고릅니다

- **상승 방향(bullish)**
    - MACD가 시그널선을 상향 돌파하거나, 히스토그램이 음수에서 줄어들며 0선을 향해 올라오는 구간에 주목합니다.
    - `focus_direction = "bullish"`로 두면, 이런 상황에서의 전환 신호만 골라서 확인할 수 있습니다.
- **하락 방향(bearish)**
    - MACD가 시그널선을 하향 돌파하거나, 히스토그램이 양수에서 줄어들며 0선을 향해 내려오는 구간을 살핍니다.
    - `focus_direction = "bearish"`로 설정하면, 하락 전환 신호만 추적합니다.
- **양쪽 모두(both)**
    - 위 두 방향 모두를 한 번에 보고 싶다면 `focus_direction = "both"`로 둡니다.
    - 최근 N회(`lookback`)의 교차 이벤트를 모두 기록해, 상승/하락 전환 히스토리를 같이 볼 수 있습니다.

### 활용 시나리오

- MACD가 막 시그널선을 상향 돌파했는지 확인하고 **초기 반전 구간**을 포착하고 싶을 때
- 강한 상승 추세에서 히스토그램이 꺾이는지 체크하며 **모멘텀 둔화에 따른 차익 실현 타이밍**을 찾고 싶을 때
- 장기 하락 이후 히스토그램이 음수에서 줄어드는지 살펴 **과도한 매도 세가 진정되는 구간**을 찾고 싶을 때
## DSL 예시
```python
{
    "condition_id": "StockMACDShift",
    "parameters": {
        "appkey": "your_appkey",
        "appsecretkey": "your_appsecret",
        "fast_period": 12,
        "slow_period": 26,
        "signal_period": 9,
        "timeframe": "days",
        "lookback": 4,
        "focus_direction": "both",
        "qrycnt": 250
    }
}
```

별도의 시작/종료일을 넣지 않아도 가장 최근 거래일부터 `qrycnt` 길이만큼 데이터를 자동 조회합니다.

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `fast_period` | int | 5 | MACD 단기 EMA 길이입니다. 작으면 빠르게 반응하지만 노이즈가 늘어납니다. 항상 `slow_period`보다 작아야 합니다. |
| `slow_period` | int | 10 | 장기 EMA 길이입니다. 값을 늘리면 큰 추세만 남고, 줄이면 단기 흔들림도 민감하게 반영합니다. |
| `signal_period` | int | 9 | MACD를 한 번 더 완만하게 만든 시그널선 EMA 기간입니다. 짧게 두면 교차가 잦고, 길게 두면 확실한 전환만 남습니다. |
| `lookback` | int | 4 | 최근 몇 개 교차 이벤트를 모아둘지 결정합니다. 1이면 가장 최근 교차만, 4면 최근 4번의 골든/데드 크로스를 보여줍니다. |
| `timeframe` | str | `days` | 어떤 봉 간격으로 MACD를 계산할지 선택합니다. `weeks`/`months`를 고르면 더 완만한 추세를 확인할 수 있습니다. |
| `focus_direction` | str | `both` | `bullish`(골든) 또는 `bearish`(데드)만 볼지, 아니면 둘 다(`both`) 볼지 선택합니다. |
| `qrycnt` | int | 250 | 조회할 캔들 수입니다. 길게 설정할수록 EMA 초기화 구간이 안정적이고 히스토그램 신뢰도가 높아집니다. |
| `appkey` | str | - | LS증권 해외주식 Open API 인증 정보입니다. 실거래/모의거래 환경에 맞는 키를 입력하세요. |
| `appsecretkey` | str | - | LS증권 해외주식 Open API 인증 시크릿입니다. |

## 전략 사용 시 주의사항

- MACD 교차는 모멘텀 방향을 알려줄 뿐, **추세의 지속 시간이나 수익 규모를 보장하지 않습니다.**
- 거래량·가격 패턴·뉴스 이벤트 등 다른 지표와 함께 확인하면 신호 해석에 도움이 됩니다.
- API 인증 정보(`appkey`, `appsecretkey`)는 반드시 안전하게 관리하고, 외부에 노출되지 않도록 주의하세요.
- 과거 데이터 분석 결과는 미래 수익을 보장하지 않으므로, 손절·분할 매수/매도 등 기본적인 리스크 관리와 함께 사용하는 것이 좋습니다.
