# 터틀 해외주식 스캐너 (Turtle Breakout Filter)

## 전략 ID
`OverseasStockTurtleFilter`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **터틀 트레이딩의 핵심 규칙(유동성·변동성·돌파·손절·피라미딩)을 한 번에 점검해, “지금 이 종목이 터틀 규칙에 맞는가?”만 깔끔하게 판단해 주는 스캐너**입니다.

20일 고점 돌파, 55일 강력 돌파, 10일 이탈, ATR 기반 변동성, 유동성 조건을 함께 확인해
**터틀 원칙에 맞는 후보 종목만 다음 단계(실제 주문, 리스크 관리)로 넘겨 줍니다.**

## 이 전략이 필요한 이유

- 터틀 트레이딩은 **“분명한 추세 + 일정한 위험 관리”** 가 핵심인데, 실제로는 여러 조건을 동시에 체크해야 하다 보니 사람이 매번 수동으로 확인하기 어렵습니다.
- 유동성, 변동성, 돌파 여부, 계좌당 리스크까지 한 번에 계산해 주면,
    **“지금은 이 종목을 터틀 규칙에 따라 진입/유지해도 되는가?”** 에만 집중할 수 있습니다.
- `OverseasStockTurtleFilter`는 복잡한 계산을 숨기고,
    - 유동성 기준 통과 여부
    - 변동성 기준 통과 여부
    - 추세 돌파/이탈 여부
    - 계좌 크기와 1% 위험 기준에 맞는 추천 수량
    등을 한 눈에 보여줘 **터틀 운영자의 판단 부담을 크게 줄여 줍니다.**

## 전략 상세 설명

### 먼저, 용어를 간단히 정리해 볼게요

- **유동성**
    - “이 종목을 사고팔 사람이 얼마나 많은가?”를 숫자로 보는 개념입니다.
    - 보통 **거래대금(가격 × 거래량)** 과 **거래량(주식 수)** 으로 판단합니다.
    - 유동성이 낮으면 원하는 가격에 주문이 잘 안 채워지고, **슬리피지(원하던 가격보다 불리한 가격에 체결되는 현상)** 가 커집니다.

- **ATR (Average True Range)**
    - 우리말로는 대략 **“평균 진폭”**, 즉 **“이 종목이 하루에 평균 얼마나 흔들리는지”** 를 나타내는 지표입니다.
    - 최근 며칠 동안의 **고가·저가·종가** 정보를 이용해 “하루 움직임의 크기”를 구하고, 그것을 다시 평균 내어 하나의 숫자로 만든 값입니다.
    - ATR 값이 크면 하루에 위아래로 많이 흔든다는 뜻이고, 너무 작으면 **파도가 거의 없는 잔잔한 바다**로 볼 수 있습니다.

- **돌파 (Breakout)**
    - 최근 N일(예: 20일, 55일) 동안의 **최고가 위로 가격이 새로 뚫고 올라가는 순간**입니다.
    - 터틀 전략에서는 이런 돌파를 “추세가 본격적으로 시작되었다”는 신호로 많이 사용합니다.

- **이탈 (Breakdown / Exit)**
    - 최근 N일(예: 10일) 동안의 **최저가 아래로 가격이 떨어지는 상황**입니다.
    - 터틀에서는 주로 “이제 이 추세는 끝났다”고 보는 경계선 역할을 합니다.

### 어떤 방식으로 동작하나요?

1. **유동성 체크**
     - 최근 20일(또는 설정한 기간) 평균 거래대금과 거래량이 최소 기준을 넘는지 검사합니다.
     - 유동성이 부족한 종목은 즉시 제외합니다.
2. **변동성 체크(ATR)**
    - ATR로 계산한 하루 평균 진폭이 `min_atr` 이상인지 확인합니다.
    - 진폭이 너무 작으면 “파도가 없는 시장”으로 보고, 터틀 전략 대상에서 제외합니다.
3. **추세 강도·위치 체크**
    - 당일 종가가 `entry_long_period` (예: 20일) 고점 근처이거나 돌파에 가까운지 확인해 **기본 진입 후보 구간**인지 평가합니다.
    - 더 긴 `strong_entry_period` (예: 55일) 고점과의 거리도 함께 보며 **추세의 강도**를 수치로 요약합니다.
    - 이 전략은 어디서 청산/손절할지를 직접 결정하지 않고, **“터틀 스타일 추세 전략을 적용하기에 적당한 자리인가?”만 계산해 알려 줍니다.**
4. **리스크·수량 계산**
     - 계좌 크기(`account_equity`)와 1회 거래 위험 비율(`risk_per_trade`)을 이용해,
         한 번의 거래에서 허용할 수 있는 **금액 위험(R)** 을 계산합니다.
     - 진입 가격과 청산선(손절 기준) 사이의 거리, 종목당 최소 거래 단위(`min_trade_size`)를 반영해
         **추천 수량과 피라미딩 시 최대로 보유 가능한 수량**을 계산합니다.
5. **요약 결과 정리**
     - 유동성·변동성·추세 조건을 각각 통과했는지 여부,
     - 돌파선과 현재 가격 사이 거리,
     - 추천 수량과 최대 피라미딩 단계 등을
     실무자가 바로 이해할 수 있는 문장과 숫자 요약으로 반환합니다.

### 방향성은 이렇게 해석하세요

- **매수 후보(long)**
    - 유동성과 변동성 기준을 모두 통과하고,
    - 종가가 20일 또는 55일 고점 근처(또는 돌파에 근접한 구간)에 있는 경우, **터틀식 추세 전략으로 검토해 볼 만한 종목**으로 간주합니다.
    - 55일 고점에 더 가까울수록, “이 종목은 이미 꽤 강한 추세를 만들고 있다”는 힌트로 해석할 수 있습니다.
- **대기 상태**
    - 유동성·변동성·추세 위치 조건 중 하나라도 부족하면,
        **이번 터틀 전략 사이클에서는 진입 후보로 쓰지 않는다**는 의미입니다.
    - 실제 진입·청산·손절 타이밍은, 이 필터 결과를 참고해 **별도의 주문/리스크 전략에서 결정**하는 것을 전제로 합니다.

### 활용 시나리오

- 해외주식 전체 또는 특정 섹터를 대상으로 **터틀 규칙에 맞는 후보 종목을 자동으로 스캔**하고 싶을 때
- 이미 보유 중인 터틀 포지션에 대해, **돌파 유지 여부·청산 조건·피라미딩 여유분**을 한 번에 점검하고 싶을 때
- 자산 배분과 손실 한도를 먼저 정해 놓고, **“추세가 정말 분명한 종목만 기계적으로 집행”**하고 싶은 투자/운영 환경에서 사용

## DSL 예시
```python
{
    "condition_id": "OverseasStockTurtleFilter",
    "symbol": [{
        "symbol": "AAPL",
        "exchcd": "82"
    }],
    "params": {
        "appkey": "발급받은 LS증권 키",
        "appsecretkey": "발급받은 LS증권 시크릿",
        "min_turnover": 800000,
        "risk_per_trade": 0.01,
        "account_equity": 50000
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `appkey` | str | - | LS증권에서 발급받은 Open API 키입니다. |
| `appsecretkey` | str | - | LS증권에서 발급받은 Open API 시크릿입니다. |
| `entry_long_period` | int | 20 | 몇 일 동안의 최고가를 돌파해야 기본 매수 신호로 볼지 결정합니다. |
| `strong_entry_period` | int | 55 | 보다 강한 추세를 확인할 때 사용하는 더 긴 고점 기간입니다. |
| `exit_period` | int | 10 | 이 기간 동안의 최저가를 이탈하면 청산/손절 신호로 해석합니다. |
| `atr_period` | int | 20 | ATR(가격 진폭)을 계산할 때 사용할 일수입니다. |
| `min_turnover` | float | 1000000 | 하루 평균 거래대금이 이 금액보다 작으면 유동성이 부족하다고 판단해 제외합니다. |
| `min_volume` | int | 300000 | 하루 평균 거래량이 이 숫자보다 작으면 유동성이 부족하다고 보고 제외합니다. |
| `min_atr` | float | 0.5 | 하루 평균 진폭이 이 값보다 작으면 변동성이 부족해 터틀 전략 대상에서 제외합니다. |
| `risk_per_trade` | float | 0.01 | 계좌의 몇 %를 한 번의 거래에 사용할지 설정합니다. 일반적으로 1% 수준을 권장합니다. |
| `account_equity` | float | 50000 | 계좌 총액입니다. 입력하지 않으면 주문 단계에서 예수금을 참고할 수 있습니다. |
| `min_trade_size` | int | 1 | 거래소가 허용하는 최소 거래 수량입니다. |
| `qrycnt` | int | 260 | 불러올 캔들(일봉) 수입니다. 최소 필요 길이보다 크게 두면 초기 구간 안정성이 높아집니다. |

## 전략 사용 시 주의사항

- 이 조건은 터틀 전략 전체 체인을 구성하는 **핵심 스캐너**이지만, 단독 매매 신호라기보다는 **후보 종목 선별 + 포지션 크기 계산 도구**로 보는 것이 좋습니다.
- 유동성(`min_turnover`, `min_volume`)과 변동성(`min_atr`) 기준은 시장 상황과 개인 운용 규모에 따라 주기적으로 조정해야 합니다.
- `risk_per_trade`와 `account_equity` 설정에 따라 추천 수량이 크게 달라지므로, 본인의 리스크 허용 범위에 맞게 보수적으로 설정하는 것을 권장합니다.
- LS증권 API 키가 없으면 데이터를 불러올 수 없습니다. 키와 시크릿은 외부에 노출되지 않도록 안전하게 보관해야 합니다.