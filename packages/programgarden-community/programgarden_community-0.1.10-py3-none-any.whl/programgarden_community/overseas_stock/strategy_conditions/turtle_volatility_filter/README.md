# 터틀 변동성 체크 (Turtle Volatility Filter)

## 전략 ID
`OverseasStockTurtleVolatility`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **“요즘 이 종목이 하루에 충분히 움직이는지”** 를 먼저 확인해,
파도(변동성)가 거의 없는 종목은 아예 추세 전략 대상에서 제외해 주는 필터입니다.

해외주식의 최근 일봉 데이터를 보고, 최근 며칠 동안의 가격 변동 폭을 숫자로 계산한 뒤,
우리가 설정한 기준보다 작으면 “보류”, 크면 “통과”로 표시해 줍니다.

여기서 사용하는 "최근 며칠 동안의 평균적인 하루 변동 폭" 숫자를
**ATR(Average True Range)** 라고 부르며,
쉽게 말해 **“요즘 이 종목이 하루에 평균 얼마나 흔들리는지”** 를 나타내는 값입니다.

## 이 전략이 필요한 이유

터틀 전략은 "시장에 충분한 파도가 있을 때만 서핑한다"는 생각에서 출발합니다.
해외 주식은 종목·시장·뉴스에 따라 하루 만에 분위기가 크게 바뀌기 때문에,
먼저 **요즘 이 종목이 실제로 잘 흔들리고 있는지**부터 확인할 필요가 있습니다.

`Turtle Volatility Filter`를 사용하면:

- **조용한 시장에서 괜히 진입했다가 지치는 일을 줄이고**
- **변동성이 살아 있는 종목만 다음 단계(돌파, 손절, 리스크 관리)로 넘길 수 있어**
- 전체 추세 전략의 신뢰도를 높이는 데 도움이 됩니다.

즉, 이 전략은 "지금 이 종목이 제대로 움직일 준비가 되었는가?"라는 질문에
가장 먼저 답해 주는 **변동성 관문 필터**입니다.

## 전략 상세 설명

이 전략은 다음과 같은 순서로 동작합니다.

1. 해외주식의 일봉 데이터를 여러 개 조회합니다.
2. 최근 `atr_period`일 동안 이 종목이 하루에 얼마나 움직였는지를 숫자로 계산합니다.
   - 이 숫자가 바로 **ATR(Average True Range)** 입니다.
   - 쉽게 말해, **"요즘 이 종목이 하루에 평균 얼마만큼 흔들리는지"**를 나타냅니다.
3. 계산된 ATR이 우리가 설정한 최소 기준값(`min_atr`) 이상이면 **“통과”**,
   그렇지 않으면 **“보류”**로 판단합니다.
4. 함께 반환되는 데이터에는:
   - 계산된 ATR 값,
   - 현재가 대비 ATR이 몇 %인지,
   - ATR 계산에 사용된 최근 캔들 히스토리 일부가 포함될 수 있습니다.

### 변동성을 어떻게 계산하나요? (ATR 간단 설명)

하루 변동 폭을 구할 때는, 각 날짜마다 다음 세 값 중 **가장 큰 값**을 사용합니다.

1. 오늘 고가 - 오늘 저가  
2. |오늘 고가 - 어제 종가|  
3. |오늘 저가 - 어제 종가|

이 중 가장 큰 값을 그 날의 **True Range(TR)** 라고 부릅니다.

그 다음, 최근 `atr_period`일(기본 20일)의 TR을 평균 내면 **ATR**이 됩니다.

- ATR이 클수록: 최근 며칠 사이에 가격이 크게 출렁였다는 뜻입니다.
- ATR이 작을수록: 최근 며칠 동안 가격이 거의 움직이지 않았다는 뜻입니다.

예를 들어 현재 주가가 100달러이고 ATR이 2라면,
최근 하루 평균 움직임이 대략 2달러(약 2%)였다는 의미입니다.

## DSL 예시

```python
{
    "condition_id": "OverseasStockTurtleVolatility",
    "symbol": {"symbol": "NVDA", "exchcd": "82"},
    "params": {
        "appkey": "발급키",
        "appsecretkey": "발급시크릿",
        "atr_period": 20,
        "min_atr": 1.5,
        "qrycnt": 120
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `atr_period` | int | 20 | ATR을 계산할 일수입니다. 길수록 값이 부드럽고 느리게 움직이고, 짧을수록 변동성 변화에 민감하게 반응합니다. |
| `min_atr` | float | 0.5 | ATR이 이 값 이상일 때만 전략을 "통과"로 판단합니다. "이 정도는 움직여야 거래한다"는 최소 변동성 기준선입니다. |
| `qrycnt` | int | 120 | 서버에서 가져올 일봉 개수입니다. 최소 `atr_period`의 3배 이상을 권장합니다. 너무 짧으면 ATR이 불안정해질 수 있습니다. |
| `appkey` | str | - | API 호출용 발급 키입니다. |
| `appsecretkey` | str | - | API 호출용 시크릿 키입니다. |

## 전략 사용 시 주의사항

- 이 전략은 **"변동성이 충분한 종목만 고르는 필터"**일 뿐,
  진입/청산 타이밍을 직접 알려주지는 않습니다. 보통은 Turtle Breakout, 리스크 관리 전략과 함께 사용해야 합니다.
- `min_atr` 값을 너무 높게 잡으면,
  실제로 좋은 추세가 나오는 종목도 "보류"로 걸러질 수 있습니다. 반대로 너무 낮게 잡으면 조용한 종목까지 모두 통과되어,
  가짜 신호와 손절이 늘어날 수 있습니다.
- ATR은 과거 가격 데이터를 기반으로 계산되기 때문에,
  갑작스러운 뉴스·실적 발표 등 이벤트 직후에는 변동성이 급변할 수 있습니다.
  유동성 필터나 다른 리스크 관리 조건과 함께 사용하는 것을 권장합니다.
