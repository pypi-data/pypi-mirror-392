# Futures Split Funds

## 전략 ID
FuturesSplitFunds

## 무엇을 하나요?
주문가능 증거금의 일부를 떼어 여러 선물 종목(또는 월물)에 균등하게 배정한 뒤, 자동으로 신규 매수 주문을 생성합니다. “삼삼하게 나눠서 여러 종목을 동시에 담고 싶다”는 니즈를 간단한 설정만으로 해결할 수 있습니다.

## 핵심 흐름 요약
- 계좌의 주문가능 증거금 중 일부만 전략 예산으로 쓰고, 비상 자금은 꼭 남겨 둡니다.
- 감시 목록을 순서대로 훑으면서 종목별·전체 한도 안에서 계약 수를 골고루 배분합니다.
- 체결가 급등이나 증거금 인상 같은 돌발 상황을 대비해 주문 금액과 필요 증거금을 넉넉히 잡습니다.
- 한 종목의 주문이 잡히면 곧바로 예산을 차감해, 여러 종목을 담아도 전체 한도를 넘지 않게 유지합니다.

### 더 알고 싶다면 (선택)
세부 동작 로직이 궁금한 경우, 아래 개념을 참고하세요.
1. 시세 조회: LS o3106 API에서 가장 최근 매도호가/현재가/매수호가 중 유효한 값을 찾아 슬리피지를 반영합니다.
2. 증거금 계산: 심볼 정보의 개시/유지 증거금을 활용하고, 값이 없으면 명목가(가격 × 계약단위)를 대신 사용합니다.
3. 예산 관리: 주문이 추가될 때마다 남은 예산을 다시 계산해 다음 종목도 같은 기준으로 검증합니다.

## 어떻게 쓰나요?
- UI 또는 운영 도구에서 “선물 균등 배분 매수” 전략을 선택한 뒤, 계좌별로 허용하고 싶은 투자 비율과 종목 수 한도를 설정합니다.
- 상세 파라미터 이름은 운영자 가이드에 따르되, 투자자는 “얼마나 쓸지 / 몇 종목을 담을지 / 종목당 몇 계약까지 허용할지”만 직관적으로 입력하면 됩니다.
- API 키 등 인증 정보는 자동 로그인 기능을 쓰지 않을 때만 담당자 지시에 따라 입력하세요.

### DSL 예시 (운영자용)
자동화 파이프라인이나 백엔드에서 전략을 호출할 때는 아래와 같이 간단한 JSON 형태(DSL)를 사용합니다. 값만 상황에 맞게 바꾸면 됩니다.

```python
{
	"condition_id": "FuturesSplitFunds",
	"params": {
		"percent_balance": 0.25,
		"max_symbols": 4,
		"contracts_per_symbol": 2
	}
}
```

### 입력값 가이드 (투자자용)
| 입력 항목 (UI 라벨) | DSL 키 | 어떤 값을 넣으면 좋을까요? | 예시 |
| --- | --- | --- | --- |
| 투자 비율 | `percent_balance` | 전체 증거금 중 전략에 쓸 비율을 적습니다. 0.2 → 20% 사용. | `0.2` |
| 담을 종목 수 | `max_symbols` | 한 번에 담고 싶은 종목 개수를 적습니다. 너무 크게 잡으면 예산이 얇게 퍼집니다. | `3` |
| 종목당 계약 수 | `contracts_per_symbol` | 각 종목을 최대 몇 계약까지 살지 정합니다. 계좌 규모에 맞춰 1~3 계약 정도 권장. | `1` |
| 증거금 여유 퍼센트 | `margin_buffer` | 증거금 변동을 대비해 추가로 확보할 비율입니다. 변동성이 큰 시장이면 0.2 이상 권장. | `0.15` |
| 남겨둘 최소 증거금 | `min_remaining_balance_ratio` | 전략을 돌리고도 계좌에 남겨둘 최소 비율입니다. 급한 상황에 대비하려면 0.1~0.2 유지. | `0.1` |
| 계약당 예상 비용 | `estimated_fee_per_contract` | 수수료·거래소 비용 등 계약당 들어가는 금액을 USD 기준으로 적습니다. | `2.5` |
| 슬리피지 여유 | `slippage_ratio` | 체결가가 순간적으로 오를 때 대비한 비율입니다. 일반 시장 0.001, 변동성 크면 0.003 등으로 조정. | `0.001` |
| 인증 정보 | `appkey`, `appsecretkey` | 자동 로그인 기능을 직접 사용할 때만 담당자에게 발급받은 값을 입력합니다. | `"abc..."` |

## 참고
- 종목별 증거금 정보가 제공되지 않는 경우에는 명목가(가격 × 계약단위)를 대신 사용하므로, 실제 증거금 요구치와 차이가 날 수 있습니다. 반드시 소액으로 먼저 테스트해 보세요.
- 감시 목록에 등록된 순서대로 종목을 선택합니다. 우선순위가 중요하다면 시스템에서 목록 순서를 조정해 주세요.
- 모든 주문 후 즉시 남은 예산을 재계산하므로, 여러 종목을 매수하더라도 총합이 허용된 증거금을 넘지 않습니다.
