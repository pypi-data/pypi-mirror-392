# 주식 분할 자금 전략 (Stock Split Funds)

## 전략 ID
`StockSplitFunds`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **해외주식 매수 시 사용할 예수금을 여러 종목에 균등하게 나누어 자동으로 주문을 만들어 주는 자금 분할(분산투자) 도우미**입니다.

계좌의 예수금 중에서 **얼마나 쓸지(퍼센트)** 와 **최대 몇 종목까지 살지**를 정해 두면,
남은 작업은 전략이 알아서 각 종목당 사용할 금액과 매수 수량을 계산해 줍니다.

## 이 전략이 필요한 이유

- 해외 주식은 개별 종목의 변동성이 커서, **한 종목에 자금을 몰아 넣으면** 그 종목이 흔들릴 때 계좌 전체가 크게 출렁일 수 있습니다.
- 반대로, **여러 종목에 자금을 나눠 넣으면** 한 종목이 부진해도 나머지 종목이 보완해 줄 수 있습니다.
- `StockSplitFunds`는
    - 예수금의 일정 비율(`percent_balance`)만 사용하고,
    - 그 안에서 **최대 N종목(`max_symbols`)까지 자금을 균등하게 나누어 배분**해
    **감정에 휘둘리지 않는 기계적인 분산투자**를 도와줍니다.

## 전략 상세 설명

### 자금 분할(분산투자)을 쉽게 정리해 볼게요

- **자금 분할 = 여러 바구니에 나눠 담기**
    - 100만 원을 한 종목에 모두 투자하면, 그 종목이 20% 떨어지면 전체 자금도 20%가 줄어듭니다.
    - 대신 20만 원씩 5종목에 나누면, 한 종목이 20% 떨어져도 전체 자금 기준으로는 -4% 수준에 그칠 수 있습니다.

- **이 전략이 해 주는 일**
    - “어느 종목을 살지”는 상위 스캐너나 사용자가 결정합니다.
    - 이 전략은 **“선택된 종목들 사이에 돈을 어떻게 나눌지”**를 계산해 주는 역할을 합니다.

### 어떤 방식으로 동작하나요?

1. **사용할 총 자금 결정**
     - 현재 예수금에서 `percent_balance`만큼만 사용합니다.
     - 예: 예수금 1,000만 원, `percent_balance = 0.4` → 사용할 총 자금은 400만 원.
2. **종목당 배분 금액 계산**
     - 최대 매수 종목 수(`max_symbols`)를 기준으로 **종목당 최대 배분 금액**을 계산합니다.
     - 예: 총 400만 원, `max_symbols = 4` → 종목당 최대 100만 원까지.
3. **각 종목별 매수 수량 계산**
     - 각 후보 종목의 현재 가격을 조회하고,
     - 종목당 배분 금액으로 **살 수 있는 주식 수(정수)** 를 계산합니다.
     - 1주도 살 수 없다면 해당 종목은 이번에 주문하지 않습니다.
4. **매수 주문 생성**
     - 계산된 수량이 1주 이상인 종목에 대해서만, 균등 분할 원칙에 맞춰 매수 주문을 생성합니다.
     - 주문 방식(지정가/시장가 등)은 실제 구현에 따라 다를 수 있지만, 기본 아이디어는 **“예정된 금액 범위 안에서 균등하게 나누어 사는 것”**입니다.

### 활용 시나리오

- 해외주식 종목 스캐너가 여러 후보를 골라 줬을 때,
    **“이 중 몇 개를 골라서, 계좌의 30~40%만 분산투자하고 싶다”** 는 상황
- 매번 “몇 주를 살지” 일일이 계산하기보다는,
    **예수금 비율과 최대 종목 수만 정해 두고 자동으로 나눠 사기를 원하는** 장기/중기 투자자
- 이미 다른 전략(터틀, 모멘텀 등)으로 종목은 결정되어 있고,
    **자금 배분만 기계적으로 처리하고 싶은 운영 환경**

## DSL 예시

```python
{
        "condition_id": "StockSplitFunds",
        "params": {
                "percent_balance": 0.4,
                "max_symbols": 3,
                "appkey": "your_appkey",
                "appsecretkey": "your_appsecretkey"
        }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `percent_balance` | float | 0.4 | 현재 예수금의 몇 %를 사용할지 결정합니다. 예: 0.4 → 예수금의 40%만 분할 매수에 사용합니다. |
| `max_symbols` | int | 3 | 한 번에 최대 몇 종목까지 매수할지 설정합니다. 종목이 이 숫자보다 많으면 상위 일부만 대상으로 삼을 수 있습니다. |
| `appkey` | str | - | LS증권 Open API 앱키입니다. |
| `appsecretkey` | str | - | LS증권 Open API 앱시크릿키(로그인용)입니다. |

## 전략 사용 시 주의사항

- 시장 상황에 따라 가격 변동이 클 수 있으므로, **전략이 만든 주문이 실제 체결되는 가격**은 예시와 다를 수 있습니다.
- `percent_balance`와 `max_symbols` 값은 투자자의 리스크 성향과 계좌 규모에 맞게 설정해야 합니다. 너무 많은 종목에 너무 적은 금액을 나누면, **수수료 대비 효율이 떨어질 수 있습니다.**
- 이 전략은 **자금 배분 로직**만 담당하므로, 실제로 어떤 종목을 후보로 쓸지는 스캐너/조건 전략과 함께 설계하는 것이 좋습니다.
