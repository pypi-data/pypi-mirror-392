#!/usr/bin/env python3
"""
Reference circuit demonstrating dynamic property positioning for IC components.

This circuit includes all 6 IC components from Issue #176 to demonstrate
that property positions are now loaded dynamically from KiCAD symbol libraries.

Components:
- RF_Module:ESP32-WROOM-32 - Large RF module (40mm × 86mm)
- 74xx:74LS245 - SOIC-20W level shifter
- Interface_UART:MAX3485 - SOIC-8 transceiver
- Regulator_Linear:AMS1117-3.3 - SOT-223 LDO
- Regulator_Switching:TPS54202DDC - SOT-23-6 buck converter
- Transistor_FET:AO3401A - SOT-23 P-FET

Expected property positioning (loaded from symbol libraries):
- ESP32:    Reference (-12.7, 34.29), Value (1.27, 34.29)
- 74LS245:  Reference (-7.62, 16.51), Value (-7.62, -16.51)
- MAX3485:  Reference (-6.985, 13.97), Value (1.905, 13.97)
- AMS1117:  Reference (-3.81, 3.175), Value (0, 3.175)
- TPS54202: Reference (-7.62, 6.35), Value (0, 6.35)
- AO3401A:  Reference (5.08, 1.905), Value (5.08, 0)
"""

import kicad_sch_api as ksa

# Create schematic
sch = ksa.create_schematic("IC Property Positioning Reference")

# Grid spacing for component placement (in mm)
GRID = 50.8  # 2 inches

print("Creating reference schematic with 6 IC components...")
print("=" * 70)

# Row 1: Large ICs
print("\nRow 1: Large ICs")
print("-" * 70)

# ESP32-WROOM-32 - Large RF module
esp32 = sch.components.add(
    lib_id="RF_Module:ESP32-WROOM-32",
    reference="U1",
    value="ESP32-WROOM-32",
    position=(50, 50),
)
print(f"✓ {esp32.reference}: {esp32.lib_id} at ({esp32.position.x}, {esp32.position.y})")

# 74LS245 - Logic IC level shifter
ic_74ls245 = sch.components.add(
    lib_id="74xx:74LS245",
    reference="U2",
    value="74LS245",
    position=(150, 50),
)
print(f"✓ {ic_74ls245.reference}: {ic_74ls245.lib_id} at ({ic_74ls245.position.x}, {ic_74ls245.position.y})")

# Row 2: Communication ICs
print("\nRow 2: Communication ICs")
print("-" * 70)

# MAX3485 - UART transceiver
max3485 = sch.components.add(
    lib_id="Interface_UART:MAX3485",
    reference="U3",
    value="MAX3485",
    position=(50, 120),
)
print(f"✓ {max3485.reference}: {max3485.lib_id} at ({max3485.position.x}, {max3485.position.y})")

# Row 3: Voltage Regulators
print("\nRow 3: Voltage Regulators")
print("-" * 70)

# AMS1117-3.3 - Linear regulator
ams1117 = sch.components.add(
    lib_id="Regulator_Linear:AMS1117-3.3",
    reference="U4",
    value="AMS1117-3.3",
    position=(150, 120),
)
print(f"✓ {ams1117.reference}: {ams1117.lib_id} at ({ams1117.position.x}, {ams1117.position.y})")

# TPS54202DDC - Switching regulator
tps54202 = sch.components.add(
    lib_id="Regulator_Switching:TPS54202DDC",
    reference="U5",
    value="TPS54202DDC",
    position=(50, 170),
)
print(f"✓ {tps54202.reference}: {tps54202.lib_id} at ({tps54202.position.x}, {tps54202.position.y})")

# Row 4: Transistors
print("\nRow 4: Transistors")
print("-" * 70)

# AO3401A - P-channel FET
ao3401a = sch.components.add(
    lib_id="Transistor_FET:AO3401A",
    reference="Q1",
    value="AO3401A",
    position=(150, 170),
)
print(f"✓ {ao3401a.reference}: {ao3401a.lib_id} at ({ao3401a.position.x}, {ao3401a.position.y})")

# Add title block information
sch.title = "IC Property Positioning Reference"
sch.comment1 = "Issue #176: Dynamic property positioning from symbol libraries"
sch.comment2 = "All 6 tested IC components with correct property placement"
sch.comment3 = "Property positions loaded from KiCAD .kicad_sym files"
sch.comment4 = "Generated by circuit-synth / kicad-sch-api"

# Save schematic
output_path = "/tmp/ic_property_positioning_reference.kicad_sch"
sch.save(output_path)

print("\n" + "=" * 70)
print("SUCCESS!")
print("=" * 70)
print(f"\nSchematic saved to: {output_path}")
print("\nComponents added:")
print(f"  U1: ESP32-WROOM-32 (RF Module)")
print(f"  U2: 74LS245 (Logic IC)")
print(f"  U3: MAX3485 (UART Interface)")
print(f"  U4: AMS1117-3.3 (Linear Regulator)")
print(f"  U5: TPS54202DDC (Switching Regulator)")
print(f"  Q1: AO3401A (P-Channel FET)")
print("\nProperty positions loaded dynamically from symbol libraries.")
print("Open in KiCAD to verify property text placement is correct.")
print("=" * 70)
