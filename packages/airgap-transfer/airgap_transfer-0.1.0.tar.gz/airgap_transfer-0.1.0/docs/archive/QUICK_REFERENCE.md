# 文件传输快速参考

## 正确操作流程 (重要!)

```
┌─────────────────────────────────────────────────────────────┐
│                    本地端 (你的电脑)                        │
└─────────────────────────────────────────────────────────────┘

1. 运行传输程序:
   $ python transfer_file.py demo_test.txt

   输出:
   ======================================================================
   请在 5 秒内切换到远程终端窗口
   ======================================================================
   在远程终端执行以下命令来接收脚本:

       cat > receive.sh

   倒计时: 5 秒...


┌─────────────────────────────────────────────────────────────┐
│                远程端 (远程终端/远程桌面)                   │
└─────────────────────────────────────────────────────────────┘

2. 在远程终端输入(在倒计时结束前):
   $ cat > receive.sh

   ⚠️  执行后终端会等待输入,光标会停在下一行
   ⚠️  不要手动输入任何内容!等待本地程序自动输入


┌─────────────────────────────────────────────────────────────┐
│                    自动传输中...                            │
└─────────────────────────────────────────────────────────────┘

3. 等待自动输入完成

   本地端会显示:
   输入进度: 100.0% (36/36 行)
   ----------------------------------------------------------------------
   ✓ 传输完成!
   总用时: 15.2 秒

   远程端终端会自动显示所有脚本内容


┌─────────────────────────────────────────────────────────────┐
│                远程端 - 保存并执行                          │
└─────────────────────────────────────────────────────────────┘

4. 在远程终端按 Ctrl+D 保存脚本

   看到:
   $ cat > receive.sh
   #!/bin/bash
   # 自动生成的文件传输解码脚本
   ...
   (按 Ctrl+D)
   $ ← 返回正常提示符

5. 执行脚本:
   $ bash receive.sh

   输出:
   开始解码文件: demo_test.txt
   ✓ 文件传输成功! 校验和匹配
   文件已保存到: demo_test.txt
   -rw-r--r-- 1 user user 46B demo_test.txt

6. (可选) 清理脚本:
   $ rm receive.sh
```

## 常见错误

### ❌ 错误：没有使用 cat > receive.sh

```
远程端:
$ ← 直接等待输入,什么都不做

结果:
脚本内容被直接输入到终端执行,出现:
then>
else>
dquote>
脚本无法正常结束!
```

**解决**: 必须先执行 `cat > receive.sh`

### ❌ 错误：按错了键

```
远程端:
$ cat > receive.sh
(脚本输入中...)
按 Ctrl+C ← 错误!

结果:
输入被取消,脚本未保存
```

**解决**: 应该按 `Ctrl+D` (表示 EOF，保存文件)

### ❌ 错误：过早按 Ctrl+D

```
远程端:
$ cat > receive.sh
#!/bin/bash
# 自动生成的...
(传输还在进行中就按了 Ctrl+D)

结果:
脚本不完整,执行会失败
```

**解决**: 等待本地程序显示"传输完成"后再按 Ctrl+D

## 命令速查

### 基本传输
```bash
python transfer_file.py myfile.pdf
```

### 指定输出路径
```bash
python transfer_file.py myfile.pdf -o /tmp/output.pdf
```

### 慢速连接 (字符丢失时使用)
```bash
python transfer_file.py myfile.pdf --char-delay 0.01 --line-delay 0.05
```

### 快速连接 (本地虚拟机)
```bash
python transfer_file.py myfile.pdf --char-delay 0.001 --line-delay 0.01
```

### 交互式模式
```bash
python interactive_transfer.py
```

### 预览脚本 (不传输)
```bash
python demo_generated_script.py myfile.pdf
```

## 键盘快捷键

| 键 | 用途 |
|---|------|
| `Ctrl+D` | EOF (保存 cat > 输入的内容) |
| `Ctrl+C` | 中断/取消当前命令 |

⚠️ **重要**: 保存脚本用 `Ctrl+D`,不是 `Ctrl+C`!

## 故障排除速查

| 问题 | 解决方案 |
|-----|---------|
| 脚本显示 `then>`, `else>` | 按 Ctrl+C 退出，先执行 `cat > receive.sh` |
| 首字符丢失 | 增加倒计时：`--countdown 10` |
| 字符丢失 | 增加延迟：`--char-delay 0.01 --line-delay 0.05` |
| 校验和不匹配 | 1) 增加延迟重试 2) 检查终端编码 (UTF-8) |
| 文件未保存 | 确保按 `Ctrl+D` 而不是 `Ctrl+C` |

## 文件大小建议

| 大小 | 时间估算 | 推荐度 |
|-----|---------|-------|
| < 10 KB | < 1 分钟 | ⭐⭐⭐⭐⭐ |
| 10-100 KB | 1-10 分钟 | ⭐⭐⭐⭐ |
| 100 KB - 1 MB | 10-60 分钟 | ⭐⭐⭐ |
| 1-10 MB | 1-10 小时 | ⭐⭐ |
| > 10 MB | > 10 小时 | ⭐ (不推荐) |

## 完整文档

- `TRANSFER_FILE_README.md` - 完整使用文档
- `TROUBLESHOOTING_TRANSFER.md` - 问题排查详解
- `example_usage.md` - 实际使用场景
- `FILE_TRANSFER_SUMMARY.md` - 项目总览
