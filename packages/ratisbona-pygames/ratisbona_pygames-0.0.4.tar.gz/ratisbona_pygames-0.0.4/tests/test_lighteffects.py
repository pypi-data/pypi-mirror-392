import unittest

from ratisbona_pygames.gameutils import LarsonScanner


class TestLarsonScanner(unittest.TestCase):

    def test_larson_scanner_must_scan_with_simulator(self):
        lights = [" "] * 8
        def callback(light, onoff):
            lights[light] = "*" if onoff else " "

        scanner = LarsonScanner(num_lights=8, extra_border=0, trailing_lights=1, callback=callback)

        expected = [
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
        ]

        for i in range(16):
            scanner.cycle()
            self.assertEqual(expected[i], lights)

    def test_larson_scanner_must_scan_with_extra_border1(self):
        lights = [" "] * 8

        def callback(light, onoff):
            lights[light] = "*" if onoff else " "

        scanner = LarsonScanner(num_lights=8, extra_border=1, trailing_lights=1, callback=callback)

        expected = [
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
        ]

        for i in range(25):
            scanner.cycle()
            self.assertEqual(expected[i], lights)

    def test_larson_scanner_must_scan_with_extra_border2(self):
        lights = [" "] * 8

        def callback(light, onoff):
            lights[light] = "*" if onoff else " "

        scanner = LarsonScanner(num_lights=8, extra_border=2, trailing_lights=1, callback=callback)

        expected = [
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', ' ', ' ', ' ', ' '],
        ]

        for i in range(30):
            scanner.cycle()
            print(lights)
            self.assertEqual(expected[i], lights)

    def test_larson_scanner_must_scan_with_extra_border2_and_trailing_lights(self):
        lights = [" "] * 8

        def callback(light, onoff):
            lights[light] = "*" if onoff else " "

        scanner = LarsonScanner(num_lights=8, extra_border=2, trailing_lights=3, callback=callback)

        expected = [
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', '*', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', '*', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', '*', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', '*', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', '*', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', '*', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', '*'],
            [' ', ' ', ' ', ' ', ' ', '*', '*', '*'],
            [' ', ' ', ' ', ' ', '*', '*', '*', ' '],
            [' ', ' ', ' ', '*', '*', '*', ' ', ' '],
            [' ', ' ', '*', '*', '*', ' ', ' ', ' '],
            [' ', '*', '*', '*', ' ', ' ', ' ', ' '],
            ['*', '*', '*', ' ', ' ', ' ', ' ', ' '],
            ['*', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', '*', ' ', ' ', ' ', ' ', ' ', ' '],
            ['*', '*', '*', ' ', ' ', ' ', ' ', ' '],
            [' ', '*', '*', '*', ' ', ' ', ' ', ' '],
            [' ', ' ', '*', '*', '*', ' ', ' ', ' '],
            [' ', ' ', ' ', '*', '*', '*', ' ', ' '],
            [' ', ' ', ' ', ' ', '*', '*', '*', ' '],
            [' ', ' ', ' ', ' ', ' ', '*', '*', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', '*', '*'],
            [' ', ' ', ' ', ' ', ' ', ' ', ' ', '*']
        ]

        for i in range(30):
            scanner.cycle()
            print(lights)
            self.assertEqual(expected[i], lights)


if __name__ == '__main__':
    unittest.main()






