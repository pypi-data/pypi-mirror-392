name: Release and Publish

on:
  workflow_dispatch:

permissions:
  actions: write

jobs:
  # Trigger the combined build, release, and publish workflow
  trigger-deployment:
    name: Trigger Build and Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment workflow
        uses: actions/github-script@v7
        with:
          script: |
            const result = await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deployment.yml',
              ref: 'main'
            });
            console.log('Workflow dispatch triggered successfully');

      - name: Discord notification
        if: success()
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        uses: Ilshidur/action-discord@master
        with:
          args: 'Release and publish workflow has been triggered for {{ EVENT_PAYLOAD.repository.full_name }}.'
        continue-on-error: true
