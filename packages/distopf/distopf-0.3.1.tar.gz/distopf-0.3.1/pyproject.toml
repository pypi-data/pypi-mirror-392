[project]
name = "distopf"
version = "0.3.1"
description = "A package for solving unbalanced three-phase distribution system optimal power flow problems."
readme = "README.md"
authors = [
  {  name="Nathan Gray", email="nathan.gray@pnnl.gov" },
  {  name="Rabayet Sadnan", email="rabayet.sadnan@pnnl.gov"},
  {  name="Abodh Poudyal"},
]

requires-python = ">=3.10"
dependencies = [
    "cim-graph==0.4.1a2",
    "gridappsd-python>=2025.3.2a1,<2026.0.0",
    "cvxpy>=1.7.2",
    "networkx>=3.4.2",
    "numpy>=2.2.6",
    "opendssdirect-py==0.8.4",
    "plotly>=6.3.0",
    "scipy>=1.15.3",
    "pyomo>=6.9.4",
    "pandas>=2.3.3",
]

[project.urls]
Homepage = "https://github.com/GRIDAPPSD/distopf"
Issues = "https://github.com/GRIDAPPSD/distopf/issues"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[dependency-groups]
dev = [
    "jupyter>=1.1.1",
    "marimo>=0.15.2",
    "mypy>=1.18.2",
    "pandas-stubs>=2.3.2.250926",
    "pytest>=8.4.2",
    "pytest-cov>=7.0.0",
    "ruff>=0.12.12",
    "scipy-stubs>=1.15.3.0",
    "tabulate>=0.9.0",
    "ty>=0.0.1a26",
    "types-networkx>=3.5.0.20250901",
    "types-openpyxl>=3.1.5.20250822",
    "types-python-dateutil>=2.9.0.20250822",
]


[tool.mypy]
[[tool.mypy.overrides]]
module = "cimgraph.*"
follow_untyped_imports = true

[tool.ty.src]
exclude = ["src/distopf/pyomo_models"]

[tool.ty.rules]
possibly-missing-attribute = "ignore"

[tool.pytest.ini_options]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "performance: marks tests as performance tests",
    "unit: marks tests as unit tests",
]
testpaths = ["tests"]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
addopts = """
    --cov=distopf
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=50
    -v
    --tb=short
"""
filterwarnings = [
    # The format is action:message:category:module
    "ignore::DeprecationWarning:pytz",
]
