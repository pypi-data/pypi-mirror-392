{% set name = "flync" %}
{# Use environment-provided version if available (injected by CI), fallback to explicit value #}
{% set version = environ.get('FLYNC_BUILD_VERSION', '1.0.1') %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  path: ..

build:
  number: 0
  script: SETUPTOOLS_SCM_PRETEND_VERSION={{ version }} {{ PYTHON }} -m pip install . -vv
  entry_points:
    - flync = flync.cli:main
  skip: true  # [not linux]

requirements:
  host:
    - python >=3.11,<3.13
    - pip
    - setuptools
  run:
    - python >=3.11,<3.13
    # Bioinformatics tools
    - hisat2 >=2.2.1
    - stringtie >=2.2.1
    - samtools >=1.17
    - bedtools >=2.31.0
    - gffcompare >=0.12.6
    - gffread >=0.12.7
    - sra-tools >=3.0.0
    - pybigwig >=0.3.22
    - pybedtools >=0.9.1
    - snakemake-minimal >=7.32.0
    # Build tools
    - git >=2.40.0
    # Python dependencies
    - pandas >=2.0.0
    - numpy >=1.24.0
    - scikit-learn >=1.3.0
    - pyyaml >=6.0
    - click >=8.1.0
    - pyfaidx >=0.7.0
    - gffutils >=0.12.0
    - pyranges >=0.0.129
    - biopython >=1.81
    - joblib >=1.3.0
    - tqdm >=4.65.0
    - requests >=2.31.0
    - optuna >=3.0.0
    - mlflow >=2.7.0
    - interpret >=0.4.0

test:
  imports:
    - flync
    - flync.cli
    - flync.features
    - flync.ml
    - flync.config
    - flync.assets
  commands:
    - flync --help
    - flync --version
  source_files:
    - src/flync/assets/flync_ebm_model.pkl
    - src/flync/assets/flync_ebm_scaler.pkl
    - src/flync/assets/flync_ebm_model_schema.json
    - src/flync/config/bwq_config.yaml

about:
  home: https://github.com/homemlab/flync
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: 'FLYNC - FLY Non-Coding gene discovery & classification pipeline'
  description: |
    FLYNC is a complete bioinformatics pipeline for discovering and classifying 
    long non-coding RNAs (lncRNAs) in Drosophila melanogaster. It combines 
    RNA-seq processing, comprehensive genomic feature extraction, and machine 
    learning classification to identify novel lncRNA candidates.
  doc_url: https://github.com/homemlab/flync/blob/master/README.md
  dev_url: https://github.com/homemlab/flync

extra:
  recipe-maintainers:
    - homemlab
