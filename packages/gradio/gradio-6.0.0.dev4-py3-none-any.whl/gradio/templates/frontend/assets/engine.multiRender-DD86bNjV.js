import{L as V,I as X}from"./index-CKSmRzt-.js";import{WebGPUEngine as f}from"./webgpuEngine-BVALq9Yy.js";import"./index-bhUlIv2p.js";import"./bakedVertexAnimation-CylHCrPv.js";import"./instancesDeclaration-ClMHPNOg.js";import"./helperFunctions-BuKjnj6O.js";import"./fresnelFunction-CLtUumo5.js";import"./meshUboDeclaration-BNkB1Zzh.js";import"./sceneUboDeclaration-DZ-zHf4a.js";import"./decalFragment-CFTjSm3i.js";import"./audioEngine-D7o11N0J.js";f.prototype.unBindMultiColorAttachmentFramebuffer=function(t,e=!1,n){n&&n(),this._endCurrentRenderPass(),e||this.generateMipMapsMultiFramebuffer(t),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)};f.prototype.createMultipleRenderTarget=function(t,e,n){let i=!1,a=!0,u=!1,o=!1,c=15,x=1,d=1;const H=0,U=3,k=!1,v=5,N=3553;let m=[],T=[],M=[],_=[],y=[],R=[],S=[],b=[],A=[],B=[],g=!1;const l=this._createHardwareRenderTargetWrapper(!0,!1,t);e!==void 0&&(i=e.generateMipMaps??!1,a=e.generateDepthBuffer??!0,u=e.generateStencilBuffer??!1,o=e.generateDepthTexture??!1,x=e.textureCount??1,c=e.depthTextureFormat??15,m=e.types||m,T=e.samplingModes||T,M=e.useSRGBBuffers||M,_=e.formats||_,y=e.targetTypes||y,R=e.faceIndex||R,S=e.layerIndex||S,b=e.layerCounts||b,A=e.labels||A,B=e.creationFlags||B,d=e.samples??d,g=e.dontCreateTextures??!1);const D=t.width??t,G=t.height??t,F=[],I=[],w=[];l.label=e?.label??"MultiRenderTargetWrapper",l._generateDepthBuffer=a,l._generateStencilBuffer=u,l._attachments=I,l._defaultAttachments=w;let h=null;(a||u||o)&&!g&&(o||(a&&u?c=13:a?c=14:c=19),h=l.createDepthStencilTexture(0,!1,u,1,c,l.label+"-DepthStencil"));const P=e!==void 0&&typeof e=="object"&&e.createMipMaps&&!i;for(let s=0;s<x;s++){let C=T[s]||U,p=m[s]||H;const Y=_[s]||v,j=(M[s]||k)&&this._caps.supportSRGBBuffers,L=y[s]||N,E=b[s]??1,O=B[s];if((p===1&&!this._caps.textureFloatLinearFiltering||p===2&&!this._caps.textureHalfFloatLinearFiltering)&&(C=1),p===1&&!this._caps.textureFloat&&(p=0,V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),I.push(s+1),w.push(n?s+1:s===0?1:0),L===-1||g)continue;const r=new X(this,6);switch(F[s]=r,L){case 34067:r.isCube=!0;break;case 32879:r.is3D=!0,r.baseDepth=r.depth=E;break;case 35866:r.is2DArray=!0,r.baseDepth=r.depth=E;break}r.baseWidth=D,r.baseHeight=G,r.width=D,r.height=G,r.isReady=!0,r.samples=1,r.generateMipMaps=i,r.samplingMode=C,r.type=p,r._cachedWrapU=0,r._cachedWrapV=0,r._useSRGBBuffer=j,r.format=Y,r.label=A[s]??l.label+"-Texture"+s,this._internalTexturesCache.push(r),P&&(r.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(r,void 0,void 0,void 0,O,!0),P&&(r.generateMipMaps=!1)}return h&&(h.incrementReferences(),F[x]=h,this._internalTexturesCache.push(h)),l.setTextures(F),l.setLayerAndFaceIndices(S,R),g?l._samples=d:this.updateMultipleRenderTargetTextureSampleCount(l,d),l};f.prototype.updateMultipleRenderTargetTextureSampleCount=function(t,e){if(!t||!t.textures||t.textures.length===0||t.textures[0].samples===e)return e;const n=t.textures.length;if(n===0)return 1;e=Math.min(e,this.getCaps().maxMSAASamples);for(let a=0;a<n;++a)t.textures[a]._hardwareTexture?.releaseMSAATexture(t.getBaseArrayLayer(a));const i=t._depthStencilTexture===t.textures[n-1];for(let a=0;a<n;++a){const u=t.textures[a];this._textureHelper.createMSAATexture(u,e,!1,t.getBaseArrayLayer(a)),u.samples=e}return t._depthStencilTexture&&!i&&(this._textureHelper.createMSAATexture(t._depthStencilTexture,e),t._depthStencilTexture.samples=e),t._samples=e,e};f.prototype.generateMipMapsMultiFramebuffer=function(t){const e=t;if(!e.isMulti)return;const i=e._attachments.length;for(let a=0;a<i;a++){const u=e.textures[a];u.generateMipMaps&&!u.isCube&&!u.is3D&&this._generateMipmaps(u)}};f.prototype.resolveMultiFramebuffer=function(t){throw new Error("resolveMultiFramebuffer is not yet implemented in WebGPU!")};f.prototype.bindAttachments=function(t){t.length===0||!this._currentRenderTarget||(this._mrtAttachments=t,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(t))};f.prototype.buildTextureLayout=function(t,e=!1){const n=[];if(e)n.push(1);else for(let i=0;i<t.length;i++)t[i]?n.push(i+1):n.push(0);return n};f.prototype.restoreSingleAttachment=function(){};f.prototype.restoreSingleAttachmentForRenderTarget=function(){};
//# sourceMappingURL=engine.multiRender-DD86bNjV.js.map
