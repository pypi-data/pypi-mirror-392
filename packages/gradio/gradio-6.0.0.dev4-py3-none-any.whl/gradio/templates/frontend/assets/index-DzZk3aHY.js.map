{"version":3,"file":"index-DzZk3aHY.js","sources":["../../../../js/core/src/init.svelte.ts"],"sourcesContent":["import {\n\tdetermine_interactivity,\n\tget_component,\n\tget_inputs_outputs\n} from \"./init_utils\";\nimport { translate_if_needed } from \"./i18n\";\n\nimport type {\n\tComponentMeta,\n\tProcessedComponentMeta,\n\tLayoutNode,\n\tDependency,\n\tLoadingComponent,\n\tAppConfig,\n\tServerFunctions\n} from \"./types\";\nimport type { SharedProps } from \"@gradio/utils\";\nimport { allowed_shared_props } from \"@gradio/utils\";\nimport { Client } from \"@gradio/client\";\n\ntype client_return = Awaited<ReturnType<typeof Client.connect>>;\n\ntype set_data_type = (data: Record<string, unknown>) => void;\ntype get_data_type = () => Promise<Record<string, unknown>>;\ntype visitor<T> = (node: T) => ProcessedComponentMeta;\n\ntype Tab = {\n\tlabel: string;\n\tid: string;\n\tvisible: boolean;\n\tinteractive: boolean;\n\telem_id: string | undefined;\n\tscale: number | null;\n\torder?: number;\n};\nexport class AppTree {\n\t/** the raw component structure received from the backend */\n\t#component_payload: ComponentMeta[];\n\t/** the raw layout node structure received from the backend */\n\t#layout_payload: LayoutNode;\n\t/** the raw dependency structure received from the backend */\n\t#dependency_payload: Dependency[];\n\t/** Need this to set i18n in re-render */\n\treactive_formatter: (str: string) => string = (str: string) => str;\n\t/** the config for the app */\n\t#config: AppConfig;\n\tclient: client_return;\n\n\t/** the root node of the processed layout tree */\n\troot = $state<ProcessedComponentMeta>();\n\n\t/** a set of all component IDs that are inputs to dependencies */\n\t#input_ids: Set<number> = new Set();\n\t/** a set of all component IDs that are outputs of dependencies */\n\t#output_ids: Set<number> = new Set();\n\n\t/** A list of components that are currently loading */\n\t#pending_components: Array<LoadingComponent> = [];\n\n\t#get_callbacks = new Map<number, get_data_type>();\n\t#set_callbacks = new Map<number, set_data_type>();\n\tcomponent_ids: number[];\n\tinitial_tabs: Record<number, Tab[]> = {};\n\n\tcomponents_to_register: Set<number> = new Set();\n\tready: Promise<void>;\n\tready_resolve!: () => void;\n\tresolved: boolean = false;\n\n\tconstructor(\n\t\tcomponents: ComponentMeta[],\n\t\tlayout: LayoutNode,\n\t\tdependencies: Dependency[],\n\t\tconfig: AppConfig,\n\t\tapp: client_return,\n\t\treactive_formatter: (str: string) => string\n\t) {\n\t\tthis.ready = new Promise<void>((resolve) => {\n\t\t\tthis.ready_resolve = resolve;\n\t\t});\n\t\tthis.reactive_formatter = reactive_formatter;\n\n\t\tthis.#config = config;\n\t\tthis.#component_payload = components;\n\t\tthis.#layout_payload = layout;\n\t\tthis.#dependency_payload = dependencies;\n\t\tthis.root = this.create_node(\n\t\t\t{ id: layout.id, children: [] },\n\t\t\tnew Map(),\n\t\t\ttrue\n\t\t);\n\t\tfor (const comp of components) {\n\t\t\tif (comp.props.visible != false) this.components_to_register.add(comp.id);\n\t\t}\n\n\t\tthis.client = app;\n\n\t\tthis.prepare();\n\n\t\tconst component_map = components.reduce((map, comp) => {\n\t\t\tmap.set(comp.id, comp);\n\t\t\treturn map;\n\t\t}, new Map<number, ComponentMeta>());\n\n\t\tthis.root!.children = this.#layout_payload.children.map((node) =>\n\t\t\tthis.traverse(node, (node) => {\n\t\t\t\tconst new_node = this.create_node(node, component_map);\n\t\t\t\treturn new_node;\n\t\t\t})\n\t\t);\n\t\tthis.component_ids = components.map((c) => c.id);\n\t\tthis.initial_tabs = {};\n\t\tgather_initial_tabs(this.root!, this.initial_tabs);\n\t\tthis.postprocess(this.root!);\n\t}\n\n\t/**\n\t * Registers a component with its ID and data callbacks\n\t * @param id the ID of the component\n\t * @param _set_data the set data callback\n\t * @param _get_data the get data callback\n\t */\n\tregister_component(\n\t\tid: number,\n\t\t_set_data: set_data_type,\n\t\t_get_data: get_data_type\n\t): void {\n\t\tthis.#set_callbacks.set(id, _set_data);\n\t\tthis.#get_callbacks.set(id, _get_data);\n\t\tthis.components_to_register.delete(id);\n\t\tif (this.components_to_register.size === 0 && !this.resolved) {\n\t\t\tthis.resolved = true;\n\t\t\tthis.ready_resolve();\n\t\t}\n\t}\n\n\t/**\n\t * Preprocess the payloads to get the correct state read to build the tree\n\t */\n\tprepare() {\n\t\tconst [inputs, outputs] = get_inputs_outputs(this.#dependency_payload);\n\t\tthis.#input_ids = inputs;\n\t\tthis.#output_ids = outputs;\n\t}\n\n\t/** Processes the layout payload into a tree of components */\n\tprocess() {}\n\n\tpostprocess(tree: ProcessedComponentMeta) {\n\t\tthis.root = this.traverse(tree, [\n\t\t\t(node) => handle_visibility(node, this.#config.root),\n\t\t\t(node) =>\n\t\t\t\tuntrack_children_of_invisible_parents(\n\t\t\t\t\tnode,\n\t\t\t\t\tthis.#config.root,\n\t\t\t\t\tthis.components_to_register\n\t\t\t\t),\n\t\t\t(node) =>\n\t\t\t\thandle_empty_forms(\n\t\t\t\t\tnode,\n\t\t\t\t\tthis.#config.root,\n\t\t\t\t\tthis.components_to_register\n\t\t\t\t),\n\t\t\t(node) => translate_props(node, this.#config.root),\n\t\t\t(node) => apply_initial_tabs(node, this.#config.root, this.initial_tabs),\n\t\t\t(node) => this.find_attached_events(node, this.#dependency_payload)\n\t\t]);\n\t}\n\n\tfind_attached_events(\n\t\tnode: ProcessedComponentMeta,\n\t\tdependencies: Dependency[]\n\t): ProcessedComponentMeta {\n\t\tconst attached_events = dependencies\n\t\t\t.filter((dep) => dep.targets.find(([id]) => id === node.id))\n\t\t\t.map((dep) => {\n\t\t\t\tconst target = dep.targets.find(([id]) => id === node.id);\n\t\t\t\treturn target ? target[1] : null;\n\t\t\t})\n\t\t\t.filter(Boolean) as string[];\n\n\t\tnode.props.shared_props.attached_events = attached_events;\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Traverses the layout tree and applies a callback to each node\n\t * @param node the current layout node\n\t * @param visit the callback to apply to each node\n\t * @returns the return value of the callback, with a `children` property added for any child nodes\n\t */\n\n\ttraverse<T extends LayoutNode | ProcessedComponentMeta>(\n\t\tnode: T,\n\t\tvisit: visitor<T> | visitor<T>[]\n\t): ProcessedComponentMeta {\n\t\tfunction single_visit<U extends T>(\n\t\t\tnode: U,\n\t\t\tvisit: visitor<U>,\n\t\t\ttraverse_fn: any\n\t\t): ProcessedComponentMeta {\n\t\t\tconst result = visit(node);\n\t\t\tif (\"children\" in node && node.children.length > 0) {\n\t\t\t\tresult.children =\n\t\t\t\t\tnode.children?.map((child) => traverse_fn(child, visit)) || [];\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tif (Array.isArray(visit)) {\n\t\t\tlet result: ProcessedComponentMeta = node as ProcessedComponentMeta;\n\t\t\tfor (const v of visit) {\n\t\t\t\tresult = single_visit(result as T, v, this.traverse.bind(this));\n\t\t\t}\n\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn single_visit(node, visit, this.traverse.bind(this));\n\t\t}\n\t}\n\n\t/**\n\t * Creates a processed component node from a layout node\n\t * @param opts the layout node options\n\t * @param root whether this is the root node\n\t * @returns the processed component node\n\t */\n\tcreate_node(\n\t\topts: LayoutNode,\n\t\tcomponent_map: Map<number, ComponentMeta>,\n\t\troot = false,\n\t\treactive_formatter?: (str: string) => string\n\t): ProcessedComponentMeta {\n\t\tlet component: ComponentMeta | undefined;\n\t\tif (!root) {\n\t\t\tcomponent = component_map.get(opts.id);\n\t\t} else {\n\t\t\tcomponent = {\n\t\t\t\ttype: \"column\",\n\t\t\t\tid: opts.id,\n\t\t\t\t// @ts-ignore\n\t\t\t\tprops: {\n\t\t\t\t\tvisible: true,\n\t\t\t\t\troot: \"\",\n\t\t\t\t\ttheme_mode: \"light\"\n\t\t\t\t},\n\t\t\t\tcomponent_class_id: \"column\",\n\t\t\t\tkey: null\n\t\t\t};\n\t\t}\n\n\t\tif (!component) {\n\t\t\tthrow new Error(`Component with ID ${opts.id} not found`);\n\t\t}\n\t\tif (reactive_formatter) {\n\t\t\tcomponent.props.i18n = reactive_formatter;\n\t\t}\n\t\tconst processed_props = gather_props(\n\t\t\topts.id,\n\t\t\tcomponent.props,\n\t\t\t[this.#input_ids, this.#output_ids],\n\t\t\tthis.client,\n\t\t\t{ ...this.#config }\n\t\t);\n\n\t\tconst node = {\n\t\t\tid: opts.id,\n\t\t\ttype: component.type,\n\t\t\tprops: processed_props,\n\t\t\tchildren: [],\n\t\t\tshow_progress_on: null,\n\t\t\tcomponent_class_id: component.component_class_id || component.type,\n\t\t\tcomponent:\n\t\t\t\tprocessed_props.shared_props.visible !== false\n\t\t\t\t\t? get_component(\n\t\t\t\t\t\t\tcomponent.type,\n\t\t\t\t\t\t\tcomponent.component_class_id,\n\t\t\t\t\t\t\tthis.#config.root || \"\"\n\t\t\t\t\t\t)\n\t\t\t\t\t: null,\n\t\t\tkey: component.key,\n\t\t\trendered_in: component.rendered_in,\n\t\t\tdocumentation: component.documentation\n\t\t};\n\n\t\treturn node;\n\t}\n\n\trerender(components: ComponentMeta[], layout: LayoutNode) {\n\t\tconst component_map = components.reduce((map, comp) => {\n\t\t\tmap.set(comp.id, comp);\n\t\t\treturn map;\n\t\t}, new Map<number, ComponentMeta>());\n\t\tconst subtree = this.traverse(layout, (node) => {\n\t\t\tconst new_node = this.create_node(\n\t\t\t\tnode,\n\t\t\t\tcomponent_map,\n\t\t\t\tfalse,\n\t\t\t\tthis.reactive_formatter\n\t\t\t);\n\t\t\treturn new_node;\n\t\t});\n\n\t\tconst n = find_node_by_id(this.root!, subtree.id);\n\n\t\tif (!n) {\n\t\t\tthrow new Error(\"Rerender failed: root node not found in current tree\");\n\t\t}\n\t\tn.children = subtree.children;\n\t}\n\n\t/*\n\t * Updates the state of a component by its ID\n\t * @param id the ID of the component to update\n\t * @param new_state the new state to set\n\t * */\n\tasync update_state(\n\t\tid: number,\n\t\tnew_state: Partial<SharedProps> & Record<string, unknown>,\n\t\tcheck_visibility: boolean = true\n\t) {\n\t\t// Visibility is tricky ðŸ˜…\n\t\t// If the component is not visible, it has not been rendered\n\t\t// and so it has no _set_data callback\n\t\t// Therefore, we need to traverse the tree and set the visible prop to true\n\t\t// and then render it and its children. After that, we can call the _set_data callback\n\t\tconst node = find_node_by_id(this.root!, id);\n\t\tlet already_updated_visibility = false;\n\t\tif (check_visibility && !node?.component) {\n\t\t\tthis.root = this.traverse(this.root!, [\n\t\t\t\t//@ts-ignore\n\t\t\t\t(n) => set_visibility_for_updated_node(n, id, new_state.visible),\n\t\t\t\t(n) => handle_visibility(n, this.#config.root)\n\t\t\t]);\n\t\t\talready_updated_visibility = true;\n\t\t}\n\t\tconst _set_data = this.#set_callbacks.get(id);\n\t\tif (!_set_data) return;\n\t\t_set_data(new_state);\n\t\tif (!check_visibility || already_updated_visibility) return;\n\t\tthis.root = this.traverse(this.root!, (n) =>\n\t\t\thandle_visibility(n, this.#config.root)\n\t\t);\n\t}\n\n\t/**\n\t * Gets the current state of a component by its ID\n\t * @param id the ID of the component to get the state of\n\t * @returns the current state of the component, or null if not found\n\t */\n\tasync get_state(id: number): Promise<Record<string, unknown> | null> {\n\t\tconst _get_data = this.#get_callbacks.get(id);\n\t\tconst component = this.#component_payload.find((c) => c.id === id);\n\t\tif (!_get_data && !component) return null;\n\t\tif (_get_data) return await _get_data();\n\n\t\tif (component) return Promise.resolve({ value: component.props.value });\n\n\t\treturn null;\n\t}\n}\n\n/**\n * Process the server function names and return a dictionary of functions\n * @param id the component id\n * @param server_fns the server function names\n * @param app the client instance\n * @returns the actual server functions\n */\nexport function process_server_fn(\n\tid: number,\n\tserver_fns: string[] | undefined,\n\tapp: client_return\n): ServerFunctions {\n\tif (!server_fns) {\n\t\treturn {};\n\t}\n\treturn server_fns.reduce((acc, fn: string) => {\n\t\tacc[fn] = async (...args: any[]) => {\n\t\t\tif (args.length === 1) {\n\t\t\t\targs = args[0];\n\t\t\t}\n\t\t\tconst result = await app.component_server(id, fn, args);\n\t\t\treturn result;\n\t\t};\n\t\treturn acc;\n\t}, {} as ServerFunctions);\n}\n\n/**\n * Gathers the props for a component\n * @param id the ID of the component\n * @param props the props of the component\n * @param dependencies the component's dependencies\n * @param additional any additional props to include\n * @returns the gathered props as an object with `shared_props` and `props` keys\n */\nfunction gather_props(\n\tid: number,\n\tprops: ComponentMeta[\"props\"],\n\tdependencies: [Set<number>, Set<number>],\n\tclient: client_return,\n\tadditional: Record<string, unknown> = {}\n): {\n\tshared_props: SharedProps;\n\tprops: Record<string, unknown>;\n} {\n\tconst _shared_props: Partial<SharedProps> = {};\n\tconst _props: Record<string, unknown> = {};\n\tfor (const key in props) {\n\t\t// For Tabs (or any component that already has an id prop)\n\t\t// Set the id to the props so that it doesn't get overwritten\n\t\tif (key === \"id\") {\n\t\t\t_props[key] = props[key];\n\t\t} else if (allowed_shared_props.includes(key as keyof SharedProps)) {\n\t\t\tconst _key = key as keyof SharedProps;\n\t\t\t_shared_props[_key] = props[key];\n\t\t\tif (_key === \"server_fns\") {\n\t\t\t\t_shared_props.server = process_server_fn(id, props.server_fns, client);\n\t\t\t}\n\t\t} else {\n\t\t\t_props[key] = props[key];\n\t\t}\n\t}\n\n\tfor (const key in additional) {\n\t\tif (allowed_shared_props.includes(key as keyof SharedProps)) {\n\t\t\tconst _key = key as keyof SharedProps;\n\t\t\t_shared_props[_key] = additional[key];\n\t\t} else {\n\t\t\t_props[key] = additional[key];\n\t\t}\n\t}\n\n\t_shared_props.client = client;\n\t_shared_props.id = id;\n\t_shared_props.interactive = determine_interactivity(\n\t\tid,\n\t\t_shared_props.interactive,\n\t\t_props.value,\n\t\tdependencies\n\t);\n\n\t_shared_props.load_component = (\n\t\tname: string,\n\t\tvariant: \"base\" | \"component\" | \"example\"\n\t) =>\n\t\tget_component(\n\t\t\tname,\n\t\t\t\"\",\n\t\t\t_shared_props.root || \"\",\n\t\t\tvariant\n\t\t) as LoadingComponent;\n\n\t_shared_props.visible =\n\t\t_shared_props.visible === undefined ? true : _shared_props.visible;\n\t_shared_props.loading_status = {};\n\n\treturn { shared_props: _shared_props as SharedProps, props: _props };\n}\n\nfunction handle_visibility(\n\tnode: ProcessedComponentMeta,\n\troot: string\n): ProcessedComponentMeta {\n\t// Check if the node is visible\n\tif (node.props.shared_props.visible && !node.component) {\n\t\tconst result: ProcessedComponentMeta = {\n\t\t\t...node,\n\t\t\tcomponent: get_component(node.type, node.component_class_id, root),\n\t\t\tchildren: []\n\t\t};\n\n\t\tif (node.children) {\n\t\t\tresult.children = node.children.map((child) =>\n\t\t\t\thandle_visibility(child, root)\n\t\t\t);\n\t\t}\n\t\treturn result;\n\t} else {\n\t\treturn node;\n\t}\n}\n\nfunction set_visibility_for_updated_node(\n\tnode: ProcessedComponentMeta,\n\tid: number,\n\tvisible: boolean\n): ProcessedComponentMeta {\n\tif (node.id == id) {\n\t\tnode.props.shared_props.visible = visible;\n\t}\n\treturn node;\n}\n\nfunction _untrack(\n\tnode: ProcessedComponentMeta,\n\tcomponents_to_register: Set<number>\n): void {\n\tcomponents_to_register.delete(node.id);\n\tif (node.children) {\n\t\tnode.children.forEach((child) => _untrack(child, components_to_register));\n\t}\n\treturn;\n}\n\nfunction untrack_children_of_invisible_parents(\n\tnode: ProcessedComponentMeta,\n\troot: string,\n\tcomponents_to_register: Set<number>\n): ProcessedComponentMeta {\n\t// Check if the node is visible\n\tif (node.props.shared_props.visible !== true) {\n\t\t_untrack(node, components_to_register);\n\t}\n\treturn node;\n}\n\nfunction handle_empty_forms(\n\tnode: ProcessedComponentMeta,\n\troot: string,\n\tcomponents_to_register: Set<number>\n): ProcessedComponentMeta {\n\t// Check if the node is visible\n\tif (node.type === \"form\") {\n\t\tconst all_children_invisible = node.children.every(\n\t\t\t(child) => child.props.shared_props.visible === false\n\t\t);\n\n\t\tif (all_children_invisible) {\n\t\t\tnode.props.shared_props.visible = false;\n\t\t\tcomponents_to_register.delete(node.id);\n\t\t\treturn node;\n\t\t}\n\t}\n\n\treturn node;\n}\n\nfunction translate_props(\n\tnode: ProcessedComponentMeta,\n\troot: string\n): ProcessedComponentMeta {\n\tconst supported_props = [\n\t\t\"description\",\n\t\t\"info\",\n\t\t\"title\",\n\t\t\"placeholder\",\n\t\t\"value\",\n\t\t\"label\"\n\t];\n\tfor (const attr of Object.keys(node.props.shared_props)) {\n\t\tif (supported_props.includes(attr as string)) {\n\t\t\t// @ts-ignore\n\t\t\tnode.props.shared_props[attr] = translate_if_needed(\n\t\t\t\tnode.props.shared_props[attr as keyof SharedProps]\n\t\t\t);\n\t\t}\n\t}\n\tfor (const attr of Object.keys(node.props.props)) {\n\t\tif (supported_props.includes(attr as string)) {\n\t\t\tnode.props.props[attr] = translate_if_needed(node.props.props[attr]);\n\t\t}\n\t}\n\treturn node;\n}\n\nfunction apply_initial_tabs(\n\tnode: ProcessedComponentMeta,\n\troot: string,\n\tinitial_tabs: Record<number, Tab[]>\n): ProcessedComponentMeta {\n\tif (node.type === \"tabs\" && node.id in initial_tabs) {\n\t\tconst tabs = initial_tabs[node.id].sort((a, b) => a.order! - b.order!);\n\t\tnode.props.props.initial_tabs = tabs;\n\t}\n\treturn node;\n}\n\nfunction _gather_initial_tabs(\n\tnode: ProcessedComponentMeta,\n\tinitial_tabs: Record<number, Tab[]>,\n\tparent_tab_id: number | null,\n\torder: number | null\n): void {\n\tif (parent_tab_id !== null && node.type === \"tabitem\") {\n\t\tif (!(parent_tab_id in initial_tabs)) {\n\t\t\tinitial_tabs[parent_tab_id] = [];\n\t\t}\n\t\tif (!(\"id\" in node.props.props)) {\n\t\t\tnode.props.props.id = node.id;\n\t\t}\n\t\tinitial_tabs[parent_tab_id].push({\n\t\t\tlabel: node.props.shared_props.label as string,\n\t\t\tid: node.props.props.id,\n\t\t\telem_id: node.props.shared_props.elem_id,\n\t\t\tvisible: node.props.shared_props.visible,\n\t\t\tinteractive: node.props.shared_props.interactive,\n\t\t\tscale: node.props.shared_props.scale || null\n\t\t});\n\t\tnode.props.props.order = order;\n\t}\n\tif (node.children) {\n\t\tnode.children.forEach((child, i) => {\n\t\t\t_gather_initial_tabs(\n\t\t\t\tchild,\n\t\t\t\tinitial_tabs,\n\t\t\t\tnode.type === \"tabs\" ? node.id : null,\n\t\t\t\tnode.type === \"tabs\" ? i : null\n\t\t\t);\n\t\t});\n\t}\n\treturn;\n}\n\nfunction gather_initial_tabs(\n\tnode: ProcessedComponentMeta,\n\tinitial_tabs: Record<number, Tab[]>\n): void {\n\tfunction single_visit<U extends ProcessedComponentMeta>(node: U): void {\n\t\tif (\"children\" in node && node.children.length > 0) {\n\t\t\tnode.children?.forEach((child) =>\n\t\t\t\t_gather_initial_tabs(\n\t\t\t\t\tchild,\n\t\t\t\t\tinitial_tabs,\n\t\t\t\t\tnode.type === \"tabs\" ? node.id : null\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\treturn single_visit(node);\n}\n\nfunction find_node_by_id(\n\ttree: ProcessedComponentMeta,\n\tid: number\n): ProcessedComponentMeta | null {\n\tif (tree.id === id) {\n\t\treturn tree;\n\t}\n\n\tif (tree.children) {\n\t\tfor (const child of tree.children) {\n\t\t\tconst result = find_node_by_id(child, id);\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n"],"names":["AppTree","str","#input_ids","#output_ids","#get_callbacks","#set_callbacks","components","layout","dependencies","config","app","reactive_formatter","resolve","#config","#component_payload","#layout_payload","#dependency_payload","comp","component_map","map","node","c","gather_initial_tabs","id","_set_data","_get_data","inputs","outputs","get_inputs_outputs","tree","handle_visibility","untrack_children_of_invisible_parents","handle_empty_forms","translate_props","apply_initial_tabs","attached_events","dep","target","visit","single_visit","traverse_fn","result","child","v","opts","root","component","processed_props","gather_props","get_component","subtree","n","find_node_by_id","new_state","check_visibility","already_updated_visibility","set_visibility_for_updated_node","process_server_fn","server_fns","acc","fn","args","props","client","additional","_shared_props","_props","key","allowed_shared_props","_key","determine_interactivity","name","variant","visible","_untrack","components_to_register","supported_props","attr","translate_if_needed","initial_tabs","tabs","a","b","_gather_initial_tabs","parent_tab_id","order","i"],"mappings":"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"}