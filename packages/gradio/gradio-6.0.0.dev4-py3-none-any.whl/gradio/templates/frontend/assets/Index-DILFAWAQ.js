import{p as me,d as ot,b as ce,i as B,a as K,t as lt,e as he,c as nt,u as it,f as pt,g as ct}from"./i18n-5O2R8uRh.js";import{p as ye,R as dt,f as T,h as y,s as O,r as $,t as L,k as we,e as P,b as C,c as $e,g as be,af as M,ag as ne,ah as Re,j as r,a9 as S,i as e,ac as ut,$ as Ae,aD as vt,W as ft,Y as xe,X as gt,U as Ne,_ as Z}from"./index-bhUlIv2p.js";import{G as Ue}from"./utils.svelte-Baqu2V3e.js";import{t as ie,f as pe}from"./index-VAFKmIBi.js";import{b as ke}from"./input-BWfFfFnB.js";/* empty css                                                        */import{B as _t}from"./BlockTitle-FeDv4ORC.js";import{I as mt}from"./IconButton-CbXWacxl.js";import"./MarkdownCode.svelte_svelte_type_style_lang-ywXsGwHK.js";import{C as ht}from"./Check-CsvuanvC.js";import{C as bt}from"./Copy-CXx5az33.js";import{P as xt}from"./Plus-0tECih92.js";import{S as kt}from"./Send-0efWa9lQ.js";import{T as wt}from"./Trash-LJETE64H.js";import{I as yt}from"./IconButtonWrapper-DsFz-pKX.js";import{b as $t,D as Le}from"./Dropdown-cdNuGM3A.js";/* empty css                                                   *//* empty css                                              */import{B as Ct}from"./Block-CWUxteKJ.js";import{S as It}from"./index-D9STzgM4.js";import{default as wa}from"./Example-B7kfh6Ad.js";import"./Info-BxoDwKiQ.js";import"./MarkdownCode-B8rUXPOm.js";import"./html-BYxzblBS.js";import"./svelte-component-Df_c_uts.js";import"./misc-BSG2QtlE.js";import"./prism-python-Bb2K859D.js";import"./window-BwbneT0F.js";import"./event-modifiers-CdEA5IGF.js";import"./DropdownArrow-CjmTE0-H.js";import"./Clear-DimAkCP_.js";var Dt=T('<div class="s s--slider svelte-1io85vl" style="font-size:var(--font-size-sm)px"><button role="switch" class="svelte-1io85vl"></button> <span> </span></div>');function St(Q,N){ye(N,!1);let t=me(N,"label",12),p=me(N,"checked",12,!1),x=me(N,"disabled",12,!1);const _=dt();function X(b){const E=b.target.getAttribute("aria-checked");p(E!=="true"),_("click",{checked:p()})}var W={get label(){return t()},set label(b){t(b),be()},get checked(){return p()},set checked(b){p(b),be()},get disabled(){return x()},set disabled(b){x(b),be()}};ot();var U=Dt(),m=y(U),k=O(m,2),h=y(k,!0);return $(k),$(U),L(()=>{ce(m,"aria-checked",p()),m.disabled=x(),we(h,t())}),P("click",m,X),C(Q,U),$e(W)}var Tt=T("<div><!></div>"),Bt=T('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to dialogue format...</div></div>'),Pt=T('<textarea rows="1" readonly="" class="svelte-1p54cvv"></textarea>'),Ot=T('<div id="tag-menu" class="tag-menu svelte-1p54cvv"><!></div>'),Et=T('<div><button class="add-button svelte-1p54cvv" aria-label="Add new line"><!></button></div>'),Mt=T('<div class="dialogue-line svelte-1p54cvv"><div class="speaker-column svelte-1p54cvv" role="button" tabindex="0"><!></div> <div class="text-column svelte-1p54cvv"><div class="input-container svelte-1p54cvv"><textarea rows="1" class="svelte-1p54cvv"></textarea> <!></div></div> <!> <div><button class="delete-button svelte-1p54cvv" aria-label="Remove current line"><!></button></div></div>'),Rt=T("<div><!> <!></div>"),At=T('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to plain text...</div></div>'),Lt=T('<div id="tag-menu" class="tag-menu-plain-text svelte-1p54cvv"><!></div>'),Nt=T('<div><!> <textarea data-testid="textbox" class="svelte-1p54cvv"></textarea> <!></div>'),Ut=T('<div class="submit-container svelte-1p54cvv"><button class="submit-button svelte-1p54cvv"><!></button></div>'),zt=T("<label><!> <!> <!> <!> <!></label>");function Gt(Q,N){ye(N,!0);const t=N.gradio;let p=S(()=>!1),x=S(()=>!t.shared.interactive),_=M(ne([]));Re(()=>{t.props.value&&t.props.value.length&&typeof t.props.value!="string"?r(_,[...t.props.value],!0):t.props.value&&typeof t.props.value!="string"?r(_,[{speaker:`${t.props.speakers.length?t.props.speakers[0]:""}`,text:""}],!0):typeof t.props.value=="string"&&(r(I,t.props.value,!0),r(p,!0))});let X=S(()=>t.props.buttons||["copy"]),W=M(ne(t.props.value));Re(()=>{e(W)!=t.props.value&&(r(W,t.props.value,!0),t.dispatch("change"))});let U,m=M(!1),k=M(-1),h=M(0),b=M(ne([])),R=ne([]),E,Ce=M(0),ee=M(!1),de,I=M(""),te=M(null),Y=M(!1),q=M(!1);const Ie=["red","green","blue","yellow","purple","teal","orange","cyan","lime","pink"],ze={red:"rgba(254, 202, 202, 0.7)",green:"rgba(209, 250, 229, 0.7)",blue:"rgba(219, 234, 254, 0.7)",yellow:"rgba(254, 243, 199, 0.7)",purple:"rgba(233, 213, 255, 0.7)",teal:"rgba(204, 251, 241, 0.7)",orange:"rgba(254, 215, 170, 0.7)",cyan:"rgba(207, 250, 254, 0.7)",lime:"rgba(217, 249, 157, 0.7)",pink:"rgba(252, 231, 243, 0.7)"};let Ge=S(()=>{let a={};return t.props.color_map?a={...t.props.color_map}:(a={},t.props.speakers.forEach((s,o)=>{const d=Ie[o%Ie.length];a[s]=ze[d]})),a});function He(a){const s=t.props.speakers.length>0?t.props.speakers[0]:"";r(_,[...e(_).slice(0,a+1),{speaker:s,text:""},...e(_).slice(a+1)],!0),Z().then(()=>{R[a+1]&&R[a+1].focus()}),t.props.value=[...e(_)]}function We(a){r(_,[...e(_).slice(0,a),...e(_).slice(a+1)],!0),t.props.value=[...e(_)]}function ue(a,s,o){e(_)[a][s]=o,r(_,[...e(_)],!0),t.props.value=[...e(_)]}function ae(a,s){const o=a.target||HTMLTextAreaElement;o&&!R[s]&&(R[s]=o);const d=o.selectionStart||0,f=o.value;let g=!1,c=-1;if(f[d-1]===":"){r(k,s,!0),c=d;const l=je(f,d);r(b,t.props.tags.filter(i=>l===""||i.toLowerCase().includes(l.toLowerCase())),!0),g=e(b).length>0,r(h,0)}else{const l=f.lastIndexOf(":",d-1);if(l>=0&&!f.substring(l+1,d).includes(" ")){r(k,s,!0),c=l+1;const i=f.substring(l+1,d);r(b,t.props.tags.filter(u=>i===""||u.toLowerCase().includes(i.toLowerCase())),!0),g=e(b).length>0,r(h,0)}}if(g&&c!==-1){r(m,!0);const l=o.getBoundingClientRect();if(U){const i=U.getBoundingClientRect();r(Ce,i.top+l.height*(s+1.5))}}else r(m,!1);t.dispatch("input")}function je(a,s){const o=a.lastIndexOf(":",s-1);return o>=0?a.substring(o+1,s):""}async function De(){const a=e(b)[e(h)];if(a){let s,o;e(p)?(o=E,s=e(I)):(o=R[e(k)],s=e(_)[e(k)].text);const d=o?.selectionStart||0,f=s.lastIndexOf(":",d-1);if(f>=0){const g=s.substring(0,f),c=s.substring(d);if(e(p)){const l=`${g}${a} ${c}`;r(I,l),t.props.speakers.length===0?t.props.value=l:t.props.value=await t.shared.server.unformat({text:l}),Z().then(()=>{if(E){const i=g.length+a.length+1;E.setSelectionRange(i,i),E.focus()}})}else{const l=g.replace(/\[S\d+\]/g,"").trim(),i=`${l}${a} ${c}`;ue(e(k),"text",i),Z().then(()=>{const u=R[e(k)];if(u){const D=l.length+a.length+1;u.setSelectionRange(D,D),u.focus()}})}}r(m,!1),r(h,0)}}async function Se(a){const s=t.props.tags[a.detail.target.dataset.index];if(s){let o,d;e(p)?(d=E,o=e(I)):(d=R[e(k)],o=e(_)[e(k)].text);const f=d?.selectionStart||0,g=o.lastIndexOf(":",f-1);if(g>=0){const c=o.substring(0,g),l=o.substring(f);if(e(p)){const i=`${c}${s} ${l}`;r(I,i),t.props.speakers.length===0?t.props.value=i:t.props.value=await t.shared.server.unformat({text:i}),Z().then(()=>{if(E){const u=c.length+s.length+1;E.setSelectionRange(u,u),E.focus()}})}else{const i=c.replace(/\[S\d+\]/g,"").trim(),u=`${i}${s} ${l}`;ue(e(k),"text",u),Z().then(()=>{const D=R[e(k)];if(D){const F=i.length+s.length+1;D.setSelectionRange(F,F),D.focus()}})}}r(m,!1),r(h,0)}}function Xe(a){if(e(m)){const s=a.target,o=document.getElementById("tag-menu");o&&!o.contains(s)&&r(m,!1)}}async function ve(a){return typeof a=="string"?a:await t.shared.server.format(a)}async function Ye(){if("clipboard"in navigator){const a=await ve(t.props.value);await navigator.clipboard.writeText(a),qe()}}function qe(){r(ee,!0),de&&clearTimeout(de),de=setTimeout(()=>{r(ee,!1)},1e3)}async function Fe(){e(p)&&(t.props.value=await t.shared.server.unformat({text:e(I)})),t.dispatch("submit")}ut(async()=>{if(typeof t.props.value=="string")r(I,t.props.value,!0);else if(t.props.value&&t.props.value.length>0){const a=await ve(t.props.value);r(I,a,!0)}else r(I,"")});var se=zt();P("click",vt,Xe);let Te;var Be=y(se);{var Je=a=>{yt(a,{children:(s,o)=>{{let d=S(()=>e(ee)?ht:bt),f=S(()=>e(ee)?"Copied":"Copy");mt(s,{get Icon(){return e(d)},get label(){return e(f)},$$events:{click:Ye}})}},$$slots:{default:!0}})};B(Be,a=>{t.shared.show_label&&e(X).includes("copy")&&a(Je)})}var Pe=O(Be,2);_t(Pe,{get show_label(){return t.shared.show_label},get info(){return t.props.info},children:(a,s)=>{ft();var o=Ae();L(()=>we(o,t.shared.label||"Dialogue")),C(a,o)},$$slots:{default:!0}});var Oe=O(Pe,2);{var Ke=a=>{var s=Tt();let o;var d=y(s);{let f=S(()=>e(q)||e(Y));St(d,{label:"Plain Text",get disabled(){return e(f)},get checked(){return e(p)},set checked(g){r(p,g)},$$events:{click:async g=>{if(g.detail.checked){r(q,!0);try{r(I,await ve(e(_)),!0)}finally{r(q,!1)}}else{r(Y,!0);try{t.props.value=await t.shared.server.unformat({text:e(I)}),r(_,[...t.props.value],!0)}finally{r(Y,!1)}}}}})}$(s),L(()=>o=K(s,1,"switch-container top-switch svelte-1p54cvv",null,o,{"switch-disabled":e(q)||e(Y)})),C(a,s)};B(Oe,a=>{t.props.ui_mode==="both"&&a(Ke)})}var Ee=O(Oe,2);{var Qe=a=>{var s=Rt();let o;var d=y(s);{var f=c=>{var l=Bt();ie(3,l,()=>pe,()=>({duration:200})),C(c,l)};B(d,c=>{e(Y)&&c(f)})}var g=O(d,2);lt(g,17,()=>e(_),it,(c,l,i)=>{var u=Mt(),D=y(u),F=y(D);{var v=n=>{var w=Pt();xe(w),L(()=>w.disabled=e(x)),ke(w,()=>e(l).speaker,H=>e(l).speaker=H),C(n,w)},z=n=>{const w=S(()=>new Ue({shared_props:{container:!0,show_label:!1,interactive:!0,label:""},props:{value:e(l).speaker,choices:t.props.speakers.map(H=>[H,H])}}));$t(n,{on_change:()=>ue(i,"speaker",e(w).props.value),get gradio(){return e(w)}})};B(F,n=>{e(x)?n(v):n(z,!1)})}$(D);var V=O(D,2),re=y(V),A=y(re);xe(A),he(A,(n,w)=>R[w]=n,n=>R?.[n],()=>[i]);var fe=O(A,2);{var G=n=>{var w=Ot(),H=y(w);{let J=S(()=>t.props.tags.map((j,rt)=>[j,rt])),_e=S(()=>e(b).map(j=>t.props.tags.indexOf(j))),st=S(()=>e(b).map(j=>t.props.tags.indexOf(j))[e(h)]);Le(H,{get choices(){return e(J)},get filtered_indices(){return e(_e)},get active_index(){return e(st)},show_options:!0,get offset_from_top(){return e(Ce)},from_top:!0,$$events:{change:j=>Se(j)}})}$(w),ie(3,w,()=>pe,()=>({duration:100})),C(n,w)};B(fe,n=>{e(m)&&e(k)===i&&n(G)})}$(re),$(V);var oe=O(V,2);{var tt=n=>{var w=Et();let H;var J=y(w),_e=y(J);xt(_e),$(J),$(w),L(()=>{H=K(w,1,"svelte-1p54cvv",null,H,{"action-column":i==0,hidden:e(x)}),J.disabled=e(x)}),P("click",J,()=>He(i)),C(n,w)};B(oe,n=>{(t.props.max_lines==null||t.props.max_lines&&i<t.props.max_lines-1)&&n(tt)})}var ge=O(oe,2);let Me;var le=y(ge),at=y(le);wt(at),$(le),$(ge),$(u),L(()=>{nt(u,`--speaker-bg-color: ${(e(x)&&(e(te)===null||e(te)===e(l).speaker)&&e(Ge)[e(l).speaker]||"transparent")??""}`),ce(A,"placeholder",t.props.placeholder),A.disabled=e(x),Me=K(ge,1,"action-column svelte-1p54cvv",null,Me,{hidden:e(x)||i==0}),le.disabled=e(x)}),P("mouseenter",D,()=>e(x)&&r(te,e(l).speaker,!0)),P("mouseleave",D,()=>e(x)&&r(te,null)),ke(A,()=>e(l).text,n=>e(l).text=n),P("input",A,n=>ae(n,i)),P("focus",A,n=>ae(n,i)),P("keydown",A,n=>{n.key==="Escape"&&e(m)?(r(m,!1),r(h,0),n.preventDefault()):e(m)&&e(k)===i&&(n.key==="ArrowDown"?(r(h,Math.min(e(h)+1,e(b).length-1),!0),n.preventDefault()):n.key==="ArrowUp"?(r(h,Math.max(e(h)-1,0),!0),n.preventDefault()):n.key==="Enter"&&(e(b)[e(h)]&&De(),n.preventDefault()))}),P("click",le,()=>We(i)),C(c,u)}),$(s),he(s,c=>U=c,()=>U),L(()=>o=K(s,1,"dialogue-container svelte-1p54cvv",null,o,{loading:e(Y)})),C(a,s)},Ve=a=>{var s=gt(),o=Ne(s);{var d=f=>{var g=Nt();let c;var l=y(g);{var i=v=>{var z=At();ie(3,z,()=>pe,()=>({duration:200})),C(v,z)};B(l,v=>{e(q)&&v(i)})}var u=O(l,2);xe(u),ce(u,"rows",5),he(u,v=>E=v,()=>E);var D=O(u,2);{var F=v=>{var z=Lt(),V=y(z);{let re=S(()=>t.props.tags.map((G,oe)=>[G,oe])),A=S(()=>e(b).map(G=>t.props.tags.indexOf(G))),fe=S(()=>e(b).map(G=>t.props.tags.indexOf(G))[e(h)]);Le(V,{get choices(){return e(re)},get filtered_indices(){return e(A)},get active_index(){return e(fe)},show_options:!0,$$events:{change:G=>Se(G)}})}$(z),ie(3,z,()=>pe,()=>({duration:100})),C(v,z)};B(D,v=>{e(m)&&v(F)})}$(g),L(()=>{c=K(g,1,"textarea-container svelte-1p54cvv",null,c,{loading:e(q)}),ce(u,"placeholder",t.props.placeholder),u.disabled=e(x)}),ke(u,()=>e(I),v=>r(I,v)),P("input",u,v=>{ae(v,0),t.props.value=e(I)}),P("focus",u,v=>ae(v,0)),P("keydown",u,v=>{v.key==="Escape"&&e(m)?(r(m,!1),r(h,0),v.preventDefault()):e(m)&&(v.key==="ArrowDown"?(r(h,Math.min(e(h)+1,e(b).length-1),!0),v.preventDefault()):v.key==="ArrowUp"?(r(h,Math.max(e(h)-1,0),!0),v.preventDefault()):v.key==="Enter"&&(e(b)[e(h)]&&De(),v.preventDefault()))}),C(f,g)};B(o,f=>{(e(p)||t.props.ui_mode!=="dialogue")&&f(d)},!0)}C(a,s)};B(Ee,a=>{!e(p)&&t.props.ui_mode!=="text"?a(Qe):a(Ve,!1)})}var Ze=O(Ee,2);{var et=a=>{var s=Ut(),o=y(s),d=y(o);{var f=c=>{var l=Ae();L(()=>we(l,t.props.submit_btn)),C(c,l)},g=c=>{kt(c)};B(d,c=>{typeof t.props.submit_btn=="string"?c(f):c(g,!1)})}$(o),$(s),L(()=>o.disabled=e(x)),P("click",o,Fe),C(a,s)};B(Ze,a=>{t.props.submit_btn&&!e(x)&&a(et)})}$(se),L(()=>Te=K(se,1,"svelte-1p54cvv",null,Te,{container:t.shared.container})),C(Q,se),$e()}var Ht=T("<!> <!>",1);function ba(Q,N){ye(N,!0);const t=pt(N,["$$slots","$$events","$$legacy"]),p=new Ue(t);Ct(Q,{get visible(){return p.shared.visible},get elem_id(){return p.shared.elem_id},get elem_classes(){return p.shared.elem_classes},get scale(){return p.shared.scale},get min_width(){return p.shared.min_width},allow_overflow:!0,get padding(){return p.shared.container},children:(x,_)=>{var X=Ht(),W=Ne(X);{var U=k=>{It(k,ct({get autoscroll(){return p.shared.autoscroll},get i18n(){return p.i18n}},()=>p.shared.loading_status,{$$events:{clear_status:()=>p.dispatch("clear_status",p.shared.loading_status)}}))};B(W,k=>{p.shared.loading_status&&k(U)})}var m=O(W,2);Gt(m,{get gradio(){return p}}),C(x,X)},$$slots:{default:!0}}),$e()}export{Gt as BaseDialogue,wa as BaseExample,ba as default};
//# sourceMappingURL=Index-DILFAWAQ.js.map
