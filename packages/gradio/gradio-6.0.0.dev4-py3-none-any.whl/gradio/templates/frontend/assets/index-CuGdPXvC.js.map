{"version":3,"file":"index-CuGdPXvC.js","sources":["../../../../js/audio/Index.svelte"],"sourcesContent":["<svelte:options accessors={true} />\n\n<script lang=\"ts\">\n\timport { tick } from \"svelte\";\n\timport { Gradio } from \"@gradio/utils\";\n\timport { StatusTracker } from \"@gradio/statustracker\";\n\timport type { LoadingStatus } from \"@gradio/statustracker\";\n\timport { onMount } from \"svelte\";\n\n\timport StaticAudio from \"./static/StaticAudio.svelte\";\n\timport InteractiveAudio from \"./interactive/InteractiveAudio.svelte\";\n\timport { Block, UploadText } from \"@gradio/atoms\";\n\timport type { AudioEvents, AudioProps } from \"./shared/types\";\n\n\tlet props = $props();\n\tlet upload_promise = $state<Promise<any>>();\n\n\tprops.props.stream_every = 0.1; // default to 0.1s stream interval\n\n\tclass AudioGradio extends Gradio<AudioEvents, AudioProps> {\n\t\tasync get_data() {\n\t\t\tif (upload_promise) {\n\t\t\t\tawait upload_promise;\n\t\t\t\tawait tick();\n\t\t\t}\n\n\t\t\tconst data = await super.get_data();\n\n\t\t\treturn data;\n\t\t}\n\t}\n\n\tconst gradio = new AudioGradio(props);\n\tlet label = $derived(gradio.shared.label || gradio.i18n(\"audio.audio\"));\n\n\t// let uploading = $state(false);\n\tlet active_source = $derived.by(() =>\n\t\tgradio.props.sources ? gradio.props.sources[0] : null\n\t);\n\tlet initial_value = gradio.props.value;\n\n\tconst handle_reset_value = (): void => {\n\t\tif (initial_value === null || gradio.props.value === initial_value) {\n\t\t\treturn;\n\t\t}\n\t\tgradio.props.value = initial_value;\n\t};\n\n\tlet dragging: boolean;\n\n\tlet color_accent = \"darkorange\";\n\n\tlet waveform_settings = $derived({\n\t\theight: 50,\n\t\tbarWidth: 2,\n\t\tbarGap: 3,\n\t\tcursorWidth: 2,\n\t\tcursorColor: \"#ddd5e9\",\n\t\tautoplay: gradio.props.autoplay,\n\t\tbarRadius: 10,\n\t\tdragToSeek: true,\n\t\tnormalize: true,\n\t\tminPxPerSec: 20\n\t});\n\n\tconst trim_region_settings = {\n\t\tcolor: gradio.props.waveform_options.trim_region_color,\n\t\tdrag: true,\n\t\tresize: true\n\t};\n\n\tfunction set_trim_region_colour(): void {\n\t\tdocument.documentElement.style.setProperty(\n\t\t\t\"--trim-region-color\",\n\t\t\ttrim_region_settings.color || color_accent\n\t\t);\n\t}\n\n\tfunction handle_error({ detail }: CustomEvent<string>): void {\n\t\tconst [level, status] = detail.includes(\"Invalid file type\")\n\t\t\t? [\"warning\", \"complete\"]\n\t\t\t: [\"error\", \"error\"];\n\t\tif (gradio.shared.loading_status) {\n\t\t\tgradio.shared.loading_status.status = status as LoadingStatus[\"status\"];\n\t\t\tgradio.shared.loading_status.message = detail;\n\t\t}\n\t\tgradio.dispatch(level as \"error\" | \"warning\", detail);\n\t}\n\n\tlet old_value = $state(gradio.props.value);\n\t$effect(() => {\n\t\tif (old_value != gradio.props.value) {\n\t\t\told_value = gradio.props.value;\n\t\t\tgradio.dispatch(\"change\");\n\t\t}\n\t});\n\n\tonMount(() => {\n\t\tcolor_accent = getComputedStyle(document?.documentElement).getPropertyValue(\n\t\t\t\"--color-accent\"\n\t\t);\n\t\tset_trim_region_colour();\n\t\twaveform_settings.waveColor =\n\t\t\tgradio.props.waveform_options.waveform_color || \"#9ca3af\";\n\t\twaveform_settings.progressColor =\n\t\t\tgradio.props.waveform_options.waveform_progress_color || color_accent;\n\t\twaveform_settings.mediaControls =\n\t\t\tgradio.props.waveform_options.show_controls;\n\t\twaveform_settings.sampleRate =\n\t\t\tgradio.props.waveform_options.sample_rate || 44100;\n\t});\n</script>\n\n{#if !gradio.shared.interactive}\n\t<Block\n\t\tvariant={\"solid\"}\n\t\tborder_mode={dragging ? \"focus\" : \"base\"}\n\t\tpadding={false}\n\t\tallow_overflow={false}\n\t\telem_id={gradio.shared.elem_id}\n\t\telem_classes={gradio.shared.elem_classes}\n\t\tvisible={gradio.shared.visible}\n\t\tcontainer={gradio.shared.container}\n\t\tscale={gradio.shared.scale}\n\t\tmin_width={gradio.shared.min_width}\n\t>\n\t\t<StatusTracker\n\t\t\tautoscroll={gradio.shared.autoscroll}\n\t\t\ti18n={gradio.i18n}\n\t\t\t{...gradio.shared.loading_status}\n\t\t\ton:clear_status={() =>\n\t\t\t\tgradio.dispatch(\"clear_status\", gradio.shared.loading_status)}\n\t\t/>\n\n\t\t<StaticAudio\n\t\t\ti18n={gradio.i18n}\n\t\t\tshow_label={gradio.shared.show_label}\n\t\t\tbuttons={gradio.props.buttons ?? [\"download\", \"share\"]}\n\t\t\tvalue={gradio.props.value}\n\t\t\tsubtitles={gradio.props.subtitles}\n\t\t\t{label}\n\t\t\tloop={gradio.props.loop}\n\t\t\t{waveform_settings}\n\t\t\twaveform_options={gradio.props.waveform_options}\n\t\t\teditable={gradio.props.editable}\n\t\t\ton:share={(e) => gradio.dispatch(\"share\", e.detail)}\n\t\t\ton:error={(e) => gradio.dispatch(\"error\", e.detail)}\n\t\t\ton:play={() => gradio.dispatch(\"play\")}\n\t\t\ton:pause={() => gradio.dispatch(\"pause\")}\n\t\t\ton:stop={() => gradio.dispatch(\"stop\")}\n\t\t/>\n\t</Block>\n{:else}\n\t<Block\n\t\tvariant={gradio.props.value === null && active_source === \"upload\"\n\t\t\t? \"dashed\"\n\t\t\t: \"solid\"}\n\t\tborder_mode={dragging ? \"focus\" : \"base\"}\n\t\tpadding={false}\n\t\tallow_overflow={false}\n\t\telem_id={gradio.shared.elem_id}\n\t\telem_classes={gradio.shared.elem_classes}\n\t\tvisible={gradio.shared.visible}\n\t\tcontainer={gradio.shared.container}\n\t\tscale={gradio.shared.scale}\n\t\tmin_width={gradio.shared.min_width}\n\t>\n\t\t<StatusTracker\n\t\t\tautoscroll={gradio.shared.autoscroll}\n\t\t\ti18n={gradio.i18n}\n\t\t\t{...gradio.shared.loading_status}\n\t\t\ton:clear_status={() =>\n\t\t\t\tgradio.dispatch(\"clear_status\", gradio.shared.loading_status)}\n\t\t/>\n\t\t<InteractiveAudio\n\t\t\tbind:upload_promise\n\t\t\tbind:initial_value\n\t\t\t{label}\n\t\t\tshow_label={gradio.shared.show_label}\n\t\t\tbuttons={gradio.props.buttons ?? []}\n\t\t\tvalue={gradio.props.value}\n\t\t\tsubtitles={gradio.props.subtitles}\n\t\t\ton:change={({ detail }) => (gradio.props.value = detail)}\n\t\t\ton:stream={({ detail }) => {\n\t\t\t\tgradio.props.value = detail;\n\t\t\t\tgradio.dispatch(\"stream\", gradio.props.value);\n\t\t\t}}\n\t\t\ton:drag={({ detail }) => (dragging = detail)}\n\t\t\troot={gradio.shared.root}\n\t\t\tsources={gradio.props.sources}\n\t\t\t{active_source}\n\t\t\tpending={gradio.shared.loading_status.pending}\n\t\t\tstreaming={gradio.props.streaming}\n\t\t\tbind:recording={gradio.props.recording}\n\t\t\tloop={gradio.props.loop}\n\t\t\tmax_file_size={gradio.shared.max_file_size}\n\t\t\t{handle_reset_value}\n\t\t\teditable={gradio.props.editable}\n\t\t\tbind:dragging\n\t\t\ton:edit={() => gradio.dispatch(\"edit\")}\n\t\t\ton:play={() => gradio.dispatch(\"play\")}\n\t\t\ton:pause={() => gradio.dispatch(\"pause\")}\n\t\t\ton:stop={() => gradio.dispatch(\"stop\")}\n\t\t\ton:start_recording={() => gradio.dispatch(\"start_recording\")}\n\t\t\ton:pause_recording={() => gradio.dispatch(\"pause_recording\")}\n\t\t\ton:stop_recording={(e) => {\n\t\t\t\tgradio.dispatch(\"stop_recording\");\n\t\t\t\tgradio.dispatch(\"input\");\n\t\t\t}}\n\t\t\ton:upload={() => {\n\t\t\t\tgradio.dispatch(\"upload\");\n\t\t\t\tgradio.dispatch(\"input\");\n\t\t\t}}\n\t\t\ton:clear={() => {\n\t\t\t\tgradio.dispatch(\"clear\");\n\t\t\t\tgradio.dispatch(\"input\");\n\t\t\t}}\n\t\t\ton:error={handle_error}\n\t\t\ton:close_stream={() => gradio.dispatch(\"close_stream\", \"stream\")}\n\t\t\ti18n={gradio.i18n}\n\t\t\t{waveform_settings}\n\t\t\twaveform_options={gradio.props.waveform_options}\n\t\t\t{trim_region_settings}\n\t\t\tstream_every={gradio.props.stream_every}\n\t\t\tstream_state={gradio.shared.loading_status.stream_state}\n\t\t\tupload={(...args) => gradio.shared.client.upload(...args)}\n\t\t\tstream_handler={(...args) => gradio.shared.client.stream(...args)}\n\t\t\ttime_limit={gradio.shared.loading_status.time_limit}\n\t\t>\n\t\t\t<UploadText i18n={gradio.i18n} type=\"audio\" />\n\t\t</InteractiveAudio>\n\t</Block>\n{/if}\n"],"names":["props","$.rest_props","$$props","upload_promise","$.state","AudioGradio","Gradio","tick","gradio","label","$.derived","active_source","initial_value","handle_reset_value","dragging","color_accent","waveform_settings","trim_region_settings","set_trim_region_colour","handle_error","level","status","detail","old_value","$.proxy","$.user_effect","$.get","onMount","e","$$value","$$render","alternate","consequent"],"mappings":"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"}