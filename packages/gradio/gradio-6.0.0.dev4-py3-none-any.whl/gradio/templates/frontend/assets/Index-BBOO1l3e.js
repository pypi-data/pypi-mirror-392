const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./embed-7_F0aD6F.js","./mollweide-mzWwiTwZ.js","./ordinal-BeghXfj9.js","./init-Dmth1JHB.js","./linear-JtEhER7e.js","./step-6CpiyZxH.js","./defaultLocale-CNpUPyHh.js","./time-BZ-JeWI2.js","./dispatch-kxCwF96_.js","./range-OtVwhkKS.js","./index-BU4IRnz1.js","./colors-Cc3OSVma.js","./dsv-DB8NKgIY.js","./arc-LH9133G6.js"])))=>i.map(i=>d[i]);
import{p as be,af as $,ag as ae,ah as X,j as h,i as t,a9 as x,ac as xe,Q as ke,f as H,U as K,$ as we,t as se,b as S,s as W,c as $e,aj as Ee,k as ie,W as Ie,h as Fe,r as Pe}from"./index-bhUlIv2p.js";import{f as ze,i as z,g as Oe,e as Ae}from"./i18n-5O2R8uRh.js";import{G as Se}from"./utils.svelte-Baqu2V3e.js";import{B as We}from"./Block-CWUxteKJ.js";import{B as Me}from"./BlockTitle-FeDv4ORC.js";/* empty css                                                        */import{I as Te}from"./IconButton-CbXWacxl.js";import{E as Ce}from"./Empty-5TrEX-tI.js";import"./MarkdownCode.svelte_svelte_type_style_lang-ywXsGwHK.js";import{D as Ve}from"./Download-CYnkzDbq.js";import{L as je}from"./LineChart-DjRo3J4k.js";import{I as Le}from"./IconButtonWrapper-DsFz-pKX.js";import{F as Ne}from"./FullscreenButton-0A34tPEK.js";import{S as De}from"./index-D9STzgM4.js";/* empty css                                                   */import"./Info-BxoDwKiQ.js";import"./MarkdownCode-B8rUXPOm.js";import"./html-BYxzblBS.js";import"./svelte-component-Df_c_uts.js";import"./misc-BSG2QtlE.js";import"./prism-python-Bb2K859D.js";import"./Maximize-Dcz8xF4p.js";import"./Clear-DimAkCP_.js";var Be=H("<!> <!>",1),He=H('<p class="caption svelte-19utvcn"> </p>'),Re=H('<div class="svelte-19utvcn"></div> <!>',1),Ue=H("<!> <!> <!> <!>",1);function mt(pe,Z){be(Z,!0);let ue=ze(Z,["$$slots","$$events","$$legacy"]);const e=new Se(ue);let ee=x(()=>e.props.color&&e.props.value&&e.props.value.datatypes[e.props.color]==="nominal"?Array.from(new Set(t(V).map(r=>r[e.props.color]))):[]),O=x(()=>e.props.x_lim||null),M=x(()=>e.props.y_lim||null),T=x(()=>t(O)?.[0]!==null?t(O)?.[0]:void 0),C=x(()=>t(O)?.[1]!==null?t(O)?.[1]:void 0),te=x(()=>t(M)?.[0]!==null?t(M)?.[0]:void 0),re=x(()=>t(M)?.[1]!==null?t(M)?.[1]:void 0),E=$(!1);function de(r){if(r==="x")return"ascending";if(r==="-x")return"descending";if(r==="y")return{field:e.props.y,order:"ascending"};if(r==="-y")return{field:e.props.y,order:"descending"};if(r===null)return null;if(Array.isArray(r))return r}let fe=x(()=>de(e.props.sort)),V=$(ae([]));function A(r){return r.replace(/\./g,"\\.").replace(/\[/g,"\\[").replace(/\]/g,"\\]")}let R=x(()=>e.props.value&&e.props.value.datatypes[e.props.x]==="temporal"),j=x(()=>t(R)?[t(T)!==void 0?t(T)*1e3:null,t(C)!==void 0?t(C)*1e3:null]:t(O)),U=$(!1);const ce={s:1,m:60,h:3600,d:1440*60};let I=x(()=>e.props.x_bin?typeof e.props.x_bin=="string"?1e3*parseInt(e.props.x_bin.substring(0,e.props.x_bin.length-1))*ce[e.props.x_bin[e.props.x_bin.length-1]]:e.props.x_bin:void 0),G=x(()=>{if(e.props.value)if(e.props.value.mark==="point"){const r=t(I)!==void 0;return e.props.y_aggregate||r?"sum":void 0}else return e.props.y_aggregate?e.props.y_aggregate:"sum"}),oe=x(()=>e.props.value?e.props.value.mark==="point"?t(I)!==void 0:t(I)!==void 0||e.props.value.datatypes[e.props.x]==="nominal":!1);function le(r,a,f,l,g,p){if(r.length<1e3||e.props.x_bin!==null||e.props.value?.mark!=="line"||e.props.value?.datatypes[e.props.x]==="nominal")return r;const c=250;let s={};if((g===void 0||p===void 0)&&r.forEach(o=>{let u=o[a];(g===void 0||u<g)&&(g=u),(p===void 0||u>p)&&(p=u)}),g===void 0||p===void 0)return r;const d=(p-g)/c;r.forEach((o,u)=>{const v=o[a],m=o[f],i=l!==null?o[l]:"any",n=Math.floor((v-g)/d);s[i]===void 0&&(s[i]=[]),s[i][n]=s[i][n]||[null,Number.POSITIVE_INFINITY,null,Number.NEGATIVE_INFINITY],m<s[i][n][1]&&(s[i][n][0]=u,s[i][n][1]=m),m>s[i][n][3]&&(s[i][n][2]=u,s[i][n][3]=m)});const w=[];return Object.values(s).forEach(o=>{o.forEach(([u,v,m,i])=>{let n=[];u!==null&&m!==null?n=[Math.min(u,m),Math.max(u,m)]:u!==null?n=[u]:m!==null&&(n=[m]),n.forEach(F=>{w.push(r[F])})})}),w}function _e(r,a,f){let l=r.columns.indexOf(e.props.x),g=r.columns.indexOf(e.props.y),p=e.props.color?r.columns.indexOf(e.props.color):null,c=r.data;if(a!==void 0&&f!==void 0){const s=r.datatypes[e.props.x]==="temporal"?1e3:1,_=a*s,d=f*s;let w={},o={};const u=c.filter((v,m)=>{const i=v[l],n=p!==null?v[p]:"any";return i<_&&(w[n]===void 0||i>w[n][1])&&(w[n]=[m,i]),i>d&&(o[n]===void 0||i<o[n][1])&&(o[n]=[m,i]),i>=_&&i<=d});c=[...Object.values(w).map(([v,m])=>c[v]),...le(u,l,g,p,_,d),...Object.values(o).map(([v,m])=>c[v])]}else c=le(c,l,g,p,void 0,void 0);return e.props.tooltip=="all"||Array.isArray(e.props.tooltip)?c.map(s=>{const _={};return r.columns.forEach((d,w)=>{_[d]=s[w]}),_}):c.map(s=>{const _={[e.props.x]:s[l],[e.props.y]:s[g]};return e.props.color&&p!==null&&(_[e.props.color]=s[p]),_})}X(()=>{console.log("effect 0 run"),h(V,e.props.value?_e(e.props.value,t(T),t(C)):[],!0)});let ne=$(ae(e.props.value));X(()=>{console.log("effect 1 run"),t(ne)!==e.props.value&&t(y)&&(h(ne,e.props.value,!0),t(y).data("data",t(V)).runAsync())});const me=typeof window<"u";let b=$(void 0),k=x(()=>t(b)?window.getComputedStyle(t(b)):null),y=$(void 0),L=$(!1),N=$(0),Y=$(0),D=$(void 0),q;async function B(){if(t(U)){h(J,!0);return}if(t(y)&&t(y).finalize(),!e.props.value||!t(b))return;h(N,t(b).offsetWidth,!0),h(Y,t(b).offsetHeight,!0);const r=he();r&&(h(D,new ResizeObserver(a=>{if(!(!a[0].target||!(a[0].target instanceof HTMLElement)))if(t(N)===0&&t(b).offsetWidth!==0&&e.props.value.datatypes[e.props.x]==="nominal")B();else{const f=Math.abs(t(N)-a[0].target.offsetWidth),l=Math.abs(t(Y)-a[0].target.offsetHeight);f>100||l>100?(h(N,a[0].target.offsetWidth,!0),h(Y,a[0].target.offsetHeight,!0),B()):(t(y).signal("width",a[0].target.offsetWidth).run(),t(E)&&t(y).signal("height",a[0].target.offsetHeight).run())}}),!0),q||(q=(await Ee(async()=>{const{default:a}=await import("./embed-7_F0aD6F.js");return{default:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url)).default),q(t(b),r,{actions:!1}).then(function(a){h(y,a.view,!0),t(D).observe(t(b));var f,l=0;t(y).addEventListener("dblclick",()=>{e.dispatch("double_click")}),t(b).addEventListener("mousedown",function(g){g.detail>1&&g.preventDefault()},!1),e.props._selectable&&t(y).addSignalListener("brush",function(g,p){if(Date.now()-l<1e3||(h(U,!0),Object.keys(p).length===0))return;clearTimeout(f);let c=p[Object.keys(p)[0]];t(R)&&(c=[c[0]/1e3,c[1]/1e3]),f=setTimeout(function(){h(U,!1),l=Date.now(),e.dispatch("select",{value:c,index:c,selected:!0}),t(J)&&(h(J,!1),B())},250)})}))}let J=$(!1);xe(()=>(h(L,!0),()=>{h(L,!1),t(y)&&t(y).finalize(),t(D)&&t(D).disconnect()}));function ge(){if(!t(y)||!t(k))return;const a=t(k).getPropertyValue("--block-background-fill")||"white";t(y).background(a).run(),t(y).toImageURL("png",2).then(function(f){t(y).background("transparent").run();const l=document.createElement("a");l.setAttribute("href",f),l.setAttribute("download","chart.png"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}).catch(function(f){console.error("Export failed:",f),t(y).background("transparent").run()})}let ve=x(()=>JSON.stringify(e.props.color_map));X(()=>{e.props.title,e.props.x_title,e.props.y_title,e.props.color_title,e.props.x,e.props.y,e.props.color,e.props.x_bin,t(G),t(ve),e.props.colors_in_legend,t(T),t(C),t(te),t(re),e.props.caption,e.props.sort,t(L),t(b),t(E),t(k),t(L)&&t(b)&&(console.log("Reloading chart due to prop change"),ke(()=>{B()}))});function he(){if(!e.props.value||!t(k))return null;let r=t(k).getPropertyValue("--color-accent"),a=t(k).getPropertyValue("--body-text-color"),f=t(k).getPropertyValue("--border-color-primary"),l=t(k).fontFamily,g=t(k).getPropertyValue("--block-title-text-weight");const p=_=>_.endsWith("px")?parseFloat(_.slice(0,-2)):12;let c=p(t(k).getPropertyValue("--text-md")),s=p(t(k).getPropertyValue("--text-sm"));return{$schema:"https://vega.github.io/schema/vega-lite/v5.17.0.json",background:"transparent",config:{autosize:{type:"fit",contains:"padding"},axis:{labelFont:l,labelColor:a,titleFont:l,titleColor:a,titlePadding:8,tickColor:f,labelFontSize:s,gridColor:f,titleFontWeight:"normal",titleFontSize:s,labelFontWeight:"normal",domain:!1,labelAngle:0,titleLimit:t(b).offsetHeight*.8},legend:{labelColor:a,labelFont:l,titleColor:a,titleFont:l,titleFontWeight:"normal",titleFontSize:s,labelFontWeight:"normal",offset:2},title:{color:a,font:l,fontSize:c,fontWeight:g,anchor:"middle"},view:{stroke:f},mark:{stroke:e.props.value.mark!=="bar"?r:void 0,fill:e.props.value.mark==="bar"?r:void 0,cursor:"crosshair"}},data:{name:"data"},datasets:{data:t(V)},layer:["plot",...e.props.value.mark==="line"?["hover"]:[]].map(_=>({encoding:{size:e.props.value.mark==="line"?_=="plot"?{condition:{empty:!1,param:"hoverPlot",value:3},value:2}:{condition:{empty:!1,param:"hover",value:100},value:0}:void 0,opacity:_==="plot"?void 0:{condition:{empty:!1,param:"hover",value:1},value:0},x:{axis:{...e.props.x_label_angle!==null&&{labelAngle:e.props.x_label_angle},labels:e.props.x_axis_labels_visible,ticks:e.props.x_axis_labels_visible},field:A(e.props.x),title:e.props.x_title||e.props.x,type:e.props.value.datatypes[e.props.x],scale:{zero:!1,domainMin:t(j)?.[0]!==null?t(j)?.[0]:void 0,domainMax:t(j)?.[1]!==null?t(j)?.[1]:void 0},bin:t(I)?{step:t(I)}:void 0,sort:t(fe)},y:{axis:e.props.y_label_angle?{labelAngle:e.props.y_label_angle}:{},field:A(e.props.y),title:e.props.y_title||e.props.y,type:e.props.value.datatypes[e.props.y],scale:{zero:!1,domainMin:t(te)??void 0,domainMax:t(re)??void 0},aggregate:t(oe)?t(G):void 0},color:e.props.color?{field:A(e.props.color),legend:{orient:"bottom",title:e.props.color_title,values:e.props.colors_in_legend||void 0},scale:e.props.value.datatypes[e.props.color]==="nominal"?{domain:t(ee),range:e.props.color_map?t(ee).map(d=>e.props.color_map[d]):void 0}:{range:[100,200,300,400,500,600,700,800,900].map(d=>t(k).getPropertyValue("--primary-"+d)),interpolate:"hsl"},type:e.props.value.datatypes[e.props.color]}:void 0,tooltip:e.props.tooltip=="none"?void 0:[{field:A(e.props.y),type:e.props.value.datatypes[e.props.y],aggregate:t(oe)?t(G):void 0,title:e.props.y_title||e.props.y},{field:A(e.props.x),type:e.props.value.datatypes[e.props.x],title:e.props.x_title||e.props.x,format:t(R)?"%Y-%m-%d %H:%M:%S":void 0,bin:t(I)?{step:t(I)}:void 0},...e.props.color?[{field:e.props.color,type:e.props.value.datatypes[e.props.color]}]:[],...e.props.tooltip==="axis"?[]:e.props.value?.columns.filter(d=>d!==e.props.x&&d!==e.props.y&&d!==e.props.color&&(e.props.tooltip==="all"||e.props.tooltip.includes(d))).map(d=>({field:d,type:e.props.value.datatypes[d]}))]},strokeDash:{},mark:{clip:!0,type:_==="hover"?"point":e.props.value.mark},name:_})),params:[...e.props.value.mark==="line"?[{name:"hoverPlot",select:{clear:"mouseout",fields:e.props.color?[e.props.color]:[],nearest:!0,on:"mouseover",type:"point"},views:["hover"]},{name:"hover",select:{clear:"mouseout",nearest:!0,on:"mouseover",type:"point"},views:["hover"]}]:[],...e.props._selectable?[{name:"brush",select:{encodings:["x"],mark:{fill:"gray",fillOpacity:.3,stroke:"none"},type:"interval"},views:["plot"]}]:[]],width:t(b).offsetWidth,height:e.props.height||t(E)?"container":void 0,title:e.props.title||void 0}}We(pe,{get visible(){return e.shared.visible},get elem_id(){return e.shared.elem_id},get elem_classes(){return e.shared.elem_classes},get scale(){return e.shared.scale},get min_width(){return e.shared.min_width},allow_overflow:!1,padding:!0,get height(){return e.props.height},get fullscreen(){return t(E)},set fullscreen(r){h(E,r,!0)},children:(r,a)=>{var f=Ue(),l=K(f);{var g=o=>{De(o,Oe({get autoscroll(){return e.shared.autoscroll},get i18n(){return e.i18n}},()=>e.shared.loading_status,{$$events:{clear_status:()=>e.dispatch("clear_status",e.shared.loading_status)}}))};z(l,o=>{e.shared.loading_status&&o(g)})}var p=W(l,2);{var c=o=>{Le(o,{children:(u,v)=>{var m=Be(),i=K(m);{var n=P=>{Te(P,{get Icon(){return Ve},label:"Export",$$events:{click:ge}})};z(i,P=>{e.props.buttons?.includes("export")&&P(n)})}var F=W(i,2);{var Q=P=>{Ne(P,{get fullscreen(){return t(E)},$$events:{fullscreen:({detail:ye})=>{h(E,ye,!0)}}})};z(F,P=>{e.props.buttons?.includes("fullscreen")&&P(Q)})}S(u,m)},$$slots:{default:!0}})};z(p,o=>{e.props.buttons?.length&&o(c)})}var s=W(p,2);Me(s,{get show_label(){return e.props.show_label},info:void 0,children:(o,u)=>{Ie();var v=we();se(()=>ie(v,e.props.label)),S(o,v)},$$slots:{default:!0}});var _=W(s,2);{var d=o=>{var u=Re(),v=K(u);Ae(v,n=>h(b,n),()=>t(b));var m=W(v,2);{var i=n=>{var F=He(),Q=Fe(F,!0);Pe(F),se(()=>ie(Q,e.props.caption)),S(n,F)};z(m,n=>{e.props.caption&&n(i)})}S(o,u)},w=o=>{Ce(o,{unpadded_box:!0,children:(u,v)=>{je(u)},$$slots:{default:!0}})};z(_,o=>{e.props.value&&me?o(d):o(w,!1)})}S(r,f)},$$slots:{default:!0}}),$e()}export{mt as default};
//# sourceMappingURL=Index-BBOO1l3e.js.map
