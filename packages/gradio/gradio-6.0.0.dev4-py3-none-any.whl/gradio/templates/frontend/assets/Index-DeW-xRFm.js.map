{"version":3,"file":"Index-DeW-xRFm.js","sources":["../../../../js/gallery/Index.svelte"],"sourcesContent":["<script context=\"module\" lang=\"ts\">\n\texport { default as BaseGallery } from \"./shared/Gallery.svelte\";\n\texport { default as BaseExample } from \"./Example.svelte\";\n</script>\n\n<script lang=\"ts\">\n\timport { tick } from \"svelte\";\n\timport type { FileData } from \"@gradio/client\";\n\timport { Block, UploadText } from \"@gradio/atoms\";\n\timport Gallery from \"./shared/Gallery.svelte\";\n\timport { StatusTracker } from \"@gradio/statustracker\";\n\timport { Gradio } from \"@gradio/utils\";\n\timport { BaseFileUpload } from \"@gradio/file\";\n\timport type { GalleryProps, GalleryEvents, GalleryData } from \"./types\";\n\n\tlet upload_promise = $state<Promise<any>>();\n\n\tclass GalleryGradio extends Gradio<GalleryEvents, GalleryProps> {\n\t\tasync get_data() {\n\t\t\tif (upload_promise) {\n\t\t\t\tawait upload_promise;\n\t\t\t\tawait tick();\n\t\t\t}\n\t\t\tconst data = await super.get_data();\n\n\t\t\treturn data;\n\t\t}\n\t}\n\n\tconst props = $props();\n\tconst gradio = new GalleryGradio<GalleryEvents, GalleryProps>(props);\n\n\tlet fullscreen = $state(false);\n\n\tlet no_value = $derived(\n\t\tgradio.props.value === null ? true : gradio.props.value.length === 0\n\t);\n\n\tfunction handle_delete(\n\t\tevent: CustomEvent<{ file: FileData; index: number }>\n\t): void {\n\t\tif (!gradio.props.value) return;\n\t\tconst { index } = event.detail;\n\t\tgradio.dispatch(\"delete\", event.detail);\n\t\tgradio.props.value = gradio.props.value.filter((_, i) => i !== index);\n\t\tgradio.dispatch(\"change\", gradio.props.value);\n\t}\n\n\tasync function process_upload_files(\n\t\tfiles: FileData[]\n\t): Promise<GalleryData[]> {\n\t\tconst processed_files = await Promise.all(\n\t\t\tfiles.map(async (x) => {\n\t\t\t\tif (x.path?.toLowerCase().endsWith(\".svg\") && x.url) {\n\t\t\t\t\tconst response = await fetch(x.url);\n\t\t\t\t\tconst svgContent = await response.text();\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...x,\n\t\t\t\t\t\turl: `data:image/svg+xml,${encodeURIComponent(svgContent)}`\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn x;\n\t\t\t})\n\t\t);\n\n\t\treturn processed_files.map((x) =>\n\t\t\tx.mime_type?.includes(\"video\")\n\t\t\t\t? { video: x, caption: null }\n\t\t\t\t: { image: x, caption: null }\n\t\t);\n\t}\n</script>\n\n<Block\n\tvisible={gradio.shared.visible}\n\tvariant=\"solid\"\n\tpadding={false}\n\telem_id={gradio.shared.elem_id}\n\telem_classes={gradio.shared.elem_classes}\n\tcontainer={gradio.shared.container}\n\tscale={gradio.shared.scale}\n\tmin_width={gradio.shared.min_width}\n\tallow_overflow={false}\n\theight={typeof gradio.props.height === \"number\"\n\t\t? gradio.props.height\n\t\t: undefined}\n\tbind:fullscreen\n>\n\t<StatusTracker\n\t\tautoscroll={gradio.shared.autoscroll}\n\t\ti18n={gradio.i18n}\n\t\t{...gradio.shared.loading_status}\n\t\ton:clear_status={() =>\n\t\t\tgradio.dispatch(\"clear_status\", gradio.shared.loading_status)}\n\t/>\n\t{#if gradio.shared.interactive && no_value}\n\t\t<BaseFileUpload\n\t\t\tbind:upload_promise\n\t\t\tvalue={null}\n\t\t\troot={gradio.shared.root}\n\t\t\tlabel={gradio.shared.label}\n\t\t\tmax_file_size={gradio.shared.max_file_size}\n\t\t\tfile_count={\"multiple\"}\n\t\t\tfile_types={gradio.props.file_types}\n\t\t\ti18n={gradio.i18n}\n\t\t\tupload={(...args) => gradio.shared.client.upload(...args)}\n\t\t\tstream_handler={(...args) => gradio.shared.client.stream(...args)}\n\t\t\ton:upload={async (e) => {\n\t\t\t\tconst files = Array.isArray(e.detail) ? e.detail : [e.detail];\n\t\t\t\tgradio.props.value = await process_upload_files(files);\n\t\t\t\tgradio.dispatch(\"upload\", gradio.props.value);\n\t\t\t\tgradio.dispatch(\"change\", gradio.props.value);\n\t\t\t}}\n\t\t\ton:error={({ detail }) => {\n\t\t\t\tgradio.shared.loading_status = gradio.shared.loading_status || {};\n\t\t\t\tgradio.shared.loading_status.status = \"error\";\n\t\t\t\tgradio.dispatch(\"error\", detail);\n\t\t\t}}\n\t\t>\n\t\t\t<UploadText i18n={gradio.i18n} type=\"gallery\" />\n\t\t</BaseFileUpload>\n\t{:else}\n\t\t<Gallery\n\t\t\ton:change={() => gradio.dispatch(\"change\")}\n\t\t\ton:clear={() => gradio.dispatch(\"change\")}\n\t\t\ton:select={(e) => gradio.dispatch(\"select\", e.detail)}\n\t\t\ton:share={(e) => gradio.dispatch(\"share\", e.detail)}\n\t\t\ton:error={(e) => gradio.dispatch(\"error\", e.detail)}\n\t\t\ton:preview_open={() => gradio.dispatch(\"preview_open\")}\n\t\t\ton:preview_close={() => gradio.dispatch(\"preview_close\")}\n\t\t\ton:fullscreen={({ detail }) => {\n\t\t\t\tfullscreen = detail;\n\t\t\t}}\n\t\t\ton:delete={handle_delete}\n\t\t\ton:upload={async (e) => {\n\t\t\t\tconst files = Array.isArray(e.detail) ? e.detail : [e.detail];\n\t\t\t\tconst new_value = await process_upload_files(files);\n\t\t\t\tgradio.props.value = gradio.props.value\n\t\t\t\t\t? [...gradio.props.value, ...new_value]\n\t\t\t\t\t: new_value;\n\t\t\t\tgradio.dispatch(\"upload\", new_value);\n\t\t\t\tgradio.dispatch(\"change\", gradio.props.value);\n\t\t\t}}\n\t\t\tlabel={gradio.shared.label}\n\t\t\tshow_label={gradio.shared.show_label}\n\t\t\tcolumns={gradio.props.columns}\n\t\t\trows={gradio.props.rows}\n\t\t\theight={gradio.props.height}\n\t\t\tpreview={gradio.props.preview}\n\t\t\tobject_fit={gradio.props.object_fit}\n\t\t\tinteractive={gradio.shared.interactive}\n\t\t\tallow_preview={gradio.props.allow_preview}\n\t\t\tbind:selected_index={gradio.props.selected_index}\n\t\t\tbind:value={gradio.props.value}\n\t\t\tshow_share_button={gradio.props.buttons.includes(\"share\")}\n\t\t\tshow_download_button={gradio.props.buttons.includes(\"download\")}\n\t\t\tfit_columns={gradio.props.fit_columns}\n\t\t\ti18n={gradio.i18n}\n\t\t\t_fetch={(...args) => gradio.shared.client.fetch(...args)}\n\t\t\tshow_fullscreen_button={gradio.props.buttons.includes(\"fullscreen\")}\n\t\t\t{fullscreen}\n\t\t\troot={gradio.shared.root}\n\t\t\tfile_types={gradio.props.file_types}\n\t\t\tmax_file_size={gradio.shared.max_file_size}\n\t\t\tupload={(...args) => gradio.shared.client.upload(...args)}\n\t\t\tstream_handler={(...args) => gradio.shared.client.stream(...args)}\n\t\t/>\n\t{/if}\n</Block>\n"],"names":["upload_promise","GalleryGradio","Gradio","$.get","tick","props","gradio","fullscreen","no_value","event","index","_","i","process_upload_files","files","x","svgContent","$0","$.derived","args","e","detail","$.set","handle_delete","new_value","$$render","consequent","alternate"],"mappings":"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"}