{"version":3,"file":"postProcessRenderEffect-Cke6bzhv.js","sources":["../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/PostProcesses/RenderPipeline/postProcessRenderPipeline.js","../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/PostProcesses/RenderPipeline/postProcessRenderEffect.js"],"sourcesContent":["import { __decorate } from \"../../tslib.es6.js\";\nimport { Tools } from \"../../Misc/tools.js\";\nimport { serialize } from \"../../Misc/decorators.js\";\nimport { UniqueIdGenerator } from \"../../Misc/uniqueIdGenerator.js\";\n/**\n * PostProcessRenderPipeline\n * @see https://doc.babylonjs.com/features/featuresDeepDive/postProcesses/postProcessRenderPipeline\n */\nexport class PostProcessRenderPipeline {\n    /**\n     * Gets pipeline name\n     */\n    get name() {\n        return this._name;\n    }\n    /** Gets the list of attached cameras */\n    get cameras() {\n        return this._cameras;\n    }\n    /**\n     * Gets the active engine\n     */\n    get engine() {\n        return this._engine;\n    }\n    /**\n     * Initializes a PostProcessRenderPipeline\n     * @param _engine engine to add the pipeline to\n     * @param name name of the pipeline\n     */\n    constructor(_engine, name) {\n        this._engine = _engine;\n        /**\n         * Gets the unique id of the post process rendering pipeline\n         */\n        this.uniqueId = UniqueIdGenerator.UniqueId;\n        this._name = name;\n        this._renderEffects = {};\n        this._renderEffectsForIsolatedPass = new Array();\n        this._cameras = [];\n    }\n    /**\n     * Gets the class name\n     * @returns \"PostProcessRenderPipeline\"\n     */\n    getClassName() {\n        return \"PostProcessRenderPipeline\";\n    }\n    /**\n     * If all the render effects in the pipeline are supported\n     */\n    get isSupported() {\n        for (const renderEffectName in this._renderEffects) {\n            if (Object.prototype.hasOwnProperty.call(this._renderEffects, renderEffectName)) {\n                if (!this._renderEffects[renderEffectName].isSupported) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    /**\n     * Adds an effect to the pipeline\n     * @param renderEffect the effect to add\n     */\n    addEffect(renderEffect) {\n        this._renderEffects[renderEffect._name] = renderEffect;\n    }\n    // private\n    /** @internal */\n    _rebuild() { }\n    /**\n     * @internal\n     */\n    _enableEffect(renderEffectName, cameras) {\n        const renderEffects = this._renderEffects[renderEffectName];\n        if (!renderEffects) {\n            return;\n        }\n        renderEffects._enable(Tools.MakeArray(cameras || this._cameras));\n    }\n    /**\n     * @internal\n     */\n    _disableEffect(renderEffectName, cameras) {\n        const renderEffects = this._renderEffects[renderEffectName];\n        if (!renderEffects) {\n            return;\n        }\n        renderEffects._disable(Tools.MakeArray(cameras || this._cameras));\n    }\n    /**\n     * @internal\n     */\n    _attachCameras(cameras, unique) {\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        const indicesToDelete = [];\n        let i;\n        for (i = 0; i < cams.length; i++) {\n            const camera = cams[i];\n            if (!camera) {\n                continue;\n            }\n            if (this._cameras.indexOf(camera) === -1) {\n                this._cameras.push(camera);\n            }\n            else if (unique) {\n                indicesToDelete.push(i);\n            }\n        }\n        for (i = 0; i < indicesToDelete.length; i++) {\n            cams.splice(indicesToDelete[i], 1);\n        }\n        for (const renderEffectName in this._renderEffects) {\n            if (Object.prototype.hasOwnProperty.call(this._renderEffects, renderEffectName)) {\n                this._renderEffects[renderEffectName]._attachCameras(cams);\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _detachCameras(cameras) {\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        for (const renderEffectName in this._renderEffects) {\n            if (Object.prototype.hasOwnProperty.call(this._renderEffects, renderEffectName)) {\n                this._renderEffects[renderEffectName]._detachCameras(cams);\n            }\n        }\n        for (let i = 0; i < cams.length; i++) {\n            this._cameras.splice(this._cameras.indexOf(cams[i]), 1);\n        }\n    }\n    /** @internal */\n    _update() {\n        for (const renderEffectName in this._renderEffects) {\n            if (Object.prototype.hasOwnProperty.call(this._renderEffects, renderEffectName)) {\n                this._renderEffects[renderEffectName]._update();\n            }\n        }\n        for (let i = 0; i < this._cameras.length; i++) {\n            if (!this._cameras[i]) {\n                continue;\n            }\n            const cameraName = this._cameras[i].name;\n            if (this._renderEffectsForIsolatedPass[cameraName]) {\n                this._renderEffectsForIsolatedPass[cameraName]._update();\n            }\n        }\n    }\n    /** @internal */\n    _reset() {\n        this._renderEffects = {};\n        this._renderEffectsForIsolatedPass = new Array();\n    }\n    _enableMSAAOnFirstPostProcess(sampleCount) {\n        if (!this._engine._features.supportMSAA) {\n            return false;\n        }\n        // Set samples of the very first post process to 4 to enable native anti-aliasing in browsers that support webGL 2.0 (See: https://github.com/BabylonJS/Babylon.js/issues/3754)\n        const effectKeys = Object.keys(this._renderEffects);\n        if (effectKeys.length > 0) {\n            const postProcesses = this._renderEffects[effectKeys[0]].getPostProcesses();\n            if (postProcesses) {\n                postProcesses[0].samples = sampleCount;\n            }\n        }\n        return true;\n    }\n    /**\n     * Ensures that all post processes in the pipeline are the correct size according to the\n     * the viewport's required size\n     */\n    _adaptPostProcessesToViewPort() {\n        const effectKeys = Object.keys(this._renderEffects);\n        for (const effectKey of effectKeys) {\n            const postProcesses = this._renderEffects[effectKey].getPostProcesses();\n            if (postProcesses) {\n                for (const postProcess of postProcesses) {\n                    postProcess.adaptScaleToCurrentViewport = true;\n                }\n            }\n        }\n    }\n    /**\n     * Sets the required values to the prepass renderer.\n     * @param prePassRenderer defines the prepass renderer to setup.\n     * @returns true if the pre pass is needed.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    setPrePassRenderer(prePassRenderer) {\n        // Do Nothing by default\n        return false;\n    }\n    /**\n     * Disposes of the pipeline\n     */\n    dispose() {\n        // Must be implemented by children\n    }\n}\n__decorate([\n    serialize()\n], PostProcessRenderPipeline.prototype, \"_name\", void 0);\n//# sourceMappingURL=postProcessRenderPipeline.js.map","import { Tools } from \"../../Misc/tools.js\";\n/**\n * This represents a set of one or more post processes in Babylon.\n * A post process can be used to apply a shader to a texture after it is rendered.\n * @example https://doc.babylonjs.com/features/featuresDeepDive/postProcesses/postProcessRenderPipeline\n */\nexport class PostProcessRenderEffect {\n    /**\n     * Instantiates a post process render effect.\n     * A post process can be used to apply a shader to a texture after it is rendered.\n     * @param engine The engine the effect is tied to\n     * @param name The name of the effect\n     * @param getPostProcesses A function that returns a set of post processes which the effect will run in order to be run.\n     * @param singleInstance False if this post process can be run on multiple cameras. (default: true)\n     */\n    constructor(engine, name, getPostProcesses, singleInstance = true) {\n        this._name = name;\n        this._singleInstance = singleInstance;\n        this._getPostProcesses = getPostProcesses;\n        this._cameras = {};\n        this._indicesForCamera = {};\n        this._postProcesses = {};\n    }\n    /**\n     * Checks if all the post processes in the effect are supported.\n     */\n    get isSupported() {\n        for (const index in this._postProcesses) {\n            if (Object.prototype.hasOwnProperty.call(this._postProcesses, index)) {\n                const pps = this._postProcesses[index];\n                for (let ppIndex = 0; ppIndex < pps.length; ppIndex++) {\n                    if (!pps[ppIndex].isSupported) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    }\n    /**\n     * Updates the current state of the effect\n     * @internal\n     */\n    _update() { }\n    /**\n     * Attaches the effect on cameras\n     * @param cameras The camera to attach to.\n     * @internal\n     */\n    _attachCameras(cameras) {\n        let cameraKey;\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        for (let i = 0; i < cams.length; i++) {\n            const camera = cams[i];\n            if (!camera) {\n                continue;\n            }\n            const cameraName = camera.name;\n            if (this._singleInstance) {\n                cameraKey = 0;\n            }\n            else {\n                cameraKey = cameraName;\n            }\n            if (!this._postProcesses[cameraKey]) {\n                const postProcess = this._getPostProcesses();\n                if (postProcess) {\n                    this._postProcesses[cameraKey] = Array.isArray(postProcess) ? postProcess : [postProcess];\n                }\n            }\n            if (!this._indicesForCamera[cameraName]) {\n                this._indicesForCamera[cameraName] = [];\n            }\n            const pps = this._postProcesses[cameraKey];\n            for (const postProcess of pps) {\n                const index = camera.attachPostProcess(postProcess);\n                this._indicesForCamera[cameraName].push(index);\n            }\n            if (!this._cameras[cameraName]) {\n                this._cameras[cameraName] = camera;\n            }\n        }\n    }\n    /**\n     * Detaches the effect on cameras\n     * @param cameras The camera to detach from.\n     * @internal\n     */\n    _detachCameras(cameras) {\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        for (let i = 0; i < cams.length; i++) {\n            const camera = cams[i];\n            const cameraName = camera.name;\n            const postProcesses = this._postProcesses[this._singleInstance ? 0 : cameraName];\n            if (postProcesses) {\n                for (const postProcess of postProcesses) {\n                    camera.detachPostProcess(postProcess);\n                }\n            }\n            if (this._cameras[cameraName]) {\n                this._cameras[cameraName] = null;\n            }\n            delete this._indicesForCamera[cameraName];\n        }\n    }\n    /**\n     * Enables the effect on given cameras\n     * @param cameras The camera to enable.\n     * @internal\n     */\n    _enable(cameras) {\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        for (let i = 0; i < cams.length; i++) {\n            const camera = cams[i];\n            const cameraName = camera.name;\n            const cameraKey = this._singleInstance ? 0 : cameraName;\n            for (let j = 0; j < this._indicesForCamera[cameraName].length; j++) {\n                const index = this._indicesForCamera[cameraName][j];\n                const postProcess = camera._postProcesses[index];\n                if (postProcess === undefined || postProcess === null) {\n                    cams[i].attachPostProcess(this._postProcesses[cameraKey][j], index);\n                }\n            }\n        }\n    }\n    /**\n     * Disables the effect on the given cameras\n     * @param cameras The camera to disable.\n     * @internal\n     */\n    _disable(cameras) {\n        const cams = Tools.MakeArray(cameras || this._cameras);\n        if (!cams) {\n            return;\n        }\n        for (let i = 0; i < cams.length; i++) {\n            const camera = cams[i];\n            const cameraName = camera.name;\n            const pps = this._postProcesses[this._singleInstance ? 0 : cameraName];\n            for (const postProcess of pps) {\n                camera.detachPostProcess(postProcess);\n            }\n        }\n    }\n    /**\n     * Gets a list of the post processes contained in the effect.\n     * @param camera The camera to get the post processes on.\n     * @returns The list of the post processes in the effect.\n     */\n    getPostProcesses(camera) {\n        if (this._singleInstance) {\n            return this._postProcesses[0];\n        }\n        else {\n            if (!camera) {\n                return null;\n            }\n            return this._postProcesses[camera.name];\n        }\n    }\n}\n//# sourceMappingURL=postProcessRenderEffect.js.map"],"names":["PostProcessRenderPipeline","_engine","name","UniqueIdGenerator","renderEffectName","renderEffect","cameras","renderEffects","Tools","unique","cams","indicesToDelete","i","camera","cameraName","sampleCount","effectKeys","postProcesses","effectKey","postProcess","prePassRenderer","__decorate","serialize","PostProcessRenderEffect","engine","getPostProcesses","singleInstance","index","pps","ppIndex","cameraKey","j"],"mappings":"8DAQO,MAAMA,CAA0B,CAInC,IAAI,MAAO,CACP,OAAO,KAAK,KAChB,CAEA,IAAI,SAAU,CACV,OAAO,KAAK,QAChB,CAIA,IAAI,QAAS,CACT,OAAO,KAAK,OAChB,CAMA,YAAYC,EAASC,EAAM,CACvB,KAAK,QAAUD,EAIf,KAAK,SAAWE,EAAkB,SAClC,KAAK,MAAQD,EACb,KAAK,eAAiB,CAAA,EACtB,KAAK,8BAAgC,IAAI,MACzC,KAAK,SAAW,CAAA,CACpB,CAKA,cAAe,CACX,MAAO,2BACX,CAIA,IAAI,aAAc,CACd,UAAWE,KAAoB,KAAK,eAChC,GAAI,OAAO,UAAU,eAAe,KAAK,KAAK,eAAgBA,CAAgB,GACtE,CAAC,KAAK,eAAeA,CAAgB,EAAE,YACvC,MAAO,GAInB,MAAO,EACX,CAKA,UAAUC,EAAc,CACpB,KAAK,eAAeA,EAAa,KAAK,EAAIA,CAC9C,CAGA,UAAW,CAAE,CAIb,cAAcD,EAAkBE,EAAS,CACrC,MAAMC,EAAgB,KAAK,eAAeH,CAAgB,EACrDG,GAGLA,EAAc,QAAQC,EAAM,UAAUF,GAAW,KAAK,QAAQ,CAAC,CACnE,CAIA,eAAeF,EAAkBE,EAAS,CACtC,MAAMC,EAAgB,KAAK,eAAeH,CAAgB,EACrDG,GAGLA,EAAc,SAASC,EAAM,UAAUF,GAAW,KAAK,QAAQ,CAAC,CACpE,CAIA,eAAeA,EAASG,EAAQ,CAC5B,MAAMC,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAI,CAACI,EACD,OAEJ,MAAMC,EAAkB,CAAA,EACxB,IAAIC,EACJ,IAAKA,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAAK,CAC9B,MAAMC,EAASH,EAAKE,CAAC,EAChBC,IAGD,KAAK,SAAS,QAAQA,CAAM,IAAM,GAClC,KAAK,SAAS,KAAKA,CAAM,EAEpBJ,GACLE,EAAgB,KAAKC,CAAC,EAE9B,CACA,IAAKA,EAAI,EAAGA,EAAID,EAAgB,OAAQC,IACpCF,EAAK,OAAOC,EAAgBC,CAAC,EAAG,CAAC,EAErC,UAAWR,KAAoB,KAAK,eAC5B,OAAO,UAAU,eAAe,KAAK,KAAK,eAAgBA,CAAgB,GAC1E,KAAK,eAAeA,CAAgB,EAAE,eAAeM,CAAI,CAGrE,CAIA,eAAeJ,EAAS,CACpB,MAAMI,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAKI,EAGL,WAAWN,KAAoB,KAAK,eAC5B,OAAO,UAAU,eAAe,KAAK,KAAK,eAAgBA,CAAgB,GAC1E,KAAK,eAAeA,CAAgB,EAAE,eAAeM,CAAI,EAGjE,QAASE,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAC7B,KAAK,SAAS,OAAO,KAAK,SAAS,QAAQF,EAAKE,CAAC,CAAC,EAAG,CAAC,EAE9D,CAEA,SAAU,CACN,UAAWR,KAAoB,KAAK,eAC5B,OAAO,UAAU,eAAe,KAAK,KAAK,eAAgBA,CAAgB,GAC1E,KAAK,eAAeA,CAAgB,EAAE,QAAO,EAGrD,QAASQ,EAAI,EAAGA,EAAI,KAAK,SAAS,OAAQA,IAAK,CAC3C,GAAI,CAAC,KAAK,SAASA,CAAC,EAChB,SAEJ,MAAME,EAAa,KAAK,SAASF,CAAC,EAAE,KAChC,KAAK,8BAA8BE,CAAU,GAC7C,KAAK,8BAA8BA,CAAU,EAAE,QAAO,CAE9D,CACJ,CAEA,QAAS,CACL,KAAK,eAAiB,CAAA,EACtB,KAAK,8BAAgC,IAAI,KAC7C,CACA,8BAA8BC,EAAa,CACvC,GAAI,CAAC,KAAK,QAAQ,UAAU,YACxB,MAAO,GAGX,MAAMC,EAAa,OAAO,KAAK,KAAK,cAAc,EAClD,GAAIA,EAAW,OAAS,EAAG,CACvB,MAAMC,EAAgB,KAAK,eAAeD,EAAW,CAAC,CAAC,EAAE,iBAAgB,EACrEC,IACAA,EAAc,CAAC,EAAE,QAAUF,EAEnC,CACA,MAAO,EACX,CAKA,+BAAgC,CAC5B,MAAMC,EAAa,OAAO,KAAK,KAAK,cAAc,EAClD,UAAWE,KAAaF,EAAY,CAChC,MAAMC,EAAgB,KAAK,eAAeC,CAAS,EAAE,iBAAgB,EACrE,GAAID,EACA,UAAWE,KAAeF,EACtBE,EAAY,4BAA8B,EAGtD,CACJ,CAOA,mBAAmBC,EAAiB,CAEhC,MAAO,EACX,CAIA,SAAU,CAEV,CACJ,CACAC,EAAW,CACPC,EAAS,CACb,EAAGtB,EAA0B,UAAW,QAAS,MAAM,EC3MhD,MAAMuB,CAAwB,CASjC,YAAYC,EAAQtB,EAAMuB,EAAkBC,EAAiB,GAAM,CAC/D,KAAK,MAAQxB,EACb,KAAK,gBAAkBwB,EACvB,KAAK,kBAAoBD,EACzB,KAAK,SAAW,CAAA,EAChB,KAAK,kBAAoB,CAAA,EACzB,KAAK,eAAiB,CAAA,CAC1B,CAIA,IAAI,aAAc,CACd,UAAWE,KAAS,KAAK,eACrB,GAAI,OAAO,UAAU,eAAe,KAAK,KAAK,eAAgBA,CAAK,EAAG,CAClE,MAAMC,EAAM,KAAK,eAAeD,CAAK,EACrC,QAASE,EAAU,EAAGA,EAAUD,EAAI,OAAQC,IACxC,GAAI,CAACD,EAAIC,CAAO,EAAE,YACd,MAAO,EAGnB,CAEJ,MAAO,EACX,CAKA,SAAU,CAAE,CAMZ,eAAevB,EAAS,CACpB,IAAIwB,EACJ,MAAMpB,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAKI,EAGL,QAASE,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAAK,CAClC,MAAMC,EAASH,EAAKE,CAAC,EACrB,GAAI,CAACC,EACD,SAEJ,MAAMC,EAAaD,EAAO,KAO1B,GANI,KAAK,gBACLiB,EAAY,EAGZA,EAAYhB,EAEZ,CAAC,KAAK,eAAegB,CAAS,EAAG,CACjC,MAAMX,EAAc,KAAK,kBAAiB,EACtCA,IACA,KAAK,eAAeW,CAAS,EAAI,MAAM,QAAQX,CAAW,EAAIA,EAAc,CAACA,CAAW,EAEhG,CACK,KAAK,kBAAkBL,CAAU,IAClC,KAAK,kBAAkBA,CAAU,EAAI,CAAA,GAEzC,MAAMc,EAAM,KAAK,eAAeE,CAAS,EACzC,UAAWX,KAAeS,EAAK,CAC3B,MAAMD,EAAQd,EAAO,kBAAkBM,CAAW,EAClD,KAAK,kBAAkBL,CAAU,EAAE,KAAKa,CAAK,CACjD,CACK,KAAK,SAASb,CAAU,IACzB,KAAK,SAASA,CAAU,EAAID,EAEpC,CACJ,CAMA,eAAeP,EAAS,CACpB,MAAMI,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAKI,EAGL,QAASE,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAAK,CAClC,MAAMC,EAASH,EAAKE,CAAC,EACfE,EAAaD,EAAO,KACpBI,EAAgB,KAAK,eAAe,KAAK,gBAAkB,EAAIH,CAAU,EAC/E,GAAIG,EACA,UAAWE,KAAeF,EACtBJ,EAAO,kBAAkBM,CAAW,EAGxC,KAAK,SAASL,CAAU,IACxB,KAAK,SAASA,CAAU,EAAI,MAEhC,OAAO,KAAK,kBAAkBA,CAAU,CAC5C,CACJ,CAMA,QAAQR,EAAS,CACb,MAAMI,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAKI,EAGL,QAASE,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAAK,CAClC,MAAMC,EAASH,EAAKE,CAAC,EACfE,EAAaD,EAAO,KACpBiB,EAAY,KAAK,gBAAkB,EAAIhB,EAC7C,QAASiB,EAAI,EAAGA,EAAI,KAAK,kBAAkBjB,CAAU,EAAE,OAAQiB,IAAK,CAChE,MAAMJ,EAAQ,KAAK,kBAAkBb,CAAU,EAAEiB,CAAC,EAC5CZ,EAAcN,EAAO,eAAec,CAAK,EACdR,GAAgB,MAC7CT,EAAKE,CAAC,EAAE,kBAAkB,KAAK,eAAekB,CAAS,EAAEC,CAAC,EAAGJ,CAAK,CAE1E,CACJ,CACJ,CAMA,SAASrB,EAAS,CACd,MAAMI,EAAOF,EAAM,UAAUF,GAAW,KAAK,QAAQ,EACrD,GAAKI,EAGL,QAASE,EAAI,EAAGA,EAAIF,EAAK,OAAQE,IAAK,CAClC,MAAMC,EAASH,EAAKE,CAAC,EACfE,EAAaD,EAAO,KACpBe,EAAM,KAAK,eAAe,KAAK,gBAAkB,EAAId,CAAU,EACrE,UAAWK,KAAeS,EACtBf,EAAO,kBAAkBM,CAAW,CAE5C,CACJ,CAMA,iBAAiBN,EAAQ,CACrB,OAAI,KAAK,gBACE,KAAK,eAAe,CAAC,EAGvBA,EAGE,KAAK,eAAeA,EAAO,IAAI,EAF3B,IAInB,CACJ","x_google_ignoreList":[0,1]}