{"version":3,"file":"D_jsYR-Y.js","sources":["../../../../../../../image/shared/utils.ts","../../../../../../../image/shared/ImagePreview.svelte"],"sourcesContent":["export const get_coordinates_of_clicked_image = (\n\tevt: MouseEvent\n): [number, number] | null => {\n\tlet image;\n\tif (evt.currentTarget instanceof Element) {\n\t\timage = evt.currentTarget.querySelector(\"img\") as HTMLImageElement;\n\t} else {\n\t\treturn [NaN, NaN];\n\t}\n\n\tconst imageRect = image.getBoundingClientRect();\n\tconst xScale = image.naturalWidth / imageRect.width;\n\tconst yScale = image.naturalHeight / imageRect.height;\n\tif (xScale > yScale) {\n\t\tconst displayed_height = image.naturalHeight / xScale;\n\t\tconst y_offset = (imageRect.height - displayed_height) / 2;\n\t\tvar x = Math.round((evt.clientX - imageRect.left) * xScale);\n\t\tvar y = Math.round((evt.clientY - imageRect.top - y_offset) * xScale);\n\t} else {\n\t\tconst displayed_width = image.naturalWidth / yScale;\n\t\tconst x_offset = (imageRect.width - displayed_width) / 2;\n\t\tvar x = Math.round((evt.clientX - imageRect.left - x_offset) * yScale);\n\t\tvar y = Math.round((evt.clientY - imageRect.top) * yScale);\n\t}\n\tif (x < 0 || x >= image.naturalWidth || y < 0 || y >= image.naturalHeight) {\n\t\treturn null;\n\t}\n\treturn [x, y];\n};\n","<script lang=\"ts\">\n\timport { createEventDispatcher, onMount } from \"svelte\";\n\timport type { SelectData } from \"@gradio/utils\";\n\timport { uploadToHuggingFace } from \"@gradio/utils\";\n\timport {\n\t\tBlockLabel,\n\t\tEmpty,\n\t\tIconButton,\n\t\tShareButton,\n\t\tIconButtonWrapper,\n\t\tFullscreenButton,\n\t\tDownloadLink\n\t} from \"@gradio/atoms\";\n\timport { Download, Image as ImageIcon } from \"@gradio/icons\";\n\timport { get_coordinates_of_clicked_image } from \"./utils\";\n\timport Image from \"./Image.svelte\";\n\n\timport type { I18nFormatter } from \"@gradio/utils\";\n\timport type { FileData } from \"@gradio/client\";\n\n\texport let value: null | FileData;\n\texport let label: string | undefined = undefined;\n\texport let show_label: boolean;\n\texport let buttons: string[] | null = null;\n\texport let selectable = false;\n\texport let i18n: I18nFormatter;\n\texport let display_icon_button_wrapper_top_corner = false;\n\texport let fullscreen = false;\n\n\tconst dispatch = createEventDispatcher<{\n\t\tchange: string;\n\t\tselect: SelectData;\n\t\tfullscreen: boolean;\n\t}>();\n\n\tconst handle_click = (evt: MouseEvent): void => {\n\t\tlet coordinates = get_coordinates_of_clicked_image(evt);\n\t\tif (coordinates) {\n\t\t\tdispatch(\"select\", { index: coordinates, value: null });\n\t\t}\n\t};\n\n\tlet image_container: HTMLElement;\n</script>\n\n<BlockLabel\n\t{show_label}\n\tIcon={ImageIcon}\n\tlabel={!show_label ? \"\" : label || i18n(\"image.image\")}\n/>\n{#if value == null || !value?.url}\n\t<Empty unpadded_box={true} size=\"large\"><ImageIcon /></Empty>\n{:else}\n\t<div class=\"image-container\" bind:this={image_container}>\n\t\t<IconButtonWrapper\n\t\t\tdisplay_top_corner={display_icon_button_wrapper_top_corner}\n\t\t>\n\t\t\t{#if buttons === null ? true : buttons.includes(\"fullscreen\")}\n\t\t\t\t<FullscreenButton {fullscreen} on:fullscreen />\n\t\t\t{/if}\n\n\t\t\t{#if buttons === null ? true : buttons.includes(\"download\")}\n\t\t\t\t<DownloadLink href={value.url} download={value.orig_name || \"image\"}>\n\t\t\t\t\t<IconButton Icon={Download} label={i18n(\"common.download\")} />\n\t\t\t\t</DownloadLink>\n\t\t\t{/if}\n\t\t\t{#if buttons === null ? true : buttons.includes(\"share\")}\n\t\t\t\t<ShareButton\n\t\t\t\t\t{i18n}\n\t\t\t\t\ton:share\n\t\t\t\t\ton:error\n\t\t\t\t\tformatter={async (value) => {\n\t\t\t\t\t\tif (!value) return \"\";\n\t\t\t\t\t\tlet url = await uploadToHuggingFace(value, \"url\");\n\t\t\t\t\t\treturn `<img src=\"${url}\" />`;\n\t\t\t\t\t}}\n\t\t\t\t\t{value}\n\t\t\t\t/>\n\t\t\t{/if}\n\t\t</IconButtonWrapper>\n\t\t<button on:click={handle_click}>\n\t\t\t<div class:selectable class=\"image-frame\">\n\t\t\t\t<Image\n\t\t\t\t\tsrc={value.url}\n\t\t\t\t\trestProps={{ loading: \"lazy\", alt: \"\" }}\n\t\t\t\t\ton:load\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t</div>\n{/if}\n\n<style>\n\t.image-container {\n\t\theight: 100%;\n\t\tposition: relative;\n\t\tmin-width: var(--size-20);\n\t}\n\n\t.image-container button {\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t\tborder-radius: var(--radius-lg);\n\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t.image-frame :global(img) {\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t\tobject-fit: scale-down;\n\t}\n\n\t.selectable {\n\t\tcursor: crosshair;\n\t}\n\n\t:global(.fullscreen-controls svg) {\n\t\tposition: relative;\n\t\ttop: 0px;\n\t}\n\n\t:global(.image-container:fullscreen) {\n\t\tbackground-color: black;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\t:global(.image-container:fullscreen img) {\n\t\tmax-width: 90vw;\n\t\tmax-height: 90vh;\n\t\tobject-fit: scale-down;\n\t}\n\n\t.image-frame {\n\t\twidth: auto;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n</style>\n"],"names":["$.prop","$.mutable_source","$.untrack","ImageIcon","value","$.bind_this","$.set"],"mappings":"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"}