{"version":3,"file":"DRfd0I_5.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/Meshes/Compression/meshoptCompression.js","../../../../../../../../node_modules/.pnpm/@babylonjs+loaders@8.36.1_@babylonjs+core@8.36.1_babylonjs-gltf2interface@8.36.1/node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_meshopt_compression.js"],"sourcesContent":["import { Tools } from \"../../Misc/tools.js\";\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet NumberOfWorkers = 0;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet WorkerTimeout = null;\n/**\n * Meshopt compression (https://github.com/zeux/meshoptimizer)\n *\n * This class wraps the meshopt library from https://github.com/zeux/meshoptimizer/tree/master/js.\n *\n * **Encoder**\n *\n * The encoder is not currently implemented.\n *\n * **Decoder**\n *\n * By default, the configuration points to a copy of the meshopt files on the Babylon.js preview CDN (e.g. https://preview.babylonjs.com/meshopt_decoder.js).\n *\n * To update the configuration, use the following code:\n * ```javascript\n *     MeshoptCompression.Configuration = {\n *         decoder: {\n *             url: \"<url to the meshopt decoder library>\"\n *         }\n *     };\n * ```\n */\nexport class MeshoptCompression {\n    /**\n     * Default instance for the meshoptimizer object.\n     */\n    static get Default() {\n        if (!MeshoptCompression._Default) {\n            MeshoptCompression._Default = new MeshoptCompression();\n        }\n        return MeshoptCompression._Default;\n    }\n    /**\n     * Constructor\n     */\n    constructor() {\n        const decoder = MeshoptCompression.Configuration.decoder;\n        // eslint-disable-next-line github/no-then\n        this._decoderModulePromise = Tools.LoadBabylonScriptAsync(decoder.url).then(() => {\n            // Wait for WebAssembly compilation before resolving promise\n            return MeshoptDecoder.ready;\n        });\n    }\n    /**\n     * Stop all async operations and release resources.\n     */\n    dispose() {\n        delete this._decoderModulePromise;\n    }\n    /**\n     * Decode meshopt data.\n     * @see https://github.com/zeux/meshoptimizer/tree/master/js#decoder\n     * @param source The input data.\n     * @param count The number of elements.\n     * @param stride The stride in bytes.\n     * @param mode The compression mode.\n     * @param filter The compression filter.\n     * @returns a Promise<Uint8Array> that resolves to the decoded data\n     */\n    async decodeGltfBufferAsync(source, count, stride, mode, filter) {\n        await this._decoderModulePromise;\n        if (NumberOfWorkers === 0) {\n            MeshoptDecoder.useWorkers(1);\n            NumberOfWorkers = 1;\n        }\n        const result = await MeshoptDecoder.decodeGltfBufferAsync(count, stride, source, mode, filter);\n        // a simple debounce to avoid switching back and forth between workers and no workers while decoding\n        if (WorkerTimeout !== null) {\n            clearTimeout(WorkerTimeout);\n        }\n        WorkerTimeout = setTimeout(() => {\n            MeshoptDecoder.useWorkers(0);\n            NumberOfWorkers = 0;\n            WorkerTimeout = null;\n        }, 1000);\n        return result;\n    }\n}\n/**\n * The configuration. Defaults to the following:\n * ```javascript\n * decoder: {\n *   url: \"https://cdn.babylonjs.com/meshopt_decoder.js\"\n * }\n * ```\n */\nMeshoptCompression.Configuration = {\n    decoder: {\n        url: `${Tools._DefaultCdnUrl}/meshopt_decoder.js`,\n    },\n};\nMeshoptCompression._Default = null;\n//# sourceMappingURL=meshoptCompression.js.map","import { ArrayItem, GLTFLoader } from \"../glTFLoader.js\";\nimport { MeshoptCompression } from \"@babylonjs/core/Meshes/Compression/meshoptCompression.js\";\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry.js\";\nconst NAME = \"EXT_meshopt_compression\";\n/**\n * [Specification](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Vendor/EXT_meshopt_compression/README.md)\n *\n * This extension uses a WebAssembly decoder module from https://github.com/zeux/meshoptimizer/tree/master/js\n * @since 5.0.0\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class EXT_meshopt_compression {\n    /**\n     * @internal\n     */\n    constructor(loader) {\n        /**\n         * The name of this extension.\n         */\n        this.name = NAME;\n        this.enabled = loader.isExtensionUsed(NAME);\n        this._loader = loader;\n    }\n    /** @internal */\n    dispose() {\n        this._loader = null;\n    }\n    /**\n     * @internal\n     */\n    // eslint-disable-next-line no-restricted-syntax\n    loadBufferViewAsync(context, bufferView) {\n        return GLTFLoader.LoadExtensionAsync(context, bufferView, this.name, async (extensionContext, extension) => {\n            const bufferViewMeshopt = bufferView;\n            if (bufferViewMeshopt._meshOptData) {\n                return await bufferViewMeshopt._meshOptData;\n            }\n            const buffer = ArrayItem.Get(`${context}/buffer`, this._loader.gltf.buffers, extension.buffer);\n            bufferViewMeshopt._meshOptData = this._loader\n                .loadBufferAsync(`/buffers/${buffer.index}`, buffer, extension.byteOffset || 0, extension.byteLength)\n                // eslint-disable-next-line github/no-then\n                .then(async (buffer) => {\n                return await MeshoptCompression.Default.decodeGltfBufferAsync(buffer, extension.count, extension.byteStride, extension.mode, extension.filter);\n            });\n            return await bufferViewMeshopt._meshOptData;\n        });\n    }\n}\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new EXT_meshopt_compression(loader));\n//# sourceMappingURL=EXT_meshopt_compression.js.map"],"names":["buffer"],"mappings":";;AAEA,IAAI,kBAAkB;AAEtB,IAAI,gBAAgB;AAuBb,MAAM,mBAAmB;AAAA;AAAA;AAAA;AAAA,EAI5B,WAAW,UAAU;AACjB,QAAI,CAAC,mBAAmB,UAAU;AAC9B,yBAAmB,WAAW,IAAI,mBAAkB;AAAA,IACxD;AACA,WAAO,mBAAmB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAIA,cAAc;AACV,UAAM,UAAU,mBAAmB,cAAc;AAEjD,SAAK,wBAAwB,MAAM,uBAAuB,QAAQ,GAAG,EAAE,KAAK,MAAM;AAE9E,aAAO,eAAe;AAAA,IAC1B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA,EAIA,UAAU;AACN,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,sBAAsB,QAAQ,OAAO,QAAQ,MAAM,QAAQ;AAC7D,UAAM,KAAK;AACX,QAAI,oBAAoB,GAAG;AACvB,qBAAe,WAAW,CAAC;AAC3B,wBAAkB;AAAA,IACtB;AACA,UAAM,SAAS,MAAM,eAAe,sBAAsB,OAAO,QAAQ,QAAQ,MAAM,MAAM;AAE7F,QAAI,kBAAkB,MAAM;AACxB,mBAAa,aAAa;AAAA,IAC9B;AACA,oBAAgB,WAAW,MAAM;AAC7B,qBAAe,WAAW,CAAC;AAC3B,wBAAkB;AAClB,sBAAgB;AAAA,IACpB,GAAG,GAAI;AACP,WAAO;AAAA,EACX;AACJ;AASA,mBAAmB,gBAAgB;AAAA,EAC/B,SAAS;AAAA,IACL,KAAK,GAAG,MAAM,cAAc;AAAA,EACpC;AACA;AACA,mBAAmB,WAAW;AC7F9B,MAAM,OAAO;AAQN,MAAM,wBAAwB;AAAA;AAAA;AAAA;AAAA,EAIjC,YAAY,QAAQ;AAIhB,SAAK,OAAO;AACZ,SAAK,UAAU,OAAO,gBAAgB,IAAI;AAC1C,SAAK,UAAU;AAAA,EACnB;AAAA;AAAA,EAEA,UAAU;AACN,SAAK,UAAU;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,SAAS,YAAY;AACrC,WAAO,WAAW,mBAAmB,SAAS,YAAY,KAAK,MAAM,OAAO,kBAAkB,cAAc;AACxG,YAAM,oBAAoB;AAC1B,UAAI,kBAAkB,cAAc;AAChC,eAAO,MAAM,kBAAkB;AAAA,MACnC;AACA,YAAM,SAAS,UAAU,IAAI,GAAG,OAAO,WAAW,KAAK,QAAQ,KAAK,SAAS,UAAU,MAAM;AAC7F,wBAAkB,eAAe,KAAK,QACjC,gBAAgB,YAAY,OAAO,KAAK,IAAI,QAAQ,UAAU,cAAc,GAAG,UAAU,UAAU,EAEnG,KAAK,OAAOA,YAAW;AACxB,eAAO,MAAM,mBAAmB,QAAQ,sBAAsBA,SAAQ,UAAU,OAAO,UAAU,YAAY,UAAU,MAAM,UAAU,MAAM;AAAA,MACjJ,CAAC;AACD,aAAO,MAAM,kBAAkB;AAAA,IACnC,CAAC;AAAA,EACL;AACJ;AACA,wBAAwB,IAAI;AAC5B,sBAAsB,MAAM,MAAM,CAAC,WAAW,IAAI,wBAAwB,MAAM,CAAC;","x_google_ignoreList":[0,1]}