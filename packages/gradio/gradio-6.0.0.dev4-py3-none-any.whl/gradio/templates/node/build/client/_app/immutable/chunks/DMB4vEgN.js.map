{"version":3,"file":"DMB4vEgN.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+loaders@8.36.1_@babylonjs+core@8.36.1_babylonjs-gltf2interface@8.36.1/node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_lights_ies.js"],"sourcesContent":["import { Vector3 } from \"@babylonjs/core/Maths/math.vector.js\";\nimport { Color3 } from \"@babylonjs/core/Maths/math.color.js\";\nimport { SpotLight } from \"@babylonjs/core/Lights/spotLight.js\";\nimport { Light } from \"@babylonjs/core/Lights/light.js\";\nimport { GLTFLoader, ArrayItem } from \"../glTFLoader.js\";\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry.js\";\nimport { Texture } from \"@babylonjs/core/Materials/Textures/texture.js\";\nconst NAME = \"EXT_lights_ies\";\n/**\n * [Specification](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_lights_ies)\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class EXT_lights_ies {\n    /**\n     * @internal\n     */\n    constructor(loader) {\n        /**\n         * The name of this extension.\n         */\n        this.name = NAME;\n        this._loader = loader;\n        this.enabled = this._loader.isExtensionUsed(NAME);\n    }\n    /** @internal */\n    dispose() {\n        this._loader = null;\n        delete this._lights;\n    }\n    /** @internal */\n    onLoading() {\n        const extensions = this._loader.gltf.extensions;\n        if (extensions && extensions[this.name]) {\n            const extension = extensions[this.name];\n            this._lights = extension.lights;\n            ArrayItem.Assign(this._lights);\n        }\n    }\n    /**\n     * @internal\n     */\n    // eslint-disable-next-line no-restricted-syntax\n    // eslint-disable-next-line no-restricted-syntax\n    loadNodeAsync(context, node, assign) {\n        return GLTFLoader.LoadExtensionAsync(context, node, this.name, async (extensionContext, extension) => {\n            this._loader._allMaterialsDirtyRequired = true;\n            let babylonSpotLight;\n            let light;\n            const transformNode = await this._loader.loadNodeAsync(context, node, (babylonMesh) => {\n                light = ArrayItem.Get(extensionContext, this._lights, extension.light);\n                const name = light.name || babylonMesh.name;\n                this._loader.babylonScene._blockEntityCollection = !!this._loader._assetContainer;\n                babylonSpotLight = new SpotLight(name, Vector3.Zero(), Vector3.Backward(), 0, 1, this._loader.babylonScene);\n                babylonSpotLight.angle = Math.PI / 2;\n                babylonSpotLight.innerAngle = 0;\n                babylonSpotLight._parentContainer = this._loader._assetContainer;\n                this._loader.babylonScene._blockEntityCollection = false;\n                light._babylonLight = babylonSpotLight;\n                babylonSpotLight.falloffType = Light.FALLOFF_GLTF;\n                babylonSpotLight.diffuse = extension.color ? Color3.FromArray(extension.color) : Color3.White();\n                babylonSpotLight.intensity = extension.multiplier || 1;\n                babylonSpotLight.range = Number.MAX_VALUE;\n                babylonSpotLight.parent = babylonMesh;\n                this._loader._babylonLights.push(babylonSpotLight);\n                GLTFLoader.AddPointerMetadata(babylonSpotLight, extensionContext);\n                assign(babylonMesh);\n            });\n            // Load the profile\n            let bufferData;\n            if (light.uri) {\n                bufferData = await this._loader.loadUriAsync(context, light, light.uri);\n            }\n            else {\n                const bufferView = ArrayItem.Get(`${context}/bufferView`, this._loader.gltf.bufferViews, light.bufferView);\n                bufferData = await this._loader.loadBufferViewAsync(`/bufferViews/${bufferView.index}`, bufferView);\n            }\n            babylonSpotLight.iesProfileTexture = new Texture(name + \"_iesProfile\", this._loader.babylonScene, true, false, undefined, null, null, bufferData, true, undefined, undefined, undefined, undefined, \".ies\");\n            return transformNode;\n        });\n    }\n}\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new EXT_lights_ies(loader));\n//# sourceMappingURL=EXT_lights_ies.js.map"],"names":["name"],"mappings":";;;AAOA,MAAM,OAAO;AAKN,MAAM,eAAe;AAAA;AAAA;AAAA;AAAA,EAIxB,YAAY,QAAQ;AAIhB,SAAK,OAAO;AACZ,SAAK,UAAU;AACf,SAAK,UAAU,KAAK,QAAQ,gBAAgB,IAAI;AAAA,EACpD;AAAA;AAAA,EAEA,UAAU;AACN,SAAK,UAAU;AACf,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA,EAEA,YAAY;AACR,UAAM,aAAa,KAAK,QAAQ,KAAK;AACrC,QAAI,cAAc,WAAW,KAAK,IAAI,GAAG;AACrC,YAAM,YAAY,WAAW,KAAK,IAAI;AACtC,WAAK,UAAU,UAAU;AACzB,gBAAU,OAAO,KAAK,OAAO;AAAA,IACjC;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAc,SAAS,MAAM,QAAQ;AACjC,WAAO,WAAW,mBAAmB,SAAS,MAAM,KAAK,MAAM,OAAO,kBAAkB,cAAc;AAClG,WAAK,QAAQ,6BAA6B;AAC1C,UAAI;AACJ,UAAI;AACJ,YAAM,gBAAgB,MAAM,KAAK,QAAQ,cAAc,SAAS,MAAM,CAAC,gBAAgB;AACnF,gBAAQ,UAAU,IAAI,kBAAkB,KAAK,SAAS,UAAU,KAAK;AACrE,cAAMA,QAAO,MAAM,QAAQ,YAAY;AACvC,aAAK,QAAQ,aAAa,yBAAyB,CAAC,CAAC,KAAK,QAAQ;AAClE,2BAAmB,IAAI,UAAUA,OAAM,QAAQ,KAAI,GAAI,QAAQ,SAAQ,GAAI,GAAG,GAAG,KAAK,QAAQ,YAAY;AAC1G,yBAAiB,QAAQ,KAAK,KAAK;AACnC,yBAAiB,aAAa;AAC9B,yBAAiB,mBAAmB,KAAK,QAAQ;AACjD,aAAK,QAAQ,aAAa,yBAAyB;AACnD,cAAM,gBAAgB;AACtB,yBAAiB,cAAc,MAAM;AACrC,yBAAiB,UAAU,UAAU,QAAQ,OAAO,UAAU,UAAU,KAAK,IAAI,OAAO,MAAK;AAC7F,yBAAiB,YAAY,UAAU,cAAc;AACrD,yBAAiB,QAAQ,OAAO;AAChC,yBAAiB,SAAS;AAC1B,aAAK,QAAQ,eAAe,KAAK,gBAAgB;AACjD,mBAAW,mBAAmB,kBAAkB,gBAAgB;AAChE,eAAO,WAAW;AAAA,MACtB,CAAC;AAED,UAAI;AACJ,UAAI,MAAM,KAAK;AACX,qBAAa,MAAM,KAAK,QAAQ,aAAa,SAAS,OAAO,MAAM,GAAG;AAAA,MAC1E,OACK;AACD,cAAM,aAAa,UAAU,IAAI,GAAG,OAAO,eAAe,KAAK,QAAQ,KAAK,aAAa,MAAM,UAAU;AACzG,qBAAa,MAAM,KAAK,QAAQ,oBAAoB,gBAAgB,WAAW,KAAK,IAAI,UAAU;AAAA,MACtG;AACA,uBAAiB,oBAAoB,IAAI,QAAQ,OAAO,eAAe,KAAK,QAAQ,cAAc,MAAM,OAAO,QAAW,MAAM,MAAM,YAAY,MAAM,QAAW,QAAW,QAAW,QAAW,MAAM;AAC1M,aAAO;AAAA,IACX,CAAC;AAAA,EACL;AACJ;AACA,wBAAwB,IAAI;AAC5B,sBAAsB,MAAM,MAAM,CAAC,WAAW,IAAI,eAAe,MAAM,CAAC;","x_google_ignoreList":[0]}