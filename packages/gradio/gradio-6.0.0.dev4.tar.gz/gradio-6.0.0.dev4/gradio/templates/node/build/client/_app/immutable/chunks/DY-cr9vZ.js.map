{"version":3,"file":"DY-cr9vZ.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent.js"],"sourcesContent":["import { ShadowGenerator } from \"./shadowGenerator.js\";\nimport { CascadedShadowGenerator } from \"./cascadedShadowGenerator.js\";\nimport { SceneComponentConstants } from \"../../sceneComponent.js\";\nimport { AddParser } from \"../../Loading/Plugins/babylonFileParser.function.js\";\n// Adds the parser to the scene parsers.\nAddParser(SceneComponentConstants.NAME_SHADOWGENERATOR, (parsedData, scene) => {\n    // Shadows\n    if (parsedData.shadowGenerators !== undefined && parsedData.shadowGenerators !== null) {\n        for (let index = 0, cache = parsedData.shadowGenerators.length; index < cache; index++) {\n            const parsedShadowGenerator = parsedData.shadowGenerators[index];\n            if (parsedShadowGenerator.className === CascadedShadowGenerator.CLASSNAME) {\n                CascadedShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            else {\n                ShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            // SG would be available on their associated lights\n        }\n    }\n});\n/**\n * Defines the shadow generator component responsible to manage any shadow generators\n * in a given scene.\n */\nexport class ShadowGeneratorSceneComponent {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    constructor(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_SHADOWGENERATOR;\n        this.scene = scene;\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    register() {\n        this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR, this, this._gatherRenderTargets);\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    rebuild() {\n        // Nothing To Do Here.\n    }\n    /**\n     * Serializes the component data to the specified json object\n     * @param serializationObject The object to serialize to\n     */\n    serialize(serializationObject) {\n        // Shadows\n        serializationObject.shadowGenerators = [];\n        const lights = this.scene.lights;\n        for (const light of lights) {\n            if (light.doNotSerialize) {\n                continue;\n            }\n            const shadowGenerators = light.getShadowGenerators();\n            if (shadowGenerators) {\n                const iterator = shadowGenerators.values();\n                for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\n                    const shadowGenerator = key.value;\n                    if (shadowGenerator.doNotSerialize) {\n                        continue;\n                    }\n                    serializationObject.shadowGenerators.push(shadowGenerator.serialize());\n                }\n            }\n        }\n    }\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    addFromContainer(container) {\n        // Nothing To Do Here. (directly attached to a light)\n    }\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    removeFromContainer(container, dispose) {\n        // Nothing To Do Here. (directly attached to a light)\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    dispose() {\n        // Nothing To Do Here.\n    }\n    _gatherRenderTargets(renderTargets) {\n        // Shadows\n        const scene = this.scene;\n        if (this.scene.shadowsEnabled) {\n            for (let lightIndex = 0; lightIndex < scene.lights.length; lightIndex++) {\n                const light = scene.lights[lightIndex];\n                const shadowGenerators = light.getShadowGenerators();\n                if (light.isEnabled() && light.shadowEnabled && shadowGenerators) {\n                    const iterator = shadowGenerators.values();\n                    for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\n                        const shadowGenerator = key.value;\n                        const shadowMap = shadowGenerator.getShadowMap();\n                        if (scene.textures.indexOf(shadowMap) !== -1) {\n                            renderTargets.push(shadowMap);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\nShadowGenerator._SceneComponentInitialization = (scene) => {\n    let component = scene._getComponent(SceneComponentConstants.NAME_SHADOWGENERATOR);\n    if (!component) {\n        component = new ShadowGeneratorSceneComponent(scene);\n        scene._addComponent(component);\n    }\n};\n//# sourceMappingURL=shadowGeneratorSceneComponent.js.map"],"names":[],"mappings":";AAwBO,MAAM,8BAA8B;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvC,YAAY,OAAO;AAIf,SAAK,OAAO,wBAAwB;AACpC,SAAK,QAAQ;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAIA,WAAW;AACP,SAAK,MAAM,0BAA0B,aAAa,wBAAwB,0CAA0C,MAAM,KAAK,oBAAoB;AAAA,EACvJ;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AAAA,EAEV;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,qBAAqB;AAE3B,wBAAoB,mBAAmB,CAAA;AACvC,UAAM,SAAS,KAAK,MAAM;AAC1B,eAAW,SAAS,QAAQ;AACxB,UAAI,MAAM,gBAAgB;AACtB;AAAA,MACJ;AACA,YAAM,mBAAmB,MAAM,oBAAmB;AAClD,UAAI,kBAAkB;AAClB,cAAM,WAAW,iBAAiB,OAAM;AACxC,iBAAS,MAAM,SAAS,QAAQ,IAAI,SAAS,MAAM,MAAM,SAAS,KAAI,GAAI;AACtE,gBAAM,kBAAkB,IAAI;AAC5B,cAAI,gBAAgB,gBAAgB;AAChC;AAAA,UACJ;AACA,8BAAoB,iBAAiB,KAAK,gBAAgB,UAAS,CAAE;AAAA,QACzE;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,WAAW;AAAA,EAE5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,oBAAoB,WAAW,SAAS;AAAA,EAExC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AAAA,EAEV;AAAA,EACA,qBAAqB,eAAe;AAEhC,UAAM,QAAQ,KAAK;AACnB,QAAI,KAAK,MAAM,gBAAgB;AAC3B,eAAS,aAAa,GAAG,aAAa,MAAM,OAAO,QAAQ,cAAc;AACrE,cAAM,QAAQ,MAAM,OAAO,UAAU;AACrC,cAAM,mBAAmB,MAAM,oBAAmB;AAClD,YAAI,MAAM,UAAS,KAAM,MAAM,iBAAiB,kBAAkB;AAC9D,gBAAM,WAAW,iBAAiB,OAAM;AACxC,mBAAS,MAAM,SAAS,QAAQ,IAAI,SAAS,MAAM,MAAM,SAAS,KAAI,GAAI;AACtE,kBAAM,kBAAkB,IAAI;AAC5B,kBAAM,YAAY,gBAAgB,aAAY;AAC9C,gBAAI,MAAM,SAAS,QAAQ,SAAS,MAAM,IAAI;AAC1C,4BAAc,KAAK,SAAS;AAAA,YAChC;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AACJ;AACA,gBAAgB,gCAAgC,CAAC,UAAU;AACvD,MAAI,YAAY,MAAM,cAAc,wBAAwB,oBAAoB;AAChF,MAAI,CAAC,WAAW;AACZ,gBAAY,IAAI,8BAA8B,KAAK;AACnD,UAAM,cAAc,SAAS;AAAA,EACjC;AACJ;","x_google_ignoreList":[0]}