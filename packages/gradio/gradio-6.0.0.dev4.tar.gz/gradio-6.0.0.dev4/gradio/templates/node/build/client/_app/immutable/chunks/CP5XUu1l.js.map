{"version":3,"file":"CP5XUu1l.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/ControlFlow/flowGraphWaitAllBlock.js"],"sourcesContent":["import { FlowGraphExecutionBlockWithOutSignal } from \"../../../flowGraphExecutionBlockWithOutSignal.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { RichTypeFlowGraphInteger } from \"../../../flowGraphRichTypes.js\";\nimport { FlowGraphInteger } from \"../../../CustomTypes/flowGraphInteger.js\";\n/**\n * A block that waits for all input flows to be activated before activating its output flow.\n */\nexport class FlowGraphWaitAllBlock extends FlowGraphExecutionBlockWithOutSignal {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        /**\n         * An array of input signals\n         */\n        this.inFlows = [];\n        this._cachedActivationState = [];\n        this.reset = this._registerSignalInput(\"reset\");\n        this.completed = this._registerSignalOutput(\"completed\");\n        this.remainingInputs = this.registerDataOutput(\"remainingInputs\", RichTypeFlowGraphInteger, new FlowGraphInteger(this.config.inputSignalCount || 0));\n        // The first inFlow is the default input signal all execution blocks have\n        for (let i = 0; i < this.config.inputSignalCount; i++) {\n            this.inFlows.push(this._registerSignalInput(`in_${i}`));\n        }\n        // no need for in\n        this._unregisterSignalInput(\"in\");\n    }\n    _getCurrentActivationState(context) {\n        const activationState = this._cachedActivationState;\n        activationState.length = 0;\n        if (!context._hasExecutionVariable(this, \"activationState\")) {\n            for (let i = 0; i < this.config.inputSignalCount; i++) {\n                activationState.push(false);\n            }\n        }\n        else {\n            const contextActivationState = context._getExecutionVariable(this, \"activationState\", []);\n            for (let i = 0; i < contextActivationState.length; i++) {\n                activationState.push(contextActivationState[i]);\n            }\n        }\n        return activationState;\n    }\n    _execute(context, callingSignal) {\n        const activationState = this._getCurrentActivationState(context);\n        if (callingSignal === this.reset) {\n            for (let i = 0; i < this.config.inputSignalCount; i++) {\n                activationState[i] = false;\n            }\n        }\n        else {\n            const index = this.inFlows.indexOf(callingSignal);\n            if (index >= 0) {\n                activationState[index] = true;\n            }\n        }\n        this.remainingInputs.setValue(new FlowGraphInteger(activationState.filter((v) => !v).length), context);\n        context._setExecutionVariable(this, \"activationState\", activationState.slice());\n        if (!activationState.includes(false)) {\n            this.completed._activateSignal(context);\n            for (let i = 0; i < this.config.inputSignalCount; i++) {\n                activationState[i] = false;\n            }\n        }\n        else {\n            callingSignal !== this.reset && this.out._activateSignal(context);\n        }\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphWaitAllBlock\" /* FlowGraphBlockNames.WaitAll */;\n    }\n    /**\n     * Serializes this block into a object\n     * @param serializationObject the object to serialize to\n     */\n    serialize(serializationObject) {\n        super.serialize(serializationObject);\n        serializationObject.config.inputFlows = this.config.inputSignalCount;\n    }\n}\nRegisterClass(\"FlowGraphWaitAllBlock\" /* FlowGraphBlockNames.WaitAll */, FlowGraphWaitAllBlock);\n//# sourceMappingURL=flowGraphWaitAllBlock.js.map"],"names":[],"mappings":";;;AAOO,MAAM,8BAA8B,qCAAqC;AAAA,EAC5E,YAIA,QAAQ;AACJ,UAAM,MAAM;AACZ,SAAK,SAAS;AAId,SAAK,UAAU,CAAA;AACf,SAAK,yBAAyB,CAAA;AAC9B,SAAK,QAAQ,KAAK,qBAAqB,OAAO;AAC9C,SAAK,YAAY,KAAK,sBAAsB,WAAW;AACvD,SAAK,kBAAkB,KAAK,mBAAmB,mBAAmB,0BAA0B,IAAI,iBAAiB,KAAK,OAAO,oBAAoB,CAAC,CAAC;AAEnJ,aAAS,IAAI,GAAG,IAAI,KAAK,OAAO,kBAAkB,KAAK;AACnD,WAAK,QAAQ,KAAK,KAAK,qBAAqB,MAAM,CAAC,EAAE,CAAC;AAAA,IAC1D;AAEA,SAAK,uBAAuB,IAAI;AAAA,EACpC;AAAA,EACA,2BAA2B,SAAS;AAChC,UAAM,kBAAkB,KAAK;AAC7B,oBAAgB,SAAS;AACzB,QAAI,CAAC,QAAQ,sBAAsB,MAAM,iBAAiB,GAAG;AACzD,eAAS,IAAI,GAAG,IAAI,KAAK,OAAO,kBAAkB,KAAK;AACnD,wBAAgB,KAAK,KAAK;AAAA,MAC9B;AAAA,IACJ,OACK;AACD,YAAM,yBAAyB,QAAQ,sBAAsB,MAAM,mBAAmB,CAAA,CAAE;AACxF,eAAS,IAAI,GAAG,IAAI,uBAAuB,QAAQ,KAAK;AACpD,wBAAgB,KAAK,uBAAuB,CAAC,CAAC;AAAA,MAClD;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EACA,SAAS,SAAS,eAAe;AAC7B,UAAM,kBAAkB,KAAK,2BAA2B,OAAO;AAC/D,QAAI,kBAAkB,KAAK,OAAO;AAC9B,eAAS,IAAI,GAAG,IAAI,KAAK,OAAO,kBAAkB,KAAK;AACnD,wBAAgB,CAAC,IAAI;AAAA,MACzB;AAAA,IACJ,OACK;AACD,YAAM,QAAQ,KAAK,QAAQ,QAAQ,aAAa;AAChD,UAAI,SAAS,GAAG;AACZ,wBAAgB,KAAK,IAAI;AAAA,MAC7B;AAAA,IACJ;AACA,SAAK,gBAAgB,SAAS,IAAI,iBAAiB,gBAAgB,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,GAAG,OAAO;AACrG,YAAQ,sBAAsB,MAAM,mBAAmB,gBAAgB,MAAK,CAAE;AAC9E,QAAI,CAAC,gBAAgB,SAAS,KAAK,GAAG;AAClC,WAAK,UAAU,gBAAgB,OAAO;AACtC,eAAS,IAAI,GAAG,IAAI,KAAK,OAAO,kBAAkB,KAAK;AACnD,wBAAgB,CAAC,IAAI;AAAA,MACzB;AAAA,IACJ,OACK;AACD,wBAAkB,KAAK,SAAS,KAAK,IAAI,gBAAgB,OAAO;AAAA,IACpE;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAIA,eAAe;AACX,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,qBAAqB;AAC3B,UAAM,UAAU,mBAAmB;AACnC,wBAAoB,OAAO,aAAa,KAAK,OAAO;AAAA,EACxD;AACJ;AACA,cAAc,yBAA2D,qBAAqB;","x_google_ignoreList":[0]}