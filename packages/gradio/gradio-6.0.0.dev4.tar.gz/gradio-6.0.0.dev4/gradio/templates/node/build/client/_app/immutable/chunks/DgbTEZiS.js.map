{"version":3,"file":"DgbTEZiS.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+loaders@8.36.1_@babylonjs+core@8.36.1_babylonjs-gltf2interface@8.36.1/node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_node_selectability.js"],"sourcesContent":["import { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry.js\";\nimport { addNewInteractivityFlowGraphMapping } from \"./KHR_interactivity/declarationMapper.js\";\nimport { AddObjectAccessorToKey } from \"./objectModelMapping.js\";\nconst NAME = \"KHR_node_selectability\";\n// add the interactivity mapping for the onSelect event\naddNewInteractivityFlowGraphMapping(\"event/onSelect\", NAME, {\n    // using GetVariable as the nodeIndex is a configuration and not a value (i.e. it's not mutable)\n    blocks: [\"FlowGraphMeshPickEventBlock\" /* FlowGraphBlockNames.MeshPickEvent */, \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */, \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */, \"KHR_interactivity/FlowGraphGLTFDataProvider\"],\n    configuration: {\n        stopPropagation: { name: \"stopPropagation\" },\n        nodeIndex: {\n            name: \"variable\",\n            toBlock: \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */,\n            dataTransformer(data) {\n                return [\"pickedMesh_\" + data[0]];\n            },\n        },\n    },\n    outputs: {\n        values: {\n            selectedNodeIndex: { name: \"index\", toBlock: \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */ },\n            controllerIndex: { name: \"pointerId\" },\n            selectionPoint: { name: \"pickedPoint\" },\n            selectionRayOrigin: { name: \"pickOrigin\" },\n        },\n        flows: {\n            out: { name: \"done\" },\n        },\n    },\n    interBlockConnectors: [\n        {\n            input: \"asset\",\n            output: \"value\",\n            inputBlockIndex: 0,\n            outputBlockIndex: 1,\n            isVariable: true,\n        },\n        {\n            input: \"array\",\n            output: \"nodes\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 3,\n            isVariable: true,\n        },\n        {\n            input: \"object\",\n            output: \"pickedMesh\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 0,\n            isVariable: true,\n        },\n    ],\n    extraProcessor(gltfBlock, _declaration, _mapping, _arrays, serializedObjects, context, globalGLTF) {\n        // add the glTF to the configuration of the last serialized object\n        const serializedObject = serializedObjects[serializedObjects.length - 1];\n        serializedObject.config = serializedObject.config || {};\n        serializedObject.config.glTF = globalGLTF;\n        // find the listener nodeIndex value\n        const nodeIndex = gltfBlock.configuration?.[\"nodeIndex\"]?.value[0];\n        if (nodeIndex === undefined || typeof nodeIndex !== \"number\") {\n            throw new Error(\"nodeIndex not found in configuration\");\n        }\n        const variableName = \"pickedMesh_\" + nodeIndex;\n        // find the nodeIndex value\n        serializedObjects[1].config.variable = variableName;\n        context._userVariables[variableName] = {\n            className: \"Mesh\",\n            id: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.id,\n            uniqueId: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.uniqueId,\n        };\n        return serializedObjects;\n    },\n});\n// object model extension for selectable\nAddObjectAccessorToKey(\"/nodes/{}/extensions/KHR_node_selectability/selectable\", {\n    get: (node) => {\n        const tn = node._babylonTransformNode;\n        if (tn && tn.isPickable !== undefined) {\n            return tn.isPickable;\n        }\n        return true;\n    },\n    set: (value, node) => {\n        node._primitiveBabylonMeshes?.forEach((mesh) => {\n            mesh.isPickable = value;\n        });\n    },\n    getTarget: (node) => node._babylonTransformNode,\n    getPropertyName: [() => \"isPickable\"],\n    type: \"boolean\",\n});\n/**\n * Loader extension for KHR_selectability\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class KHR_node_selectability {\n    /**\n     * @internal\n     */\n    constructor(loader) {\n        /**\n         * The name of this extension.\n         */\n        this.name = NAME;\n        this._loader = loader;\n        this.enabled = loader.isExtensionUsed(NAME);\n    }\n    // eslint-disable-next-line @typescript-eslint/naming-convention, @typescript-eslint/no-misused-promises\n    async onReady() {\n        this._loader.gltf.nodes?.forEach((node) => {\n            if (node.extensions?.KHR_node_selectability && node.extensions?.KHR_node_selectability.selectable === false) {\n                node._babylonTransformNode?.getChildMeshes().forEach((mesh) => {\n                    mesh.isPickable = false;\n                });\n            }\n        });\n    }\n    dispose() {\n        this._loader = null;\n    }\n}\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new KHR_node_selectability(loader));\n//# sourceMappingURL=KHR_node_selectability.js.map"],"names":[],"mappings":"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","x_google_ignoreList":[0]}