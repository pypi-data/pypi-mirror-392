{"version":3,"file":"3qd4RMIU.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/ControlFlow/flowGraphMultiGateBlock.js"],"sourcesContent":["import { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { FlowGraphExecutionBlock } from \"../../../flowGraphExecutionBlock.js\";\nimport { RichTypeFlowGraphInteger } from \"../../../flowGraphRichTypes.js\";\nimport { FlowGraphInteger } from \"../../../CustomTypes/flowGraphInteger.js\";\n/**\n * A block that has an input flow and routes it to any potential output flows, randomly or sequentially\n */\nexport class FlowGraphMultiGateBlock extends FlowGraphExecutionBlock {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        /**\n         * Output connections: The output signals.\n         */\n        this.outputSignals = [];\n        this.reset = this._registerSignalInput(\"reset\");\n        this.lastIndex = this.registerDataOutput(\"lastIndex\", RichTypeFlowGraphInteger, new FlowGraphInteger(-1));\n        this.setNumberOfOutputSignals(config?.outputSignalCount);\n    }\n    _getNextIndex(indexesUsed) {\n        // find the next index available from the indexes used array\n        // if all outputs were used, reset the indexes used array if we are in a loop multi gate\n        if (!indexesUsed.includes(false)) {\n            if (this.config.isLoop) {\n                indexesUsed.fill(false);\n            }\n        }\n        if (!this.config.isRandom) {\n            return indexesUsed.indexOf(false);\n        }\n        else {\n            const unusedIndexes = indexesUsed.map((used, index) => (used ? -1 : index)).filter((index) => index !== -1);\n            return unusedIndexes.length ? unusedIndexes[Math.floor(Math.random() * unusedIndexes.length)] : -1;\n        }\n    }\n    /**\n     * Sets the block's output signals. Would usually be passed from the constructor but can be changed afterwards.\n     * @param numberOutputSignals the number of output flows\n     */\n    setNumberOfOutputSignals(numberOutputSignals = 1) {\n        // check the size of the outFlow Array, see if it is not larger than needed\n        while (this.outputSignals.length > numberOutputSignals) {\n            const flow = this.outputSignals.pop();\n            if (flow) {\n                flow.disconnectFromAll();\n                this._unregisterSignalOutput(flow.name);\n            }\n        }\n        while (this.outputSignals.length < numberOutputSignals) {\n            this.outputSignals.push(this._registerSignalOutput(`out_${this.outputSignals.length}`));\n        }\n    }\n    _execute(context, callingSignal) {\n        // set the state(s) of the block\n        if (!context._hasExecutionVariable(this, \"indexesUsed\")) {\n            context._setExecutionVariable(this, \"indexesUsed\", this.outputSignals.map(() => false));\n        }\n        if (callingSignal === this.reset) {\n            context._deleteExecutionVariable(this, \"indexesUsed\");\n            this.lastIndex.setValue(new FlowGraphInteger(-1), context);\n            return;\n        }\n        const indexesUsed = context._getExecutionVariable(this, \"indexesUsed\", []);\n        const nextIndex = this._getNextIndex(indexesUsed);\n        if (nextIndex > -1) {\n            this.lastIndex.setValue(new FlowGraphInteger(nextIndex), context);\n            indexesUsed[nextIndex] = true;\n            context._setExecutionVariable(this, \"indexesUsed\", indexesUsed);\n            this.outputSignals[nextIndex]._activateSignal(context);\n        }\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphMultiGateBlock\" /* FlowGraphBlockNames.MultiGate */;\n    }\n    /**\n     * Serializes the block.\n     * @param serializationObject the object to serialize to.\n     */\n    serialize(serializationObject) {\n        super.serialize(serializationObject);\n        serializationObject.config.outputSignalCount = this.config.outputSignalCount;\n        serializationObject.config.isRandom = this.config.isRandom;\n        serializationObject.config.loop = this.config.isLoop;\n        serializationObject.config.startIndex = this.config.startIndex;\n    }\n}\nRegisterClass(\"FlowGraphMultiGateBlock\" /* FlowGraphBlockNames.MultiGate */, FlowGraphMultiGateBlock);\n//# sourceMappingURL=flowGraphMultiGateBlock.js.map"],"names":[],"mappings":";;;AAOO,MAAM,gCAAgC,wBAAwB;AAAA,EACjE,YAIA,QAAQ;AACJ,UAAM,MAAM;AACZ,SAAK,SAAS;AAId,SAAK,gBAAgB,CAAA;AACrB,SAAK,QAAQ,KAAK,qBAAqB,OAAO;AAC9C,SAAK,YAAY,KAAK,mBAAmB,aAAa,0BAA0B,IAAI,iBAAiB,EAAE,CAAC;AACxG,SAAK,yBAAyB,QAAQ,iBAAiB;AAAA,EAC3D;AAAA,EACA,cAAc,aAAa;AAGvB,QAAI,CAAC,YAAY,SAAS,KAAK,GAAG;AAC9B,UAAI,KAAK,OAAO,QAAQ;AACpB,oBAAY,KAAK,KAAK;AAAA,MAC1B;AAAA,IACJ;AACA,QAAI,CAAC,KAAK,OAAO,UAAU;AACvB,aAAO,YAAY,QAAQ,KAAK;AAAA,IACpC,OACK;AACD,YAAM,gBAAgB,YAAY,IAAI,CAAC,MAAM,UAAW,OAAO,KAAK,KAAM,EAAE,OAAO,CAAC,UAAU,UAAU,EAAE;AAC1G,aAAO,cAAc,SAAS,cAAc,KAAK,MAAM,KAAK,WAAW,cAAc,MAAM,CAAC,IAAI;AAAA,IACpG;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,sBAAsB,GAAG;AAE9C,WAAO,KAAK,cAAc,SAAS,qBAAqB;AACpD,YAAM,OAAO,KAAK,cAAc,IAAG;AACnC,UAAI,MAAM;AACN,aAAK,kBAAiB;AACtB,aAAK,wBAAwB,KAAK,IAAI;AAAA,MAC1C;AAAA,IACJ;AACA,WAAO,KAAK,cAAc,SAAS,qBAAqB;AACpD,WAAK,cAAc,KAAK,KAAK,sBAAsB,OAAO,KAAK,cAAc,MAAM,EAAE,CAAC;AAAA,IAC1F;AAAA,EACJ;AAAA,EACA,SAAS,SAAS,eAAe;AAE7B,QAAI,CAAC,QAAQ,sBAAsB,MAAM,aAAa,GAAG;AACrD,cAAQ,sBAAsB,MAAM,eAAe,KAAK,cAAc,IAAI,MAAM,KAAK,CAAC;AAAA,IAC1F;AACA,QAAI,kBAAkB,KAAK,OAAO;AAC9B,cAAQ,yBAAyB,MAAM,aAAa;AACpD,WAAK,UAAU,SAAS,IAAI,iBAAiB,EAAE,GAAG,OAAO;AACzD;AAAA,IACJ;AACA,UAAM,cAAc,QAAQ,sBAAsB,MAAM,eAAe,CAAA,CAAE;AACzE,UAAM,YAAY,KAAK,cAAc,WAAW;AAChD,QAAI,YAAY,IAAI;AAChB,WAAK,UAAU,SAAS,IAAI,iBAAiB,SAAS,GAAG,OAAO;AAChE,kBAAY,SAAS,IAAI;AACzB,cAAQ,sBAAsB,MAAM,eAAe,WAAW;AAC9D,WAAK,cAAc,SAAS,EAAE,gBAAgB,OAAO;AAAA,IACzD;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAIA,eAAe;AACX,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,qBAAqB;AAC3B,UAAM,UAAU,mBAAmB;AACnC,wBAAoB,OAAO,oBAAoB,KAAK,OAAO;AAC3D,wBAAoB,OAAO,WAAW,KAAK,OAAO;AAClD,wBAAoB,OAAO,OAAO,KAAK,OAAO;AAC9C,wBAAoB,OAAO,aAAa,KAAK,OAAO;AAAA,EACxD;AACJ;AACA,cAAc,2BAA+D,uBAAuB;","x_google_ignoreList":[0]}