{"version":3,"file":"DRT7jzQa.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/Animation/flowGraphStopAnimationBlock.js"],"sourcesContent":["import { RichTypeAny, RichTypeNumber } from \"../../../flowGraphRichTypes.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Logger } from \"../../../../Misc/logger.js\";\nimport { FlowGraphAsyncExecutionBlock } from \"../../../flowGraphAsyncExecutionBlock.js\";\n/**\n * @experimental\n * Block that stops a running animation\n */\nexport class FlowGraphStopAnimationBlock extends FlowGraphAsyncExecutionBlock {\n    constructor(config) {\n        super(config);\n        this.animationGroup = this.registerDataInput(\"animationGroup\", RichTypeAny);\n        this.stopAtFrame = this.registerDataInput(\"stopAtFrame\", RichTypeNumber, -1);\n    }\n    _preparePendingTasks(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const stopAtFrame = this.stopAtFrame.getValue(context) ?? -1;\n        // get the context variable\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        // add the animation to the list\n        pendingStopAnimations.push({ uniqueId: animationToStopValue.uniqueId, stopAtFrame });\n        // set the global context variable\n        context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n    }\n    _cancelPendingTasks(context) {\n        // remove the animation from the list\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        for (let i = 0; i < pendingStopAnimations.length; i++) {\n            if (pendingStopAnimations[i].uniqueId === animationToStopValue.uniqueId) {\n                pendingStopAnimations.splice(i, 1);\n                // set the global context variable\n                context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n                break;\n            }\n        }\n    }\n    _execute(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const stopTime = this.stopAtFrame.getValue(context) ?? -1;\n        // check the values\n        if (!animationToStopValue) {\n            Logger.Warn(\"No animation group provided to stop.\");\n            return this._reportError(context, \"No animation group provided to stop.\");\n        }\n        if (isNaN(stopTime)) {\n            return this._reportError(context, \"Invalid stop time.\");\n        }\n        if (stopTime > 0) {\n            this._startPendingTasks(context);\n        }\n        else {\n            this._stopAnimation(animationToStopValue, context);\n        }\n        // note that out will not be triggered in case of an error\n        this.out._activateSignal(context);\n    }\n    _executeOnTick(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        // check each frame if any animation should be stopped\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        for (let i = 0; i < pendingStopAnimations.length; i++) {\n            // compare the uniqueId to the animation to stop\n            if (pendingStopAnimations[i].uniqueId === animationToStopValue.uniqueId) {\n                // check if the current frame is AFTER the stopAtFrame\n                if (animationToStopValue.getCurrentFrame() >= pendingStopAnimations[i].stopAtFrame) {\n                    // stop the animation\n                    this._stopAnimation(animationToStopValue, context);\n                    // remove the animation from the list\n                    pendingStopAnimations.splice(i, 1);\n                    // set the global context variable\n                    context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n                    this.done._activateSignal(context);\n                    context._removePendingBlock(this);\n                    break;\n                }\n            }\n        }\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphStopAnimationBlock\" /* FlowGraphBlockNames.StopAnimation */;\n    }\n    _stopAnimation(animationGroup, context) {\n        const currentlyRunning = context._getGlobalContextVariable(\"currentlyRunningAnimationGroups\", []);\n        const index = currentlyRunning.indexOf(animationGroup.uniqueId);\n        if (index !== -1) {\n            animationGroup.stop();\n            currentlyRunning.splice(index, 1);\n            // update the global context variable\n            context._setGlobalContextVariable(\"currentlyRunningAnimationGroups\", currentlyRunning);\n        }\n        else {\n            // Logger.Warn(\"Trying to stop an animation that is not running.\");\n            // no-op for now. Probably no need to log anything here.\n        }\n    }\n}\nRegisterClass(\"FlowGraphStopAnimationBlock\" /* FlowGraphBlockNames.StopAnimation */, FlowGraphStopAnimationBlock);\n//# sourceMappingURL=flowGraphStopAnimationBlock.js.map"],"names":[],"mappings":";;;AAQO,MAAM,oCAAoC,6BAA6B;AAAA,EAC1E,YAAY,QAAQ;AAChB,UAAM,MAAM;AACZ,SAAK,iBAAiB,KAAK,kBAAkB,kBAAkB,WAAW;AAC1E,SAAK,cAAc,KAAK,kBAAkB,eAAe,gBAAgB,EAAE;AAAA,EAC/E;AAAA,EACA,qBAAqB,SAAS;AAC1B,UAAM,uBAAuB,KAAK,eAAe,SAAS,OAAO;AACjE,UAAM,cAAc,KAAK,YAAY,SAAS,OAAO,KAAK;AAE1D,UAAM,wBAAwB,QAAQ,0BAA0B,yBAAyB,CAAA,CAAE;AAE3F,0BAAsB,KAAK,EAAE,UAAU,qBAAqB,UAAU,aAAa;AAEnF,YAAQ,0BAA0B,yBAAyB,qBAAqB;AAAA,EACpF;AAAA,EACA,oBAAoB,SAAS;AAEzB,UAAM,uBAAuB,KAAK,eAAe,SAAS,OAAO;AACjE,UAAM,wBAAwB,QAAQ,0BAA0B,yBAAyB,CAAA,CAAE;AAC3F,aAAS,IAAI,GAAG,IAAI,sBAAsB,QAAQ,KAAK;AACnD,UAAI,sBAAsB,CAAC,EAAE,aAAa,qBAAqB,UAAU;AACrE,8BAAsB,OAAO,GAAG,CAAC;AAEjC,gBAAQ,0BAA0B,yBAAyB,qBAAqB;AAChF;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,SAAS,SAAS;AACd,UAAM,uBAAuB,KAAK,eAAe,SAAS,OAAO;AACjE,UAAM,WAAW,KAAK,YAAY,SAAS,OAAO,KAAK;AAEvD,QAAI,CAAC,sBAAsB;AACvB,aAAO,KAAK,sCAAsC;AAClD,aAAO,KAAK,aAAa,SAAS,sCAAsC;AAAA,IAC5E;AACA,QAAI,MAAM,QAAQ,GAAG;AACjB,aAAO,KAAK,aAAa,SAAS,oBAAoB;AAAA,IAC1D;AACA,QAAI,WAAW,GAAG;AACd,WAAK,mBAAmB,OAAO;AAAA,IACnC,OACK;AACD,WAAK,eAAe,sBAAsB,OAAO;AAAA,IACrD;AAEA,SAAK,IAAI,gBAAgB,OAAO;AAAA,EACpC;AAAA,EACA,eAAe,SAAS;AACpB,UAAM,uBAAuB,KAAK,eAAe,SAAS,OAAO;AAEjE,UAAM,wBAAwB,QAAQ,0BAA0B,yBAAyB,CAAA,CAAE;AAC3F,aAAS,IAAI,GAAG,IAAI,sBAAsB,QAAQ,KAAK;AAEnD,UAAI,sBAAsB,CAAC,EAAE,aAAa,qBAAqB,UAAU;AAErE,YAAI,qBAAqB,gBAAe,KAAM,sBAAsB,CAAC,EAAE,aAAa;AAEhF,eAAK,eAAe,sBAAsB,OAAO;AAEjD,gCAAsB,OAAO,GAAG,CAAC;AAEjC,kBAAQ,0BAA0B,yBAAyB,qBAAqB;AAChF,eAAK,KAAK,gBAAgB,OAAO;AACjC,kBAAQ,oBAAoB,IAAI;AAChC;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAIA,eAAe;AACX,WAAO;AAAA,EACX;AAAA,EACA,eAAe,gBAAgB,SAAS;AACpC,UAAM,mBAAmB,QAAQ,0BAA0B,mCAAmC,CAAA,CAAE;AAChG,UAAM,QAAQ,iBAAiB,QAAQ,eAAe,QAAQ;AAC9D,QAAI,UAAU,IAAI;AACd,qBAAe,KAAI;AACnB,uBAAiB,OAAO,OAAO,CAAC;AAEhC,cAAQ,0BAA0B,mCAAmC,gBAAgB;AAAA,IACzF;AAAA,EAKJ;AACJ;AACA,cAAc,+BAAuE,2BAA2B;","x_google_ignoreList":[0]}