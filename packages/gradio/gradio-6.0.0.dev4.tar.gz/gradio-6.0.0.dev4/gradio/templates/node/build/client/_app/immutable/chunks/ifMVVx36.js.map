{"version":3,"file":"ifMVVx36.js","sources":["../../../../../../../upload/src/utils.ts"],"sourcesContent":["interface DragActionOptions {\n\tdisable_click?: boolean;\n\taccepted_types?: string | string[] | null;\n\tmode?: \"single\" | \"multiple\" | \"directory\";\n\ton_drag_change?: (dragging: boolean) => void;\n\ton_files?: (files: File[]) => void;\n}\n\ntype ActionReturn = {\n\tupdate: (new_options: DragActionOptions) => void;\n\tdestroy: () => void;\n};\n\nexport function create_drag(): {\n\tdrag: (node: HTMLElement, options: DragActionOptions) => ActionReturn;\n\topen_file_upload: () => void;\n} {\n\tlet hidden_input: HTMLInputElement;\n\tlet _options: DragActionOptions;\n\treturn {\n\t\tdrag(\n\t\t\tnode: HTMLElement,\n\t\t\toptions: DragActionOptions = {}\n\t\t): {\n\t\t\tupdate: (new_options: DragActionOptions) => void;\n\t\t\tdestroy: () => void;\n\t\t} {\n\t\t\t_options = options;\n\n\t\t\t// Create and configure hidden file input\n\t\t\tfunction setup_hidden_input(): void {\n\t\t\t\thidden_input = document.createElement(\"input\");\n\t\t\t\thidden_input.type = \"file\";\n\t\t\t\thidden_input.style.display = \"none\";\n\t\t\t\thidden_input.setAttribute(\"aria-label\", \"File upload\");\n\t\t\t\thidden_input.setAttribute(\"data-testid\", \"file-upload\");\n\t\t\t\tconst accept_options = Array.isArray(_options.accepted_types)\n\t\t\t\t\t? _options.accepted_types.join(\",\")\n\t\t\t\t\t: _options.accepted_types || undefined;\n\n\t\t\t\tif (accept_options) {\n\t\t\t\t\thidden_input.accept = accept_options;\n\t\t\t\t}\n\n\t\t\t\thidden_input.multiple = _options.mode === \"multiple\" || false;\n\t\t\t\tif (_options.mode === \"directory\") {\n\t\t\t\t\thidden_input.webkitdirectory = true;\n\t\t\t\t\thidden_input.setAttribute(\"directory\", \"\");\n\t\t\t\t\thidden_input.setAttribute(\"mozdirectory\", \"\");\n\t\t\t\t}\n\t\t\t\tnode.appendChild(hidden_input);\n\t\t\t}\n\n\t\t\tsetup_hidden_input();\n\n\t\t\tfunction handle_drag(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\tfunction handle_drag_enter(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(true);\n\t\t\t}\n\n\t\t\tfunction handle_drag_leave(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(false);\n\t\t\t}\n\n\t\t\tfunction handle_drop(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(false);\n\n\t\t\t\tif (!e.dataTransfer?.files) return;\n\t\t\t\tconst files = Array.from(e.dataTransfer.files);\n\t\t\t\tif (files.length > 0) {\n\t\t\t\t\t_options.on_files?.(files);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handle_click(): void {\n\t\t\t\tif (!_options.disable_click) {\n\t\t\t\t\thidden_input.value = \"\";\n\t\t\t\t\thidden_input.click();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handle_file_input_change(): void {\n\t\t\t\tif (hidden_input.files) {\n\t\t\t\t\tconst files = Array.from(hidden_input.files);\n\t\t\t\t\tif (files.length > 0) {\n\t\t\t\t\t\t_options.on_files?.(files);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add all event listeners\n\t\t\tnode.addEventListener(\"drag\", handle_drag);\n\t\t\tnode.addEventListener(\"dragstart\", handle_drag);\n\t\t\tnode.addEventListener(\"dragend\", handle_drag);\n\t\t\tnode.addEventListener(\"dragover\", handle_drag);\n\t\t\tnode.addEventListener(\"dragenter\", handle_drag_enter);\n\t\t\tnode.addEventListener(\"dragleave\", handle_drag_leave);\n\t\t\tnode.addEventListener(\"drop\", handle_drop);\n\t\t\tnode.addEventListener(\"click\", handle_click);\n\t\t\thidden_input!.addEventListener(\"change\", handle_file_input_change);\n\n\t\t\treturn {\n\t\t\t\tupdate(new_options: DragActionOptions) {\n\t\t\t\t\t_options = new_options;\n\t\t\t\t\t// Recreate hidden input with new options\n\t\t\t\t\thidden_input.remove();\n\t\t\t\t\tsetup_hidden_input();\n\t\t\t\t\thidden_input.addEventListener(\"change\", handle_file_input_change);\n\t\t\t\t},\n\t\t\t\tdestroy() {\n\t\t\t\t\tnode.removeEventListener(\"drag\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragstart\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragend\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragover\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragenter\", handle_drag_enter);\n\t\t\t\t\tnode.removeEventListener(\"dragleave\", handle_drag_leave);\n\t\t\t\t\tnode.removeEventListener(\"drop\", handle_drop);\n\t\t\t\t\tnode.removeEventListener(\"click\", handle_click);\n\t\t\t\t\thidden_input.removeEventListener(\"change\", handle_file_input_change);\n\t\t\t\t\thidden_input.remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\topen_file_upload(): void {\n\t\t\tif (hidden_input) {\n\t\t\t\thidden_input.value = \"\";\n\t\t\t\thidden_input.click();\n\t\t\t}\n\t\t}\n\t};\n}\n"],"names":[],"mappings":"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"}