{"version":3,"file":"DdmrBfgg.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/Misc/workerPool.js"],"sourcesContent":["/**\n * Helper class to push actions to a pool of workers.\n */\nexport class WorkerPool {\n    /**\n     * Constructor\n     * @param workers Array of workers to use for actions\n     */\n    constructor(workers) {\n        this._pendingActions = new Array();\n        this._workerInfos = workers.map((worker) => ({\n            workerPromise: Promise.resolve(worker),\n            idle: true,\n        }));\n    }\n    /**\n     * Terminates all workers and clears any pending actions.\n     */\n    dispose() {\n        for (const workerInfo of this._workerInfos) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\n            workerInfo.workerPromise.then((worker) => {\n                worker.terminate();\n            });\n        }\n        this._workerInfos.length = 0;\n        this._pendingActions.length = 0;\n    }\n    /**\n     * Pushes an action to the worker pool. If all the workers are active, the action will be\n     * pended until a worker has completed its action.\n     * @param action The action to perform. Call onComplete when the action is complete.\n     */\n    push(action) {\n        if (!this._executeOnIdleWorker(action)) {\n            this._pendingActions.push(action);\n        }\n    }\n    _executeOnIdleWorker(action) {\n        for (const workerInfo of this._workerInfos) {\n            if (workerInfo.idle) {\n                this._execute(workerInfo, action);\n                return true;\n            }\n        }\n        return false;\n    }\n    _execute(workerInfo, action) {\n        workerInfo.idle = false;\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\n        workerInfo.workerPromise.then((worker) => {\n            action(worker, () => {\n                const nextAction = this._pendingActions.shift();\n                if (nextAction) {\n                    this._execute(workerInfo, nextAction);\n                }\n                else {\n                    workerInfo.idle = true;\n                }\n            });\n        });\n    }\n}\n/**\n * Similar to the WorkerPool class except it creates and destroys workers automatically with a maximum of `maxWorkers` workers.\n * Workers are terminated when it is idle for at least `idleTimeElapsedBeforeRelease` milliseconds.\n */\nexport class AutoReleaseWorkerPool extends WorkerPool {\n    constructor(maxWorkers, createWorkerAsync, options = AutoReleaseWorkerPool.DefaultOptions) {\n        super([]);\n        this._maxWorkers = maxWorkers;\n        this._createWorkerAsync = createWorkerAsync;\n        this._options = options;\n    }\n    push(action) {\n        if (!this._executeOnIdleWorker(action)) {\n            if (this._workerInfos.length < this._maxWorkers) {\n                const workerInfo = {\n                    workerPromise: this._createWorkerAsync(),\n                    idle: false,\n                };\n                this._workerInfos.push(workerInfo);\n                this._execute(workerInfo, action);\n            }\n            else {\n                this._pendingActions.push(action);\n            }\n        }\n    }\n    _execute(workerInfo, action) {\n        // Reset the idle timeout.\n        if (workerInfo.timeoutId) {\n            clearTimeout(workerInfo.timeoutId);\n            delete workerInfo.timeoutId;\n        }\n        super._execute(workerInfo, (worker, onComplete) => {\n            action(worker, () => {\n                onComplete();\n                if (workerInfo.idle) {\n                    // Schedule the worker to be terminated after the elapsed time.\n                    workerInfo.timeoutId = setTimeout(() => {\n                        // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\n                        workerInfo.workerPromise.then((worker) => {\n                            worker.terminate();\n                        });\n                        const indexOf = this._workerInfos.indexOf(workerInfo);\n                        if (indexOf !== -1) {\n                            this._workerInfos.splice(indexOf, 1);\n                        }\n                    }, this._options.idleTimeElapsedBeforeRelease);\n                }\n            });\n        });\n    }\n}\n/**\n * Default options for the constructor.\n * Override to change the defaults.\n */\nAutoReleaseWorkerPool.DefaultOptions = {\n    idleTimeElapsedBeforeRelease: 1000,\n};\n//# sourceMappingURL=workerPool.js.map"],"names":["worker"],"mappings":"AAGO,MAAM,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,EAKpB,YAAY,SAAS;AACjB,SAAK,kBAAkB,IAAI,MAAK;AAChC,SAAK,eAAe,QAAQ,IAAI,CAAC,YAAY;AAAA,MACzC,eAAe,QAAQ,QAAQ,MAAM;AAAA,MACrC,MAAM;AAAA,IAClB,EAAU;AAAA,EACN;AAAA;AAAA;AAAA;AAAA,EAIA,UAAU;AACN,eAAW,cAAc,KAAK,cAAc;AAExC,iBAAW,cAAc,KAAK,CAAC,WAAW;AACtC,eAAO,UAAS;AAAA,MACpB,CAAC;AAAA,IACL;AACA,SAAK,aAAa,SAAS;AAC3B,SAAK,gBAAgB,SAAS;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAK,QAAQ;AACT,QAAI,CAAC,KAAK,qBAAqB,MAAM,GAAG;AACpC,WAAK,gBAAgB,KAAK,MAAM;AAAA,IACpC;AAAA,EACJ;AAAA,EACA,qBAAqB,QAAQ;AACzB,eAAW,cAAc,KAAK,cAAc;AACxC,UAAI,WAAW,MAAM;AACjB,aAAK,SAAS,YAAY,MAAM;AAChC,eAAO;AAAA,MACX;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EACA,SAAS,YAAY,QAAQ;AACzB,eAAW,OAAO;AAElB,eAAW,cAAc,KAAK,CAAC,WAAW;AACtC,aAAO,QAAQ,MAAM;AACjB,cAAM,aAAa,KAAK,gBAAgB,MAAK;AAC7C,YAAI,YAAY;AACZ,eAAK,SAAS,YAAY,UAAU;AAAA,QACxC,OACK;AACD,qBAAW,OAAO;AAAA,QACtB;AAAA,MACJ,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AACJ;AAKO,MAAM,8BAA8B,WAAW;AAAA,EAClD,YAAY,YAAY,mBAAmB,UAAU,sBAAsB,gBAAgB;AACvF,UAAM,CAAA,CAAE;AACR,SAAK,cAAc;AACnB,SAAK,qBAAqB;AAC1B,SAAK,WAAW;AAAA,EACpB;AAAA,EACA,KAAK,QAAQ;AACT,QAAI,CAAC,KAAK,qBAAqB,MAAM,GAAG;AACpC,UAAI,KAAK,aAAa,SAAS,KAAK,aAAa;AAC7C,cAAM,aAAa;AAAA,UACf,eAAe,KAAK,mBAAkB;AAAA,UACtC,MAAM;AAAA,QAC1B;AACgB,aAAK,aAAa,KAAK,UAAU;AACjC,aAAK,SAAS,YAAY,MAAM;AAAA,MACpC,OACK;AACD,aAAK,gBAAgB,KAAK,MAAM;AAAA,MACpC;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,SAAS,YAAY,QAAQ;AAEzB,QAAI,WAAW,WAAW;AACtB,mBAAa,WAAW,SAAS;AACjC,aAAO,WAAW;AAAA,IACtB;AACA,UAAM,SAAS,YAAY,CAAC,QAAQ,eAAe;AAC/C,aAAO,QAAQ,MAAM;AACjB,mBAAU;AACV,YAAI,WAAW,MAAM;AAEjB,qBAAW,YAAY,WAAW,MAAM;AAEpC,uBAAW,cAAc,KAAK,CAACA,YAAW;AACtC,cAAAA,QAAO,UAAS;AAAA,YACpB,CAAC;AACD,kBAAM,UAAU,KAAK,aAAa,QAAQ,UAAU;AACpD,gBAAI,YAAY,IAAI;AAChB,mBAAK,aAAa,OAAO,SAAS,CAAC;AAAA,YACvC;AAAA,UACJ,GAAG,KAAK,SAAS,4BAA4B;AAAA,QACjD;AAAA,MACJ,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AACJ;AAKA,sBAAsB,iBAAiB;AAAA,EACnC,8BAA8B;AAClC;","x_google_ignoreList":[0]}