{"version":3,"file":"CFkVJniv.js","sources":["../../../../../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/ControlFlow/flowGraphThrottleBlock.js"],"sourcesContent":["import { RichTypeNumber } from \"../../../flowGraphRichTypes.js\";\nimport { FlowGraphExecutionBlockWithOutSignal } from \"../../../flowGraphExecutionBlockWithOutSignal.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * A block that throttles the execution of its output flow.\n */\nexport class FlowGraphThrottleBlock extends FlowGraphExecutionBlockWithOutSignal {\n    constructor(config) {\n        super(config);\n        this.reset = this._registerSignalInput(\"reset\");\n        this.duration = this.registerDataInput(\"duration\", RichTypeNumber);\n        this.lastRemainingTime = this.registerDataOutput(\"lastRemainingTime\", RichTypeNumber, NaN);\n    }\n    _execute(context, callingSignal) {\n        if (callingSignal === this.reset) {\n            this.lastRemainingTime.setValue(NaN, context);\n            context._setExecutionVariable(this, \"lastRemainingTime\", NaN);\n            context._setExecutionVariable(this, \"timestamp\", 0);\n            return;\n        }\n        // in seconds\n        const durationValue = this.duration.getValue(context);\n        if (durationValue <= 0 || isNaN(durationValue) || !isFinite(durationValue)) {\n            return this._reportError(context, \"Invalid duration in Throttle block\");\n        }\n        const lastRemainingTime = context._getExecutionVariable(this, \"lastRemainingTime\", NaN);\n        // Using Date.now() to get ms since epoch. not using performance.now() because its precision is not needed here\n        const currentTime = Date.now();\n        if (isNaN(lastRemainingTime)) {\n            this.lastRemainingTime.setValue(0, context);\n            context._setExecutionVariable(this, \"lastRemainingTime\", 0);\n            context._setExecutionVariable(this, \"timestamp\", currentTime);\n            // according to glTF interactivity specs\n            return this.out._activateSignal(context);\n        }\n        else {\n            const elapsedTime = currentTime - context._getExecutionVariable(this, \"timestamp\", 0);\n            // duration is in seconds, so we need to multiply by 1000\n            const durationInMs = durationValue * 1000;\n            if (durationInMs <= elapsedTime) {\n                this.lastRemainingTime.setValue(0, context);\n                context._setExecutionVariable(this, \"lastRemainingTime\", 0);\n                context._setExecutionVariable(this, \"timestamp\", currentTime);\n                return this.out._activateSignal(context);\n            }\n            else {\n                const remainingTime = durationInMs - elapsedTime;\n                // output is in seconds\n                this.lastRemainingTime.setValue(remainingTime / 1000, context);\n                context._setExecutionVariable(this, \"lastRemainingTime\", remainingTime);\n            }\n        }\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphThrottleBlock\" /* FlowGraphBlockNames.Throttle */;\n    }\n}\nRegisterClass(\"FlowGraphThrottleBlock\" /* FlowGraphBlockNames.Throttle */, FlowGraphThrottleBlock);\n//# sourceMappingURL=flowGraphThrottleBlock.js.map"],"names":[],"mappings":";;;AAMO,MAAM,+BAA+B,qCAAqC;AAAA,EAC7E,YAAY,QAAQ;AAChB,UAAM,MAAM;AACZ,SAAK,QAAQ,KAAK,qBAAqB,OAAO;AAC9C,SAAK,WAAW,KAAK,kBAAkB,YAAY,cAAc;AACjE,SAAK,oBAAoB,KAAK,mBAAmB,qBAAqB,gBAAgB,GAAG;AAAA,EAC7F;AAAA,EACA,SAAS,SAAS,eAAe;AAC7B,QAAI,kBAAkB,KAAK,OAAO;AAC9B,WAAK,kBAAkB,SAAS,KAAK,OAAO;AAC5C,cAAQ,sBAAsB,MAAM,qBAAqB,GAAG;AAC5D,cAAQ,sBAAsB,MAAM,aAAa,CAAC;AAClD;AAAA,IACJ;AAEA,UAAM,gBAAgB,KAAK,SAAS,SAAS,OAAO;AACpD,QAAI,iBAAiB,KAAK,MAAM,aAAa,KAAK,CAAC,SAAS,aAAa,GAAG;AACxE,aAAO,KAAK,aAAa,SAAS,oCAAoC;AAAA,IAC1E;AACA,UAAM,oBAAoB,QAAQ,sBAAsB,MAAM,qBAAqB,GAAG;AAEtF,UAAM,cAAc,KAAK,IAAG;AAC5B,QAAI,MAAM,iBAAiB,GAAG;AAC1B,WAAK,kBAAkB,SAAS,GAAG,OAAO;AAC1C,cAAQ,sBAAsB,MAAM,qBAAqB,CAAC;AAC1D,cAAQ,sBAAsB,MAAM,aAAa,WAAW;AAE5D,aAAO,KAAK,IAAI,gBAAgB,OAAO;AAAA,IAC3C,OACK;AACD,YAAM,cAAc,cAAc,QAAQ,sBAAsB,MAAM,aAAa,CAAC;AAEpF,YAAM,eAAe,gBAAgB;AACrC,UAAI,gBAAgB,aAAa;AAC7B,aAAK,kBAAkB,SAAS,GAAG,OAAO;AAC1C,gBAAQ,sBAAsB,MAAM,qBAAqB,CAAC;AAC1D,gBAAQ,sBAAsB,MAAM,aAAa,WAAW;AAC5D,eAAO,KAAK,IAAI,gBAAgB,OAAO;AAAA,MAC3C,OACK;AACD,cAAM,gBAAgB,eAAe;AAErC,aAAK,kBAAkB,SAAS,gBAAgB,KAAM,OAAO;AAC7D,gBAAQ,sBAAsB,MAAM,qBAAqB,aAAa;AAAA,MAC1E;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAIA,eAAe;AACX,WAAO;AAAA,EACX;AACJ;AACA,cAAc,0BAA6D,sBAAsB;","x_google_ignoreList":[0]}