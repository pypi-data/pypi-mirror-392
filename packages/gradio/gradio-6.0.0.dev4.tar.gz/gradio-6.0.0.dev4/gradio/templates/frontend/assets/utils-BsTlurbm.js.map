{"version":3,"file":"utils-BsTlurbm.js","sources":["../../../../js/upload/src/utils.ts"],"sourcesContent":["interface DragActionOptions {\n\tdisable_click?: boolean;\n\taccepted_types?: string | string[] | null;\n\tmode?: \"single\" | \"multiple\" | \"directory\";\n\ton_drag_change?: (dragging: boolean) => void;\n\ton_files?: (files: File[]) => void;\n}\n\ntype ActionReturn = {\n\tupdate: (new_options: DragActionOptions) => void;\n\tdestroy: () => void;\n};\n\nexport function create_drag(): {\n\tdrag: (node: HTMLElement, options: DragActionOptions) => ActionReturn;\n\topen_file_upload: () => void;\n} {\n\tlet hidden_input: HTMLInputElement;\n\tlet _options: DragActionOptions;\n\treturn {\n\t\tdrag(\n\t\t\tnode: HTMLElement,\n\t\t\toptions: DragActionOptions = {}\n\t\t): {\n\t\t\tupdate: (new_options: DragActionOptions) => void;\n\t\t\tdestroy: () => void;\n\t\t} {\n\t\t\t_options = options;\n\n\t\t\t// Create and configure hidden file input\n\t\t\tfunction setup_hidden_input(): void {\n\t\t\t\thidden_input = document.createElement(\"input\");\n\t\t\t\thidden_input.type = \"file\";\n\t\t\t\thidden_input.style.display = \"none\";\n\t\t\t\thidden_input.setAttribute(\"aria-label\", \"File upload\");\n\t\t\t\thidden_input.setAttribute(\"data-testid\", \"file-upload\");\n\t\t\t\tconst accept_options = Array.isArray(_options.accepted_types)\n\t\t\t\t\t? _options.accepted_types.join(\",\")\n\t\t\t\t\t: _options.accepted_types || undefined;\n\n\t\t\t\tif (accept_options) {\n\t\t\t\t\thidden_input.accept = accept_options;\n\t\t\t\t}\n\n\t\t\t\thidden_input.multiple = _options.mode === \"multiple\" || false;\n\t\t\t\tif (_options.mode === \"directory\") {\n\t\t\t\t\thidden_input.webkitdirectory = true;\n\t\t\t\t\thidden_input.setAttribute(\"directory\", \"\");\n\t\t\t\t\thidden_input.setAttribute(\"mozdirectory\", \"\");\n\t\t\t\t}\n\t\t\t\tnode.appendChild(hidden_input);\n\t\t\t}\n\n\t\t\tsetup_hidden_input();\n\n\t\t\tfunction handle_drag(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\n\t\t\tfunction handle_drag_enter(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(true);\n\t\t\t}\n\n\t\t\tfunction handle_drag_leave(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(false);\n\t\t\t}\n\n\t\t\tfunction handle_drop(e: DragEvent): void {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\t_options.on_drag_change?.(false);\n\n\t\t\t\tif (!e.dataTransfer?.files) return;\n\t\t\t\tconst files = Array.from(e.dataTransfer.files);\n\t\t\t\tif (files.length > 0) {\n\t\t\t\t\t_options.on_files?.(files);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handle_click(): void {\n\t\t\t\tif (!_options.disable_click) {\n\t\t\t\t\thidden_input.value = \"\";\n\t\t\t\t\thidden_input.click();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handle_file_input_change(): void {\n\t\t\t\tif (hidden_input.files) {\n\t\t\t\t\tconst files = Array.from(hidden_input.files);\n\t\t\t\t\tif (files.length > 0) {\n\t\t\t\t\t\t_options.on_files?.(files);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add all event listeners\n\t\t\tnode.addEventListener(\"drag\", handle_drag);\n\t\t\tnode.addEventListener(\"dragstart\", handle_drag);\n\t\t\tnode.addEventListener(\"dragend\", handle_drag);\n\t\t\tnode.addEventListener(\"dragover\", handle_drag);\n\t\t\tnode.addEventListener(\"dragenter\", handle_drag_enter);\n\t\t\tnode.addEventListener(\"dragleave\", handle_drag_leave);\n\t\t\tnode.addEventListener(\"drop\", handle_drop);\n\t\t\tnode.addEventListener(\"click\", handle_click);\n\t\t\thidden_input!.addEventListener(\"change\", handle_file_input_change);\n\n\t\t\treturn {\n\t\t\t\tupdate(new_options: DragActionOptions) {\n\t\t\t\t\t_options = new_options;\n\t\t\t\t\t// Recreate hidden input with new options\n\t\t\t\t\thidden_input.remove();\n\t\t\t\t\tsetup_hidden_input();\n\t\t\t\t\thidden_input.addEventListener(\"change\", handle_file_input_change);\n\t\t\t\t},\n\t\t\t\tdestroy() {\n\t\t\t\t\tnode.removeEventListener(\"drag\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragstart\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragend\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragover\", handle_drag);\n\t\t\t\t\tnode.removeEventListener(\"dragenter\", handle_drag_enter);\n\t\t\t\t\tnode.removeEventListener(\"dragleave\", handle_drag_leave);\n\t\t\t\t\tnode.removeEventListener(\"drop\", handle_drop);\n\t\t\t\t\tnode.removeEventListener(\"click\", handle_click);\n\t\t\t\t\thidden_input.removeEventListener(\"change\", handle_file_input_change);\n\t\t\t\t\thidden_input.remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\topen_file_upload(): void {\n\t\t\tif (hidden_input) {\n\t\t\t\thidden_input.value = \"\";\n\t\t\t\thidden_input.click();\n\t\t\t}\n\t\t}\n\t};\n}\n"],"names":["create_drag","hidden_input","_options","node","options","setup_hidden_input","accept_options","handle_drag","e","handle_drag_enter","handle_drag_leave","handle_drop","files","handle_click","handle_file_input_change","new_options"],"mappings":"AAaO,SAASA,GAGd,CACD,IAAIC,EACAC,EACJ,MAAO,CACN,KACCC,EACAC,EAA6B,GAI5B,CACDF,EAAWE,EAGX,SAASC,GAA2B,CACnCJ,EAAe,SAAS,cAAc,OAAO,EAC7CA,EAAa,KAAO,OACpBA,EAAa,MAAM,QAAU,OAC7BA,EAAa,aAAa,aAAc,aAAa,EACrDA,EAAa,aAAa,cAAe,aAAa,EACtD,MAAMK,EAAiB,MAAM,QAAQJ,EAAS,cAAc,EACzDA,EAAS,eAAe,KAAK,GAAG,EAChCA,EAAS,gBAAkB,OAE1BI,IACHL,EAAa,OAASK,GAGvBL,EAAa,SAAWC,EAAS,OAAS,YAAc,GACpDA,EAAS,OAAS,cACrBD,EAAa,gBAAkB,GAC/BA,EAAa,aAAa,YAAa,EAAE,EACzCA,EAAa,aAAa,eAAgB,EAAE,GAE7CE,EAAK,YAAYF,CAAY,CAC9B,CAEAI,EAAA,EAEA,SAASE,EAAYC,EAAoB,CACxCA,EAAE,eAAA,EACFA,EAAE,gBAAA,CACH,CAEA,SAASC,EAAkBD,EAAoB,CAC9CA,EAAE,eAAA,EACFA,EAAE,gBAAA,EACFN,EAAS,iBAAiB,EAAI,CAC/B,CAEA,SAASQ,EAAkBF,EAAoB,CAC9CA,EAAE,eAAA,EACFA,EAAE,gBAAA,EACFN,EAAS,iBAAiB,EAAK,CAChC,CAEA,SAASS,EAAYH,EAAoB,CAKxC,GAJAA,EAAE,eAAA,EACFA,EAAE,gBAAA,EACFN,EAAS,iBAAiB,EAAK,EAE3B,CAACM,EAAE,cAAc,MAAO,OAC5B,MAAMI,EAAQ,MAAM,KAAKJ,EAAE,aAAa,KAAK,EACzCI,EAAM,OAAS,GAClBV,EAAS,WAAWU,CAAK,CAE3B,CAEA,SAASC,GAAqB,CACxBX,EAAS,gBACbD,EAAa,MAAQ,GACrBA,EAAa,MAAA,EAEf,CAEA,SAASa,GAAiC,CACzC,GAAIb,EAAa,MAAO,CACvB,MAAMW,EAAQ,MAAM,KAAKX,EAAa,KAAK,EACvCW,EAAM,OAAS,GAClBV,EAAS,WAAWU,CAAK,CAE3B,CACD,CAGA,OAAAT,EAAK,iBAAiB,OAAQI,CAAW,EACzCJ,EAAK,iBAAiB,YAAaI,CAAW,EAC9CJ,EAAK,iBAAiB,UAAWI,CAAW,EAC5CJ,EAAK,iBAAiB,WAAYI,CAAW,EAC7CJ,EAAK,iBAAiB,YAAaM,CAAiB,EACpDN,EAAK,iBAAiB,YAAaO,CAAiB,EACpDP,EAAK,iBAAiB,OAAQQ,CAAW,EACzCR,EAAK,iBAAiB,QAASU,CAAY,EAC3CZ,EAAc,iBAAiB,SAAUa,CAAwB,EAE1D,CACN,OAAOC,EAAgC,CACtCb,EAAWa,EAEXd,EAAa,OAAA,EACbI,EAAA,EACAJ,EAAa,iBAAiB,SAAUa,CAAwB,CACjE,EACA,SAAU,CACTX,EAAK,oBAAoB,OAAQI,CAAW,EAC5CJ,EAAK,oBAAoB,YAAaI,CAAW,EACjDJ,EAAK,oBAAoB,UAAWI,CAAW,EAC/CJ,EAAK,oBAAoB,WAAYI,CAAW,EAChDJ,EAAK,oBAAoB,YAAaM,CAAiB,EACvDN,EAAK,oBAAoB,YAAaO,CAAiB,EACvDP,EAAK,oBAAoB,OAAQQ,CAAW,EAC5CR,EAAK,oBAAoB,QAASU,CAAY,EAC9CZ,EAAa,oBAAoB,SAAUa,CAAwB,EACnEb,EAAa,OAAA,CACd,CAAA,CAEF,EACA,kBAAyB,CACpBA,IACHA,EAAa,MAAQ,GACrBA,EAAa,MAAA,EAEf,CAAA,CAEF"}