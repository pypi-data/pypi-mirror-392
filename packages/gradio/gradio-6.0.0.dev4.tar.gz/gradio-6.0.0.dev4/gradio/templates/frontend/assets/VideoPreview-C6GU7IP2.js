import{p as n,d as he,i as Z,t as Xe,b as ke,u as Ce,c as pe,a as ge,v as Ue}from"./i18n-5O2R8uRh.js";import{p as fe,ac as xe,ai as He,l as _e,i as e,m as N,a as be,f as z,h as U,r as H,b as F,c as we,j as b,g as o,s as I,t as ue,e as j,d as C,U as le,V as oe,Q as Y,k as De,R as Pe,X as je,aB as Fe,T as qe,_ as ze}from"./index-bhUlIv2p.js";import{k as Oe}from"./key-DIjq0Qdg.js";import{b as J}from"./misc-BSG2QtlE.js";/* empty css                                                        */import"./MarkdownCode.svelte_svelte_type_style_lang-ywXsGwHK.js";import{B as We}from"./BlockLabel-B0lD-lMe.js";import{D as Ne}from"./DownloadLink-BGikjoQ1.js";import{I as Ee}from"./IconButton-CbXWacxl.js";import{E as Qe}from"./Empty-5TrEX-tI.js";import{S as Ge}from"./ShareButton-2E8myMWE.js";import{D as Je}from"./Download-CYnkzDbq.js";import{V as Te}from"./Video-Cx3u5wRP.js";import{I as Ke}from"./IconButtonWrapper-DsFz-pKX.js";import{f as de,u as Ye}from"./utils.svelte-Baqu2V3e.js";import{p as Ve,s as Ze}from"./event-modifiers-CdEA5IGF.js";import{M as $e}from"./Maximize-Dcz8xF4p.js";import{T as et,P as tt}from"./Trim-BNRWAQmZ.js";import{P as at}from"./Play-a1iOyiRM.js";import{U as Re}from"./Undo-CfrxzS-O.js";import{b as rt,t as lt,V as nt}from"./Video-Bk_QzOHi.js";/* empty css                                             */import{M as ot}from"./ModifyUpload-BwV9897O.js";var it=z('<div class="load-wrap svelte-mctcyk"><span aria-label="loading timeline" class="loader svelte-mctcyk"></span></div>'),st=z('<img draggable="false" class="svelte-mctcyk"/>'),dt=z('<div id="timeline" class="thumbnail-wrapper svelte-mctcyk"><button aria-label="start drag handle for trimming video" class="handle left svelte-mctcyk"></button> <div class="opaque-layer svelte-mctcyk"></div> <!> <button aria-label="end drag handle for trimming video" class="handle right svelte-mctcyk"></button></div>'),ut=z('<div class="container svelte-mctcyk"><!></div>');function vt(ne,t){fe(t,!1);let r=n(t,"videoElement",12),E=n(t,"trimmedDuration",12),L=n(t,"dragStart",12),v=n(t,"dragEnd",12),S=n(t,"loadingTimeline",12),D=N([]),T=10,w,_=N(0),m=N(100),y=null;const P=l=>{y=l},A=()=>{y=null},h=(l,u)=>{if(y){const f=document.getElementById("timeline");if(!f)return;const k=f.getBoundingClientRect();let V=(l.clientX-k.left)/k.width*100;if(u?V=y==="left"?e(_)+u:e(m)+u:V=(l.clientX-k.left)/k.width*100,V=Math.max(0,Math.min(V,100)),y==="left"){b(_,Math.min(V,e(m)));const X=e(_)/100*w;r(r().currentTime=X,!0),L(X)}else if(y==="right"){b(m,Math.max(V,e(_)));const X=e(m)/100*w;r(r().currentTime=X,!0),v(X)}const O=e(_)/100*w,g=e(m)/100*w;E(g-O),b(_,e(_)),b(m,e(m))}},Q=l=>{if(y){const u=1/w*100;l.key==="ArrowLeft"?h({clientX:0},-u):l.key==="ArrowRight"&&h({clientX:0},u)}},G=()=>{const l=document.createElement("canvas"),u=l.getContext("2d");if(!u)return;l.width=r().videoWidth,l.height=r().videoHeight,u.drawImage(r(),0,0,l.width,l.height);const f=l.toDataURL("image/jpeg",.7);b(D,[...e(D),f])};xe(()=>{const l=()=>{w=r().duration;const u=w/T;let f=0;const k=()=>{G(),f++,f<T?r(r().currentTime+=u,!0):r().removeEventListener("seeked",k)};r().addEventListener("seeked",k),r(r().currentTime=0,!0)};r().readyState>=1?l():r().addEventListener("loadedmetadata",l)}),He(()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",A),window.removeEventListener("keydown",Q)}),xe(()=>{window.addEventListener("mousemove",h),window.addEventListener("mouseup",A),window.addEventListener("keydown",Q)}),_e(()=>e(D),()=>{S(e(D).length!==T)}),be();var q={get videoElement(){return r()},set videoElement(l){r(l),o()},get trimmedDuration(){return E()},set trimmedDuration(l){E(l),o()},get dragStart(){return L()},set dragStart(l){L(l),o()},get dragEnd(){return v()},set dragEnd(l){v(l),o()},get loadingTimeline(){return S()},set loadingTimeline(l){S(l),o()}};he();var K=ut(),R=U(K);{var p=l=>{var u=it();F(l,u)},s=l=>{var u=dt(),f=U(u),k=I(f,2),V=I(k,2);Xe(V,1,()=>e(D),Ce,(g,X,i)=>{var x=st();ke(x,"alt",`frame-${i}`),ue(()=>ke(x,"src",e(X))),F(g,x)});var O=I(V,2);H(u),ue(()=>{pe(f,`left: ${e(_)??""}%;`),pe(k,`left: ${e(_)??""}%; right: ${100-e(m)}%`),pe(O,`left: ${e(m)??""}%;`)}),j("mousedown",f,()=>P("left")),j("blur",f,A),j("keydown",f,g=>{(g.key==="ArrowLeft"||g.key=="ArrowRight")&&P("left")}),j("mousedown",O,()=>P("right")),j("blur",O,A),j("keydown",O,g=>{(g.key==="ArrowLeft"||g.key=="ArrowRight")&&P("right")}),F(l,u)};Z(R,l=>{S()?l(p):l(s,!1)})}return H(K),F(ne,K),we(q)}var ct=z('<div class="timeline-wrapper svelte-1orxdv"><!></div>'),gt=z('<time aria-label="duration of selected region in seconds"> </time> <div class="edit-buttons svelte-1orxdv"><button>Trim</button> <button>Cancel</button></div>',1),_t=z('<div class="svelte-1orxdv"></div>'),mt=z("<!> <!>",1),ht=z('<div><!> <div class="controls svelte-1orxdv" data-testid="waveform-controls"><!></div></div> <!>',1);function ft(ne,t){fe(t,!1);let r=n(t,"videoElement",12),E=n(t,"showRedo",12,!1),L=n(t,"interactive",12,!0),v=n(t,"mode",12,""),S=n(t,"handle_reset_value",12),D=n(t,"handle_trim_video",12),T=n(t,"processingVideo",12,!1),w=n(t,"i18n",12),_=n(t,"value",12,null),m=n(t,"show_download_button",12,!1),y=n(t,"handle_clear",12,()=>{}),P=n(t,"has_change_history",12,!1),A=N();xe(async()=>{b(A,await rt())});let h=N(null),Q=N(0),G=N(0),q=N(!1);const K=()=>{v()==="edit"?(v(""),b(h,r().duration)):v("edit")};_e(()=>(C(v()),e(h),C(r())),()=>{v()==="edit"&&e(h)===null&&r()&&b(h,r().duration)}),be();var R={get videoElement(){return r()},set videoElement(i){r(i),o()},get showRedo(){return E()},set showRedo(i){E(i),o()},get interactive(){return L()},set interactive(i){L(i),o()},get mode(){return v()},set mode(i){v(i),o()},get handle_reset_value(){return S()},set handle_reset_value(i){S(i),o()},get handle_trim_video(){return D()},set handle_trim_video(i){D(i),o()},get processingVideo(){return T()},set processingVideo(i){T(i),o()},get i18n(){return w()},set i18n(i){w(i),o()},get value(){return _()},set value(i){_(i),o()},get show_download_button(){return m()},set show_download_button(i){m(i),o()},get handle_clear(){return y()},set handle_clear(i){y(i),o()},get has_change_history(){return P()},set has_change_history(i){P(i),o()}};he();var p=ht(),s=le(p);let l;var u=U(s);{var f=i=>{var x=ct(),W=U(x);vt(W,{get videoElement(){return r()},get dragStart(){return e(Q)},set dragStart(c){b(Q,c)},get dragEnd(){return e(G)},set dragEnd(c){b(G,c)},get trimmedDuration(){return e(h)},set trimmedDuration(c){b(h,c)},get loadingTimeline(){return e(q)},set loadingTimeline(c){b(q,c)},$$legacy:!0}),H(x),F(i,x)};Z(u,i=>{v()==="edit"&&i(f)})}var k=I(u,2),V=U(k);{var O=i=>{var x=gt(),W=le(x);let c;var M=U(W,!0);H(W);var ee=I(W,2),$=U(ee);let ae;var B=I($,2);let ie;H(ee),ue(ve=>{c=ge(W,1,"svelte-1orxdv",null,c,{hidden:e(q)}),De(M,ve),ae=ge($,1,"text-button svelte-1orxdv",null,ae,{hidden:e(q)}),ie=ge(B,1,"text-button svelte-1orxdv",null,ie,{hidden:e(q)})},[()=>(C(de),e(h),Y(()=>de(e(h))))]),j("click",$,()=>{v(""),T(!0),lt(e(A),e(Q),e(G),r()).then(ve=>{D()(ve)}).then(()=>{T(!1)})}),j("click",B,K),F(i,x)},g=i=>{var x=_t();F(i,x)};Z(V,i=>{v()==="edit"&&e(h)!==null?i(O):i(g,!1)})}H(k),H(s);var X=I(s,2);{let i=oe(()=>(C(m()),C(_()),Y(()=>m()?_()?.url:null)));ot(X,{get i18n(){return w()},get download(){return e(i)},$$events:{clear:()=>y()()},children:(x,W)=>{var c=mt(),M=le(c);{var ee=B=>{{let ie=oe(()=>T()||!P());Ee(B,{get Icon(){return Re},label:"Reset video to initial value",get disabled(){return e(ie)},$$events:{click:()=>{S()(),v("")}}})}};Z(M,B=>{E()&&v()===""&&B(ee)})}var $=I(M,2);{var ae=B=>{Ee(B,{get Icon(){return et},label:"Trim video to selection",get disabled(){return T()},$$events:{click:K}})};Z($,B=>{L()&&v()===""&&B(ae)})}F(x,c)},$$slots:{default:!0}})}return ue(()=>l=ge(s,1,"container svelte-1orxdv",null,l,{hidden:v()!=="edit"})),F(ne,p),we(R)}var bt=z('<track kind="captions" default/>'),wt=z('<div class="wrap svelte-1k28h7x"><div><!></div> <div class="controls svelte-1k28h7x"><div class="inner svelte-1k28h7x"><span role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="play-pause-replay-button"><!></span> <span class="time svelte-1k28h7x"> </span>  <progress class="svelte-1k28h7x"></progress> <div role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="full-screen"><!></div></div></div></div> <!>',1);function yt(ne,t){fe(t,!1);let r=n(t,"root",12,""),E=n(t,"src",12),L=n(t,"subtitle",12,null),v=n(t,"mirror",12),S=n(t,"autoplay",12),D=n(t,"loop",12),T=n(t,"label",12,"test"),w=n(t,"interactive",12,!1),_=n(t,"handle_change",12,()=>{}),m=n(t,"handle_reset_value",12,()=>{}),y=n(t,"upload",12),P=n(t,"is_stream",12),A=n(t,"i18n",12),h=n(t,"show_download_button",12,!1),Q=n(t,"value",12,null),G=n(t,"handle_clear",12,()=>{}),q=n(t,"has_change_history",12,!1);const K=Pe();let R=N(0),p=N(),s=N(!0),l=N(),u=N(!1);function f(a){if(!e(p))return;if(a.type==="click"){V(a);return}if(a.type!=="touchmove"&&!(a.buttons&1))return;const d=a.type==="touchmove"?a.touches[0].clientX:a.clientX,{left:te,right:re}=a.currentTarget.getBoundingClientRect();b(R,e(p)*(d-te)/(re-te))}async function k(){document.fullscreenElement!=e(l)&&(e(l).currentTime>0&&!e(l).paused&&!e(l).ended&&e(l).readyState>e(l).HAVE_CURRENT_DATA?e(l).pause():await e(l).play())}function V(a){const{left:d,right:te}=a.currentTarget.getBoundingClientRect();b(R,e(p)*(a.clientX-d)/(te-d))}function O(){K("stop"),K("end")}const g=async a=>{let d=new File([a],"video.mp4");const te=await Fe([d]);let re=(await y()(te,r()))?.filter(Boolean)[0];_()(re)};function X(){e(l).requestFullscreen()}_e(()=>e(R),()=>{b(R,e(R)||0)}),_e(()=>e(p),()=>{b(p,e(p)||0)}),be();var i={get root(){return r()},set root(a){r(a),o()},get src(){return E()},set src(a){E(a),o()},get subtitle(){return L()},set subtitle(a){L(a),o()},get mirror(){return v()},set mirror(a){v(a),o()},get autoplay(){return S()},set autoplay(a){S(a),o()},get loop(){return D()},set loop(a){D(a),o()},get label(){return T()},set label(a){T(a),o()},get interactive(){return w()},set interactive(a){w(a),o()},get handle_change(){return _()},set handle_change(a){_(a),o()},get handle_reset_value(){return m()},set handle_reset_value(a){m(a),o()},get upload(){return y()},set upload(a){y(a),o()},get is_stream(){return P()},set is_stream(a){P(a),o()},get i18n(){return A()},set i18n(a){A(a),o()},get show_download_button(){return h()},set show_download_button(a){h(a),o()},get value(){return Q()},set value(a){Q(a),o()},get handle_clear(){return G()},set handle_clear(a){G(a),o()},get has_change_history(){return q()},set has_change_history(a){q(a),o()}};he();var x=wt(),W=le(x),c=U(W);let M;var ee=U(c);{let a=oe(()=>`${T()}-player`);nt(ee,{get src(){return E()},preload:"auto",get autoplay(){return S()},get loop(){return D()},get is_stream(){return P()},get"data-testid"(){return e(a)},get processingVideo(){return e(u)},get currentTime(){return e(R)},set currentTime(d){b(R,d)},get duration(){return e(p)},set duration(d){b(p,d)},get paused(){return e(s)},set paused(d){b(s,d)},get node(){return e(l)},set node(d){b(l,d)},$$events:{click:k,play(d){J.call(this,t,d)},pause(d){J.call(this,t,d)},error(d){J.call(this,t,d)},ended:O,loadstart(d){J.call(this,t,d)},loadeddata(d){J.call(this,t,d)},loadedmetadata(d){J.call(this,t,d)}},children:(d,te)=>{var re=bt();ue(()=>ke(re,"src",L())),F(d,re)},$$slots:{default:!0},$$legacy:!0})}H(c);var $=I(c,2),ae=U($),B=U(ae),ie=U(B);{var ve=a=>{Re(a)},Le=a=>{var d=je(),te=le(d);{var re=se=>{at(se)},Ae=se=>{tt(se)};Z(te,se=>{e(s)?se(re):se(Ae,!1)},!0)}F(a,d)};Z(ie,a=>{e(R)===e(p)?a(ve):a(Le,!1)})}H(B);var ye=I(B,2),Se=U(ye);H(ye);var ce=I(ye,2),me=I(ce,2),Me=U(me);$e(Me),H(me),H(ae),H($),H(W);var Be=I(W,2);{var Ie=a=>{ft(a,{get videoElement(){return e(l)},showRedo:!0,handle_trim_video:g,get handle_reset_value(){return m()},get value(){return Q()},get i18n(){return A()},get show_download_button(){return h()},get handle_clear(){return G()},get has_change_history(){return q()},get processingVideo(){return e(u)},set processingVideo(d){b(u,d)},$$legacy:!0})};Z(Be,a=>{w()&&a(Ie)})}return ue((a,d)=>{M=ge(c,1,"mirror-wrap svelte-1k28h7x",null,M,{mirror:v()}),De(Se,`${a??""} / ${d??""}`),Ue(ce,e(R)/e(p)||0)},[()=>(C(de),e(R),Y(()=>de(e(R)))),()=>(C(de),e(p),Y(()=>de(e(p))))]),j("click",B,k),j("keydown",B,k),j("mousemove",ce,f),j("touchmove",ce,Ve(f)),j("click",ce,Ve(Ze(V))),j("click",me,X),j("keypress",me,X),F(ne,x),we(i)}var pt=z("<!> <!>",1),kt=z('<!> <div data-testid="download-div"><!></div>',1),xt=z("<!> <!>",1);function Et(ne,t){fe(t,!1);let r=n(t,"value",12,null),E=n(t,"subtitle",12,null),L=n(t,"label",12,void 0),v=n(t,"show_label",12,!0),S=n(t,"autoplay",12),D=n(t,"show_share_button",12,!0),T=n(t,"show_download_button",12,!0),w=n(t,"loop",12),_=n(t,"i18n",12),m=n(t,"upload",12),y=n(t,"display_icon_button_wrapper_top_corner",12,!1),P=null,A=null;const h=Pe();qe(async()=>{r()!==P&&E()!==A&&A!==null&&(P=r(),r(null),await ze(),r(P)),P=r(),A=E()}),_e(()=>C(r()),()=>{r()&&h("change",r())}),be();var Q={get value(){return r()},set value(s){r(s),o()},get subtitle(){return E()},set subtitle(s){E(s),o()},get label(){return L()},set label(s){L(s),o()},get show_label(){return v()},set show_label(s){v(s),o()},get autoplay(){return S()},set autoplay(s){S(s),o()},get show_share_button(){return D()},set show_share_button(s){D(s),o()},get show_download_button(){return T()},set show_download_button(s){T(s),o()},get loop(){return w()},set loop(s){w(s),o()},get i18n(){return _()},set i18n(s){_(s),o()},get upload(){return m()},set upload(s){m(s),o()},get display_icon_button_wrapper_top_corner(){return y()},set display_icon_button_wrapper_top_corner(s){y(s),o()}};he();var G=xt(),q=le(G);{let s=oe(()=>L()||"Video");We(q,{get show_label(){return v()},get Icon(){return Te},get label(){return e(s)}})}var K=I(q,2);{var R=s=>{Qe(s,{unpadded_box:!0,size:"large",children:(l,u)=>{Te(l)},$$slots:{default:!0}})},p=s=>{var l=kt(),u=le(l);Oe(u,()=>(C(r()),Y(()=>r().url)),V=>{{let O=oe(()=>(C(E()),Y(()=>E()?.url)));yt(V,{get src(){return C(r()),Y(()=>r().url)},get subtitle(){return e(O)},get is_stream(){return C(r()),Y(()=>r().is_stream)},get autoplay(){return S()},mirror:!1,get label(){return L()},get loop(){return w()},interactive:!1,get upload(){return m()},get i18n(){return _()},$$events:{play(g){J.call(this,t,g)},pause(g){J.call(this,t,g)},stop(g){J.call(this,t,g)},end(g){J.call(this,t,g)},loadedmetadata:()=>{h("load")}}})}});var f=I(u,2),k=U(f);Ke(k,{get display_top_corner(){return y()},children:(V,O)=>{var g=pt(),X=le(g);{var i=c=>{{let M=oe(()=>(C(r()),Y(()=>r().is_stream?r().url?.replace("playlist.m3u8","playlist-file"):r().url))),ee=oe(()=>(C(r()),Y(()=>r().orig_name||r().path)));Ne(c,{get href(){return e(M)},get download(){return e(ee)},children:($,ae)=>{Ee($,{get Icon(){return Je},label:"Download"})},$$slots:{default:!0}})}};Z(X,c=>{T()&&c(i)})}var x=I(X,2);{var W=c=>{Ge(c,{get i18n(){return _()},get value(){return r()},formatter:async M=>M?await Ye(M.data):"",$$events:{error(M){J.call(this,t,M)},share(M){J.call(this,t,M)}}})};Z(x,c=>{D()&&c(W)})}F(V,g)},$$slots:{default:!0}}),H(f),F(s,l)};Z(K,s=>{C(r()),Y(()=>!r()||r().url===void 0)?s(R):s(p,!1)})}return F(ne,G),we(Q)}const Gt=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{yt as P,Et as V,Gt as a};
//# sourceMappingURL=VideoPreview-C6GU7IP2.js.map
