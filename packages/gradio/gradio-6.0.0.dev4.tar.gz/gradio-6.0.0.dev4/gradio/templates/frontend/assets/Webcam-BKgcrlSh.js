import{d as Ie,c as Fe,p as h,e as Ne,i as U,a as ye,b as xe,t as Ve,G as Ge,u as Qe}from"./i18n-5O2R8uRh.js";import{n as Me,b as d,p as We,R as Re,f as x,h as s,r as n,s as T,e as $,c as Se,ac as Xe,ai as Je,t as q,g as w,i as t,m as P,j as D,Q as R,d as V,aB as Ke,U as Z,X as ge,O as Ye,k as G}from"./index-bhUlIv2p.js";import{a as Ze}from"./actions-CwcOrYgf.js";import{t as $e,f as et}from"./index-VAFKmIBi.js";import{b as tt}from"./props-BmhlB8PY.js";import{D as at}from"./DropdownArrow-CjmTE0-H.js";/* empty css                                                        */import{S as rt}from"./Square-CArgr-u_.js";import{W as it,S as ot}from"./Spinner-laNWWtqG.js";/* empty css                                                   */import"./MarkdownCode.svelte_svelte_type_style_lang-ywXsGwHK.js";import{S as st}from"./StreamingBar-C_AQhOWl.js";/* empty css                                                    */var nt=Me('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-camera"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>');function lt(g){var a=nt();d(g,a)}var ct=Me('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-circle"><circle cx="12" cy="12" r="10"></circle></svg>');function vt(g){var a=ct();d(g,a)}var dt=x('<button class="svelte-1dqolfz"><div class="wrap svelte-1dqolfz"><span class="icon-wrap svelte-1dqolfz"><!></span> </div></button>');function mt(g,a){We(a,!1);const i=Re();Ie();var o=dt();Fe(o,"",{},{height:"100%"});var I=s(o),b=s(I),j=s(b);it(j),n(b);var m=T(b);m.nodeValue=" Click to Access Webcam",n(I),n(o),$("click",o,()=>i("click")),d(g,o),Se()}function ut(){return navigator.mediaDevices.enumerateDevices()}function _t(g,a){a.srcObject=g,a.muted=!0,a.play()}async function De(g,a,i,o){const I={video:o?{deviceId:{exact:o},...i?.video}:i?.video||{width:{ideal:1920},height:{ideal:1440}},audio:g&&(i?.audio??!0)};return navigator.mediaDevices.getUserMedia(I).then(b=>(_t(b,a),b))}function ft(g){return g.filter(i=>i.kind==="videoinput")}var gt=x('<div title="grant webcam access" style="height: 100%"><!></div>'),pt=x('<div class="icon-with-text svelte-1tktvmr" style="width:var(--size-24);"><div class="icon color-primary svelte-1tktvmr" title="spinner"><!></div> </div>'),ht=x('<div class="icon-with-text svelte-1tktvmr"><div class="icon color-primary svelte-1tktvmr" title="stop recording"><!></div> </div>'),wt=x('<div class="icon-with-text svelte-1tktvmr"><div class="icon color-primary svelte-1tktvmr" title="start recording"><!></div> </div>'),bt=x('<div class="icon svelte-1tktvmr" title="capture photo"><!></div>'),kt=x('<button class="icon svelte-1tktvmr" aria-label="select input source"><!></button>'),yt=x('<option class="svelte-1tktvmr"> </option>'),xt=x('<option class="svelte-1tktvmr"> </option>'),Dt=x('<select class="select-wrap svelte-1tktvmr" aria-label="select source"><!></select>'),It=x('<div class="button-wrap svelte-1tktvmr"><button class="svelte-1tktvmr"><!></button> <!></div> <!>',1),Mt=x('<div class="wrap svelte-1tktvmr"><!>  <video></video> <img/> <!></div>',2);function Ht(g,a){We(a,!1);let i=P(),o=P([]),I=P(null),b=h(a,"stream_state",12,"closed"),j,m=h(a,"streaming",12,!1),ee=h(a,"pending",12,!1),te=h(a,"root",12,""),ae=h(a,"stream_every",12,1),C=h(a,"mode",12,"image"),Q=h(a,"mirror_webcam",12),X=h(a,"include_audio",12),J=h(a,"webcam_constraints",12,null),k=h(a,"i18n",12),re=h(a,"upload",12),A=h(a,"value",12,null),ie=h(a,"time_limit",12,null);const B=Re();Xe(()=>{j=document.createElement("canvas"),m()&&C()==="image"&&window.setInterval(()=>{t(i)&&!ee()&&pe()},ae()*1e3)});const Ee=async e=>{const l=e.target.value;await De(X(),t(i),J(),l).then(async p=>{H=p,D(I,t(o).find(N=>N.deviceId===l)||null),D(Y,!1)})};async function Te(){try{De(X(),t(i),J()).then(async e=>{D(O,!0),D(o,await ut()),H=e}).then(()=>ft(t(o))).then(e=>{D(o,e);const r=H.getTracks().map(l=>l.getSettings()?.deviceId)[0];D(I,r?e.find(l=>l.deviceId===r)||t(o)[0]:t(o)[0])}),(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)&&B("error",k()("image.no_webcam_support"))}catch(e){if(e instanceof DOMException&&e.name=="NotAllowedError")B("error",k()("image.allow_webcam_access"));else throw e}}function pe(){if((!m()||m()&&t(M))&&t(i).videoWidth&&t(i).videoHeight){console.log("Taking picture from webcam");var e=j.getContext("2d");if(j.width=t(i).videoWidth,j.height=t(i).videoHeight,e.drawImage(t(i),0,0,t(i).videoWidth,t(i).videoHeight),Q()&&(e.scale(-1,1),e.drawImage(t(i),-t(i).videoWidth,0)),m()&&(!t(M)||b()==="waiting"))return;if(m()){const r=j.toDataURL("image/jpeg");B("stream",r);return}j.toBlob(r=>{B(m()?"stream":"capture",r)},`image/${m()?"jpeg":"png"}`,.8)}}let M=P(!1),oe=[],H,F,K;function je(){if(t(M)){K.stop();let e=new Blob(oe,{type:F}),r=new FileReader;r.onload=async function(l){if(l.target){let p=new File([e],"sample."+F.substring(6));const N=await Ke([p]);let ve=(await re()(N,te()))?.filter(Boolean)[0];B("capture",ve),B("stop_recording")}},r.readAsDataURL(e)}else if(typeof MediaRecorder<"u"){B("start_recording"),oe=[];let e=["video/webm","video/mp4"];for(let r of e)if(MediaRecorder.isTypeSupported(r)){F=r;break}if(F===null){console.error("No supported MediaRecorder mimeType");return}K=new MediaRecorder(H,{mimeType:F}),K.addEventListener("dataavailable",function(r){oe.push(r.data)}),K.start(200)}D(M,!t(M))}let O=P(!1);function he({destroy:e}={}){C()==="image"&&m()&&D(M,!t(M)),e||(C()==="image"?pe():je()),!t(M)&&H&&B("close_stream")}let Y=P(!1);function se(e,r){const l=p=>{e&&!e.contains(p.target)&&!p.defaultPrevented&&r(p)};return document.addEventListener("click",l,!0),{destroy(){document.removeEventListener("click",l,!0)}}}function Be(e){e.preventDefault(),e.stopPropagation(),D(Y,!1)}Je(()=>{typeof window>"u"||(he({destroy:!0}),H?.getTracks().forEach(e=>e.stop()))});var Ce={click_outside:se,get stream_state(){return b()},set stream_state(e){b(e),w()},get streaming(){return m()},set streaming(e){m(e),w()},get pending(){return ee()},set pending(e){ee(e),w()},get root(){return te()},set root(e){te(e),w()},get stream_every(){return ae()},set stream_every(e){ae(e),w()},get mode(){return C()},set mode(e){C(e),w()},get mirror_webcam(){return Q()},set mirror_webcam(e){Q(e),w()},get include_audio(){return X()},set include_audio(e){X(e),w()},get webcam_constraints(){return J()},set webcam_constraints(e){J(e),w()},get i18n(){return k()},set i18n(e){k(e),w()},get upload(){return re()},set upload(e){re(e),w()},get value(){return A()},set value(e){A(e),w()},get time_limit(){return ie()},set time_limit(e){ie(e),w()}};Ie();var ne=Mt(),we=s(ne);st(we,{get time_limit(){return ie()}});var le=T(we,2);let be;Ne(le,e=>D(i,e),()=>t(i));var ce=T(le,2);let ke;var ze=T(ce,2);{var Le=e=>{var r=gt(),l=s(r);mt(l,{$$events:{click:async()=>Te()}}),n(r),$e(1,r,()=>et,()=>({delay:100,duration:200})),d(e,r)},Ue=e=>{var r=It(),l=Z(r),p=s(l),N=s(p);{var ve=f=>{var c=ge(),z=Z(c);{var de=u=>{var v=pt(),S=s(v),L=s(S);ot(L),n(S);var y=T(S);n(v),q(_=>G(y,` ${_??""}`),[()=>(V(k()),R(()=>k()("audio.waiting")))]),d(u,v)},me=u=>{var v=ge(),S=Z(v);{var L=_=>{var E=ht(),W=s(E),ue=s(W);rt(ue,{}),n(W);var _e=T(W);n(E),q(fe=>G(_e,` ${fe??""}`),[()=>(V(k()),R(()=>k()("audio.stop")))]),d(_,E)},y=_=>{var E=wt(),W=s(E),ue=s(W);vt(ue),n(W);var _e=T(W);n(E),q(fe=>G(_e,` ${fe??""}`),[()=>(V(k()),R(()=>k()("audio.record")))]),d(_,E)};U(S,_=>{m()&&b()==="open"||!m()&&t(M)?_(L):_(y,!1)},!0)}d(u,v)};U(z,u=>{m()&&b()==="waiting"?u(de):u(me,!1)})}d(f,c)},qe=f=>{var c=bt(),z=s(c);lt(z),n(c),d(f,c)};U(N,f=>{C()==="video"||m()?f(ve):f(qe,!1)})}n(p);var Ae=T(p,2);{var He=f=>{var c=kt(),z=s(c);at(z),n(c),$("click",c,()=>D(Y,!0)),d(f,c)};U(Ae,f=>{t(M)||f(He)})}n(l);var Oe=T(l,2);{var Pe=f=>{var c=Dt(),z=s(c);{var de=u=>{var v=yt(),S=s(v,!0);n(v),v.value=v.__value="",q(L=>G(S,L),[()=>(V(k()),R(()=>k()("common.no_devices")))]),d(u,v)},me=u=>{var v=ge(),S=Z(v);Ve(S,1,()=>t(o),Qe,(L,y)=>{var _=xt(),E=s(_,!0);n(_);var W={};q(()=>{Ge(_,(t(I),t(y),R(()=>t(I).deviceId===t(y).deviceId))),G(E,(t(y),R(()=>t(y).label))),W!==(W=(t(y),R(()=>t(y).deviceId)))&&(_.value=(_.__value=(t(y),R(()=>t(y).deviceId)))??"")}),d(L,_)}),d(u,v)};U(z,u=>{t(o),R(()=>t(o).length===0)?u(de):u(me,!1)})}n(c),Ze(c,(u,v)=>se?.(u,v),()=>Be),Ye(()=>$("change",c,Ee)),d(f,c)};U(Oe,f=>{t(Y)&&t(I)&&f(Pe)})}q(()=>xe(p,"aria-label",C()==="image"?"capture photo":"start recording")),$("click",p,()=>he()),d(e,r)};U(ze,e=>{t(O)?e(Ue,!1):e(Le)})}return n(ne),q(()=>{be=ye(le,1,"svelte-1tktvmr",null,be,{flip:Q(),hide:!t(O)||t(O)&&!!A()}),xe(ce,"src",(V(A()),R(()=>A()?.url))),ke=ye(ce,1,"svelte-1tktvmr",null,ke,{hide:!t(O)||t(O)&&!A()})}),d(g,ne),tt(a,"click_outside",se),Se(Ce)}export{vt as C,Ht as W};
//# sourceMappingURL=Webcam-BKgcrlSh.js.map
