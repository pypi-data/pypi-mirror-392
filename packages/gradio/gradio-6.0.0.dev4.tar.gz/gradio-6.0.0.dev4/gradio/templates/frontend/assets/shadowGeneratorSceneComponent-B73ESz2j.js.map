{"version":3,"file":"shadowGeneratorSceneComponent-B73ESz2j.js","sources":["../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent.js"],"sourcesContent":["import { ShadowGenerator } from \"./shadowGenerator.js\";\nimport { CascadedShadowGenerator } from \"./cascadedShadowGenerator.js\";\nimport { SceneComponentConstants } from \"../../sceneComponent.js\";\nimport { AddParser } from \"../../Loading/Plugins/babylonFileParser.function.js\";\n// Adds the parser to the scene parsers.\nAddParser(SceneComponentConstants.NAME_SHADOWGENERATOR, (parsedData, scene) => {\n    // Shadows\n    if (parsedData.shadowGenerators !== undefined && parsedData.shadowGenerators !== null) {\n        for (let index = 0, cache = parsedData.shadowGenerators.length; index < cache; index++) {\n            const parsedShadowGenerator = parsedData.shadowGenerators[index];\n            if (parsedShadowGenerator.className === CascadedShadowGenerator.CLASSNAME) {\n                CascadedShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            else {\n                ShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            // SG would be available on their associated lights\n        }\n    }\n});\n/**\n * Defines the shadow generator component responsible to manage any shadow generators\n * in a given scene.\n */\nexport class ShadowGeneratorSceneComponent {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    constructor(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_SHADOWGENERATOR;\n        this.scene = scene;\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    register() {\n        this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR, this, this._gatherRenderTargets);\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    rebuild() {\n        // Nothing To Do Here.\n    }\n    /**\n     * Serializes the component data to the specified json object\n     * @param serializationObject The object to serialize to\n     */\n    serialize(serializationObject) {\n        // Shadows\n        serializationObject.shadowGenerators = [];\n        const lights = this.scene.lights;\n        for (const light of lights) {\n            if (light.doNotSerialize) {\n                continue;\n            }\n            const shadowGenerators = light.getShadowGenerators();\n            if (shadowGenerators) {\n                const iterator = shadowGenerators.values();\n                for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\n                    const shadowGenerator = key.value;\n                    if (shadowGenerator.doNotSerialize) {\n                        continue;\n                    }\n                    serializationObject.shadowGenerators.push(shadowGenerator.serialize());\n                }\n            }\n        }\n    }\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    addFromContainer(container) {\n        // Nothing To Do Here. (directly attached to a light)\n    }\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    removeFromContainer(container, dispose) {\n        // Nothing To Do Here. (directly attached to a light)\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    dispose() {\n        // Nothing To Do Here.\n    }\n    _gatherRenderTargets(renderTargets) {\n        // Shadows\n        const scene = this.scene;\n        if (this.scene.shadowsEnabled) {\n            for (let lightIndex = 0; lightIndex < scene.lights.length; lightIndex++) {\n                const light = scene.lights[lightIndex];\n                const shadowGenerators = light.getShadowGenerators();\n                if (light.isEnabled() && light.shadowEnabled && shadowGenerators) {\n                    const iterator = shadowGenerators.values();\n                    for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\n                        const shadowGenerator = key.value;\n                        const shadowMap = shadowGenerator.getShadowMap();\n                        if (scene.textures.indexOf(shadowMap) !== -1) {\n                            renderTargets.push(shadowMap);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\nShadowGenerator._SceneComponentInitialization = (scene) => {\n    let component = scene._getComponent(SceneComponentConstants.NAME_SHADOWGENERATOR);\n    if (!component) {\n        component = new ShadowGeneratorSceneComponent(scene);\n        scene._addComponent(component);\n    }\n};\n//# sourceMappingURL=shadowGeneratorSceneComponent.js.map"],"names":["ShadowGeneratorSceneComponent","scene","SceneComponentConstants","serializationObject","lights","light","shadowGenerators","iterator","key","shadowGenerator","container","dispose","renderTargets","lightIndex","shadowMap","ShadowGenerator","component"],"mappings":"4EAwBO,MAAMA,CAA8B,CAKvC,YAAYC,EAAO,CAIf,KAAK,KAAOC,EAAwB,qBACpC,KAAK,MAAQD,CACjB,CAIA,UAAW,CACP,KAAK,MAAM,0BAA0B,aAAaC,EAAwB,yCAA0C,KAAM,KAAK,oBAAoB,CACvJ,CAKA,SAAU,CAEV,CAKA,UAAUC,EAAqB,CAE3BA,EAAoB,iBAAmB,CAAA,EACvC,MAAMC,EAAS,KAAK,MAAM,OAC1B,UAAWC,KAASD,EAAQ,CACxB,GAAIC,EAAM,eACN,SAEJ,MAAMC,EAAmBD,EAAM,oBAAmB,EAClD,GAAIC,EAAkB,CAClB,MAAMC,EAAWD,EAAiB,OAAM,EACxC,QAASE,EAAMD,EAAS,OAAQC,EAAI,OAAS,GAAMA,EAAMD,EAAS,KAAI,EAAI,CACtE,MAAME,EAAkBD,EAAI,MACxBC,EAAgB,gBAGpBN,EAAoB,iBAAiB,KAAKM,EAAgB,UAAS,CAAE,CACzE,CACJ,CACJ,CACJ,CAMA,iBAAiBC,EAAW,CAE5B,CAOA,oBAAoBA,EAAWC,EAAS,CAExC,CAKA,SAAU,CAEV,CACA,qBAAqBC,EAAe,CAEhC,MAAMX,EAAQ,KAAK,MACnB,GAAI,KAAK,MAAM,eACX,QAASY,EAAa,EAAGA,EAAaZ,EAAM,OAAO,OAAQY,IAAc,CACrE,MAAMR,EAAQJ,EAAM,OAAOY,CAAU,EAC/BP,EAAmBD,EAAM,oBAAmB,EAClD,GAAIA,EAAM,UAAS,GAAMA,EAAM,eAAiBC,EAAkB,CAC9D,MAAMC,EAAWD,EAAiB,OAAM,EACxC,QAASE,EAAMD,EAAS,OAAQC,EAAI,OAAS,GAAMA,EAAMD,EAAS,KAAI,EAAI,CAEtE,MAAMO,EADkBN,EAAI,MACM,aAAY,EAC1CP,EAAM,SAAS,QAAQa,CAAS,IAAM,IACtCF,EAAc,KAAKE,CAAS,CAEpC,CACJ,CACJ,CAER,CACJ,CACAC,EAAgB,8BAAiCd,GAAU,CACvD,IAAIe,EAAYf,EAAM,cAAcC,EAAwB,oBAAoB,EAC3Ec,IACDA,EAAY,IAAIhB,EAA8BC,CAAK,EACnDA,EAAM,cAAce,CAAS,EAErC","x_google_ignoreList":[0]}