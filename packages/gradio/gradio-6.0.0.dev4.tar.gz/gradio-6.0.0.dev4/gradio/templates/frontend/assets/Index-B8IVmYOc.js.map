{"version":3,"file":"Index-B8IVmYOc.js","sources":["../../../../js/draggable/Index.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport type { DraggableProps, DraggableEvents } from \"./types\";\n\timport { Gradio } from \"@gradio/utils\";\n\timport { StatusTracker } from \"@gradio/statustracker\";\n\timport { onMount, tick } from \"svelte\";\n\n\tconst props = $props();\n\tconst gradio = new Gradio<DraggableEvents, DraggableProps>(props);\n\n\tlet container_el: HTMLDivElement;\n\tlet dragged_el: HTMLElement | null = null;\n\tlet dragged_index = -1;\n\tlet items: HTMLElement[] = [];\n\tlet current_drop_target: HTMLElement | null = null;\n\n\tconst drag_event_handlers = [\n\t\t{ event: \"dragstart\", handler: handle_drag_start },\n\t\t{ event: \"dragend\", handler: handle_drag_end }\n\t] as const;\n\n\tconst drop_event_handlers = [\n\t\t{ event: \"dragover\", handler: handle_drag_over },\n\t\t{ event: \"drop\", handler: handle_drop },\n\t\t{ event: \"dragenter\", handler: handle_drag_enter }\n\t] as const;\n\n\tfunction add_drag_listeners(element: HTMLElement): void {\n\t\tdrag_event_handlers.forEach(({ event, handler }) => {\n\t\t\telement.addEventListener(event, handler);\n\t\t});\n\t}\n\n\tfunction remove_drag_listeners(element: HTMLElement): void {\n\t\tdrag_event_handlers.forEach(({ event, handler }) => {\n\t\t\telement.removeEventListener(event, handler);\n\t\t});\n\t}\n\n\tfunction add_drop_listeners(element: HTMLElement): void {\n\t\tdrop_event_handlers.forEach(({ event, handler }) => {\n\t\t\telement.addEventListener(event, handler);\n\t\t});\n\t}\n\n\tfunction remove_drop_listeners(element: HTMLElement): void {\n\t\tdrop_event_handlers.forEach(({ event, handler }) => {\n\t\t\telement.removeEventListener(event, handler);\n\t\t});\n\t}\n\n\tfunction setup_draggable_item(element: HTMLElement, index: number): void {\n\t\telement.classList.add(\"draggable-item\");\n\t\telement.setAttribute(\"data-index\", index.toString());\n\t\telement.style.position = \"relative\";\n\n\t\tconst handle = document.createElement(\"div\");\n\t\thandle.className = \"drag-handle\";\n\t\thandle.setAttribute(\"draggable\", \"true\");\n\t\thandle.setAttribute(\"aria-grabbed\", \"false\");\n\t\thandle.setAttribute(\"data-index\", index.toString());\n\t\thandle.innerHTML = \"⋮⋮\";\n\n\t\telement.appendChild(handle);\n\t\tadd_drag_listeners(handle);\n\t\tadd_drop_listeners(element);\n\t}\n\n\tfunction setup_drag_and_drop(): void {\n\t\tif (!container_el) return;\n\n\t\titems.forEach((item) => {\n\t\t\tconst handle = item.querySelector(\".drag-handle\");\n\t\t\tif (handle) {\n\t\t\t\tremove_drag_listeners(handle as HTMLElement);\n\t\t\t\thandle.remove();\n\t\t\t}\n\t\t\tremove_drop_listeners(item);\n\t\t});\n\t\titems = [];\n\n\t\tconst children = Array.from(container_el.children) as HTMLElement[];\n\t\tlet item_index = 0;\n\n\t\tchildren.forEach((child) => {\n\t\t\tif (child.classList.contains(\"status-tracker\")) return;\n\n\t\t\tif (child.classList.contains(\"form\") && child.children.length > 0) {\n\t\t\t\tconst form_children = Array.from(child.children) as HTMLElement[];\n\t\t\t\tform_children.forEach((form_child) => {\n\t\t\t\t\titems.push(form_child);\n\t\t\t\t\tsetup_draggable_item(form_child, item_index);\n\t\t\t\t\titem_index++;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\titems.push(child);\n\t\t\t\tsetup_draggable_item(child, item_index);\n\t\t\t\titem_index++;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handle_drag_start(e: DragEvent): void {\n\t\te.stopPropagation?.();\n\n\t\tconst handle = e.currentTarget as HTMLElement;\n\t\tconst element = handle.parentElement as HTMLElement;\n\t\tdragged_el = element;\n\t\tdragged_index = parseInt(handle.dataset.index || \"-1\");\n\n\t\thandle.setAttribute(\"aria-grabbed\", \"true\");\n\t\telement.classList.add(\"dragging\");\n\n\t\tif (e.dataTransfer) {\n\t\t\te.dataTransfer.effectAllowed = \"move\";\n\t\t\te.dataTransfer.setData(\"text/html\", element.outerHTML);\n\t\t\te.dataTransfer.setDragImage(element, 10, 10);\n\t\t}\n\t}\n\n\tfunction handle_drag_end(e: DragEvent): void {\n\t\te.stopPropagation?.();\n\n\t\tconst handle = e.currentTarget as HTMLElement;\n\t\tconst element = handle.parentElement as HTMLElement;\n\t\telement.classList.remove(\"dragging\");\n\t\thandle.setAttribute(\"aria-grabbed\", \"false\");\n\n\t\tif (current_drop_target) {\n\t\t\tcurrent_drop_target.classList.remove(\"drop-target\");\n\t\t\tcurrent_drop_target = null;\n\t\t}\n\n\t\tdragged_el = null;\n\t\tdragged_index = -1;\n\t}\n\n\tfunction handle_drag_over(e: DragEvent): boolean {\n\t\te.preventDefault();\n\t\te.dataTransfer && (e.dataTransfer.dropEffect = \"move\");\n\t\treturn false;\n\t}\n\n\tfunction handle_drag_enter(e: DragEvent): void {\n\t\te.stopPropagation?.();\n\n\t\tconst target = e.currentTarget as HTMLElement;\n\t\tif (target === dragged_el) return;\n\n\t\tif (!dragged_el || !container_el) return;\n\n\t\tconst dragged_parent = dragged_el.parentElement;\n\t\tconst target_parent = target.parentElement;\n\n\t\tconst is_dragged_in_form =\n\t\t\tdragged_parent?.classList.contains(\"form\") &&\n\t\t\tdragged_parent.parentElement === container_el;\n\t\tconst is_target_in_form =\n\t\t\ttarget_parent?.classList.contains(\"form\") &&\n\t\t\ttarget_parent.parentElement === container_el;\n\t\tconst is_dragged_direct = dragged_parent === container_el;\n\t\tconst is_target_direct = target_parent === container_el;\n\n\t\tif (\n\t\t\t!(\n\t\t\t\t(is_dragged_in_form || is_dragged_direct) &&\n\t\t\t\t(is_target_in_form || is_target_direct)\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (current_drop_target && current_drop_target !== target) {\n\t\t\tcurrent_drop_target.classList.remove(\"drop-target\");\n\t\t}\n\n\t\ttarget.classList.add(\"drop-target\");\n\t\tcurrent_drop_target = target;\n\t}\n\n\tasync function handle_drop(e: DragEvent): Promise<boolean> {\n\t\te.stopPropagation?.();\n\n\t\tconst target = e.currentTarget as HTMLElement;\n\t\ttarget.classList.remove(\"drop-target\");\n\n\t\tif (current_drop_target) {\n\t\t\tcurrent_drop_target.classList.remove(\"drop-target\");\n\t\t\tcurrent_drop_target = null;\n\t\t}\n\n\t\tif (dragged_el && dragged_el !== target && container_el) {\n\t\t\tconst dragged_parent = dragged_el.parentElement;\n\t\t\tconst target_parent = target.parentElement;\n\n\t\t\tconst is_dragged_in_form =\n\t\t\t\tdragged_parent?.classList.contains(\"form\") &&\n\t\t\t\tdragged_parent.parentElement === container_el;\n\t\t\tconst is_target_in_form =\n\t\t\t\ttarget_parent?.classList.contains(\"form\") &&\n\t\t\t\ttarget_parent.parentElement === container_el;\n\t\t\tconst is_dragged_direct = dragged_parent === container_el;\n\t\t\tconst is_target_direct = target_parent === container_el;\n\n\t\t\tif (\n\t\t\t\t!(\n\t\t\t\t\t(is_dragged_in_form || is_dragged_direct) &&\n\t\t\t\t\t(is_target_in_form || is_target_direct)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst placeholder = document.createElement(\"div\");\n\t\t\tplaceholder.style.display = \"none\";\n\n\t\t\tdragged_parent!.insertBefore(placeholder, dragged_el);\n\n\t\t\ttarget_parent!.insertBefore(dragged_el, target);\n\t\t\tdragged_parent!.insertBefore(target, placeholder);\n\n\t\t\tplaceholder.remove();\n\n\t\t\tdragged_el?.classList.remove(\"dragging\");\n\t\t\tconst dragged_handle = dragged_el?.querySelector(\n\t\t\t\t\".drag-handle\"\n\t\t\t) as HTMLElement;\n\t\t\tif (dragged_handle) {\n\t\t\t\tdragged_handle.setAttribute(\"aria-grabbed\", \"false\");\n\t\t\t}\n\n\t\t\tawait tick();\n\t\t\tsetup_drag_and_drop();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonMount(() => {\n\t\tsetup_drag_and_drop();\n\n\t\tconst observer = new MutationObserver(setup_drag_and_drop);\n\n\t\tif (container_el) {\n\t\t\tobserver.observe(container_el, {\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: false\n\t\t\t});\n\t\t}\n\n\t\treturn () => {\n\t\t\tobserver.disconnect();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst handle = item.querySelector(\".drag-handle\");\n\t\t\t\tif (handle) {\n\t\t\t\t\tremove_drag_listeners(handle as HTMLElement);\n\t\t\t\t}\n\t\t\t\tremove_drop_listeners(item);\n\t\t\t});\n\t\t};\n\t});\n</script>\n\n<div\n\tbind:this={container_el}\n\tclass:hide={!gradio.shared.visible}\n\tclass:horizontal={gradio.props.orientation === \"row\"}\n\tclass:vertical={gradio.props.orientation === \"column\"}\n\tid={gradio.shared.elem_id}\n\tclass=\"draggable {(gradio.shared.elem_classes || []).join(' ')}\"\n\trole=\"region\"\n\taria-label=\"Draggable items container\"\n>\n\t{#if gradio.shared.loading_status && gradio.props.show_progress}\n\t\t<StatusTracker\n\t\t\tautoscroll={gradio.shared.autoscroll}\n\t\t\ti18n={gradio.i18n}\n\t\t\t{...gradio.shared.loading_status}\n\t\t\tstatus={gradio.shared.loading_status\n\t\t\t\t? gradio.shared.loading_status.status == \"pending\"\n\t\t\t\t\t? \"generating\"\n\t\t\t\t\t: gradio.shared.loading_status.status\n\t\t\t\t: null}\n\t\t/>\n\t{/if}\n\t<slot />\n</div>\n\n<style>\n\t.draggable {\n\t\tdisplay: flex;\n\t\tgap: var(--layout-gap);\n\t\twidth: var(--size-full);\n\t\tposition: relative;\n\t}\n\n\t.horizontal {\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t}\n\n\t.vertical {\n\t\tflex-direction: column;\n\t}\n\n\t.hide {\n\t\tdisplay: none;\n\t}\n\n\t.draggable > :global(.draggable-item),\n\t.draggable > :global(.form > .draggable-item) {\n\t\ttransition:\n\t\t\ttransform 0.2s ease,\n\t\t\tborder 0.2s ease;\n\t}\n\n\t.draggable > :global(.draggable-item.drop-target),\n\t.draggable > :global(.form > .draggable-item.drop-target) {\n\t\tborder: 2px dashed var(--border-color-primary) !important;\n\t\tborder-radius: 8px;\n\t\ttransform: scale(0.98);\n\t\topacity: 0.8;\n\t}\n\n\t.draggable > :global(.draggable-item.dragging),\n\t.draggable > :global(.form > .draggable-item.dragging) {\n\t\topacity: 0.5;\n\t\ttransform: scale(1.02);\n\t\tz-index: 1001;\n\t}\n\n\t.draggable > :global(.draggable-item .drag-handle) {\n\t\tposition: absolute;\n\t\ttop: 4px;\n\t\tleft: 4px;\n\t\twidth: 20px;\n\t\theight: 20px;\n\t\tmin-width: 20px;\n\t\tmax-width: 20px;\n\t\tmin-height: 20px;\n\t\tmax-height: 20px;\n\t\tbackground: var(--background-fill-secondary);\n\t\tborder: 1px solid rgba(0, 0, 0, 0.2);\n\t\tborder-radius: 4px;\n\t\tcursor: grab;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 10px;\n\t\tcolor: var(--body-text-color-subdued);\n\t\topacity: 0;\n\t\ttransition: opacity 0.2s ease;\n\t\tz-index: 100;\n\t\tuser-select: none;\n\t\tflex-shrink: 0;\n\t}\n\n\t.draggable > :global(.draggable-item:hover .drag-handle) {\n\t\topacity: 1;\n\t}\n\n\t.draggable > :global(.draggable-item .drag-handle:hover) {\n\t\tbackground: var(--background-fill-secondary);\n\t\tborder-color: var(--border-color-primary);\n\t\topacity: 1;\n\t\tz-index: 101;\n\t}\n\n\t.draggable > :global(.draggable-item .drag-handle:active) {\n\t\tcursor: grabbing;\n\t\tbackground: var(--background-fill-secondary);\n\t\topacity: 1;\n\t\tz-index: 101;\n\t}\n\n\t.horizontal > :global(.draggable-item),\n\t.horizontal > :global(.form > .draggable-item) {\n\t\tflex: 1 1 0%;\n\t\tflex-wrap: wrap;\n\t\tmin-width: min(160px, 100%);\n\t}\n\n\t.vertical > :global(.draggable-item),\n\t.vertical > :global(.form > .draggable-item) {\n\t\twidth: var(--size-full);\n\t}\n</style>\n"],"names":["props","$.rest_props","$$props","gradio","Gradio","container_el","dragged_el","items","current_drop_target","handle_drag_end","drop_event_handlers","handle_drag_over","handle_drop","handle_drag_enter","add_drag_listeners","element","drag_event_handlers","event","handler","remove_drag_listeners","add_drop_listeners","remove_drop_listeners","setup_draggable_item","index","handle","setup_drag_and_drop","item","children","item_index","child","form_child","handle_drag_start","target","dragged_parent","target_parent","is_dragged_in_form","is_target_in_form","placeholder","dragged_handle"],"mappings":"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"}