import{Q as v,R as _,T as u,U as y}from"./i18n-5O2R8uRh.js";import{E as C,Y as J,J as L,Z as Q,W as U,V,I as W,_ as X,D as Y,A as Z,X as $,z as q}from"./i18n-5O2R8uRh.js";import{af as b,i as g,j as w}from"./index-bhUlIv2p.js";import{d}from"./utils.svelte-Baqu2V3e.js";class R{#r;#s;#e;reactive_formatter=e=>e;#t;client;#i=b();get root(){return g(this.#i)}set root(e){w(this.#i,e,!0)}#o=new Set;#n=new Set;#l=[];#p=new Map;#a=new Map;component_ids;initial_tabs={};components_to_register=new Set;ready;ready_resolve;resolved=!1;constructor(e,r,i,o,s,p){this.ready=new Promise(a=>{this.ready_resolve=a}),this.reactive_formatter=p,this.#t=o,this.#r=e,this.#s=r,this.#e=i,this.root=this.create_node({id:r.id,children:[]},new Map,!0);for(const a of e)a.props.visible!=!1&&this.components_to_register.add(a.id);this.client=s,this.prepare();const n=e.reduce((a,l)=>(a.set(l.id,l),a),new Map);this.root.children=this.#s.children.map(a=>this.traverse(a,l=>this.create_node(l,n))),this.component_ids=e.map(a=>a.id),this.initial_tabs={},z(this.root,this.initial_tabs),this.postprocess(this.root)}register_component(e,r,i){this.#a.set(e,r),this.#p.set(e,i),this.components_to_register.delete(e),this.components_to_register.size===0&&!this.resolved&&(this.resolved=!0,this.ready_resolve())}prepare(){const[e,r]=v(this.#e);this.#o=e,this.#n=r}process(){}postprocess(e){this.root=this.traverse(e,[r=>c(r,this.#t.root),r=>A(r,this.#t.root,this.components_to_register),r=>j(r,this.#t.root,this.components_to_register),r=>x(r,this.#t.root),r=>S(r,this.#t.root,this.initial_tabs),r=>this.find_attached_events(r,this.#e)])}find_attached_events(e,r){const i=r.filter(o=>o.targets.find(([s])=>s===e.id)).map(o=>{const s=o.targets.find(([p])=>p===e.id);return s?s[1]:null}).filter(Boolean);return e.props.shared_props.attached_events=i,e}traverse(e,r){function i(o,s,p){const n=s(o);return"children"in o&&o.children.length>0&&(n.children=o.children?.map(a=>p(a,s))||[]),n}if(Array.isArray(r)){let o=e;for(const s of r)o=i(o,s,this.traverse.bind(this));return o}else return i(e,r,this.traverse.bind(this))}create_node(e,r,i=!1,o){let s;if(i?s={type:"column",id:e.id,props:{visible:!0,root:"",theme_mode:"light"},component_class_id:"column",key:null}:s=r.get(e.id),!s)throw new Error(`Component with ID ${e.id} not found`);o&&(s.props.i18n=o);const p=E(e.id,s.props,[this.#o,this.#n],this.client,{...this.#t});return{id:e.id,type:s.type,props:p,children:[],show_progress_on:null,component_class_id:s.component_class_id||s.type,component:p.shared_props.visible!==!1?_(s.type,s.component_class_id,this.#t.root||""):null,key:s.key,rendered_in:s.rendered_in,documentation:s.documentation}}rerender(e,r){const i=e.reduce((p,n)=>(p.set(n.id,n),p),new Map),o=this.traverse(r,p=>this.create_node(p,i,!1,this.reactive_formatter)),s=h(this.root,o.id);if(!s)throw new Error("Rerender failed: root node not found in current tree");s.children=o.children}async update_state(e,r,i=!0){const o=h(this.root,e);let s=!1;i&&!o?.component&&(this.root=this.traverse(this.root,[n=>M(n,e,r.visible),n=>c(n,this.#t.root)]),s=!0);const p=this.#a.get(e);p&&(p(r),!(!i||s)&&(this.root=this.traverse(this.root,n=>c(n,this.#t.root))))}async get_state(e){const r=this.#p.get(e),i=this.#r.find(o=>o.id===e);return!r&&!i?null:r?await r():i?Promise.resolve({value:i.props.value}):null}}function k(t,e,r){return e?e.reduce((i,o)=>(i[o]=async(...s)=>(s.length===1&&(s=s[0]),await r.component_server(t,o,s)),i),{}):{}}function E(t,e,r,i,o={}){const s={},p={};for(const n in e)if(n==="id")p[n]=e[n];else if(d.includes(n)){const a=n;s[a]=e[n],a==="server_fns"&&(s.server=k(t,e.server_fns,i))}else p[n]=e[n];for(const n in o)if(d.includes(n)){const a=n;s[a]=o[n]}else p[n]=o[n];return s.client=i,s.id=t,s.interactive=y(t,s.interactive,p.value,r),s.load_component=(n,a)=>_(n,"",s.root||"",a),s.visible=s.visible===void 0?!0:s.visible,s.loading_status={},{shared_props:s,props:p}}function c(t,e){if(t.props.shared_props.visible&&!t.component){const r={...t,component:_(t.type,t.component_class_id,e),children:[]};return t.children&&(r.children=t.children.map(i=>c(i,e))),r}else return t}function M(t,e,r){return t.id==e&&(t.props.shared_props.visible=r),t}function f(t,e){e.delete(t.id),t.children&&t.children.forEach(r=>f(r,e))}function A(t,e,r){return t.props.shared_props.visible!==!0&&f(t,r),t}function j(t,e,r){return t.type==="form"&&t.children.every(o=>o.props.shared_props.visible===!1)&&(t.props.shared_props.visible=!1,r.delete(t.id)),t}function x(t,e){const r=["description","info","title","placeholder","value","label"];for(const i of Object.keys(t.props.shared_props))r.includes(i)&&(t.props.shared_props[i]=u(t.props.shared_props[i]));for(const i of Object.keys(t.props.props))r.includes(i)&&(t.props.props[i]=u(t.props.props[i]));return t}function S(t,e,r){if(t.type==="tabs"&&t.id in r){const i=r[t.id].sort((o,s)=>o.order-s.order);t.props.props.initial_tabs=i}return t}function m(t,e,r,i){r!==null&&t.type==="tabitem"&&(r in e||(e[r]=[]),"id"in t.props.props||(t.props.props.id=t.id),e[r].push({label:t.props.shared_props.label,id:t.props.props.id,elem_id:t.props.shared_props.elem_id,visible:t.props.shared_props.visible,interactive:t.props.shared_props.interactive,scale:t.props.shared_props.scale||null}),t.props.props.order=i),t.children&&t.children.forEach((o,s)=>{m(o,e,t.type==="tabs"?t.id:null,t.type==="tabs"?s:null)})}function z(t,e){function r(i){"children"in i&&i.children.length>0&&i.children?.forEach(o=>m(o,e,i.type==="tabs"?i.id:null))}return r(t)}function h(t,e){if(t.id===e)return t;if(t.children)for(const r of t.children){const i=h(r,e);if(i)return i}return null}export{R as AppTree,C as Embed,J as all_common_keys,L as changeLocale,Q as get_initial_locale,U as i18n_marker,V as is_translation_metadata,W as language_choices,X as load_translations,Y as mount_css,Z as prefix_css,$ as process_langs,q as setupi18n,u as translate_if_needed};
//# sourceMappingURL=index-DzZk3aHY.js.map
