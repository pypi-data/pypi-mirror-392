{"version":3,"file":"flowGraphSetVariableBlock-B8UJ-Wwt.js","sources":["../../../../node_modules/.pnpm/@babylonjs+core@8.36.1/node_modules/@babylonjs/core/FlowGraph/Blocks/Execution/flowGraphSetVariableBlock.js"],"sourcesContent":["import { RegisterClass } from \"../../../Misc/typeStore.js\";\nimport { FlowGraphExecutionBlockWithOutSignal } from \"../../flowGraphExecutionBlockWithOutSignal.js\";\nimport { RichTypeAny } from \"../../flowGraphRichTypes.js\";\n/**\n * This block will set a variable on the context.\n */\nexport class FlowGraphSetVariableBlock extends FlowGraphExecutionBlockWithOutSignal {\n    constructor(config) {\n        super(config);\n        // check if the variable is defined\n        if (!config.variable && !config.variables) {\n            throw new Error(\"FlowGraphSetVariableBlock: variable/variables is not defined\");\n        }\n        // check if the variable is an array\n        if (config.variables && config.variable) {\n            throw new Error(\"FlowGraphSetVariableBlock: variable and variables are both defined\");\n        }\n        // check if we have either a variable or variables. If we have variables, set the inputs correctly\n        if (config.variables) {\n            for (const variable of config.variables) {\n                this.registerDataInput(variable, RichTypeAny);\n            }\n        }\n        else {\n            this.registerDataInput(\"value\", RichTypeAny);\n        }\n    }\n    _execute(context, _callingSignal) {\n        if (this.config?.variables) {\n            for (const variable of this.config.variables) {\n                this._saveVariable(context, variable);\n            }\n        }\n        else {\n            this._saveVariable(context, this.config?.variable, \"value\");\n        }\n        this.out._activateSignal(context);\n    }\n    _saveVariable(context, variableName, inputName) {\n        // check if there is an animation(group) running on this variable. If there is, stop the animation - a value was force-set.\n        const currentlyRunningAnimationGroups = context._getGlobalContextVariable(\"currentlyRunningAnimationGroups\", []);\n        for (const animationUniqueId of currentlyRunningAnimationGroups) {\n            const animationGroup = context.assetsContext.animationGroups.find((animationGroup) => animationGroup.uniqueId == animationUniqueId);\n            if (animationGroup) {\n                // check if there is a target animation that has the target set to be the context\n                for (const targetAnimation of animationGroup.targetedAnimations) {\n                    // check if the target property is the variable we are setting\n                    if (targetAnimation.target === context) {\n                        // check the variable name\n                        if (targetAnimation.animation.targetProperty === variableName) {\n                            // stop the animation\n                            animationGroup.stop();\n                            // remove the animation from the currently running animations\n                            const index = currentlyRunningAnimationGroups.indexOf(animationUniqueId);\n                            if (index > -1) {\n                                currentlyRunningAnimationGroups.splice(index, 1);\n                            }\n                            context._setGlobalContextVariable(\"currentlyRunningAnimationGroups\", currentlyRunningAnimationGroups);\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n        const value = this.getDataInput(inputName || variableName)?.getValue(context);\n        context.setVariable(variableName, value);\n    }\n    getClassName() {\n        return \"FlowGraphSetVariableBlock\" /* FlowGraphBlockNames.SetVariable */;\n    }\n    serialize(serializationObject) {\n        super.serialize(serializationObject);\n        serializationObject.config.variable = this.config?.variable;\n    }\n}\nRegisterClass(\"FlowGraphSetVariableBlock\" /* FlowGraphBlockNames.SetVariable */, FlowGraphSetVariableBlock);\n//# sourceMappingURL=flowGraphSetVariableBlock.js.map"],"names":["FlowGraphSetVariableBlock","FlowGraphExecutionBlockWithOutSignal","config","variable","RichTypeAny","context","_callingSignal","variableName","inputName","currentlyRunningAnimationGroups","animationUniqueId","animationGroup","targetAnimation","index","value","serializationObject","RegisterClass"],"mappings":"qNAMO,MAAMA,UAAkCC,CAAqC,CAChF,YAAYC,EAAQ,CAGhB,GAFA,MAAMA,CAAM,EAER,CAACA,EAAO,UAAY,CAACA,EAAO,UAC5B,MAAM,IAAI,MAAM,8DAA8D,EAGlF,GAAIA,EAAO,WAAaA,EAAO,SAC3B,MAAM,IAAI,MAAM,oEAAoE,EAGxF,GAAIA,EAAO,UACP,UAAWC,KAAYD,EAAO,UAC1B,KAAK,kBAAkBC,EAAUC,CAAW,OAIhD,KAAK,kBAAkB,QAASA,CAAW,CAEnD,CACA,SAASC,EAASC,EAAgB,CAC9B,GAAI,KAAK,QAAQ,UACb,UAAWH,KAAY,KAAK,OAAO,UAC/B,KAAK,cAAcE,EAASF,CAAQ,OAIxC,KAAK,cAAcE,EAAS,KAAK,QAAQ,SAAU,OAAO,EAE9D,KAAK,IAAI,gBAAgBA,CAAO,CACpC,CACA,cAAcA,EAASE,EAAcC,EAAW,CAE5C,MAAMC,EAAkCJ,EAAQ,0BAA0B,kCAAmC,CAAA,CAAE,EAC/G,UAAWK,KAAqBD,EAAiC,CAC7D,MAAME,EAAiBN,EAAQ,cAAc,gBAAgB,KAAMM,GAAmBA,EAAe,UAAYD,CAAiB,EAClI,GAAIC,GAEA,UAAWC,KAAmBD,EAAe,mBAEzC,GAAIC,EAAgB,SAAWP,GAEvBO,EAAgB,UAAU,iBAAmBL,EAAc,CAE3DI,EAAe,KAAI,EAEnB,MAAME,EAAQJ,EAAgC,QAAQC,CAAiB,EACnEG,EAAQ,IACRJ,EAAgC,OAAOI,EAAO,CAAC,EAEnDR,EAAQ,0BAA0B,kCAAmCI,CAA+B,EACpG,KACJ,EAIhB,CACA,MAAMK,EAAQ,KAAK,aAAaN,GAAaD,CAAY,GAAG,SAASF,CAAO,EAC5EA,EAAQ,YAAYE,EAAcO,CAAK,CAC3C,CACA,cAAe,CACX,MAAO,2BACX,CACA,UAAUC,EAAqB,CAC3B,MAAM,UAAUA,CAAmB,EACnCA,EAAoB,OAAO,SAAW,KAAK,QAAQ,QACvD,CACJ,CACAC,EAAc,4BAAmEhB,CAAyB","x_google_ignoreList":[0]}