import{p as o,d as ve,i as Z,a as ue,v as Fe,s as pe,b as Y,c as he}from"./i18n-5O2R8uRh.js";import{p as ye,m as F,R as be,ac as Le,i as l,j as m,ai as Te,l as $,a as we,f as te,h as x,r as k,s as me,t as ee,k as ie,Q as G,b as j,c as xe,g as d,d as Oe,X as oe,U as de,aB as je,_ as Ie,e as Se}from"./index-bhUlIv2p.js";import{a as De}from"./actions-CwcOrYgf.js";import{b as H}from"./props-BmhlB8PY.js";/* empty css                                             */import{c as Me}from"./utils-BsTlurbm.js";var Re=te('<div class="file svelte-ua961l"><span><div class="progress-bar svelte-ua961l"><progress style="visibility:hidden;height:0;width:0;" max="100" class="svelte-ua961l"> </progress></div></span> <span class="file-name svelte-ua961l"> </span></div>'),Be=te('<div><span class="uploading svelte-ua961l"> </span> <!></div>');function Je(re,r){ye(r,!1);let b=o(r,"upload_id",12),J=o(r,"root",12),I=o(r,"files",12),n=o(r,"stream_handler",12),v,A=F(!1),W=F(),c=F(),_=F(I().map(s=>({...s,progress:0})));const S=be();function D(s,f){m(_,l(_).map(h=>(h.orig_name===s&&(h.progress+=f),h)))}function y(s){return s.progress*100/(s.size||0)||0}Le(async()=>{if(v=await n()(new URL(`${J()}/gradio_api/upload_progress?upload_id=${b()}`)),v==null)throw new Error("Event source is not defined");v.onmessage=async function(s){const f=JSON.parse(s.data);l(A)||m(A,!0),f.msg==="done"?(v?.close(),S("done")):(m(W,f),D(f.orig_name,f.chunk_size))}}),Te(()=>{(v!=null||v!=null)&&v.close()});function M(s){let f=0;return s.forEach(h=>{f+=y(h)}),document.documentElement.style.setProperty("--upload-progress-width",(f/s.length).toFixed(2)+"%"),f/s.length}$(()=>l(_),()=>{M(l(_))}),$(()=>(l(W),l(_)),()=>{m(c,l(W)||l(_)[0])}),we();var P={get upload_id(){return b()},set upload_id(s){b(s),d()},get root(){return J()},set root(s){J(s),d()},get files(){return I()},set files(s){I(s),d()},get stream_handler(){return n()},set stream_handler(s){n(s),d()}};ve();var z=Be();let R;var L=x(z),N=x(L);k(L);var U=me(L,2);{var p=s=>{var f=Re(),h=x(f),T=x(h),O=x(T),C=x(O,!0);k(O),k(T),k(h);var Q=me(h,2),ae=x(Q,!0);k(Q),k(f),ee((w,le)=>{Fe(O,w),ie(C,le),ie(ae,(l(c),G(()=>l(c).orig_name)))},[()=>(l(c),G(()=>y(l(c)))),()=>(l(c),G(()=>y(l(c))))]),j(s,f)};Z(U,s=>{l(c)&&s(p)})}return k(z),ee(()=>{R=ue(z,1,"wrap svelte-ua961l",null,R,{progress:l(A)}),ie(N,`Uploading ${l(_),G(()=>l(_).length)??""}
		${l(_),G(()=>l(_).length>1?"files":"file")??""}...`)}),j(re,z),xe(P)}var Ne=te("<button><!></button>"),Qe=te('<button aria-dropeffect="copy"><!></button>');function Ye(re,r){ye(r,!1);const b=F(),{drag:J,open_file_upload:I}=Me();let n=o(r,"filetype",12,null),v=o(r,"dragging",12,!1),A=o(r,"boundedheight",12,!0),W=o(r,"center",12,!0),c=o(r,"flex",12,!0),_=o(r,"file_count",12,"single"),S=o(r,"disable_click",12,!1),D=o(r,"root",12),y=o(r,"hidden",12,!1),M=o(r,"format",12,"file"),P=o(r,"uploading",12,!1),z=o(r,"show_progress",12,!0),R=o(r,"max_file_size",12,null),L=o(r,"upload",12),N=o(r,"stream_handler",12),U=o(r,"icon_upload",12,!1),p=o(r,"height",12,void 0),s=o(r,"aria_label",12,void 0),f=o(r,"upload_promise",12,null);function h(){I()}let T=F(""),O=F(),C=F(),Q=null;const ae=()=>{if(typeof navigator<"u"){const e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>-1||e.indexOf("ipad")>-1}return!1},w=be(),le=["image","video","audio","text","file"],se=e=>l(b)&&e.startsWith(".")?(Q=!0,e):l(b)&&e.includes("file/*")?"*":e.startsWith(".")||e.endsWith("/*")?e:le.includes(e)?e+"/*":"."+e;function ne(){navigator.clipboard.read().then(async e=>{for(let a=0;a<e.length;a++){const i=e[a].types.find(t=>t.startsWith("image/"));if(i){e[a].getType(i).then(async t=>{const u=new File([t],`clipboard.${i.replace("image/","")}`);await X([u])});break}}})}function fe(){I()}function ke(e,a){return f(new Promise(async(i,t)=>{await Ie(),a?m(T,a):m(T,Math.random().toString(36).substring(2,15)),P(!0);try{const u=await L()(e,D(),l(T),R()??1/0);return w("load",_()==="single"?u?.[0]:u),i(u||[]),P(!1),u||[]}catch(u){w("error",u.message),P(!1),i([])}})),f()}function Ae(e,a,i){if(!e||e==="*"||e==="file/*"||Array.isArray(e)&&e.some(u=>u==="*"||u==="file/*"))return!0;let t;if(typeof e=="string")t=e.split(",").map(u=>u.trim());else if(Array.isArray(e))t=e;else return!1;return t.includes(a)||t.some(u=>{const[E]=u.split("/").map(g=>g.trim());return u.endsWith("/*")&&i.startsWith(E+"/")})}async function X(e,a){if(!e.length)return;let i=e.map(t=>new File([t],t instanceof File?t.name:"file",{type:t.type}));return l(b)&&Q&&(i=i.filter(t=>_e(t)?!0:(w("error",`Invalid file type: ${t.name}. Only ${n()} allowed.`),!1)),i.length===0)?[]:(m(O,await je(i)),await ke(l(O),a))}function _e(e){return n()?(Array.isArray(n())?n():[n()]).some(i=>{const t=se(i);if(t.startsWith("."))return e.name.toLowerCase().endsWith(t.toLowerCase());if(t==="*")return!0;if(t.endsWith("/*")){const[u]=t.split("/");return e.type.startsWith(u+"/")}return e.type===t}):!0}async function We(e){const a=e.filter(i=>{const t="."+i.name.toLowerCase().split(".").pop();return t&&Ae(l(C),t,i.type)||(t&&Array.isArray(n())?n().includes(t):t===n())?!0:(w("error",`Invalid file type only ${n()} allowed.`),!1)});if(M()!="blob")await X(a);else{if(_()==="single"){w("load",a[0]);return}w("load",a)}}async function ce(e){if(v(!1),!e.dataTransfer?.files)return;const a=Array.from(e.dataTransfer.files).filter(_e);if(M()!="blob")await X(a);else{if(_()==="single"){w("load",a[0]);return}w("load",a)}}$(()=>{},()=>{m(b,ae())}),$(()=>(Oe(n()),l(b)),()=>{n()==null?m(C,null):typeof n()=="string"?m(C,se(n())):l(b)&&n().includes("file/*")?m(C,"*"):(n(n().map(se)),m(C,n().join(", ")))}),we();var Pe={open_upload:h,paste_clipboard:ne,open_file_upload:fe,load_files:X,load_files_from_drop:ce,get filetype(){return n()},set filetype(e){n(e),d()},get dragging(){return v()},set dragging(e){v(e),d()},get boundedheight(){return A()},set boundedheight(e){A(e),d()},get center(){return W()},set center(e){W(e),d()},get flex(){return c()},set flex(e){c(e),d()},get file_count(){return _()},set file_count(e){_(e),d()},get disable_click(){return S()},set disable_click(e){S(e),d()},get root(){return D()},set root(e){D(e),d()},get hidden(){return y()},set hidden(e){y(e),d()},get format(){return M()},set format(e){M(e),d()},get uploading(){return P()},set uploading(e){P(e),d()},get show_progress(){return z()},set show_progress(e){z(e),d()},get max_file_size(){return R()},set max_file_size(e){R(e),d()},get upload(){return L()},set upload(e){L(e),d()},get stream_handler(){return N()},set stream_handler(e){N(e),d()},get icon_upload(){return U()},set icon_upload(e){U(e),d()},get height(){return p()},set height(e){p(e),d()},get aria_label(){return s()},set aria_label(e){s(e),d()},get upload_promise(){return f()},set upload_promise(e){f(e),d()}};ve();var ge=oe(),ze=de(ge);{var Ue=e=>{var a=Ne();let i,t;var u=x(a);pe(u,r,"default",{},null),k(a),ee(()=>{Y(a,"tabindex",y()?-1:0),Y(a,"aria-label",s()||"Paste from clipboard"),i=ue(a,1,"svelte-8prmba",null,i,{hidden:y(),center:W(),boundedheight:A(),flex:c(),"icon-mode":U()}),t=he(a,"",t,{height:U()?"":p()?typeof p()=="number"?p()+"px":p():"100%"})}),Se("click",a,ne),j(e,a)},Ce=e=>{var a=oe(),i=de(a);{var t=E=>{var g=oe(),K=de(g);{var V=q=>{Je(q,{get root(){return D()},get upload_id(){return l(T)},get files(){return l(O)},get stream_handler(){return N()}})};Z(K,q=>{y()||q(V)})}j(E,g)},u=E=>{var g=Qe();let K,V;var q=x(g);pe(q,r,"default",{},null),k(g),De(g,(B,Ee)=>J?.(B,Ee),()=>({on_drag_change:B=>B=B,on_files:B=>We(B),accepted_types:l(C),mode:_(),disable_click:S()})),ee(()=>{Y(g,"tabindex",y()?-1:0),Y(g,"aria-label",s()||"Click to upload or drop files"),K=ue(g,1,"svelte-8prmba",null,K,{hidden:y(),center:W(),boundedheight:A(),flex:c(),disable_click:S(),"icon-mode":U()}),V=he(g,"",V,{height:U()?"":p()?typeof p()=="number"?p()+"px":p():"100%"})}),j(E,g)};Z(i,E=>{P()&&z()?E(t):E(u,!1)},!0)}j(e,a)};Z(ze,e=>{n()==="clipboard"?e(Ue):e(Ce,!1)})}return j(re,ge),H(r,"open_upload",h),H(r,"paste_clipboard",ne),H(r,"open_file_upload",fe),H(r,"load_files",X),H(r,"load_files_from_drop",ce),xe(Pe)}export{Ye as U,Je as a};
//# sourceMappingURL=Upload-DUNHTCuE.js.map
