import{A as ee,h as c,c as m,o as t,w as e,e as _,a as l,t as s,f as n,b as W,u as le,n as ae,B as oe,q as te,i as D,j as I,d as se,z as ue,g as re,l as y,m as V,k as f,F as O,_ as ne}from"./index-WQ41F5VK.js";import{b as de,a as ie,A as me,_ as fe}from"./AccountAliasForm-OvFAP6Ru.js";import{r as ce,V as _e}from"./VForm-CxFPdkZa.js";import{V as ve}from"./VAutocomplete-BdsSHywe.js";import{V as H}from"./VTextField-fWt9fUJr.js";import{u as X}from"./language.store-DuvIgs5v.js";import{_ as pe}from"./ResourcesForm-CD3wObzE.js";import{L as ge}from"./LoadingData-Dcu-PCpp.js";import{a as J}from"./accounts-CaYgxMST.js";import{p as ye}from"./parameters-CxHnQU2I.js";import{u as Ve}from"./permissions-TImOfY3I.js";import{d as w,c as C,V as K}from"./VAvatar-BKSHKr1K.js";import{V as h,c as A,a as E,b as be}from"./VExpansionPanels-CBqUBAh-.js";import{V as v,a as i}from"./VRow-CVWfiMs5.js";import{V as ke,a as xe}from"./VToolbar-DYf0Nubr.js";import"./ChoiceField-BpSW5-Ay.js";import"./VAlert-Ck0PurTo.js";import"./VProgressCircular-DN4UW8ON.js";import"./tag-D-paBiFC.js";import"./AccountPasswordSubForm-XZN7PcjO.js";import"./VSwitch-BYsITk7O.js";import"./VInput-quQSdtEy.js";import"./VSelectionControl-DMlq6-TE.js";import"./EmailField-BXU27oIO.js";import"./VMenu--sryJ9Uc.js";import"./ssrBoot-B5vxBC28.js";import"./domains.store-W5AiCN3q.js";import"./domains-DGdr9Equ.js";import"./VSelect-Okzuwz-S.js";import"./VCheckboxBtn-p4bo2BTE.js";import"./filter-BH0Tmqu3.js";import"./languages-CE73-P-v.js";import"./VContainer-CmyIOuWp.js";/* empty css              */const Fe={class:"m-label"},we={class:"m-label"},he={class:"m-label"},Ae={__name:"AccountProfileForm",props:{modelValue:{type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(T,{expose:x}){const p=ee(T,"modelValue"),d=X(),U=c(""),$=c();return x({vFormRef:$}),(b,g)=>(t(),m(_e,{ref_key:"vFormRef",ref:$},{default:e(()=>[_("label",Fe,s(b.$gettext("Language")),1),l(ve,{modelValue:p.value.language,"onUpdate:modelValue":g[0]||(g[0]=k=>p.value.language=k),items:n(d).availableLanguages,"item-title":"label","item-value":"code",variant:"outlined",density:"compact","error-messages":U.value},null,8,["modelValue","items","error-messages"]),_("label",we,s(b.$gettext("Phone number")),1),l(H,{modelValue:p.value.phone_number,"onUpdate:modelValue":g[1]||(g[1]=k=>p.value.phone_number=k),variant:"outlined",density:"compact"},null,8,["modelValue"]),_("label",he,s(b.$gettext("Secondary email")),1),l(H,{modelValue:p.value.secondary_email,"onUpdate:modelValue":g[2]||(g[2]=k=>p.value.secondary_email=k),variant:"outlined",density:"compact",rules:[n(ce).emailOrNull]},null,8,["modelValue","rules"])]),_:1},512))}},Ee={key:1},Ue={key:0},$e={key:0},Re={class:"mr-2"},Se={class:"mr-2"},Ne={key:0},Le={class:"mr-2"},Pe={key:0},Ce={class:"mr-2"},Te={class:"mr-2"},Be={class:"mr-2"},Me={key:0},je={class:"mr-2"},De={key:0},Ie={class:"mr-2"},Oe={class:"mr-2"},qe={class:"mt-4 d-flex justify-end"},Ge={__name:"AccountEditForm",async setup(T){let x,p;const{$gettext:d}=W(),U=le(),{displayNotification:$}=ae(),b=X(),g=oe(),k=te(),{canSetRole:B}=Ve(),a=c({pk:g.params.id}),R=D(()=>a.value.username&&a.value.username.indexOf("@")!==-1),M=D(()=>{const o=j.value.params&&j.value.params.enable_admin_limits&&a.value.role!==I.USER&&a.value.role!==I.SUPER_ADMIN;return o===void 0?!1:o}),j=c({}),S=c(0),F=c(!1),N=c(!1),L=c(),q=c(),G=c(),Q=c(),P=c(),z=c(),Y=D(()=>{const o={roleForm:L,generalForm:q,profileForm:z};return R.value&&(o.aliasForm=Q,o.mailboxForm=G),M.value&&(o.resourcesForm=P),o});async function Z(){N.value=!1,S.value=[];for(const[o,r]of Object.entries(Y.value))if(r.value!=null){const{valid:u}=await r.value.vFormRef.validate();u||(N.value=!0,S.value.push(o))}if(!N.value){F.value=!0;try{const o={...a.value};R.value?o.mailbox.full_address=o.username:o.mailbox&&delete o.mailbox.full_address,o.new_password&&(o.password=o.new_password,delete o.new_password,delete o.password_confirmation),M.value&&P.value!==null&&(o.resources=P.value.getPayload()),o.aliases===null&&delete o.aliases,B.value||(a.value.pk===U.authUser.pk?o.role=U.authUser.role:o.role=I.USER),await J.patch(a.value.pk,o),$({msg:d("Account updated")}),k.push({name:"AccountDetail",params:{id:g.params.id}})}finally{F.value=!1}}}return se(()=>{J.get(g.params.id).then(o=>{a.value=o.data,F.value=!1}),B.value&&ye.getGlobalApplication("limits").then(o=>{j.value=o.data})}),ue(a,()=>{delete a.value.domains,a.value.mailbox===null&&delete a.value.mailbox},{deep:!0}),b.loaded||([x,p]=re(()=>b.getLanguages()),await x,p()),(o,r)=>F.value?(t(),m(ge,{key:0})):(t(),y("div",Ee,[l(be,{modelValue:S.value,"onUpdate:modelValue":r[6]||(r[6]=u=>S.value=u),multiple:N.value},{default:e(()=>[n(B)?(t(),m(h,{key:0,eager:"",value:"roleForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Role")),1)]),_:1}),l(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",Ue)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[L.value?(t(),m(i,{key:0,cols:"6"},{default:e(()=>[f(s(L.value.roleLabel),1)]),_:1})):V("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(de,{ref_key:"roleForm",ref:L,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=u=>a.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0),l(h,{eager:"",value:"generalForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Account")),1)]),_:1}),l(i,{cols:"8",class:""},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",$e)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l(i,{cols:"6"},{default:e(()=>[_("div",Re,s(n(d)("Username:"))+" "+s(a.value.username),1)]),_:1}),l(i,{cols:"6"},{default:e(()=>[_("div",Se,[f(s(n(d)("Enabled"))+" ",1),a.value.is_active?(t(),m(C,{key:0,color:"success"},{default:e(()=>r[8]||(r[8]=[f("mdi-check-circle-outline")])),_:1,__:[8]})):(t(),m(C,{key:1},{default:e(()=>r[9]||(r[9]=[f("mdi-close-circle-outline")])),_:1,__:[9]}))])]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(ie,{ref_key:"generalForm",ref:q,modelValue:a.value,"onUpdate:modelValue":r[1]||(r[1]=u=>a.value=u),editing:""},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{eager:"",value:"profileForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Profile")),1)]),_:1}),l(i,{cols:"8",class:""},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",Ne)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l(i,{cols:"6"},{default:e(()=>[_("div",Le,s(n(d)("Language:"))+" "+s(n(b).getLanguageLabel(a.value.language)),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(Ae,{ref_key:"profileForm",ref:z,modelValue:a.value,"onUpdate:modelValue":r[2]||(r[2]=u=>a.value=u)},null,8,["modelValue"])]),_:1})]),_:1}),R.value?(t(),m(h,{key:1,eager:"",value:"mailboxForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Mailbox")),1)]),_:1}),l(i,{cols:"8",class:""},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",Pe)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a.value.mailbox?(t(),y(O,{key:0},[a.value.mailbox.use_domain_quota?(t(),m(i,{key:0,cols:"6"},{default:e(()=>[_("div",Ce,s(n(d)("Quota: "))+" "+s(n(d)("domain's default value")),1)]),_:1})):(t(),m(i,{key:1,cols:"6"},{default:e(()=>[_("div",Te,s(n(d)("Quota: "))+" "+s(a.value.mailbox.quota),1)]),_:1})),l(i,{cols:"6"},{default:e(()=>[_("div",Be,[f(s(n(d)("Send only"))+" ",1),a.value.mailbox.is_send_only?(t(),m(C,{key:0,color:"success"},{default:e(()=>r[10]||(r[10]=[f("mdi-check-circle-outline")])),_:1,__:[10]})):(t(),m(C,{key:1},{default:e(()=>r[11]||(r[11]=[f("mdi-close-circle-outline")])),_:1,__:[11]}))])]),_:1})],64)):V("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(me,{ref_key:"mailboxForm",ref:G,modelValue:a.value,"onUpdate:modelValue":r[3]||(r[3]=u=>a.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0),R.value?(t(),m(h,{key:2,eager:"",value:"aliasForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Alias")),1)]),_:1}),l(i,{cols:"8",class:""},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",Me)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a.value.aliases?(t(),m(i,{key:0,cols:"6"},{default:e(()=>[_("div",je,s(n(d)("Number of associated alias:"))+" "+s(a.value.aliases.length),1)]),_:1})):V("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(fe,{ref_key:"aliasForm",ref:Q,modelValue:a.value,"onUpdate:modelValue":r[4]||(r[4]=u=>a.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0),M.value?(t(),m(h,{key:3,eager:"",value:"resourcesForm"},{default:e(()=>[l(A,null,{default:e(({expanded:u})=>[l(v,{"no-gutters":""},{default:e(()=>[l(i,{cols:"4"},{default:e(()=>[f(s(n(d)("Resources")),1)]),_:1}),l(i,{cols:"8",class:""},{default:e(()=>[l(w,{"leave-absolute":""},{default:e(()=>[u?(t(),y("span",De)):(t(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a.value.resources!=null&&a.value.resources.length==2?(t(),y(O,{key:0},[l(i,{cols:"6"},{default:e(()=>[_("div",Ie,s(n(d)("Number of allowed mailboxes:"))+" "+s(a.value.resources[0].max_value),1)]),_:1}),l(i,{cols:"6"},{default:e(()=>[_("div",Oe,s(n(d)("Number of allowed mailbox aliases:"))+" "+s(a.value.resources[1].max_value),1)]),_:1})],64)):V("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),l(E,null,{default:e(()=>[l(pe,{ref_key:"resourcesForm",ref:P,modelValue:a.value.resources,"onUpdate:modelValue":r[5]||(r[5]=u=>a.value.resources=u)},null,8,["modelValue"])]),_:1})]),_:1})):V("",!0)]),_:1},8,["modelValue","multiple"]),_("div",qe,[l(K,{loading:F.value,variant:"outlined",onClick:r[7]||(r[7]=u=>o.$router.go(-1))},{default:e(()=>[f(s(n(d)("Cancel")),1)]),_:1},8,["loading"]),l(K,{class:"ml-4",color:"primary darken-1",variant:"outlined",loading:F.value,onClick:Z},{default:e(()=>[f(s(n(d)("Save")),1)]),_:1},8,["loading"])])]))}},Qe={__name:"AccountEditView",setup(T){const{$gettext:x}=W();return(p,d)=>(t(),y(O,null,[l(ke,{flat:""},{default:e(()=>[l(xe,null,{default:e(()=>[f(s(n(x)("Edit account")),1)]),_:1})]),_:1}),l(Ge)],64))}},Al=ne(Qe,[["__scopeId","data-v-4019c7f8"]]);export{Al as default};
