import{b as U,n as R,i as N,h as x,c as k,o as u,w as e,a as o,f as g,v as L,e as M,l as A,s as q,F as B,k as p,t as V,x as O,q as W,_ as H}from"./index-WQ41F5VK.js";import{_ as J}from"./CreationForm-B00QE2E0.js";import{u as z,_ as K,a as Q}from"./ProviderGeneralForm-DqVUshAw.js";import{_ as X}from"./MenuItems-CpOwNJeC.js";import{V as j,a as Y}from"./VMenu--sryJ9Uc.js";import{V as h,c as E}from"./VAvatar-BKSHKr1K.js";import{a as T}from"./VSelect-Okzuwz-S.js";import{V as G,a as Z}from"./VToolbar-DYf0Nubr.js";import{V as ee}from"./VTextField-fWt9fUJr.js";import{V as te}from"./VSpacer-yH183XvN.js";import{V as oe}from"./VDataTable-uO4iY3PI.js";import{a as ae}from"./VCard-B7MvPr5E.js";import{V as se}from"./VDialog-ByBq-y2_.js";import"./ConfirmDialog-BemItW2F.js";import"./VRow-CVWfiMs5.js";/* empty css              */import"./tag-D-paBiFC.js";import"./logos-DYp82smF.js";import"./VWindowItem-mmufRveK.js";import"./ssrBoot-B5vxBC28.js";import"./VContainer-CmyIOuWp.js";import"./VSheet-iS_sxEl7.js";import"./VProgressCircular-DN4UW8ON.js";import"./domains-DGdr9Equ.js";import"./VAutocomplete-BdsSHywe.js";import"./filter-BH0Tmqu3.js";import"./VInput-quQSdtEy.js";import"./VCheckboxBtn-p4bo2BTE.js";import"./VSelectionControl-DMlq6-TE.js";import"./VForm-CxFPdkZa.js";import"./VSwitch-BYsITk7O.js";import"./VTable-C1FqhNBY.js";const re={__name:"ProviderCreationForm",emits:["close"],setup(D,{emit:i}){const m=i,{$gettext:a}=U(),c=R(),f=z(),F=N(()=>{const n=[];let d=!0;for(const _ of s.value.domains){const I=_.new_domain?`${_.name} => ${_.new_domain.name}`:`${_.name} ${a("(the domain will be created locally)")}`;n.push({key:d?a("Associated domain"):"",value:I}),d=!1}return n}),b=N(()=>[{title:a("General"),items:[{key:a("Name"),value:s.value.name},{key:a("Address"),value:s.value.address},{key:a("Port"),value:s.value.port},{key:a("Secured"),value:s.value.secured,type:"yesno"}]},{title:a("Associated domains"),items:F.value}]),w=[{name:"general",title:a("General")},{name:"associated",title:a("Associated domains")}],s=x({domains:[]}),$=x(),S=x(),C={general:$,associated:S};P();function P(){s.value={name:"",address:"",port:993,secured:!0,domains:[]}}function l(){P(),m("close")}function r(n){return C.value[n.name]}function t(n){return console.log(s.value),C[n.name].value.vFormRef}function v(){}function y(){const n={...s.value};n.domains=[];for(const d of s.value.domains)d.new_domain?n.domains.push({name:d.name,new_domain:d.new_domain.pk}):n.domains.push(d);f.createProvider(n).then(()=>{c.displayNotification({msg:a("Provider created")}),l()})}return(n,d)=>(u(),k(g(J),{ref:"form",title:g(a)("New provider"),steps:w,"form-getter":r,"get-v-form-ref":t,"validate-object":v,"summary-sections":b.value,onClose:l,onCreate:y},{"form.general":e(()=>[o(Q,{ref_key:"general",ref:$,modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=_=>s.value=_),class:"ml-4"},null,8,["modelValue"])]),"form.associated":e(()=>[o(K,{ref_key:"associated",ref:S,modelValue:s.value.domains,"onUpdate:modelValue":d[1]||(d[1]=_=>s.value.domains=_)},null,8,["modelValue"])]),_:2},1032,["title","summary-sections"]))}},ie=["colspan"],ne={__name:"ProvidersList",setup(D){const{$gettext:i}=U(),m=z(),a=W(),c=N(()=>m.providers),f=N(()=>m.providersLoaded),F=[{title:i("Name"),key:"name"},{title:i("Address"),key:"address"},{title:i("Port"),key:"port"},{title:i("Secured"),key:"secured"},{title:i("Associated domains"),key:"domains"},{title:i("Actions"),key:"actions",sortable:!1,align:"right"}],b=x([]),w=x(""),s=x([]);function $(l){m.deleteProvider(l.id)}function S(l){a.push({name:"ProviderEdit",params:{id:l.id}})}function C(){const l=[];return l.push({label:i("Delete"),icon:"mdi-delete-outline",onClick:$,color:"red"}),l.push({label:i("Edit"),icon:"mdi-circle-edit-outline",onClick:S}),l}function P(){m.getProviders()}return f.value||P(),(l,r)=>(u(),k(ae,{class:"mt-6"},{default:e(()=>[o(oe,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=t=>b.value=t),expanded:s.value,"onUpdate:expanded":r[2]||(r[2]=t=>s.value=t),headers:F,items:Object.values(c.value),search:w.value,loading:!f.value,"item-value":"name","single-expand":"","show-select":"","onClick:row":r[3]||(r[3]=(t,v)=>v.expand(!v.isExpanded))},{top:e(()=>[o(G,{color:"white",flat:""},{default:e(()=>[o(ee,{modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=t=>w.value=t),"prepend-inner-icon":"mdi-magnify",placeholder:g(i)("Search"),"single-line":"",variant:"outlined","hide-details":"",density:"compact",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue","placeholder"]),O(l.$slots,"extraActions"),o(j,{location:"bottom"},{activator:e(({props:t})=>[o(h,L(t,{variant:"flat","append-icon":"mdi-chevron-down",size:"small"}),{default:e(()=>[p(V(g(i)("Actions")),1)]),_:2},1040)]),default:e(()=>[o(Y,{density:"compact"})]),_:1}),o(h,{variant:"text",icon:"mdi-reload",onClick:P}),o(te)]),_:3})]),"item.secured":e(({item:t})=>[t.secured===!0?(u(),k(E,{key:0,color:"green"},{default:e(()=>r[4]||(r[4]=[p(" mdi-lock ")])),_:1,__:[4]})):(u(),k(E,{key:1,color:"red"},{default:e(()=>r[5]||(r[5]=[p(" mdi-lock-off ")])),_:1,__:[5]}))]),"item.domains":e(({item:t})=>[t.domains.length>0?(u(),k(T,{key:0},{default:e(()=>[p(V(t.domains.length)+" associated domain(s) ",1)]),_:2},1024)):(u(),k(T,{key:1},{default:e(()=>r[6]||(r[6]=[p(" No associated domain ")])),_:1,__:[6]}))]),"expanded-item":e(({headers:t,item:v})=>[M("td",{colspan:t.length},[(u(!0),A(B,null,q(v.domains,(y,n)=>(u(),k(T,{key:n},{default:e(()=>[y.new_domain?(u(),A(B,{key:0},[p(V(y.name)+" --> "+V(y.new_domain.name),1)],64)):(u(),A(B,{key:1},[p(V(y.name)+" --> "+V(y.name),1)],64))]),_:2},1024))),128))],8,ie)]),"item.actions":e(({item:t})=>[o(j,{"offset-y":""},{activator:e(({props:v})=>[o(h,L({icon:"mdi-dots-horizontal",variant:"text"},v),null,16)]),default:e(()=>[o(g(X),{items:C(),obj:t},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["modelValue","expanded","items","search","loading"])]),_:3}))}},le={__name:"ProvidersView",setup(D){const{$gettext:i}=U(),m=x(!1);return(a,c)=>(u(),A("div",null,[o(G,{flat:""},{default:e(()=>[o(Z,null,{default:e(()=>[p(V(g(i)("Providers")),1)]),_:1})]),_:1}),o(g(ne),null,{extraActions:e(()=>[o(h,{color:"primary",variant:"outlined","prepend-icon":"mdi-plus",onClick:c[0]||(c[0]=f=>m.value=!0)},{default:e(()=>[p(V(a.$pgettext("male","New")),1)]),_:1})]),_:1}),o(se,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=f=>m.value=f),fullscreen:"",scrollable:"",transition:"dialog-bottom-transition"},{default:e(()=>[o(g(re),{onClose:c[1]||(c[1]=f=>m.value=!1)})]),_:1},8,["modelValue"])]))}},Ie=H(le,[["__scopeId","data-v-38468b5b"]]);export{Ie as default};
