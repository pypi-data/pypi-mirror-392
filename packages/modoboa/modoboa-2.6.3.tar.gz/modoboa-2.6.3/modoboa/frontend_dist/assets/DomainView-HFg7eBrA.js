import{_ as O,a as ke}from"./DomainAdminList-BW50F_7s.js";import{c as q}from"./colors-DoZdCu1D.js";import{b as z,l as h,o as n,e as i,a as e,k as s,t,y as me,w as l,F as T,s as Y,f as u,h as D,D as te,i as R,d as Ve,z as ie,r as ce,c,m as C,_ as fe,n as he,g as _e,A as $e,B as xe}from"./index-WQ41F5VK.js";import{b as X,V as w,a as De}from"./VAvatar-BKSHKr1K.js";import{V as we}from"./VTable-C1FqhNBY.js";import{d as E}from"./domains-DGdr9Equ.js";import{V as pe,a as ve}from"./VToolbar-DYf0Nubr.js";import{V as G}from"./VSpacer-yH183XvN.js";import{V as A,a as K,c as B,b as Q}from"./VCard-B7MvPr5E.js";import{V as $,a as d}from"./VRow-CVWfiMs5.js";import{V as Ce}from"./VSheet-iS_sxEl7.js";import{V as Se,a as Me,b as Ne}from"./VExpansionPanels-CBqUBAh-.js";import{V as P}from"./VAlert-Ck0PurTo.js";import{a as Ie,b as Te}from"./VMenu--sryJ9Uc.js";import{_ as Ae}from"./ConfirmDialog-BemItW2F.js";import{a as N}from"./VSelect-Okzuwz-S.js";import{V as Ke}from"./VDataTableVirtual-C_aJRTho.js";import{V as H}from"./VDialog-ByBq-y2_.js";import{t as je}from"./transports-DmREsCgU.js";import{V as ae,a as Ue}from"./VRadioGroup-G5s53Jnf.js";import{a as ye}from"./amavis-BUExu2Ci.js";import{V as oe}from"./VTextField-fWt9fUJr.js";import{V as Pe}from"./VCheckbox-er0bxYP_.js";import{L as Be}from"./LoadingData-Dcu-PCpp.js";import{_ as Le}from"./ResourcesForm-CD3wObzE.js";import{T as re}from"./TimeSerieChart-BY4l0TOt.js";import{V as Fe,a as Re,b as ne,c as se}from"./VTabs-DMJmfYTo.js";import{u as ze}from"./global.store-xmZ6sXxZ.js";import"./accounts-CaYgxMST.js";import"./VAutocomplete-BdsSHywe.js";import"./VProgressCircular-DN4UW8ON.js";import"./tag-D-paBiFC.js";import"./filter-BH0Tmqu3.js";import"./VInput-quQSdtEy.js";import"./VCheckboxBtn-p4bo2BTE.js";import"./VSelectionControl-DMlq6-TE.js";/* empty css              */import"./ssrBoot-B5vxBC28.js";import"./VDataTable-uO4iY3PI.js";import"./VContainer-CmyIOuWp.js";import"./VForm-CxFPdkZa.js";import"./VPicker-C6hgT7tI.js";import"./VWindowItem-mmufRveK.js";const Oe={class:"text-h6"},Ee={width:"40%"},Ye={class:"text-white"},Ge={class:"text-white"},qe={class:"text-white"},Xe={class:"text-white"},W={__name:"DmarcSourceTable",props:{title:{type:String,default:""},color:{type:String,default:""},total:{type:Number,default:null},sources:{type:Object,default:null}},setup(r){const{$gettext:o}=z();return(_,y)=>(n(),h("div",null,[i("div",Oe,[s(t(r.title)+" ",1),i("span",{class:me(`text-${r.color}-lighten-2`)},t(r.total),3)]),e(we,null,{default:l(()=>[i("tbody",null,[(n(!0),h(T,null,Y(r.sources,(a,v)=>(n(),h(T,{key:v},[i("tr",null,[i("th",Ee,t(v),1),i("th",null,t(u(o)("Total")),1),y[0]||(y[0]=i("th",null,"SPF",-1)),y[1]||(y[1]=i("th",null,"DKIM",-1))]),(n(!0),h(T,null,Y(a,(f,V)=>(n(),h("tr",{key:V},[i("td",null,t(V),1),i("td",null,t(f.total),1),i("td",null,[e(X,{color:"green lighten-2",size:"24"},{default:l(()=>[i("span",Ye,t(f.spf.success),1)]),_:2},1024),e(X,{color:"red lighten-2 ml-1",size:"24"},{default:l(()=>[i("span",Ge,t(f.spf.failure),1)]),_:2},1024)]),i("td",null,[e(X,{color:"green lighten-2",size:"24"},{default:l(()=>[i("span",qe,t(f.dkim.success),1)]),_:2},1024),e(X,{color:"red lighten-2 ml-1",size:"24"},{default:l(()=>[i("span",Xe,t(f.dkim.failure),1)]),_:2},1024)])]))),128))],64))),128))])]),_:1})]))}},We={key:0},He={class:"mx-2"},Qe={class:"text-subtitle-1"},Je={key:1},Ze={__name:"DmarcAligmentChart",props:{domain:{type:Object,default:()=>null}},setup(r){const{$gettext:o}=z(),_=["aligned","trusted","forwarded","failed"],y=r,a=D({colors:[q.green.lighten2,q.orange.lighten2,q.blue.lighten2,q.red.lighten2],labels:[o("Fully aligned"),o("Partially aligned"),o("Forwarded"),o("Failed")],legend:{position:"bottom"}}),v=D(null),f=D([{key:"total",label:o("Total"),color:"primary lighten-2"},{key:"aligned",label:o("Fully aligned"),color:"green lighten-2"},{key:"trusted",label:o("Partially aligned"),color:"orange lighten-2"},{key:"forwarded",label:o("Forwarded"),color:"blue lighten-2"},{key:"failed",label:o("Failed"),color:"red lighten-2"}]),V=te.now(),g=D(V.year),p=D(V.weekNumber),m=D(!1),b=D(!1),L=D(null),F=D([]),I=D({}),J=R(()=>te.fromObject({weekYear:g.value,weekNumber:p.value}).startOf("week")),Z=R(()=>te.fromObject({weekYear:g.value,weekNumber:p.value}).endOf("week"));function ee(U){let k="";for(const j of U.split(" "))k!==""&&(k+=" "),k+="text-"+j;return k}function le(){p.value===52?(g.value+=1,p.value=1):p.value+=1}function S(){p.value===1?(g.value-=1,p.value=52):p.value-=1}function x(){if(b.value)return;const U=`${g.value}-${p.value}`;b.value=!0,E.getDomainDmarcAlignment(y.domain.pk,U).then(k=>{if(b.value=!1,k.status===204){m.value=!0;return}I.value={total:0},v.value=k.data,F.value=[];for(const j of _){let M=0;for(const de in k.data[j])for(const be in k.data[j][de])M+=k.data[j][de][be].total;I.value.total+=M,I.value[j]=M,F.value.push(M)}})}return Ve(()=>x()),ie(p,()=>{x()}),ie(g,()=>{x()}),(U,k)=>{const j=ce("apexchart");return v.value?(n(),h("div",We,[e(K,null,{default:l(()=>[e(pe,{dense:"",elevation:"0",class:"mr-2"},{default:l(()=>[e(ve,null,{default:l(()=>[s(t(u(o)("Alignment")),1)]),_:1}),e(G),e(w,{icon:"mdi-arrow-left",size:"x-small",onClick:S}),i("span",He,t(J.value.toLocaleString())+" - "+t(Z.value.toLocaleString()),1),e(w,{icon:"mdi-arrow-right",size:"x-small",onClick:le})]),_:1}),e(A,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"5"},{default:l(()=>[F.value?(n(),c(j,{key:0,type:"pie",height:"350",options:a.value,series:F.value},null,8,["options","series"])):C("",!0)]),_:1}),e(d,{cols:"7"},{default:l(()=>[e($,null,{default:l(()=>[(n(!0),h(T,null,Y(f.value,M=>(n(),c(d,{key:M.key,cols:"6"},{default:l(()=>[e(Ce,{outlined:"",color:M.color,rounded:""},{default:l(()=>[e(K,{outlined:"",class:"pa-10 text-center"},{default:l(()=>[i("span",{class:me("text-h4 "+ee(M.color))},t(I.value[M.key]),3),k[1]||(k[1]=i("br",null,null,-1)),i("span",Qe,t(M.label),1)]),_:2,__:[1]},1024)]),_:2},1032,["color"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ne,{modelValue:L.value,"onUpdate:modelValue":k[0]||(k[0]=M=>L.value=M),class:"mt-2"},{default:l(()=>[e(Se,{title:u(o)("Detail")},{default:l(()=>[e(Me,null,{default:l(()=>[e(W,{title:u(o)("Trusted sources"),color:"green",total:I.value.aligned,sources:v.value.aligned},null,8,["title","total","sources"]),e(W,{title:u(o)("Partially trusted sources / Forwarders"),color:"orange",total:I.value.trusted,sources:v.value.trusted,class:"mt-4"},null,8,["title","total","sources"]),e(W,{title:u(o)("Forwarders with ARC"),color:"blue",total:I.value.forwarded,sources:v.value.forwarded,class:"mt-4"},null,8,["title","total","sources"]),e(W,{title:u(o)("Unknown sources / Threats"),color:"red",total:I.value.failed,sources:v.value.failed,class:"mt-4"},null,8,["title","total","sources"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])):(n(),h("div",Je,[m.value?(n(),c(P,{key:0,type:"info",variant:"outlined",prominent:"",border:"start",class:"mt-6"},{default:l(()=>[i("div",null,t(u(o)("DMARC support does not seem to be enabled for this domain.")),1),i("div",null,t(u(o)("If you configured it recently, please wait for the first report to be received and processed.")),1)]),_:1})):C("",!0)]))}}},el={id:"dkimdns",class:"dkim"},ge={__name:"DKIMKeyViewer",props:{domain:{type:Object,default:null}},setup(r){const o=r,_=R(()=>{let a=`v=DKIM1;k=rsa;p=${o.domain.dkim_public_key}`;const v=[];for(;a.length>0;)if(a.length>74)v.push(`  "${a.substring(0,74)}"`),a=a.substring(74);else{v.push(`  "${a}"`);break}return v.join(`
`)});function y(){navigator.clipboard.writeText(document.getElementById("dkimdns").textContent)}return(a,v)=>(n(),h("button",{class:"dkimbutton",onClick:v[0]||(v[0]=f=>y())},[i("pre",el,t(r.domain.dkim_key_selector)+"._domainkey."+t(r.domain.name)+". IN TXT ("+t(_.value)+`)
      }})`,1)]))}},ll={class:"headline"},tl={id:"dkimpub",class:"dkim"},al={__name:"DomainDKIMKey",props:{domain:{type:Object,default:null}},emits:["close"],setup(r,{emit:o}){const{$gettext:_}=z(),y=o;function a(){navigator.clipboard.writeText(document.getElementById("dkimpub").textContent)}return(v,f)=>(n(),c(K,null,{default:l(()=>[e(B,null,{default:l(()=>[i("span",ll,t(u(_)("DKIM public key for"))+" "+t(r.domain.name),1)]),_:1}),e(A,null,{default:l(()=>[i("p",null,t(u(_)("Raw format. Click to copy")),1),e(P,{border:"start","colored-border":"","border-color":"primary lighten-3",elevation:"2",dense:""},{default:l(()=>[i("button",{class:"dkimbutton",onClick:f[0]||(f[0]=V=>a())},[i("pre",tl,t(r.domain.dkim_public_key),1)])]),_:1})]),_:1}),e(A,null,{default:l(()=>[i("p",null,t(u(_)("Bind/named format. Click to copy")),1),e(P,{border:"start","colored-border":"","border-color":"primary lighten-3",elevation:"2",dense:""},{default:l(()=>[e(ge,{domain:r.domain},null,8,["domain"])]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(G),e(w,{onClick:f[1]||(f[1]=V=>y("close"))},{default:l(()=>[s(t(u(_)("Close")),1)]),_:1})]),_:1})]),_:1}))}},ol={class:"text-subtitle-1 text-grey-darken-2 mb-4"},nl={class:"text-h6"},sl={__name:"DomainDNSConfig",props:{domain:{type:Object,default:null}},emits:["close"],setup(r,{emit:o}){const _=o;return(y,a)=>(n(),c(K,null,{default:l(()=>[e(B,{class:"text-h5"},{default:l(()=>[i("span",null,t(y.$gettext("DNS configuration for "))+" "+t(r.domain.name),1)]),_:1}),e(A,null,{default:l(()=>[i("p",ol,t(y.$gettext("Here is an example of DNS configuration (bind format). Replace values between [ ] by the appropriate ones.")),1),e(P,{class:"mb-4",border:"start","border-color":"primary lighten-3",elevation:"2",color:"white"},{default:l(()=>[a[1]||(a[1]=i("div",{class:"text-h6"},"MX",-1)),i("pre",null,[s("mail."+t(r.domain.name)+". IN A ",1),i("strong",null,"["+t(y.$gettext("IP address of your Modoboa server"))+"]",1),s(`
@ IN MX 10 mail.`+t(r.domain.name)+".",1)])]),_:1,__:[1]}),e(P,{class:"mb-4",border:"start","border-color":"primary lighten-3",elevation:"2",dense:"",color:"white"},{default:l(()=>a[2]||(a[2]=[i("div",{class:"text-h6"},"SPF",-1),i("pre",null,'@ IN TXT "v=spf1 mx ~all"',-1)])),_:1,__:[2]}),r.domain.enable_dkim&&r.domain.dkim_public_key?(n(),c(P,{key:0,class:"mb-4",border:"start","border-color":"primary lighten-3",elevation:"2",dense:"",color:"white"},{default:l(()=>[a[3]||(a[3]=i("div",{class:"text-h6"},"DKIM",-1)),e(ge,{domain:r.domain},null,8,["domain"])]),_:1,__:[3]})):C("",!0),e(P,{class:"mb-4",border:"start","border-color":"primary lighten-3",elevation:"2",dense:"",color:"white"},{default:l(()=>[a[4]||(a[4]=i("div",{class:"text-h6"},"DMARC",-1)),i("pre",null,"_dmarc."+t(r.domain.name)+'. IN TXT "v=DMARC1; p=quarantine; pct=100;"',1)]),_:1,__:[4]}),e(P,{class:"mb-4",border:"start","border-color":"primary lighten-3",elevation:"2",dense:"",color:"white"},{default:l(()=>[i("div",nl,t(y.$gettext("Auto configuration")),1),i("pre",null,[s("autoconfig."+t(r.domain.name)+". IN CNAME ",1),i("strong",null,"["+t(y.$gettext("hostname of your automx server"))+"]",1),s(`
autodiscover.`+t(r.domain.name)+". IN CNAME ",1),i("strong",null,"["+t(y.$gettext("hostname of your automx server"))+"]",1)])]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(G),e(w,{onClick:a[0]||(a[0]=v=>_("close"))},{default:l(()=>[s(t(y.$gettext("Close")),1)]),_:1})]),_:1})]),_:1}))}},ul=fe(sl,[["__scopeId","data-v-506783e1"]]),il={__name:"DNSBLSummary",props:{mxrecord:{type:Object,default:null}},emits:["close"],setup(r,{emit:o}){const _=r,y=o;return(a,v)=>(n(),c(K,null,{default:l(()=>[e(B,{class:"text-h5"},{default:l(()=>[i("span",null,t(a.$gettext("DNSBL summary for "))+" "+t(_.mxrecord.name),1)]),_:1}),e(A,null,{default:l(()=>[s(t(a.$gettext("IP address %{ address } is currently listed by the following DNSBL providers:",{address:r.mxrecord.address}))+" ",1),e(Ie,null,{default:l(()=>[(n(!0),h(T,null,Y(_.mxrecord.dnsbl_results,f=>(n(),c(Te,{key:f.provider},{default:l(()=>[s(t(f.provider)+" ("+t(f.status)+") ",1)]),_:2},1024))),128))]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(G),e(w,{onClick:v[0]||(v[0]=f=>y("close"))},{default:l(()=>[s(t(a.$gettext("Close")),1)]),_:1})]),_:1})]),_:1}))}},dl={class:"mt-4 overline"},rl={class:"mt-4 overline"},ml={key:4,class:"d-flex align-center flex-nowrap mt-4"},cl={class:"text-subtitle-2"},fl={class:"ml-6"},_l={key:0},pl={key:1},vl={__name:"DNSDetail",props:{modelValue:{type:Object,default:null}},setup(r){const{$gettext:o}=z(),_=he(),y=r,a=R(()=>y.modelValue),v=D(),f=D({}),V=D([{title:o("Name"),value:"name"},{title:o("Address"),value:"address"},{title:o("Updated"),value:"updated"},{title:"",value:"issues"}]),g=D(!1),p=D(null),m=D(!1),b=D(!1),L=D(!1);function F(){navigator.clipboard.writeText(a.value.dkim_public_key),_.displayNotification({msg:o("DKIM key copied to clipboard"),type:"success"})}function I(){const S={dkim_private_key_path:""};E.patchDomain(a.value.pk,S).then(()=>{_.displayNotification({msg:o("A new key will be generated soon. Refresh the page in a moment to see it."),type:"success"}),a.value.dkim_private_key_path="",g.value=!1}).catch(()=>{g.value=!1})}function J(){g.value=!1}async function Z(){g.value=!0,E.getDomainDNSDetail(a.value.pk).then(async S=>{f.value=S.data,await v.value.open(o("warning"),o("DKIM key does not seem to be generated yet or has failed. Do you want to requeue the job?"),{color:"warning",cancelLabel:o("No"),agreeLabel:o("Yes")})?I():J()})}function ee(){v.value.open(o("Warning"),o("DKIM keys already exist for this domain. Do you want to overwrite them?"),{color:"error",cancelLabel:o("No"),agreeLabel:o("Yes")})}function le(S){p.value=S,L.value=!0}return ie(a,S=>{S&&E.getDomainDNSDetail(S.pk).then(x=>{f.value=x.data})},{immediate:!0}),(S,x)=>{const U=ce("translate");return a.value?(n(),c(K,{key:0},{default:l(()=>[e(B,null,{default:l(()=>[x[8]||(x[8]=i("span",null," DNS ",-1)),e(w,{class:"ml-2",icon:"mdi-information-outline",title:u(o)("DNS configuration help"),variant:"text",density:"compact",onClick:x[0]||(x[0]=k=>m.value=!0)},null,8,["title"])]),_:1,__:[8]}),e(A,null,{default:l(()=>[e(U,{class:"overline"},{default:l(()=>x[9]||(x[9]=[s("MX records")])),_:1,__:[9]}),a.value.dns_global_status=="pending"?(n(),c($,{key:0},{default:l(()=>[e(d,null,{default:l(()=>[e(N,{color:"info",size:"small"},{default:l(()=>[s(t(u(o)("Pending")),1)]),_:1})]),_:1})]),_:1})):(n(),c(Ke,{key:1,headers:V.value,items:f.value.mx_records},{"item.updated":l(({item:k})=>[s(t(S.$date(k.updated)),1)]),"item.issues":l(({item:k})=>[k.dnsbl_results.length?(n(),c(w,{key:0,icon:"mdi-bell",color:"error",variant:"flat",size:"x-small",onClick:j=>le(k)},null,8,["onClick"])):C("",!0)]),_:2},1032,["headers","items"])),i("div",dl,t(u(o)("Auto configuration")),1),a.value.dns_global_status=="pending"?(n(),c($,{key:2},{default:l(()=>[e(d,null,{default:l(()=>[e(N,{color:"info",size:"small"},{default:l(()=>[s(t(u(o)("Pending")),1)]),_:1})]),_:1})]),_:1})):(n(),h(T,{key:3},[e($,null,{default:l(()=>[e(d,null,{default:l(()=>[f.value.autoconfig_record?(n(),c(N,{key:0,color:"success"},{default:l(()=>[s(t(u(o)("autoconfig record (Mozilla): %{ value }",{value:f.value.autoconfig_record.value})),1)]),_:1})):(n(),c(N,{key:1,color:"warning"},{default:l(()=>[s(t(u(o)("autoconfig record (Mozilla) not found")),1)]),_:1}))]),_:1}),e(d,null,{default:l(()=>[f.value.autodiscover_record?(n(),c(N,{key:0,color:"success"},{default:l(()=>[s(t(u(o)("autodiscover record (Microsoft): %{ value }",{value:f.value.autodiscover_record.value})),1)]),_:1})):(n(),c(N,{key:1,color:"warning"},{default:l(()=>[s(t(u(o)("autodiscover record (Microsoft) not found")),1)]),_:1}))]),_:1})]),_:1}),i("div",rl,t(u(o)("Authentication")),1),e($,null,{default:l(()=>[e(d,null,{default:l(()=>[f.value.spf_record?(n(),c(N,{key:0,color:"success"},{default:l(()=>[s(t(u(o)("SPF record found")),1)]),_:1})):(n(),c(N,{key:1,color:"error"},{default:l(()=>[s(t(u(o)("SPF record not found")),1)]),_:1}))]),_:1}),e(d,null,{default:l(()=>[f.value.dkim_record?(n(),c(N,{key:0,color:"success"},{default:l(()=>[s(t(u(o)("DKIM record found")),1)]),_:1})):(n(),c(N,{key:1,color:"error"},{default:l(()=>[s(t(u(o)("DKIM record not found")),1)]),_:1}))]),_:1}),e(d,null,{default:l(()=>[f.value.dmarc_record?(n(),c(N,{key:0,color:"success"},{default:l(()=>[s(t(u(o)("DMARC record found")),1)]),_:1})):(n(),c(N,{key:1,color:"error"},{default:l(()=>[s(t(u(o)("DMARC record not found")),1)]),_:1}))]),_:1})]),_:1})],64)),a.value.enable_dkim?(n(),h("div",ml,[i("div",cl,t(u(o)("DKIM key")),1),i("div",fl,[a.value.dkim_private_key_path&&a.value.dkim_public_key?(n(),h("div",_l,[e(w,{color:"primary",size:"small",onClick:x[1]||(x[1]=k=>b.value=!0)},{default:l(()=>[s(t(u(o)("Show key")),1)]),_:1}),e(w,{icon:"mdi-content-copy",variant:"text",class:"ml-2",title:u(o)("Copy key to clipboard"),onClick:F},null,8,["title"]),e(w,{icon:"mdi-refresh",title:u(o)("Generate a new DKIM key"),variant:"text",loading:g.value,onClick:ee},null,8,["title","loading"])])):(n(),h("div",pl,[s(t(u(o)("Not generated"))+" ",1),e(w,{icon:"mdi-reload",color:"primary",variant:"text",loading:g.value,onClick:Z},null,8,["loading"])]))])])):C("",!0)]),_:1}),e(H,{modelValue:m.value,"onUpdate:modelValue":x[3]||(x[3]=k=>m.value=k),"max-width":"800px",persistent:""},{default:l(()=>[e(ul,{domain:a.value,onClose:x[2]||(x[2]=k=>m.value=!1)},null,8,["domain"])]),_:1},8,["modelValue"]),e(H,{modelValue:b.value,"onUpdate:modelValue":x[5]||(x[5]=k=>b.value=k),"max-width":"800px",persistent:""},{default:l(()=>[e(al,{domain:a.value,onClose:x[4]||(x[4]=k=>b.value=!1)},null,8,["domain"])]),_:1},8,["modelValue"]),e(H,{modelValue:L.value,"onUpdate:modelValue":x[7]||(x[7]=k=>L.value=k),"max-width":"800px",persistent:""},{default:l(()=>[e(il,{mxrecord:p.value,onClose:x[6]||(x[6]=k=>L.value=!1)},null,8,["mxrecord"])]),_:1},8,["modelValue"]),e(Ae,{ref_key:"dialog",ref:v},null,512)]),_:1})):C("",!0)}}},yl={class:"headline"},gl={__name:"DomainSummary",props:{domain:{type:Object,default:null}},setup(r){const{$gettext:o}=z();return(_,y)=>r.domain?(n(),c(K,{key:0},{default:l(()=>[e(B,null,{default:l(()=>[i("div",yl,t(u(o)("General information")),1)]),_:1}),e(A,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Creation date")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[s(t(_.$date(r.domain.creation)),1)]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Last modification date")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[s(t(_.$date(r.domain.last_modification)),1)]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Quota")),1)]),_:1}),r.domain.quota==="0"?(n(),c(d,{key:0,cols:"6"},{default:l(()=>[s(t(u(o)("Unlimited")),1)]),_:1})):(n(),c(d,{key:1,cols:"6"},{default:l(()=>[s(t(r.domain.quota)+" "+t(u(o)("MB")),1)]),_:1}))]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Default mailbox quota")),1)]),_:1}),r.domain.default_mailbox_quota==="0"?(n(),c(d,{key:0,cols:"6"},{default:l(()=>[s(t(u(o)("Unlimited")),1)]),_:1})):(n(),c(d,{key:1,cols:"6"},{default:l(()=>[s(t(r.domain.default_mailbox_quota)+" MB",1)]),_:1}))]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Daily sending limit")),1)]),_:1}),r.domain.message_limit!==void 0&&r.domain.message_limit!==null?(n(),c(d,{key:0,cols:"6"},{default:l(()=>[r.domain.message_limit===0?(n(),h(T,{key:0},[s(t(u(o)("Sending forbidden")),1)],64)):(n(),c(De,{key:1,color:r.domain.sent_messages_in_percent<80?"primary":"warning","model-value":r.domain.sent_messages_in_percent,height:"25",class:"white--text"},{default:l(({value:a})=>[s(t(Math.ceil(a))+"% ("+t(r.domain.message_limit)+" "+t(u(o)("messages"))+") ",1)]),_:1},8,["color","model-value"]))]),_:1})):(n(),c(d,{key:1,cols:"6"},{default:l(()=>[s(t(u(o)("Unlimited")),1)]),_:1}))]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Mailboxes")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[s(t(r.domain.mailbox_count),1)]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Aliases")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[s(t(r.domain.mbalias_count),1)]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(u(o)("Enabled")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[e(u(O),{value:r.domain.enabled,variant:"flat"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0)}},bl={class:"headline"},kl={__name:"RelayDomainSummary",props:{domain:{type:Object,default:null}},async setup(r){let o,_;const y=r,a=D([]),v=R(()=>a.value.find(g=>g.name===y.domain.transport.service)),f=g=>y.domain.transport.settings[`${v.value.name}_${g}`],V=([o,_]=_e(()=>je.getAll()),o=await o,_(),o);return a.value=V.data,(g,p)=>y.domain?(n(),c(K,{key:0},{default:l(()=>[e(B,null,{default:l(()=>[i("div",bl,t(g.$gettext("Transport")),1)]),_:1}),e(A,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(g.$gettext("Service")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[s(t(y.domain.transport.service),1)]),_:1})]),_:1}),v.value?(n(!0),h(T,{key:0},Y(v.value.settings,(m,b)=>(n(),c($,{key:b},{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(m.label),1)]),_:2},1024),e(d,{cols:"6"},{default:l(()=>[m.type!=="boolean"?(n(),h(T,{key:0},[s(t(f(m.name)),1)],64)):(n(),c(u(O),{key:1,value:f(m.name),variant:"flat"},null,8,["value"]))]),_:2},1024)]),_:2},1024))),128)):C("",!0)]),_:1})]),_:1})):C("",!0)}},ue={__name:"YesNoDefaultField",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r){const o=$e(r,"modelValue");return(_,y)=>(n(),c(Ue,{modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=a=>o.value=a),inline:""},{default:l(()=>[e(ae,{label:_.$gettext("yes"),value:"Y"},null,8,["label"]),e(ae,{label:_.$gettext("no"),value:"N"},null,8,["label"]),e(ae,{label:_.$gettext("default"),value:""},null,8,["label"])]),_:1},8,["modelValue"]))}},Vl={class:"v-label mb-4"},hl={class:"v-label mb-4"},$l={__name:"DomainPolicyForm",props:{domainId:{type:Number,default:null},modelValue:{type:Object,default:()=>{}}},emits:["close","update:modelValue"],setup(r,{emit:o}){const _=r,y=o,a=D({}),v=D(!1),f=D(!1);a.value={bypass_virus_checks:_.modelValue.bypass_virus_checks===null?"":_.modelValue.bypass_virus_checks,bypass_spam_checks:_.modelValue.bypass_spam_checks===null?"":_.modelValue.bypass_spam_checks,bypass_banned_checks:_.modelValue.bypass_banned_checks===null?"":_.modelValue.bypass_banned_checks,spam_tag2_level:_.modelValue.spam_tag2_level,spam_kill_level:_.modelValue.spam_kill_level,spam_subject_tag2:_.modelValue.spam_subject_tag2},a.value.spam_subject_tag2===null&&(f.value=!0);const V=p=>{p&&(a.value.spam_subject_tag2=null)},g=async()=>{v.value=!0;const p={...a.value};p.spam_tag2_level===""&&(p.spam_tag2_level=null),p.spam_kill_level===""&&(p.spam_kill_level=null);try{const m=await ye.updateDomainPolicy(_.domainId,p);y("update:modelValue",m.data),y("close")}finally{v.value=!1}};return(p,m)=>(n(),c(K,null,{default:l(()=>[e(B,{class:"text-h5"},{default:l(()=>[i("span",null,t(p.$gettext("Content filter settings")),1)]),_:1}),e(A,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[e(u(ue),{modelValue:a.value.bypass_virus_checks,"onUpdate:modelValue":m[0]||(m[0]=b=>a.value.bypass_virus_checks=b),label:p.$gettext("Disable virus checks"),color:"primary","hide-details":""},null,8,["modelValue","label"]),e(u(ue),{modelValue:a.value.bypass_spam_checks,"onUpdate:modelValue":m[1]||(m[1]=b=>a.value.bypass_spam_checks=b),label:p.$gettext("Disable spam checks"),color:"primary",class:"mt-6","hide-details":""},null,8,["modelValue","label"]),e(u(ue),{modelValue:a.value.bypass_banned_checks,"onUpdate:modelValue":m[2]||(m[2]=b=>a.value.bypass_banned_checks=b),label:p.$gettext("Disable banned checks"),color:"primary",class:"mt-6","hide-details":""},null,8,["modelValue","label"])]),_:1}),e(d,{cols:"6"},{default:l(()=>[i("div",null,[i("label",Vl,t(p.$gettext("Spam marker")),1),e($,null,{default:l(()=>[e(d,{cols:"9"},{default:l(()=>[e(oe,{modelValue:a.value.spam_subject_tag2,"onUpdate:modelValue":m[3]||(m[3]=b=>a.value.spam_subject_tag2=b),variant:"outlined",density:"compact",disabled:f.value},null,8,["modelValue","disabled"])]),_:1}),e(d,{cols:"3"},{default:l(()=>[e(Pe,{modelValue:f.value,"onUpdate:modelValue":[m[4]||(m[4]=b=>f.value=b),V],label:p.$gettext("default"),color:"primary",density:"compact","hide-details":""},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",hl,t(p.$gettext("Thresholds")),1),e($,{class:"align-center"},{default:l(()=>[e(d,{cols:"4"},{default:l(()=>[e(oe,{modelValue:a.value.spam_tag2_level,"onUpdate:modelValue":m[5]||(m[5]=b=>a.value.spam_tag2_level=b),variant:"outlined",density:"compact",type:"number","hide-details":""},null,8,["modelValue"])]),_:1}),e(d,{cols:"8"},{default:l(()=>[s(t(p.$gettext("or more is spam")),1)]),_:1})]),_:1}),e($,{class:"align-center"},{default:l(()=>[e(d,{cols:"4"},{default:l(()=>[e(oe,{modelValue:a.value.spam_kill_level,"onUpdate:modelValue":m[6]||(m[6]=b=>a.value.spam_kill_level=b),variant:"outlined",density:"compact",type:"number","hide-details":""},null,8,["modelValue"])]),_:1}),e(d,{cols:"8"},{default:l(()=>[s(t(p.$gettext("or more throw spam message away")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(G),e(w,{loading:v.value,onClick:m[7]||(m[7]=b=>y("close"))},{default:l(()=>[s(t(p.$gettext("Cancel")),1)]),_:1},8,["loading"]),e(w,{color:"primary",loading:v.value,onClick:g},{default:l(()=>[s(t(p.$gettext("Apply")),1)]),_:1},8,["loading"])]),_:1})]),_:1}))}},xl={key:1},Dl={key:1},wl={key:1},Cl={key:0},Sl={key:1},Ml={key:0},Nl={key:1},Il={key:0},Tl={key:1},Al={__name:"DomainPolicy",props:{domain:{type:Object,default:null}},async setup(r){let o,_;const y=r,a=D(null),v=D(!1),f=([o,_]=_e(()=>ye.getDomainPolicy(y.domain.pk)),o=await o,_(),o);return a.value=f.data,(V,g)=>(n(),h("div",null,[a.value?(n(),c(K,{key:0},{default:l(()=>[e(B,null,{default:l(()=>[i("span",null,t(V.$gettext("Content filter")),1),e(w,{class:"ml-2",icon:"mdi-circle-edit-outline",title:V.$gettext("Edit content filter settings"),variant:"text",density:"compact",onClick:g[0]||(g[0]=p=>v.value=!0)},null,8,["title"])]),_:1}),e(A,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Spam filters")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.bypass_spam_checks!==null&&a.value.bypass_spam_checks!==""?(n(),c(u(O),{key:0,value:a.value.bypass_spam_checks!=="Y",variant:"flat"},null,8,["value"])):(n(),h("span",xl,t(V.$gettext("Default value")),1))]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Virus filters")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.bypass_virus_checks!==null&&a.value.bypass_virus_checks!==""?(n(),c(u(O),{key:0,value:a.value.bypass_virus_checks!=="Y",variant:"flat"},null,8,["value"])):(n(),h("span",Dl,t(V.$gettext("Default value")),1))]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Banned filters")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.bypass_banned_checks!==null&&a.value.bypass_banned_checks!==""?(n(),c(u(O),{key:0,value:a.value.bypass_banned_checks!=="Y",variant:"flat"},null,8,["value"])):(n(),h("span",wl,t(V.$gettext("Default value")),1))]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Spam classification threshold")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.spam_tag2_level!==null?(n(),h("span",Cl,t(a.value.spam_tag2_level),1)):(n(),h("span",Sl,t(V.$gettext("Default value")),1))]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Rejection threshold")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.spam_kill_level!==null?(n(),h("span",Ml,t(a.value.spam_kill_level),1)):(n(),h("span",Nl,t(V.$gettext("Default value")),1))]),_:1})]),_:1}),e($,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[s(t(V.$gettext("Spam marker")),1)]),_:1}),e(d,{cols:"6"},{default:l(()=>[a.value.spam_subject_tag2!==null?(n(),h("span",Il,t(a.value.spam_subject_tag2),1)):(n(),h("span",Tl,t(V.$gettext("Default value")),1))]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0),e(H,{modelValue:v.value,"onUpdate:modelValue":g[3]||(g[3]=p=>v.value=p),width:"1000"},{default:l(()=>[e(u($l),{modelValue:a.value,"onUpdate:modelValue":g[1]||(g[1]=p=>a.value=p),"domain-id":y.domain.pk,onClose:g[2]||(g[2]=p=>v.value=!1)},null,8,["modelValue","domain-id"])]),_:1},8,["modelValue"])]))}},Kl={key:1},jl={__name:"DomainView",setup(r){const{$gettext:o}=z(),_=xe(),y=ze(),a=D(null),v=D({}),f=D(null),V=R(()=>"amavis"in y.capabilities);function g(){E.getDomain(_.params.id).then(p=>{a.value=p.data})}return g(),(p,m)=>a.value?(n(),h("div",Kl,[e(pe,{flat:""},{default:l(()=>[e(ve,null,{default:l(()=>[s(t(u(o)("Domain"))+" "+t(a.value.name)+" ",1),e(w,{color:"primary",icon:"mdi-circle-edit-outline",to:{name:"DomainEdit",params:{id:a.value.pk}}},null,8,["to"]),e(w,{color:"primary",icon:"mdi-reload",onClick:m[0]||(m[0]=b=>g())})]),_:1})]),_:1}),e(Fe,{modelValue:f.value,"onUpdate:modelValue":m[1]||(m[1]=b=>f.value=b),class:"mb-4",color:"primary"},{default:l(()=>[e(ne,null,{default:l(()=>[s(t(u(o)("General")),1)]),_:1}),e(ne,null,{default:l(()=>[s(t(u(o)("Statistics")),1)]),_:1}),e(ne,null,{default:l(()=>[s(t(u(o)("DMARC")),1)]),_:1})]),_:1},8,["modelValue"]),e(Re,{modelValue:f.value,"onUpdate:modelValue":m[3]||(m[3]=b=>f.value=b)},{default:l(()=>[e(se,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"12",md:"6"},{default:l(()=>[e(gl,{domain:a.value},null,8,["domain"]),m[5]||(m[5]=i("div",{class:"mt-4"},null,-1)),a.value.type==="relaydomain"?(n(),h(T,{key:0},[e(kl,{domain:a.value},null,8,["domain"]),m[4]||(m[4]=i("div",{class:"mt-4"},null,-1))],64)):C("",!0),e(ke,{domain:a.value},null,8,["domain"]),m[6]||(m[6]=i("div",{class:"mt-4"},null,-1)),V.value?(n(),c(Al,{key:1,domain:a.value},null,8,["domain"])):C("",!0)]),_:1,__:[5,6]}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(vl,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=b=>a.value=b)},null,8,["modelValue"]),m[7]||(m[7]=i("div",{class:"mt-4"},null,-1)),v.value.params&&v.value.params.enable_domain_limits&&a.value.resources&&a.value.resources.length?(n(),c(Le,{key:0,resources:a.value.resources},null,8,["resources"])):C("",!0)]),_:1,__:[7]})]),_:1})]),_:1}),e(se,null,{default:l(()=>[e($,null,{default:l(()=>[e(d,{cols:"12"},{default:l(()=>[a.value.name?(n(),c(re,{key:0,domain:a.value,"graphic-set":"mailtraffic","graphic-name":"averagetraffic"},null,8,["domain"])):C("",!0)]),_:1}),e(d,{cols:"12"},{default:l(()=>[a.value.name?(n(),c(re,{key:0,domain:a.value,"graphic-set":"mailtraffic","graphic-name":"averagetrafficsize"},null,8,["domain"])):C("",!0)]),_:1})]),_:1})]),_:1}),e(se,null,{default:l(()=>[e(Ze,{domain:a.value},null,8,["domain"])]),_:1})]),_:1},8,["modelValue"])])):(n(),c(Be,{key:0}))}},Dt=fe(jl,[["__scopeId","data-v-11fbb076"]]);export{Dt as default};
