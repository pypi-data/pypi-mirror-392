import{q as g,r,j as e,Y as j,C as v,e as B,f as S,k as D,g as E,T as A,b as z,c as _,d as F,ac as L,l as M,ad as H,B as p,m as R,n as Y,o as I,p as V,W as $}from"./index-DxSNfwTo.js";import{H as q,Y as O}from"./YamlEditor-jynfrHxa.js";import{d as W,l as G}from"./js-yaml-yTPt38rv.js";import{t as c}from"./index-Dj-YiGsJ.js";import{C as K}from"./circle-check-CRLqg4AR.js";const P=[["path",{d:"M4 12.15V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3.35",key:"1wthlu"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m5 16-3 3 3 3",key:"331omg"}],["path",{d:"m9 22 3-3-3-3",key:"lsp7cz"}]],J=g("file-code-corner",P);const Q=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],U=g("triangle-alert",Q),f=[{value:"config",label:"Main Config",description:"Project and database configuration"},{value:"import",label:"Import",description:"Data import sources configuration"},{value:"transform",label:"Transform",description:"Data transformation pipeline"},{value:"export",label:"Export",description:"Static site export configuration"}];function X({configName:i}){const{config:n,loading:s,error:d,updateConfig:N,listBackups:u,restoreBackup:y}=L(i),[l,m]=r.useState(!1),[o,C]=r.useState([]),[k,h]=r.useState(!1);r.useEffect(()=>{l&&(h(!0),u().then(a=>{C(a.backups||[]),h(!1)}))},[l,u]);const b=async a=>{try{const t=G(a),x=await N({content:t,backup:!0});c.success("Configuration saved",{description:x.backup_path?`Backup created: ${x.backup_path.split("/").pop()}`:"Configuration saved successfully"})}catch(t){throw t instanceof Error&&c.error("Failed to save configuration",{description:t.message}),t}},w=async a=>{try{await y(a),c.success("Configuration restored",{description:`Restored from ${a}`}),m(!1)}catch(t){t instanceof Error&&c.error("Failed to restore configuration",{description:t.message})}};if(s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading configuration..."})});if(d)return e.jsxs(j,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs("div",{className:"ml-2",children:["Failed to load configuration: ",d]})]});const T=n?W(n,{indent:2,lineWidth:-1}):"";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium",children:[i,".yml"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Edit your ",i," configuration. Changes are automatically backed up."]})]}),e.jsxs(M,{open:l,onOpenChange:m,children:[e.jsx(H,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"View Backups (",o?.length||0,")"]})}),e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(Y,{children:[e.jsx(I,{children:"Configuration Backups"}),e.jsx(V,{children:"Select a backup to restore. Current configuration will be backed up automatically."})]}),e.jsx($,{className:"h-96",children:k?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:"Loading backups..."}):o&&o.length>0?e.jsx("div",{className:"space-y-2 pr-4",children:o.map(a=>e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium font-mono",children:a.filename}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.modified).toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Size: ",(a.size/1024).toFixed(2)," KB"]})]}),e.jsx(p,{size:"sm",onClick:()=>w(a.filename),children:"Restore"})]})},a.filename))}):e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:"No backups available"})})]})]})]}),e.jsx(O,{value:T,onSave:b,configName:i,showToolbar:!0,height:"calc(100vh - 350px)"})]})}function ie(){const[i,n]=r.useState("config");return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Configuration Editor"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Edit your Niamoto configuration files with automatic backup and restore functionality"})]})}),e.jsxs(j,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsxs("div",{className:"ml-2 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Automatic Backups"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Every time you save a configuration, a backup is automatically created. You can restore previous versions at any time from the backup list."})]})]}),e.jsxs(v,{children:[e.jsxs(B,{children:[e.jsx(S,{children:"Configuration Files"}),e.jsx(D,{children:"Select a configuration file to edit"})]}),e.jsx(E,{children:e.jsxs(A,{value:i,onValueChange:s=>n(s),children:[e.jsx(z,{className:"grid w-full grid-cols-4",children:f.map(s=>e.jsx(_,{value:s.value,children:s.label},s.value))}),f.map(s=>e.jsxs(F,{value:s.value,className:"mt-6",children:[e.jsx("div",{className:"mb-4 p-4 bg-muted/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})}),e.jsx(X,{configName:s.value})]},s.value))]})})]})]})}export{ie as ConfigEditor};
