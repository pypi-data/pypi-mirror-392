import{al as M,am as _,an as a,r as u,ao as L,j as e,C as D,e as S,f as P,k as $,B as i,a8 as V,g as I,D as N,P as w,F as W,$ as B,ab as R,ap as F,aq as H,ar as Y,as as q,T as G,b as O,c as g,d as h,W as f,at as d,au as c,V as o}from"./index-DxSNfwTo.js";import{D as U}from"./DemoWrapper-BBh5iNb5.js";import{d as b}from"./js-yaml-yTPt38rv.js";import{C as J}from"./code-XwOALPA4.js";import{S as v}from"./settings-2-DSf9mI6l.js";import{F as C}from"./file-output-BDzy7Qas.js";import"./arrow-right-jYSyL5Rl.js";function K({data:s}){return e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[s.type==="csv"&&e.jsx(o,{variant:"outline",className:"text-xs",children:"CSV"}),s.type==="shapefile"&&e.jsx(o,{variant:"outline",className:"text-xs",children:"Shapefile"}),s.type==="raster"&&e.jsx(o,{variant:"outline",className:"text-xs",children:"Raster"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.path}),e.jsx(d,{type:"source",position:c.Right,className:"!bg-blue-600"})]})}function Q({data:s}){return e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-lg p-4 min-w-[220px]",children:[e.jsx(d,{type:"target",position:c.Left,className:"!bg-green-600"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{variant:"secondary",className:"text-xs",children:s.plugin}),s.widgets&&e.jsxs("div",{className:"text-xs text-gray-600",children:[s.widgets.length," widget",s.widgets.length>1?"s":""]})]}),e.jsx(d,{type:"source",position:c.Right,className:"!bg-green-600"})]})}function X({data:s}){return e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-4 min-w-[180px]",children:[e.jsx(d,{type:"target",position:c.Left,className:"!bg-purple-600"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]}),e.jsx(o,{variant:"outline",className:"text-xs",children:s.plugin}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.title})]})}function Z({data:s}){return e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-lg p-4 min-w-[200px]",children:[e.jsx(d,{type:"target",position:c.Left,className:"!bg-orange-600"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[s.type==="html"&&e.jsx(o,{variant:"outline",className:"text-xs",children:"HTML"}),s.type==="api"&&e.jsx(o,{variant:"outline",className:"text-xs",children:"API"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.output})]})}const ee={import:K,transform:Q,widget:X,export:Z},se=[{id:"import-taxonomy",type:"import",position:{x:50,y:100},data:{label:"Taxonomy",type:"csv",path:"imports/occurrences.csv"}},{id:"import-occurrences",type:"import",position:{x:50,y:200},data:{label:"Occurrences",type:"csv",path:"imports/occurrences.csv"}},{id:"import-plots",type:"import",position:{x:50,y:300},data:{label:"Plots",type:"csv",path:"imports/plots.csv"}},{id:"import-shapes",type:"import",position:{x:50,y:400},data:{label:"Shapes",type:"shapefile",path:"imports/shapes/*.gpkg"}},{id:"transform-taxon",type:"transform",position:{x:350,y:150},data:{label:"Taxon Transform",plugin:"nested_set",widgets:["general_info","distribution_map","top_species"]}},{id:"transform-plot",type:"transform",position:{x:350,y:350},data:{label:"Plot Transform",plugin:"stats_loader",widgets:["general_info","map_panel"]}},{id:"widget-map",type:"widget",position:{x:650,y:100},data:{label:"Map Widget",plugin:"interactive_map",title:"Distribution géographique"}},{id:"widget-info",type:"widget",position:{x:650,y:200},data:{label:"Info Grid",plugin:"info_grid",title:"Informations générales"}},{id:"widget-chart",type:"widget",position:{x:650,y:300},data:{label:"Bar Chart",plugin:"bar_plot",title:"Distribution DBH"}},{id:"export-web",type:"export",position:{x:900,y:150},data:{label:"Web Export",type:"html",output:"exports/web"}},{id:"export-api",type:"export",position:{x:900,y:250},data:{label:"API Export",type:"api",output:"exports/api"}}],te=[{id:"e1",source:"import-taxonomy",target:"transform-taxon",animated:!0,style:{stroke:"#3b82f6"},markerEnd:{type:a.ArrowClosed,color:"#3b82f6"}},{id:"e2",source:"import-occurrences",target:"transform-taxon",animated:!0,style:{stroke:"#3b82f6"},markerEnd:{type:a.ArrowClosed,color:"#3b82f6"}},{id:"e3",source:"import-plots",target:"transform-plot",animated:!0,style:{stroke:"#3b82f6"},markerEnd:{type:a.ArrowClosed,color:"#3b82f6"}},{id:"e4",source:"transform-taxon",target:"widget-map",style:{stroke:"#10b981"},markerEnd:{type:a.ArrowClosed,color:"#10b981"}},{id:"e5",source:"transform-taxon",target:"widget-info",style:{stroke:"#10b981"},markerEnd:{type:a.ArrowClosed,color:"#10b981"}},{id:"e6",source:"transform-plot",target:"widget-chart",style:{stroke:"#10b981"},markerEnd:{type:a.ArrowClosed,color:"#10b981"}},{id:"e7",source:"widget-map",target:"export-web",style:{stroke:"#8b5cf6"},markerEnd:{type:a.ArrowClosed,color:"#8b5cf6"}},{id:"e8",source:"widget-info",target:"export-web",style:{stroke:"#8b5cf6"},markerEnd:{type:a.ArrowClosed,color:"#8b5cf6"}},{id:"e9",source:"widget-chart",target:"export-api",style:{stroke:"#8b5cf6"},markerEnd:{type:a.ArrowClosed,color:"#8b5cf6"}}];function ce(){const[s,k,E]=M(se),[A,j,T]=_(te),[m,y]=u.useState("visual"),z=u.useCallback(t=>{const l={...t,animated:!0,style:{stroke:"#64748b"},markerEnd:{type:a.ArrowClosed,color:"#64748b"}};j(n=>L(l,n))},[j]),p=t=>{const l={id:`${t}-${Date.now()}`,type:t,position:{x:Math.random()*400+200,y:Math.random()*400+100},data:{label:`New ${t}`,...t==="import"&&{type:"csv",path:"path/to/file"},...t==="transform"&&{plugin:"field_aggregator",widgets:[]},...t==="widget"&&{plugin:"info_grid",title:"New Widget"},...t==="export"&&{type:"html",output:"exports/output"}}};k(n=>[...n,l])},x=u.useMemo(()=>{try{const t={},l=[],n=[];return s.forEach(r=>{r.type==="import"?t[r.data.label.toLowerCase()]={type:r.data.type,path:r.data.path}:r.type==="transform"?l.push({group_by:r.data.label.toLowerCase().replace(" transform",""),plugin:r.data.plugin,widgets_data:r.data.widgets}):r.type==="export"&&n.push({name:r.data.label.toLowerCase().replace(" export",""),type:r.data.type,output:r.data.output})}),{import:b(t,{indent:2}),transform:b(l,{indent:2}),export:b({exports:n},{indent:2})}}catch{return{import:"# Error generating YAML",transform:"# Error generating YAML",export:"# Error generating YAML"}}},[s]);return e.jsx(U,{currentDemo:"pipeline-visual",children:e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsxs(D,{className:"h-full",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Pipeline Visual Editor"}),e.jsx($,{children:"Glissez-déposez pour créer des connexions entre les nœuds du pipeline"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:m==="visual"?"default":"outline",size:"sm",onClick:()=>y("visual"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Visuel"]}),e.jsxs(i,{variant:m==="yaml"?"default":"outline",size:"sm",onClick:()=>y("yaml"),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"YAML"]})]})]})}),e.jsx(I,{className:"p-0 h-[calc(100%-80px)]",children:m==="visual"?e.jsxs("div",{className:"relative h-full",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>p("import"),children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Import"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>p("transform"),children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"Transform"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>p("widget"),children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Widget"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>p("export"),children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Export"]})]}),e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Sauvegarder"]}),e.jsxs(i,{size:"sm",variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Exporter"]}),e.jsxs(i,{size:"sm",variant:"outline",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Importer"]})]}),e.jsxs(F,{nodes:s,edges:A,onNodesChange:E,onEdgesChange:T,onConnect:z,nodeTypes:ee,fitView:!0,children:[e.jsx(H,{}),e.jsx(Y,{nodeColor:t=>{switch(t.type){case"import":return"#3b82f6";case"transform":return"#10b981";case"widget":return"#8b5cf6";case"export":return"#f97316";default:return"#64748b"}}}),e.jsx(q,{variant:"dots",gap:12,size:1})]})]}):e.jsx("div",{className:"h-full p-4",children:e.jsxs(G,{defaultValue:"import",className:"h-full",children:[e.jsxs(O,{children:[e.jsx(g,{value:"import",children:"import.yml"}),e.jsx(g,{value:"transform",children:"transform.yml"}),e.jsx(g,{value:"export",children:"export.yml"})]}),e.jsx(h,{value:"import",className:"h-[calc(100%-50px)]",children:e.jsx(f,{className:"h-full rounded-md border p-4",children:e.jsx("pre",{className:"text-sm font-mono",children:e.jsx("code",{children:x.import})})})}),e.jsx(h,{value:"transform",className:"h-[calc(100%-50px)]",children:e.jsx(f,{className:"h-full rounded-md border p-4",children:e.jsx("pre",{className:"text-sm font-mono",children:e.jsx("code",{children:x.transform})})})}),e.jsx(h,{value:"export",className:"h-[calc(100%-50px)]",children:e.jsx(f,{className:"h-full rounded-md border p-4",children:e.jsx("pre",{className:"text-sm font-mono",children:e.jsx("code",{children:x.export})})})})]})})})]})})})}export{ce as PipelineVisualDemo};
