name: Build Tests
on:
  workflow_call:
  workflow_dispatch:  # to trigger manually

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          python-version: '3.13'
          activate-environment: true

      - name: Build package
        run: |
          uv build

      - name: Install package
        run: |
          uv pip install dist/*.whl

      - name: Inspect package
        run: |
          uv pip show hatchling_autoextras_hook

      - name: Show dependency tree
        shell: bash
        run: |
          uv pip tree --package hatchling_autoextras_hook --show-version-specifiers

      - name: Import package
        run: |
          python -c "import hatchling_autoextras_hook; print('OK')"
