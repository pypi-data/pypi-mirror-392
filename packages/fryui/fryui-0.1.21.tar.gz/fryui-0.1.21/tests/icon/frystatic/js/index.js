var mt=async function(){let{nrow:h,resizable:e}=this.fryargs;this.hgutters=o=>{let f=this.fryelement.children.item(o);if(f&&f.frycomponents&&f.frycomponents.length>0){let d=f.frycomponents[0];if(d.isGutter)return[d]}return[]},this.vgutters=o=>{let f=[];for(let d=0;d<h;d++){let p=this.fryelement.children.item(d);if(p&&p.frycomponents&&p.frycomponents.length>0){let m=p.frycomponents[0];m.isGutter&&f.push(m)}}return f},this.fryembeds=[]};var yt=async function(){let{gutters:h,ncol:e,nrow:o,resizable:f}=this.fryargs;this.hgutters=d=>{let p=[];for(let m=0;m<e;m++){let z=d*e+m,l=this.fryelement.children.item(z);if(l&&l.frycomponents&&l.frycomponents.length>0){let E=l.frycomponents[0];E.isGutter&&p.push(E)}}return p},this.vgutters=d=>{let p=[];for(let m=0;m<o;m++){let z=m*e+d,l=this.fryelement.children.item(z);if(l&&l.frycomponents&&l.frycomponents.length>0){let E=l.frycomponents[0];E.isGutter&&p.push(E)}}return p},this.fryembeds=[]};var gt=async function(){let{ncol:h,resizable:e}=this.fryargs;this.hgutters=o=>{let f=[];for(let d=0;d<h;d++){let p=this.fryelement.children.item(d);if(p&&p.frycomponents&&p.frycomponents.length>0){let m=p.frycomponents[0];m.isGutter&&f.push(m)}}return f},this.vgutters=o=>{let f=this.fryelement.children.item(o);if(f&&f.frycomponents&&f.frycomponents.length>0){let d=f.frycomponents[0];if(d.isGutter)return[d]}return[]},this.fryembeds=[]};var wt=async function(){let{grid:h,topGutter:e,bottomGutter:o}=this.fryargs,f=(t,i)=>Number(t.slice(0,-1*i.length)),d=function(t){return t.endsWith("px")?{value:t,type:"px",numeric:f(t,"px")}:t.endsWith("fr")?{value:t,type:"fr",numeric:f(t,"fr")}:t.endsWith("%")?{value:t,type:"%",numeric:f(t,"%")}:t==="auto"?{value:t,type:"auto"}:null},p=t=>t.value?t.value:`${t.numeric}${t.type}`,m=t=>t.split(" ").map(d),z=t=>t.map(p).join(" "),l=5,E="grid-template-rows",N=(t,i)=>{for(let g=0;g<t.length;g++)if(t[g].type==i&&t[g].numeric>0)return g;return null},r=[],n=[],a=[],y=[],u=0,w=0,v=()=>{r=[],n=[],a=[],y=[],u=0,w=0;let t=h.style[E];if(t&&(r=m(t)),t=window.getComputedStyle(h)[E],t&&(n=m(t)),a=r.filter(i=>i.type==="fr"),a.length){let i=N(r,"fr");i!==null&&(u=n[i].numeric/r[i].numeric)}if(y=r.filter(i=>i.type==="%"),y.length){let i=N(r,"%");i!==null&&(w=n[i].numeric/r[i].numeric)}},x=(t,i)=>{r[t].value=null,r[t].type==="px"?r[t].numeric=i:r[t].type==="fr"?a.length===1?r[t].numeric=1:u!==0&&(r[t].numeric=i/u):r[t].type==="%"&&w!==0&&(r[t].numeric=i/w)};this.broaden=()=>{v();let t=n[0].numeric,i=n[2].numeric,g=n[4].numeric;t<=l||g<=l||(t-=l,g-=l,i+=l+l,x(0,t),x(2,i),x(4,g),h.style[E]=z(r))},this.narrow=()=>{v();let t=n[0].numeric,i=n[2].numeric,g=n[4].numeric;i<=l+l||(t+=l,g+=l,i-=l+l,x(0,t),x(2,i),x(4,g),h.style[E]=z(r))},this.setCentered=t=>{t&&!e.centered&&(h.style[E]="1fr 1px 2fr 1px 1fr"),e.centered=t,o.centered=t},this.isCentered=()=>e.centered,this.hgutters=t=>{if(t===1)return[e];if(t===3)return[o]},this.vgutters=t=>[e,o],this.fryembeds=[]};var St=async function(){let{bar:h,el:e,ish:o,isv:f,cursor:d,col:p,row:m,ncol:z,nrow:l,resizable:E,center:N}=this.fryargs,r=!1,n=[],a=[],y=[],u=[],w=0,v=0,x=0,t=0,i=0,g=0,R=[],V=[],k=0,Q=0,B=[],tt=[],et=0,rt=0,st=0,nt=0,M=0,xt,Et,$,Lt,j,_t,D="grid-template-columns",Y="grid-template-rows",it="bg-primarya",_=e.parentElement;h.classList.add("h-full"),h.classList.add("w-full"),o&&(h.classList.add("-top-3px"),h.classList.add("h-7px"),h.classList.remove("h-full")),f&&(h.classList.add("-left-3px"),h.classList.add("w-7px"),h.classList.remove("w-full"));let q=(s,c)=>Number(s.slice(0,-1*c.length)),Vt=function(s){return s.endsWith("px")?{value:s,type:"px",numeric:q(s,"px")}:s.endsWith("fr")?{value:s,type:"fr",numeric:q(s,"fr")}:s.endsWith("%")?{value:s,type:"%",numeric:q(s,"%")}:s==="auto"?{value:s,type:"auto"}:null},zt=s=>s.value?s.value:`${s.numeric}${s.type}`,A=s=>s.split(" ").map(Vt),ot=s=>s.map(zt).join(" "),ct=s=>y.slice(0,s).reduce((c,b)=>c+b.numeric,0),Ct=s=>y.slice(0,s+1).reduce((c,b)=>c+b.numeric,0),ft=s=>u.slice(0,s).reduce((c,b)=>c+b.numeric,0),Nt=s=>u.slice(0,s+1).reduce((c,b)=>c+b.numeric,0),lt=s=>"touches"in s?s.touches[0].clientX:s.clientX,ut=s=>"touches"in s?s.touches[0].clientY:s.clientY,P=(s,c)=>{n[s].value=null,n[s].type==="px"?n[s].numeric=c:n[s].type==="fr"?R.length===1?n[s].numeric=1:w!==0&&(n[s].numeric=c/w):n[s].type==="%"&&x!==0&&(n[s].numeric=c/x)},O=(s,c)=>{a[s].value=null,a[s].type==="px"?a[s].numeric=c:a[s].type==="fr"?B.length===1?a[s].numeric=1:v!==0&&(a[s].numeric=c/v):a[s].type==="%"&&t!==0&&(a[s].numeric=c/t)},F=(s,c)=>{for(let b=0;b<s.length;b++)if(s[b].type==c&&s[b].numeric>0)return b;return null},U=()=>!1,Rt=()=>h.classList.add(it),Gt=()=>h.classList.remove(it),at=()=>{if(this.centered){if(o)return this.fryparent.vgutters(0);if(f)return this.fryparent.hgutters(0)}if(z===1||l===1)return[this];let s=new Set;if(o)for(let c of this.fryparent.hgutters(m))s.add(c);if(f)for(let c of this.fryparent.vgutters(p))s.add(c);return s},ht=()=>{E&&at().forEach(c=>c.show())},pt=()=>{!r&&E&&at().forEach(c=>c.hide())},Wt=s=>{let c=_.getBoundingClientRect();xt=c.width,Et=c.height,$=c.top,Lt=c.bottom,j=c.left,_t=c.right;let b=lt(s),C=ut(s);if(o){let L=_.style[Y];if(L&&(a=A(L)),L=window.getComputedStyle(_)[Y],L&&(u=A(L),this.centered&&(M=u[0].numeric+u[2].numeric+u[4].numeric)),k=C-$-ft(m),Q=u[m].numeric-k,B=a.filter(S=>S.type==="fr"),tt=a.filter(S=>S.type==="%"),B.length){let S=F(a,"fr");S!==null&&(v=u[S].numeric/a[S].numeric)}if(tt.length){let S=F(a,"%");S!==null&&(t=u[S].numeric/a[S].numeric)}st=ft(m-1),nt=Nt(m+1)}if(f){let L=_.style[D];if(L&&(n=A(L)),L=window.getComputedStyle(_)[D],L&&(y=A(L),this.centered&&(M=y[0].numeric+y[2].numeric+y[4].numeric)),i=b-j-ct(p),g=y[p].numeric-i,R=n.filter(S=>S.type==="fr"),V=n.filter(S=>S.type==="%"),R.length){let S=F(n,"fr");S!==null&&(w=y[S].numeric/n[S].numeric)}if(V.length){let S=F(n,"%");S!==null&&(x=y[S].numeric/n[S].numeric)}et=ct(p-1),rt=Ct(p+1)}},dt=s=>{E&&("button"in s&&s.button!==0||(s.preventDefault(),Wt(s),r=!0,window.addEventListener("mouseup",W),window.addEventListener("touchend",W),window.addEventListener("touchcancel",W),window.addEventListener("mousemove",X),window.addEventListener("touchmove",X),document.documentElement.classList.add(d),_.addEventListener("selectstart",U),_.addEventListener("dragstart",U),_.style.userSelect="none",_.style.webkitUserSelect="none",_.style.MozUserSelect="none",_.style.pointerEvents="none",ht()))},X=s=>{if(o){let c=ut(s),b=$+st+k,C=$+nt-Q;if(c<b&&(c=b),c>C&&(c=C),this.centered){let L=0,S=0;m===1?L=c-b:L=C-c,S=M-2*L,O(0,L),O(2,S),O(4,L)}else O(m-1,c-b),O(m+1,C-c);_.style[Y]=ot(a)}if(f){let c=lt(s),b=j+et+i,C=j+rt-g;if(c<b&&(c=b),c>C&&(c=C),this.centered){let L=0,S=0;p===1?L=c-b:L=C-c,S=M-2*L,P(0,L),P(2,S),P(4,L)}else P(p-1,c-b),P(p+1,C-c);_.style[D]=ot(n)}},W=()=>{r=!1,window.removeEventListener("mouseup",W),window.removeEventListener("touchend",W),window.removeEventListener("touchcancel",W),window.removeEventListener("mousemove",X),window.removeEventListener("touchmove",X),document.documentElement.classList.remove(d),_.removeEventListener("selectstart",U),_.removeEventListener("dragstart",U),_.style.userSelect="",_.style.webkitUserSelect="",_.style.MozUserSelect="",_.style.pointerEvents="",pt()};this.centered=N,this.show=Rt,this.hide=Gt,this.col=p,this.row=m,this.ish=o,this.isv=f,this.isGutter=!0,this.fryembeds=[ht,pt,dt,dt]};var vt=async function(){let{leftGutter:h,grid:e,rightGutter:o}=this.fryargs,f=(t,i)=>Number(t.slice(0,-1*i.length)),d=function(t){return t.endsWith("px")?{value:t,type:"px",numeric:f(t,"px")}:t.endsWith("fr")?{value:t,type:"fr",numeric:f(t,"fr")}:t.endsWith("%")?{value:t,type:"%",numeric:f(t,"%")}:t==="auto"?{value:t,type:"auto"}:null},p=t=>t.value?t.value:`${t.numeric}${t.type}`,m=t=>t.split(" ").map(d),z=t=>t.map(p).join(" "),l=5,E="grid-template-columns",N=(t,i)=>{for(let g=0;g<t.length;g++)if(t[g].type==i&&t[g].numeric>0)return g;return null},r=[],n=[],a=[],y=[],u=0,w=0,v=()=>{r=[],n=[],a=[],y=[],u=0,w=0;let t=e.style[E];if(t&&(r=m(t)),t=window.getComputedStyle(e)[E],t&&(n=m(t)),a=r.filter(i=>i.type==="fr"),a.length){let i=N(r,"fr");i!==null&&(u=n[i].numeric/r[i].numeric)}if(y=r.filter(i=>i.type==="%"),y.length){let i=N(r,"%");i!==null&&(w=n[i].numeric/r[i].numeric)}},x=(t,i)=>{r[t].value=null,r[t].type==="px"?r[t].numeric=i:r[t].type==="fr"?a.length===1?r[t].numeric=1:u!==0&&(r[t].numeric=i/u):r[t].type==="%"&&w!==0&&(r[t].numeric=i/w)};this.broaden=()=>{v();let t=n[0].numeric,i=n[2].numeric,g=n[4].numeric;t<=l||g<=l||(t-=l,g-=l,i+=l+l,x(0,t),x(2,i),x(4,g),e.style[E]=z(r))},this.narrow=()=>{v();let t=n[0].numeric,i=n[2].numeric,g=n[4].numeric;i<=l+l||(t+=l,g+=l,i-=l+l,x(0,t),x(2,i),x(4,g),e.style[E]=z(r))},this.setCentered=t=>{t&&!h.centered&&(e.style[E]="1fr 1px 2fr 1px 1fr"),h.centered=t,o.centered=t},this.isCentered=()=>h.centered,this.hgutters=t=>[h,o],this.vgutters=t=>t===1?[h]:t===3?[o]:[],this.fryembeds=[]};var bt=async function(){let{dom:h}=this.fryargs;this.focus=()=>{h.focus()},this.fryembeds=[]};var G=[],T=class{constructor(e){this.rawValue=e,this.effectSet=new Set}addEffect(e){this.effectSet.add(e)}removeEffect(e){this.effectSet.delete(e)}hasEffect(e){return this.effectSet.has(e)}peek(){return this.rawValue}get value(){let e=G.length;if(e===0)return this.rawValue;let o=G[e-1];return this.hasEffect(o)||(this.effectSet.add(o),o.addSignal(this)),this.rawValue}set value(e){if(this.rawValue!==e){this.rawValue=e;let o=[];for(let f of this.effectSet)try{f.callback()}catch(d){o.push([f,d])}if(o.length>0)throw o}}};var J=class{constructor(e){this.fn=e,this.active=!1,this.todispose=!1,this.disposed=!1,this.signalSet=new Set}addSignal(e){this.signalSet.add(e)}removeSignal(e){this.signalSet.delete(e)}callback(){if(!(this.active===!0||this.disposed===!0)){G.push(this),this.active=!0,this.signalSet.clear();try{this.fn()}finally{this.active=!1,G.pop(),this.todispose&&this.dispose()}}}dispose(){if(!this.disposed){if(this.active){this.todispose=!0;return}for(let e of this.signalSet)e.removeEffect(this);this.signalSet.clear(),this.todispose=!1,this.disposed=!0}}};function I(h){let e=new J(h);try{e.callback()}catch(o){throw e.dispose(),o}return e.dispose.bind(e)}var H=class{constructor(e){this.fn=e,this.rawValue=void 0,this.active=!1,this.todispose=!1,this.disposed=!1,this.effectSet=new Set,this.signalSet=new Set}addEffect(e){this.effectSet.add(e)}removeEffect(e){this.effectSet.delete(e)}hasEffect(e){return this.effectSet.has(e)}peek(){return this.rawValue}get value(){this.rawValue=this.fn();let e=G.length;if(e===0)return this.rawValue;let o=G[e-1];return this.hasEffect(o)||(this.effectSet.add(o),o.addSignal(this)),this.rawValue}addSignal(e){this.signalSet.add(e)}removeSignal(e){this.signalSet.delete(e)}callback(){if(this.active===!0||this.disposed===!0)return;G.push(this),this.active=!0,this.signalSet.clear();let e;try{if(e=this.fn(),e!=this.rawValue){this.rawValue=e;let o=[];for(let f of this.effectSet)try{f.callback()}catch(d){o.push([f,d])}if(o.length>0)throw o}}finally{this.active=!1,G.pop(),this.todispose&&this.dispose()}}dispose(){if(!this.disposed){if(this.active){this.todispose=!0;return}for(let e of this.signalSet)e.removeEffect(this);this.signalSet.clear();for(let e of this.effectSet)e.removeSignal(this);this.effectSet.clear(),this.todispose=!1,this.disposed=!0}}};var Z=class{constructor({cid:e,name:o,setup:f,args:d,refs:p,element:m,g:z}){this.fryid=e;let l=o.split(":");l.length==1?(this.fryapp="",this.fryname=o):(this.fryapp=l[0],this.fryname=l[1]),this.frysetup=f,this.fryargs=d,this.fryrefs=p,this.fryelement=m,this.fryg=z,this._fryparent=null,this._fryroot=null}ready(e){this.fryg.readyFns.push(e)}get g(){return this.fryg.g}get isReady(){return this.fryg.isReady}get fryparent(){if(this._fryparent)return this._fryparent;let e=this.fryelement,o=e.frycomponents,f=o.indexOf(this);if(f>0)return this._fryparent=o[f-1],this._fryparent;for(e=e.parentElement;e;){if("frycomponents"in e)return o=e.frycomponents,this._fryparent=o[o.length-1],this._fryparent;e=e.parentElement}}get fryroot(){let e=this.fryelement,o=this;if(!e.isConnected)return this._fryroot=null,null;if(this._fryroot)return this._fryroot;for(;e;)"frycomponents"in e&&(o=e.frycomponents[0]),e=e.parentElement;return this._fryroot=o,o}},Pt={};async function K(h,e,o){let f={readyFns:[],isReady:!1,g:Pt},d={},p=[],m={};for(let r of document.querySelectorAll("script[data-fryid]"))m[r.dataset.fryid]=r;function z(r){let n=document.createElement("textarea");return n.innerHTML=r,JSON.parse(n.value)}function l(r){if(r.tagName!=="SCRIPT"){if(r.tagName==="TEMPLATE")return;if(r.dataset&&"fryid"in r.dataset)for(let n of r.dataset.fryid.split(" ")){if(n in d)throw`duplicate component id ${n}`;if(!(n in m))throw`unknown component id ${n}`;let a=m[n],{setup:y,args:u,refs:w}=z(a.textContent),{fryname:v}=a.dataset;p.length===0&&u&&Object.assign(u,o);let x=d[n]=new Z({cid:n,name:v,setup:y,args:u,refs:w,element:r,g:f});p.push(x),"frycomponents"in r?r.frycomponents.push(x):r.frycomponents=[x]}for(let n of r.children)l(n)}}l(h);let E=h.querySelectorAll("[data-fryref]:not(script)");for(let r of E){let n=r.dataset.fryref;for(let a of n.split(" ")){let[y,u]=a.split("-"),w=d[u];if(y.endsWith(":a")){let v=y.slice(0,-2);v in w.fryargs?w.fryargs[v].push(r):w.fryargs[v]=[r]}else w.fryargs[y]=r}}for(let r of p){let n=function(a){let y=h.querySelector(`[data-frytid="${a}"]`);return{template:y,create:async w=>{let v=y.content.cloneNode(!0);return await K(v,e,w),v.firstElementChild.frycomponents[0]}}};for(let a in r.fryrefs){let y=r.fryrefs[a],u=a,w=v=>d[v];a.startsWith("t:")&&(u=a.slice(2),w=n),Array.isArray(y)?r.fryargs[u]=y.map(v=>w(v)):r.fryargs[u]=w(y)}}function N(r){let n=""+r.fryid+"/",a=r.fryembeds;function y(u){if("fryembed"in u.dataset){let w=u.dataset.fryembed;for(let v of w.split(" ")){if(!v.startsWith(n))continue;let[x,t,...i]=v.substr(n.length).split("-"),g=parseInt(x),R=i.join("-");if(g>=a.length){console.log("invalid embed id: ",x);continue}let V=a[g];t==="text"?V instanceof T||V instanceof H?I(()=>u.textContent=V.value):u.textContent=V:t==="html"?V instanceof T||V instanceof H?I(()=>u.innerHTML=V.value):u.innerHTML=V:t==="event"?u.addEventListener(R,V):t==="attr"?V instanceof T||V instanceof H?I(()=>u.setAttribute(R,V.value)):u.setAttribute(R,V):t==="object"?("frydata"in u||(u.frydata={}),u.frydata[R]=V):console.log("invalid attribute type: ",t)}}for(let w of u.children)y(w)}y(r.fryelement)}for(let r of p){if(!r.frysetup)continue;await e[r.frysetup].bind(r)(),N(r)}for(let r of f.readyFns)r();f.readyFns.length=0,f.isReady=!0}var Ot={fryui_grid_HSplit:mt,fryui_grid_Grid:yt,fryui_grid_VSplit:gt,fryui_grid_VCenter:wt,fryui_grid_Gutter:St,fryui_grid_HCenter:vt,fryui_button_Button:bt},Zt=async h=>await K(h,Ot);export{Zt as hydrate};
//# sourceMappingURL=index.js.map
