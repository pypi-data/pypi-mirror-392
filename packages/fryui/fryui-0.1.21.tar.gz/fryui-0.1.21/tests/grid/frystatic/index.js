var V=[],A=class{constructor(r){this.rawValue=r,this.effectSet=new Set}addEffect(r){this.effectSet.add(r)}removeEffect(r){this.effectSet.delete(r)}hasEffect(r){return this.effectSet.has(r)}peek(){return this.rawValue}get value(){let r=V.length;if(r===0)return this.rawValue;let n=V[r-1];return this.hasEffect(n)||(this.effectSet.add(n),n.addSignal(this)),this.rawValue}set value(r){if(this.rawValue!==r){this.rawValue=r;let n=[];for(let c of this.effectSet)try{c.callback()}catch(b){n.push([c,b])}if(n.length>0)throw n}}};function K(l){return new A(l)}var J=class{constructor(r){this.fn=r,this.active=!1,this.todispose=!1,this.disposed=!1,this.signalSet=new Set}addSignal(r){this.signalSet.add(r)}removeSignal(r){this.signalSet.delete(r)}callback(){if(!(this.active===!0||this.disposed===!0)){V.push(this),this.active=!0,this.signalSet.clear();try{this.fn()}finally{this.active=!1,V.pop(),this.todispose&&this.dispose()}}}dispose(){if(!this.disposed){if(this.active){this.todispose=!0;return}for(let r of this.signalSet)r.removeEffect(this);this.signalSet.clear(),this.todispose=!1,this.disposed=!0}}};function q(l){let r=new J(l);try{r.callback()}catch(n){throw r.dispose(),n}return r.dispose.bind(r)}var O=class{constructor(r){this.fn=r,this.rawValue=void 0,this.active=!1,this.todispose=!1,this.disposed=!1,this.effectSet=new Set,this.signalSet=new Set}addEffect(r){this.effectSet.add(r)}removeEffect(r){this.effectSet.delete(r)}hasEffect(r){return this.effectSet.has(r)}peek(){return this.rawValue}get value(){this.rawValue=this.fn();let r=V.length;if(r===0)return this.rawValue;let n=V[r-1];return this.hasEffect(n)||(this.effectSet.add(n),n.addSignal(this)),this.rawValue}addSignal(r){this.signalSet.add(r)}removeSignal(r){this.signalSet.delete(r)}callback(){if(this.active===!0||this.disposed===!0)return;V.push(this),this.active=!0,this.signalSet.clear();let r;try{if(r=this.fn(),r!=this.rawValue){this.rawValue=r;let n=[];for(let c of this.effectSet)try{c.callback()}catch(b){n.push([c,b])}if(n.length>0)throw n}}finally{this.active=!1,V.pop(),this.todispose&&this.dispose()}}dispose(){if(!this.disposed){if(this.active){this.todispose=!0;return}for(let r of this.signalSet)r.removeEffect(this);this.signalSet.clear();for(let r of this.effectSet)r.removeSignal(this);this.effectSet.clear(),this.todispose=!1,this.disposed=!0}}};var Z=class{constructor({cid:r,name:n,setup:c,args:b,refs:u,element:h,g:E}){this.fryid=r;let d=n.split(":");d.length==1?(this.fryapp="",this.fryname=n):(this.fryapp=d[0],this.fryname=d[1]),this.frysetup=c,this.fryargs=b,this.fryrefs=u,this.fryelement=h,this.fryg=E,this._fryparent=null,this._fryroot=null}ready(r){this.fryg.readyFns.push(r)}get g(){return this.fryg.g}get isReady(){return this.fryg.isReady}get fryparent(){if(this._fryparent)return this._fryparent;let r=this.fryelement,n=r.frycomponents,c=n.indexOf(this);if(c>0)return this._fryparent=n[c-1],this._fryparent;for(r=r.parentElement;r;){if("frycomponents"in r)return n=r.frycomponents,this._fryparent=n[n.length-1],this._fryparent;r=r.parentElement}}get fryroot(){let r=this.fryelement,n=this;if(!r.isConnected)return this._fryroot=null,null;if(this._fryroot)return this._fryroot;for(;r;)"frycomponents"in r&&(n=r.frycomponents[0]),r=r.parentElement;return this._fryroot=n,n}},Pe={};async function Q(l,r,n){let c={readyFns:[],isReady:!1,g:Pe},b={},u=[],h={};for(let t of document.querySelectorAll("script[data-fryid]"))h[t.dataset.fryid]=t;function E(t){let i=document.createElement("textarea");return i.innerHTML=t,JSON.parse(i.value)}function d(t){if(t.tagName!=="SCRIPT"){if(t.tagName==="TEMPLATE")return;if(t.dataset&&"fryid"in t.dataset)for(let i of t.dataset.fryid.split(" ")){if(i in b)throw`duplicate component id ${i}`;if(!(i in h))throw`unknown component id ${i}`;let g=h[i],{setup:m,args:f,refs:p}=E(g.textContent),{fryname:w}=g.dataset;u.length===0&&f&&Object.assign(f,n);let k=b[i]=new Z({cid:i,name:w,setup:m,args:f,refs:p,element:t,g:c});u.push(k),"frycomponents"in t?t.frycomponents.push(k):t.frycomponents=[k]}for(let i of t.children)d(i)}}d(l);let v=l.querySelectorAll("[data-fryref]:not(script)");for(let t of v){let i=t.dataset.fryref;for(let g of i.split(" ")){let[m,f]=g.split("-"),p=b[f];if(m.endsWith(":a")){let w=m.slice(0,-2);w in p.fryargs?p.fryargs[w].push(t):p.fryargs[w]=[t]}else p.fryargs[m]=t}}for(let t of u){let i=function(g){let m=l.querySelector(`[data-frytid="${g}"]`);return{template:m,create:async p=>{let w=m.content.cloneNode(!0);return await Q(w,r,p),w.firstElementChild.frycomponents[0]}}};for(let g in t.fryrefs){let m=t.fryrefs[g],f=g,p=w=>b[w];g.startsWith("t:")&&(f=g.slice(2),p=i),Array.isArray(m)?t.fryargs[f]=m.map(w=>p(w)):t.fryargs[f]=p(m)}}function L(t){let i=""+t.fryid+"/",g=t.fryembeds;function m(f){if("fryembed"in f.dataset){let p=f.dataset.fryembed;for(let w of p.split(" ")){if(!w.startsWith(i))continue;let[k,e,...a]=w.substr(i.length).split("-"),y=parseInt(k),R=a.join("-");if(y>=g.length){console.log("invalid embed id: ",k);continue}let C=g[y];e==="text"?C instanceof A||C instanceof O?q(()=>f.textContent=C.value):f.textContent=C:e==="html"?C instanceof A||C instanceof O?q(()=>f.innerHTML=C.value):f.innerHTML=C:e==="event"?f.addEventListener(R,C):e==="attr"?C instanceof A||C instanceof O?q(()=>f.setAttribute(R,C.value)):f.setAttribute(R,C):e==="object"?("frydata"in f||(f.frydata={}),f.frydata[R]=C):console.log("invalid attribute type: ",e)}}for(let p of f.children)m(p)}m(t.fryelement)}for(let t of u){if(!t.frysetup)continue;await r[t.frysetup].bind(t)(),L(t)}for(let t of c.readyFns)t();c.readyFns.length=0,c.isReady=!0}var me=async function(){let{vcenter:l,hcenter:r}=this.fryargs,n=()=>r.broaden(),c=()=>r.narrow(),b=()=>l.broaden(),u=()=>l.narrow(),h=K(!1),E=K(!1),d=()=>{h.peek()?(h.value=!1,r.setCentered(!1)):(h.value=!0,r.setCentered(!0))},v=()=>{E.peek()?(E.value=!1,l.setCentered(!1)):(E.value=!0,l.setCentered(!0))};document.addEventListener("keydown",L=>{L.code==="KeyB"?(console.log(L.code),n(),b()):L.code==="KeyN"&&(console.log(L.code),c(),u())}),this.fryembeds=[n,c,d,h,b,u,v,E]};var ye=async function(){let{nrow:l,resizable:r}=this.fryargs;this.hgutters=n=>{let c=this.fryelement.children.item(n);if(c&&c.frycomponents&&c.frycomponents.length>0){let b=c.frycomponents[0];if(b.isGutter)return[b]}return[]},this.vgutters=n=>{let c=[];for(let b=0;b<l;b++){let u=this.fryelement.children.item(b);if(u&&u.frycomponents&&u.frycomponents.length>0){let h=u.frycomponents[0];h.isGutter&&c.push(h)}}return c},this.fryembeds=[]};var pe=async function(){let{gutters:l,ncol:r,nrow:n,resizable:c}=this.fryargs;this.hgutters=b=>{let u=[];for(let h=0;h<r;h++){let E=b*r+h,d=this.fryelement.children.item(E);if(d&&d.frycomponents&&d.frycomponents.length>0){let v=d.frycomponents[0];v.isGutter&&u.push(v)}}return u},this.vgutters=b=>{let u=[];for(let h=0;h<n;h++){let E=h*r+b,d=this.fryelement.children.item(E);if(d&&d.frycomponents&&d.frycomponents.length>0){let v=d.frycomponents[0];v.isGutter&&u.push(v)}}return u},this.fryembeds=[]};var xe=async function(){let{ncol:l,resizable:r}=this.fryargs;this.hgutters=n=>{let c=[];for(let b=0;b<l;b++){let u=this.fryelement.children.item(b);if(u&&u.frycomponents&&u.frycomponents.length>0){let h=u.frycomponents[0];h.isGutter&&c.push(h)}}return c},this.vgutters=n=>{let c=this.fryelement.children.item(n);if(c&&c.frycomponents&&c.frycomponents.length>0){let b=c.frycomponents[0];if(b.isGutter)return[b]}return[]},this.fryembeds=[]};var ve=async function(){let{grid:l,bottomGutter:r,topGutter:n}=this.fryargs,c=(e,a)=>Number(e.slice(0,-1*a.length)),b=function(e){return e.endsWith("px")?{value:e,type:"px",numeric:c(e,"px")}:e.endsWith("fr")?{value:e,type:"fr",numeric:c(e,"fr")}:e.endsWith("%")?{value:e,type:"%",numeric:c(e,"%")}:e==="auto"?{value:e,type:"auto"}:null},u=e=>e.value?e.value:`${e.numeric}${e.type}`,h=e=>e.split(" ").map(b),E=e=>e.map(u).join(" "),d=5,v="grid-template-rows",L=(e,a)=>{for(let y=0;y<e.length;y++)if(e[y].type==a&&e[y].numeric>0)return y;return null},t=[],i=[],g=[],m=[],f=0,p=0,w=()=>{t=[],i=[],g=[],m=[],f=0,p=0;let e=l.style[v];if(e&&(t=h(e)),e=window.getComputedStyle(l)[v],e&&(i=h(e)),g=t.filter(a=>a.type==="fr"),g.length){let a=L(t,"fr");a!==null&&(f=i[a].numeric/t[a].numeric)}if(m=t.filter(a=>a.type==="%"),m.length){let a=L(t,"%");a!==null&&(p=i[a].numeric/t[a].numeric)}},k=(e,a)=>{t[e].value=null,t[e].type==="px"?t[e].numeric=a:t[e].type==="fr"?g.length===1?t[e].numeric=1:f!==0&&(t[e].numeric=a/f):t[e].type==="%"&&p!==0&&(t[e].numeric=a/p)};this.broaden=()=>{w();let e=i[0].numeric,a=i[2].numeric,y=i[4].numeric;e<=d||y<=d||(e-=d,y-=d,a+=d+d,k(0,e),k(2,a),k(4,y),l.style[v]=E(t))},this.narrow=()=>{w();let e=i[0].numeric,a=i[2].numeric,y=i[4].numeric;a<=d+d||(e+=d,y+=d,a-=d+d,k(0,e),k(2,a),k(4,y),l.style[v]=E(t))},this.setCentered=e=>{e&&!n.centered&&(l.style[v]="1fr 1px 2fr 1px 1fr"),n.centered=e,r.centered=e},this.isCentered=()=>n.centered,this.hgutters=e=>{if(e===1)return[n];if(e===3)return[r]},this.vgutters=e=>[n,r],this.fryembeds=[]};var we=async function(){let{bar:l,el:r,ish:n,isv:c,cursor:b,col:u,row:h,ncol:E,nrow:d,resizable:v,center:L}=this.fryargs,t=!1,i=[],g=[],m=[],f=[],p=0,w=0,k=0,e=0,a=0,y=0,R=[],C=[],$=0,ee=0,X=[],re=[],te=0,oe=0,ne=0,ie=0,U=0,ze,Ee,F,_e,G,Ce,B="grid-template-columns",I="grid-template-rows",ae="bg-primarya",_=r.parentElement;l.classList.add("h-full"),l.classList.add("w-full"),n&&(l.classList.add("-top-3px"),l.classList.add("h-7px"),l.classList.remove("h-full")),c&&(l.classList.add("-left-3px"),l.classList.add("w-7px"),l.classList.remove("w-full"));let D=(o,s)=>Number(o.slice(0,-1*s.length)),Le=function(o){return o.endsWith("px")?{value:o,type:"px",numeric:D(o,"px")}:o.endsWith("fr")?{value:o,type:"fr",numeric:D(o,"fr")}:o.endsWith("%")?{value:o,type:"%",numeric:D(o,"%")}:o==="auto"?{value:o,type:"auto"}:null},je=o=>o.value?o.value:`${o.numeric}${o.type}`,W=o=>o.split(" ").map(Le),se=o=>o.map(je).join(" "),ce=o=>m.slice(0,o).reduce((s,S)=>s+S.numeric,0),Re=o=>m.slice(0,o+1).reduce((s,S)=>s+S.numeric,0),le=o=>f.slice(0,o).reduce((s,S)=>s+S.numeric,0),Ve=o=>f.slice(0,o+1).reduce((s,S)=>s+S.numeric,0),de=o=>"touches"in o?o.touches[0].clientX:o.clientX,fe=o=>"touches"in o?o.touches[0].clientY:o.clientY,M=(o,s)=>{i[o].value=null,i[o].type==="px"?i[o].numeric=s:i[o].type==="fr"?R.length===1?i[o].numeric=1:p!==0&&(i[o].numeric=s/p):i[o].type==="%"&&k!==0&&(i[o].numeric=s/k)},P=(o,s)=>{g[o].value=null,g[o].type==="px"?g[o].numeric=s:g[o].type==="fr"?X.length===1?g[o].numeric=1:w!==0&&(g[o].numeric=s/w):g[o].type==="%"&&e!==0&&(g[o].numeric=s/e)},H=(o,s)=>{for(let S=0;S<o.length;S++)if(o[S].type==s&&o[S].numeric>0)return S;return null},T=()=>!1,Ne=()=>l.classList.add(ae),Ae=()=>l.classList.remove(ae),ge=()=>{if(this.centered){if(n)return this.fryparent.vgutters(0);if(c)return this.fryparent.hgutters(0)}if(E===1||d===1)return[this];let o=new Set;if(n)for(let s of this.fryparent.hgutters(h))o.add(s);if(c)for(let s of this.fryparent.vgutters(u))o.add(s);return o},he=()=>{v&&ge().forEach(s=>s.show())},ue=()=>{!t&&v&&ge().forEach(s=>s.hide())},Me=o=>{let s=_.getBoundingClientRect();ze=s.width,Ee=s.height,F=s.top,_e=s.bottom,G=s.left,Ce=s.right;let S=de(o),j=fe(o);if(n){let z=_.style[I];if(z&&(g=W(z)),z=window.getComputedStyle(_)[I],z&&(f=W(z),this.centered&&(U=f[0].numeric+f[2].numeric+f[4].numeric)),$=j-F-le(h),ee=f[h].numeric-$,X=g.filter(x=>x.type==="fr"),re=g.filter(x=>x.type==="%"),X.length){let x=H(g,"fr");x!==null&&(w=f[x].numeric/g[x].numeric)}if(re.length){let x=H(g,"%");x!==null&&(e=f[x].numeric/g[x].numeric)}ne=le(h-1),ie=Ve(h+1)}if(c){let z=_.style[B];if(z&&(i=W(z)),z=window.getComputedStyle(_)[B],z&&(m=W(z),this.centered&&(U=m[0].numeric+m[2].numeric+m[4].numeric)),a=S-G-ce(u),y=m[u].numeric-a,R=i.filter(x=>x.type==="fr"),C=i.filter(x=>x.type==="%"),R.length){let x=H(i,"fr");x!==null&&(p=m[x].numeric/i[x].numeric)}if(C.length){let x=H(i,"%");x!==null&&(k=m[x].numeric/i[x].numeric)}te=ce(u-1),oe=Re(u+1)}},be=o=>{v&&("button"in o&&o.button!==0||(o.preventDefault(),Me(o),t=!0,window.addEventListener("mouseup",N),window.addEventListener("touchend",N),window.addEventListener("touchcancel",N),window.addEventListener("mousemove",Y),window.addEventListener("touchmove",Y),document.documentElement.classList.add(b),_.addEventListener("selectstart",T),_.addEventListener("dragstart",T),_.style.userSelect="none",_.style.webkitUserSelect="none",_.style.MozUserSelect="none",_.style.pointerEvents="none",he()))},Y=o=>{if(n){let s=fe(o),S=F+ne+$,j=F+ie-ee;if(s<S&&(s=S),s>j&&(s=j),this.centered){let z=0,x=0;h===1?z=s-S:z=j-s,x=U-2*z,P(0,z),P(2,x),P(4,z)}else P(h-1,s-S),P(h+1,j-s);_.style[I]=se(g)}if(c){let s=de(o),S=G+te+a,j=G+oe-y;if(s<S&&(s=S),s>j&&(s=j),this.centered){let z=0,x=0;u===1?z=s-S:z=j-s,x=U-2*z,M(0,z),M(2,x),M(4,z)}else M(u-1,s-S),M(u+1,j-s);_.style[B]=se(i)}},N=()=>{t=!1,window.removeEventListener("mouseup",N),window.removeEventListener("touchend",N),window.removeEventListener("touchcancel",N),window.removeEventListener("mousemove",Y),window.removeEventListener("touchmove",Y),document.documentElement.classList.remove(b),_.removeEventListener("selectstart",T),_.removeEventListener("dragstart",T),_.style.userSelect="",_.style.webkitUserSelect="",_.style.MozUserSelect="",_.style.pointerEvents="",ue()};this.centered=L,this.show=Ne,this.hide=Ae,this.col=u,this.row=h,this.ish=n,this.isv=c,this.isGutter=!0,this.fryembeds=[he,ue,be,be]};var Se=async function(){let{grid:l,rightGutter:r,leftGutter:n}=this.fryargs,c=(e,a)=>Number(e.slice(0,-1*a.length)),b=function(e){return e.endsWith("px")?{value:e,type:"px",numeric:c(e,"px")}:e.endsWith("fr")?{value:e,type:"fr",numeric:c(e,"fr")}:e.endsWith("%")?{value:e,type:"%",numeric:c(e,"%")}:e==="auto"?{value:e,type:"auto"}:null},u=e=>e.value?e.value:`${e.numeric}${e.type}`,h=e=>e.split(" ").map(b),E=e=>e.map(u).join(" "),d=5,v="grid-template-columns",L=(e,a)=>{for(let y=0;y<e.length;y++)if(e[y].type==a&&e[y].numeric>0)return y;return null},t=[],i=[],g=[],m=[],f=0,p=0,w=()=>{t=[],i=[],g=[],m=[],f=0,p=0;let e=l.style[v];if(e&&(t=h(e)),e=window.getComputedStyle(l)[v],e&&(i=h(e)),g=t.filter(a=>a.type==="fr"),g.length){let a=L(t,"fr");a!==null&&(f=i[a].numeric/t[a].numeric)}if(m=t.filter(a=>a.type==="%"),m.length){let a=L(t,"%");a!==null&&(p=i[a].numeric/t[a].numeric)}},k=(e,a)=>{t[e].value=null,t[e].type==="px"?t[e].numeric=a:t[e].type==="fr"?g.length===1?t[e].numeric=1:f!==0&&(t[e].numeric=a/f):t[e].type==="%"&&p!==0&&(t[e].numeric=a/p)};this.broaden=()=>{w();let e=i[0].numeric,a=i[2].numeric,y=i[4].numeric;e<=d||y<=d||(e-=d,y-=d,a+=d+d,k(0,e),k(2,a),k(4,y),l.style[v]=E(t))},this.narrow=()=>{w();let e=i[0].numeric,a=i[2].numeric,y=i[4].numeric;a<=d+d||(e+=d,y+=d,a-=d+d,k(0,e),k(2,a),k(4,y),l.style[v]=E(t))},this.setCentered=e=>{e&&!n.centered&&(l.style[v]="1fr 1px 2fr 1px 1fr"),n.centered=e,r.centered=e},this.isCentered=()=>n.centered,this.hgutters=e=>[n,r],this.vgutters=e=>e===1?[n]:e===3?[r]:[],this.fryembeds=[]};var ke=async function(){let{dom:l}=this.fryargs;this.focus=()=>{l.focus()},this.fryembeds=[]};var Oe={app_App:me,fryui_grid_HSplit:ye,fryui_grid_Grid:pe,fryui_grid_VSplit:xe,fryui_grid_VCenter:ve,fryui_grid_Gutter:we,fryui_grid_HCenter:Se,fryui_button_Button:ke},ir=async l=>await Q(l,Oe);export{ir as hydrate};
//# sourceMappingURL=index.js.map
