name: cte_env_var_example
description: Example pipeline demonstrating environment variable expansion in adapter paths

# Define interceptors at pipeline level
interceptors:
  # Configure WRP adapters with environment variable expansion
  - pkg_type: wrp_adapters
    pkg_name: cte_adapters
    posix: true
    mpiio: false
    stdio: false
    vfd: false
    nvidia_gds: false
    # Paths with environment variable expansion and regex patterns
    # These will be expanded at configuration time
    include:
      - "$HOME/data.*"                  # Expands to /home/username/data.*
      - "${SCRATCH_DIR}/workloads.*"    # Uses SCRATCH_DIR environment variable
      - "~/projects/ior_tests.*"        # Expands ~ to home directory
      - "/mnt/shared/datasets.*"        # Literal path with regex
    exclude:
      - "$HOME/data/exclude.*"          # Exclude specific subdirectories
      - "/tmp.*"                        # Exclude all /tmp files
    adapter_page_size: "1M"

# Define packages
pkgs:
  # Configure CTE runtime first (Service, not Interceptor)
  - pkg_type: wrp_cte
    pkg_name: cte_runtime
    devices:
      - ["ram::cte_cache", "2GB", 1.0]
      - ["/mnt/nvme", "500GB", 0.8]
    dpe_type: "round_robin"

  # Setup message
  - pkg_type: echo
    pkg_name: setup
    msg: "CTE adapters with environment variable expansion example"

  # Your application here
  # - pkg_type: my_application
  #   pkg_name: my_app
  #   interceptors: ["cte_adapters"]
  #   # Application will only intercept I/O to paths matching the expanded include list

  # Completion message
  - pkg_type: echo
    pkg_name: complete
    interceptors: []
    msg: "Pipeline complete - check logs for expanded paths"
