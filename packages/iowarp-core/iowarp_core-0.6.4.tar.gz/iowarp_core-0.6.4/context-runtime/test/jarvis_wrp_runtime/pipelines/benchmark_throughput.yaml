# BDev I/O Throughput Benchmark Pipeline
# Purpose: Measures sustained BDev I/O throughput
#   Full BDev I/O path: Continuous Allocate -> Write -> Free operations
# Each thread continuously performs operations until the duration timer expires
# Requirements: Chimaera installed in PATH
# Expected Runtime: Configurable via 'duration' parameter (default: 10 seconds)

name: benchmark_throughput

# Pipeline environment
env:
  # Use default Chimaera runtime configuration
  # CHI_SERVER_CONF will be set by wrp_runtime package

pkgs:
  # IOWarp Runtime Service
  - pkg_type: jarvis_wrp_runtime.wrp_runtime
    pkg_name: runtime
    # Runtime configuration
    sched_workers: 1
    process_reaper_workers: 1
    main_segment_size: "1G"
    client_data_segment_size: "512M"
    runtime_data_segment_size: "512M"
    port: 5555
    log_level: "info"
    stack_size: 65536
    queue_depth: 10000
    lane_map_policy: "round_robin"
    heartbeat_interval: 1000
    sleep: 1

  # BDev I/O Throughput Benchmark
  - pkg_type: jarvis_wrp_runtime.wrp_benchmark
    pkg_name: benchmark
    # Benchmark configuration
    test_case: "bdev_io"            # Test case: bdev_io, bdev_allocation, latency
    threads: 1                      # Number of client threads
    duration: 10.0                  # Duration to run benchmark in seconds
    max_file_size: "1g"             # Maximum file size for BDev container
    io_size: "4k"                   # I/O size per operation (bdev_io only)
    lane_policy: "round_robin"      # Lane mapping: map_by_pid_tid, round_robin, random
    verbose: false                  # Print per-thread statistics
    output_dir: "/tmp/wrp_benchmark"
