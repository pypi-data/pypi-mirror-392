[project]
name = "castlecraft-engineer"
version = "0.11.0"
description = "Python framework for building robust, scalable applications with DDD, CQRS, and Event Sourcing."
authors = [{ name = "Castlecraft Ecommerce Pvt. Ltd.", email = "support@castlecraft.in" }]
requires-python = ">=3.10"
readme = "README.md"
license = { file = "LICENSE" }
keywords = ["DDD", "CQRS", "Event Sourcing", "framework", "python", "architecture", "domain-driven design"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Typing :: Typed",
]
dependencies = [
    "cryptography>=44.0.3",
    "punq>=0.7.0",
    "pyjwt[crypto]>=2.10.1",
    "sqlmodel~=0.0.24",
]

[project.urls]
"Homepage" = "https://gitlab.com/castlecraft/framework/engineer"
"Documentation" = "https://engineer.castlecraft.in/"
"Repository" = "https://gitlab.com/castlecraft/framework/engineer"
"Bug Tracker" = "https://gitlab.com/castlecraft/framework/engineer/-/issues"

[dependency-groups]
dev = [
    "aiosqlite>=0.21.0",
    "bandit>=1.8.3",
    "build>=1.2.2.post1",
    "coverage>=7.8.0",
    "faker>=37.1.0",
    "ipython>=8.35.0",
    "mike>=2.1.3",
    "mkdocs>=1.6.1",
    "mkdocs-awesome-pages-plugin>=2.10.1",
    "mkdocs-gen-files>=0.5.0",
    "mkdocs-material>=9.6.14",
    "mkdocstrings[python]>=0.29.1",
    "mypy>=1.15.0",
    "pre-commit>=4.2.0,<5",
    "pymdown-extensions>=10.15",
    "pytest>=8.3.5",
    "pytest-asyncio>=0.26.0",
    "pytest-mock>=3.14.0",
    "python-semantic-release>=9.21.1",
    "radon>=6.0.1",
    "redis>=6.0.0",
    "requests>=2.32.3",
    "safety>=3.5.1",
    "twine>=6.1.0",
]

[project.scripts]
engineer = "castlecraft_engineer.commands:main"

[tool.uv]
default-groups = []

[[tool.uv.index]]
name = "safety"
url = "https://pkgs.safetycli.com/repository/castlecraft-ecommerce-pvt-ltd/project/engineer/pypi/simple/"
default = false

[tool.isort]
profile = "black"

[tool.hatch.build.targets.sdist]
include = ["src/castlecraft_engineer"]

[tool.hatch.build.targets.wheel]
include = ["src/castlecraft_engineer"]

[tool.hatch.build.targets.wheel.sources]
"src/castlecraft_engineer" = "castlecraft_engineer"

[tool.mypy]
ignore_missing_imports_per_module = true

[[tool.mypy.overrides]]
module = "punq.*"
ignore_missing_imports = true

[tool.semantic_release.remote]
type = "gitlab"

[tool.semantic_release]
version_toml = ["pyproject.toml:project.version"]
gitlab_project_id = "$CI_PROJECT_ID"
upload_to_vcs_release = true
tag_format = "v{version}"
commit_message = "chore(release): version v{version}"
branch = "main"
changelog_file = "CHANGELOG.md"
major_on_breaking_change = true
minor_on_feat = true
patch_on_fix = true
build_command = """
  set -ex;
  echo "Build command: Starting build process...";

  echo "Build command: Ensuring 'build' (frontend) and 'hatchling' (backend) are available...";
  uv pip install --disable-pip-version-check --no-cache-dir build hatchling;

  echo "Build command: Running python -m build to create sdist and wheel...";
  python -m build --sdist --wheel --outdir dist/ --no-isolation;

  echo "Build command: Updating uv.lock...";
  uv lock --cache-dir "${UV_CACHE_DIR:-.uv_cache_temp_semantic_release}";

  echo "Build command: Staging files for release commit (pyproject.toml, uv.lock, CHANGELOG.md, dist/*)...";
  git add pyproject.toml uv.lock CHANGELOG.md;
  echo "Build command: Staging complete."
"""

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
