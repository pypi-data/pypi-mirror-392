# Runner Packing Rules
#
# - backend:   (Required) The accelerated backend to pack for,
#              used to select the packing rules and Dockerfile below `pack` directory.
# - services:  (Required) The inference service to pack for,
#              used to select the Docker build phase described in `pack/${backend}/Dockerfile`.
# - platforms: (Optional) The platforms to build for,
#              used to select the Docker Linux build platforms.
#              Default to `linux/amd64` and `linux/arm64`.
# - args:      (Optional) The build arguments to pass to the Docker build,
#              used to override the default build arguments in `pack/${backend}/Dockerfile`.

rules:

  #
  # Ascend CANN
  #
  ## Ascend CANN 8.3.rc1, using CANN Kernel for A3.
  ##
  - backend: "cann"
    services:
      - "vllm"
    args:
      - "CANN_VERSION=8.3.rc1"
      - "CANN_ARCHS=a3"
  ## Ascend CANN 8.3.rc1, using CANN Kernel for 910B.
  ##
  - backend: "cann"
    services:
      - "vllm"
    args:
      - "CANN_VERSION=8.3.rc1"
      - "CANN_ARCHS=910b"
  ## Ascend CANN 8.3.rc1, using CANN Kernel for 310P.
  ##
  - backend: "cann"
    services:
      - "vllm"
    args:
      - "CANN_VERSION=8.3.rc1"
      - "CANN_ARCHS=310p"
  ## Ascend CANN 8.2.rc2, using CANN Kernel for A3.
  ##
  - backend: "cann"
    services:
      - "mindie"
      - "sglang"
    args:
      - "CANN_VERSION=8.2.rc2"
      - "CANN_ARCHS=a3"
  ## Ascend CANN 8.2.rc2, using CANN Kernel for 910B.
  ##
  - backend: "cann"
    services:
      - "mindie"
      - "sglang"
    args:
      - "CANN_VERSION=8.2.rc2"
      - "CANN_ARCHS=910b"
  ## Ascend CANN 8.2.rc2, using CANN Kernel for 310P.
  ##
  - backend: "cann"
    services:
      - "mindie"
    args:
      - "CANN_VERSION=8.2.rc2"
      - "CANN_ARCHS=310p"

  #
  # Iluvatar CoreX
  #

  ## Iluvatar CoreX 4.2.0
  ##
  - backend: "corex"
    services:
      - "vllm"
    platforms:
      - "linux/amd64"
    args:
      - "COREX_VERSION=4.2.0"

  #
  # NVIDIA CUDA
  #

  ## NVIDIA CUDA 12.6.3, using PyTorch +cu128 in linux/amd64.
  ##
  - backend: "cuda"
    services:
      - "voxbox"
      - "vllm"
      - "sglang"
    args:
      - "CUDA_VERSION=12.6.3"
      - "VOXBOX_VERSION=0.0.20"
      - "VOXBOX_TORCH_VERSION=2.7.1"
      - "VOXBOX_TORCH_CUDA_VERSION=12.8.1"
      - "VLLM_TORCH_CUDA_VERSION=12.8.1"
      - "SGLANG_BASE_IMAGE=gpustack/runner:cuda12.6-vllm0.11.1rc7"
      - "SGLANG_BUILD_BASE_IMAGE=gpustack/runner:cuda12.8-vllm0.11.1rc7"
  ## NVIDIA CUDA 12.8.1, using PyTorch +cu128 in both linux/amd64 and linux/arm64.
  ##
  - backend: "cuda"
    services:
      - "voxbox"
      - "vllm"
      - "sglang"
    args:
      - "CUDA_VERSION=12.8.1"
      - "SGLANG_BASE_IMAGE=gpustack/runner:cuda12.8-vllm0.11.1rc7"
  ## NVIDIA CUDA 12.9.1, using PyTorch +cu129 in both linux/amd64 and linux/arm64.
  ##
  - backend: "cuda"
    services:
      - "voxbox"
      - "vllm"
      - "sglang"
    args:
      - "CUDA_VERSION=12.9.1"
      - "SGLANG_BASE_IMAGE=gpustack/runner:cuda12.9-vllm0.11.1rc7"

  #
  # Hygon DTK
  #

  ## Hygon DTK 25.04.2
  ##
  - backend: "dtk"
    services:
      - "vllm"
    platforms:
      - "linux/amd64"
    args:
      - "DTK_VERSION=25.04.2"

  #
  # MateX MACA
  #

  ## MateX MACA 3.2.1
  ##
  - backend: "maca"
    services:
      - "vllm"
    platforms:
      - "linux/amd64"
    args:
      - "MACA_VERSION=3.2.1"

  #
  # AMD ROCm
  #

  ## AMD ROCm 7.0.2, using PyTorch +rocm7.0 in linux/amd64.
  ##
  - backend: "rocm"
    services:
      - "vllm"
      - "sglang"
    platforms:
      - "linux/amd64"
    args:
      - "ROCM_VERSION=7.0.2"
      - "SGLANG_BASE_IMAGE=gpustack/runner:rocm7.0-vllm0.11.0"
