version: 1.0
runtime: python311
build:
  commands:
    pre-build:
      - echo "Installing uv package manager..."
      - curl -LsSf https://astral.sh/uv/install.sh | sh
      - export PATH="/root/.cargo/bin:$PATH"
      - echo "Python version:"
      - python --version
    build:
      - echo "Installing dependencies with uv..."
      - uv pip install --system -e .
      - uv pip install --system -e ".[s3]"
    post-build:
      - echo "Build completed successfully"
      - echo "Installed packages:"
      - pip list | grep -E "(fastapi|uvicorn|pymongo|pydantic)"

run:
  runtime-version: "3.11"
  command: uvicorn putplace.main:app --host 0.0.0.0 --port 8000 --workers 2
  network:
    port: 8000
    env: APP_PORT
  # Note: Environment variables are configured via AWS CLI using
  # --instance-configuration with environment secrets references

health-check:
  protocol: http
  path: /health
  interval: 10
  timeout: 5
  healthy-threshold: 1
  unhealthy-threshold: 5
