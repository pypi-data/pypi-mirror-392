simulations:
  - id: 1
    simulation_name: "disease_cases = lagged_rainfall 3-6 weeks (spikes)"
    time_granularity: "W"
    simulation_length: 200
    features:
      - name: "population"
        function: |
          def get_population():
            return 100
      - name: "rainfall"
        function: |
          def get_rainfall(region, i):
            spikes = [10,30,50,70,90,110,130,150,170,190]
            if i in spikes:
              return 50
            return 1
      - name: "mean_temperature"
        function: |
          def get_temperature(i):
            return 10
      - name: "lagged_rainfall"
        function: |
          def get_lagged_rainfall(rainfall):
              if len(rainfall) < 6:
                  return rainfall[-1]  # Not enough data to compute lagged rainfall
              relevant_weeks = rainfall[-6:-3]  # Weeks from 6 to 2 weeks ago
              return sum(relevant_weeks) / len(relevant_weeks)
      - name: "disease_cases"
        target: True
        function: |
          def get_disease_cases(lagged_rainfall):
            return int(lagged_rainfall[-1] * 1.5)
    regions:
      - name: "Finnmark"
        region_id: 1
        rain_season:
          [
            [10, 15],
            [25, 35],
            [45, 50],
            [70, 90],
            [110, 115],
            [130, 135],
            [150, 155],
            [175, 185],
          ]
  - id: 2
    inherits: 1
    simulation_name: "disease_cases = lagged_rainfall 2-4 weeks (spikes)"
    features:
      - name: "lagged_rainfall"
        function: |
          def get_lagged_rainfall(rainfall):
            if len(rainfall) < 4:
                return rainfall[-1]
            relevant_weeks = rainfall[-4:-2]
            return sum(relevant_weeks) / len(relevant_weeks)
  - id: 3
    inherits: 1
    simulation_name: "disease_cases = lagged_rainfall 1-3 weeks (spikes)"
    features:
      - name: "lagged_rainfall"
        function: |
          def get_lagged_rainfall(rainfall):
            if len(rainfall) < 3:
                return rainfall[-1]
            relevant_weeks = rainfall[-3:-1]
            return sum(relevant_weeks) / len(relevant_weeks)
  - id: 4
    inherits: 1
    simulation_name: "disease_cases = lagged_temperature 3-6 weeks (spikes)"
    features:
      - name: "rainfall"
        function: |
          def get_rainfall():
            return 10
      - name: "mean_temperature"
        function: |
          def get_temperature(i):
            spikes = [10,30,50,70,90,110,130,150,170,190]
            if i in spikes:
              return 50
            return 1
      - name: "lagged_mean_temperature"
        function: |
          def get_lagged_temperature(mean_temperature):
            if len(mean_temperature) < 6:
                return mean_temperature[-1]
            relevant_weeks = mean_temperature[-6:-3]
            return sum(relevant_weeks) / len(relevant_weeks)
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature):
            return int(lagged_mean_temperature[-1] * 1.5)
  - id: 5
    inherits: 4
    simulation_name: "disease_cases = lagged_temperature 2-4 weeks (spikes)"
    features:
      - name: "lagged_mean_temperature"
        function: |
          def get_lagged_temperature(mean_temperature):
            if len(mean_temperature) < 4:
                return mean_temperature[-1]
            relevant_weeks = mean_temperature[-4:-2]
            return sum(relevant_weeks) / len(relevant_weeks)
  - id: 6
    inherits: 4
    simulation_name: "disease_cases = lagged_temperature 1-3 weeks (spikes)"
    features:
      - name: "lagged_mean_temperature"
        function: |
          def get_lagged_temperature(mean_temperature):
            if len(mean_temperature) < 3:
                return mean_temperature[-1]
            relevant_weeks = mean_temperature[-3:-1]
            return sum(relevant_weeks) / len(relevant_weeks)
  - id: 7
    inherits: 1
    simulation_name: "disease_cases = lagged_rainfall 3-6 weeks (periods)"
    features:
      - name: "rainfall"
        function: |
          def get_rainfall(region, i):
            rain_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                rain_season = True
            if rain_season:
                return 50
            else:
                return 1
  - id: 8
    inherits: 2
    simulation_name: "disease_cases = lagged_rainfall 2-4 weeks (period)"
    features:
      - name: "rainfall"
        function: |
          def get_rainfall(region, i):
            rain_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                rain_season = True
            if rain_season:
                return 50
            else:
                return 1
  - id: 9
    inherits: 3
    simulation_name: "disease_cases = lagged_rainfall 1-3 weeks (period)"
    features:
      - name: "rainfall"
        function: |
          def get_rainfall(region, i):
            rain_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                rain_season = True
            if rain_season:
                return 50
            else:
                return 1
  - id: 10
    inherits: 4
    simulation_name: "disease_cases = lagged_temperature 3-6 weeks (periods)"
    features:
      - name: "mean_temperature"
        function: |
          def get_temp(region, i):
            high_temp_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                high_temp_season = True
            if high_temp_season:
                return 50
            else:
                return 1
  - id: 11
    inherits: 5
    simulation_name: "disease_cases = lagged_temperature 2-4 weeks (periods)"
    features:
      - name: "mean_temperature"
        function: |
          def get_temp(region, i):
            high_temp_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                high_temp_season = True
            if high_temp_season:
                return 50
            else:
                return 1
  - id: 12
    inherits: 6
    simulation_name: "disease_cases = lagged_temperature 1-3 weeks (periods)"
    features:
      - name: "mean_temperature"
        function: |
          def get_temp(region, i):
            high_temp_season = False
            for season in region.rain_season:
              if season.start <= i <= season.end:
                high_temp_season = True
            if high_temp_season:
                return 50
            else:
                return 1
  - id: 13
    inherits: 1
    simulation_name: "AR disease_cases = lagged_rainfall 3-6 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 14
    inherits: 2
    simulation_name: "AR disease_cases = lagged_rainfall 2-4 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 15
    inherits: 3
    simulation_name: "AR disease_cases = lagged_rainfall 1-3 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 16
    inherits: 4
    simulation_name: "AR disease_cases = lagged_temperature 3-6 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)
  - id: 17
    inherits: 5
    simulation_name: "AR disease_cases = lagged_temperature 2-4 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)
  - id: 18
    inherits: 6
    simulation_name: "AR disease_cases = lagged_mean_temperature 1-3 weeks (spikes)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)
  - id: 19
    inherits: 7
    simulation_name: "AR disease_cases = lagged_rainfall 3-6 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 20
    inherits: 8
    simulation_name: "AR disease_cases = lagged_rainfall 2-4 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 21
    inherits: 9
    simulation_name: "AR disease_cases = lagged_rainfall 1-3 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_rainfall, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_rainfall[-1] * 1.5)
  - id: 22
    inherits: 10
    simulation_name: "AR disease_cases = lagged_mean_temperature 3-6 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)
  - id: 23
    inherits: 11
    simulation_name: "AR disease_cases = lagged_mean_temperature 2-4 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)
  - id: 24
    inherits: 12
    simulation_name: "AR disease_cases = lagged_mean_temperature 1-3 weeks (period)"
    features:
      - name: "disease_cases"
        function: |
          def get_disease_cases(lagged_mean_temperature, disease_cases, population):
            dc = disease_cases[-1] * 0.5
            if (len(disease_cases) > 1):
              dc+= disease_cases[-2] * 0.3

            return int(dc + lagged_mean_temperature[-1] * 1.5)

evaluators:
  - time_granularity: "W"
    prediction_length: 12
    model: "https://github.com/sandvelab/chap_auto_ewars_weekly@737446a7accf61725d4fe0ffee009a682e7457f6"
    stride: 11
    n_test_sets: 3
  - model: "models/weekly_ar_model"
    time_granularity: "W"
    n_test_sets: 3
    stride: 11
    prediction_lengt: 12
